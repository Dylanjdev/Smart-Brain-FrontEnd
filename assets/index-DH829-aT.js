var nk=(r,t)=>()=>(t||r((t={exports:{}}).exports,t),t.exports);var a8=nk((o8,eA)=>{(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function e(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(a){if(a.ep)return;a.ep=!0;const i=e(a);fetch(a.href,i)}})();function Rd(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Zv={exports:{}},gc={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _1;function rk(){if(_1)return gc;_1=1;var r=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function e(n,a,i){var o=null;if(i!==void 0&&(o=""+i),a.key!==void 0&&(o=""+a.key),"key"in a){i={};for(var u in a)u!=="key"&&(i[u]=a[u])}else i=a;return a=i.ref,{$$typeof:r,type:n,key:o,ref:a!==void 0?a:null,props:i}}return gc.Fragment=t,gc.jsx=e,gc.jsxs=e,gc}var A1;function ak(){return A1||(A1=1,Zv.exports=rk()),Zv.exports}var It=ak(),$v={exports:{}},T1;function ik(){if(T1)return $v.exports;T1=1;var r=$v.exports={},t,e;function n(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?t=setTimeout:t=n}catch{t=n}try{typeof clearTimeout=="function"?e=clearTimeout:e=a}catch{e=a}})();function i(b){if(t===setTimeout)return setTimeout(b,0);if((t===n||!t)&&setTimeout)return t=setTimeout,setTimeout(b,0);try{return t(b,0)}catch{try{return t.call(null,b,0)}catch{return t.call(this,b,0)}}}function o(b){if(e===clearTimeout)return clearTimeout(b);if((e===a||!e)&&clearTimeout)return e=clearTimeout,clearTimeout(b);try{return e(b)}catch{try{return e.call(null,b)}catch{return e.call(this,b)}}}var u=[],l=!1,h,f=-1;function p(){!l||!h||(l=!1,h.length?u=h.concat(u):f=-1,u.length&&v())}function v(){if(!l){var b=i(p);l=!0;for(var E=u.length;E;){for(h=u,u=[];++f<E;)h&&h[f].run();f=-1,E=u.length}h=null,l=!1,o(b)}}r.nextTick=function(b){var E=new Array(arguments.length-1);if(arguments.length>1)for(var C=1;C<arguments.length;C++)E[C-1]=arguments[C];u.push(new m(b,E)),u.length===1&&!l&&i(v)};function m(b,E){this.fun=b,this.array=E}m.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={};function x(){}return r.on=x,r.addListener=x,r.once=x,r.off=x,r.removeListener=x,r.removeAllListeners=x,r.emit=x,r.prependListener=x,r.prependOnceListener=x,r.listeners=function(b){return[]},r.binding=function(b){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(b){throw new Error("process.chdir is not supported")},r.umask=function(){return 0},$v.exports}var ok=ik();const ME=Rd(ok);var Jv={exports:{}},ne={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var k1;function uk(){if(k1)return ne;k1=1;var r=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),e=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),i=Symbol.for("react.consumer"),o=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),f=Symbol.for("react.lazy"),p=Symbol.iterator;function v(B){return B===null||typeof B!="object"?null:(B=p&&B[p]||B["@@iterator"],typeof B=="function"?B:null)}var m={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},x=Object.assign,b={};function E(B,$,ht){this.props=B,this.context=$,this.refs=b,this.updater=ht||m}E.prototype.isReactComponent={},E.prototype.setState=function(B,$){if(typeof B!="object"&&typeof B!="function"&&B!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,B,$,"setState")},E.prototype.forceUpdate=function(B){this.updater.enqueueForceUpdate(this,B,"forceUpdate")};function C(){}C.prototype=E.prototype;function R(B,$,ht){this.props=B,this.context=$,this.refs=b,this.updater=ht||m}var _=R.prototype=new C;_.constructor=R,x(_,E.prototype),_.isPureReactComponent=!0;var A=Array.isArray,k={H:null,A:null,T:null,S:null,V:null},D=Object.prototype.hasOwnProperty;function P(B,$,ht,ft,xt,wt){return ht=wt.ref,{$$typeof:r,type:B,key:$,ref:ht!==void 0?ht:null,props:wt}}function M(B,$){return P(B.type,$,void 0,void 0,void 0,B.props)}function O(B){return typeof B=="object"&&B!==null&&B.$$typeof===r}function F(B){var $={"=":"=0",":":"=2"};return"$"+B.replace(/[=:]/g,function(ht){return $[ht]})}var W=/\/+/g;function j(B,$){return typeof B=="object"&&B!==null&&B.key!=null?F(""+B.key):$.toString(36)}function ot(){}function nt(B){switch(B.status){case"fulfilled":return B.value;case"rejected":throw B.reason;default:switch(typeof B.status=="string"?B.then(ot,ot):(B.status="pending",B.then(function($){B.status==="pending"&&(B.status="fulfilled",B.value=$)},function($){B.status==="pending"&&(B.status="rejected",B.reason=$)})),B.status){case"fulfilled":return B.value;case"rejected":throw B.reason}}throw B}function at(B,$,ht,ft,xt){var wt=typeof B;(wt==="undefined"||wt==="boolean")&&(B=null);var Rt=!1;if(B===null)Rt=!0;else switch(wt){case"bigint":case"string":case"number":Rt=!0;break;case"object":switch(B.$$typeof){case r:case t:Rt=!0;break;case f:return Rt=B._init,at(Rt(B._payload),$,ht,ft,xt)}}if(Rt)return xt=xt(B),Rt=ft===""?"."+j(B,0):ft,A(xt)?(ht="",Rt!=null&&(ht=Rt.replace(W,"$&/")+"/"),at(xt,$,ht,"",function(Pt){return Pt})):xt!=null&&(O(xt)&&(xt=M(xt,ht+(xt.key==null||B&&B.key===xt.key?"":(""+xt.key).replace(W,"$&/")+"/")+Rt)),$.push(xt)),1;Rt=0;var Dt=ft===""?".":ft+":";if(A(B))for(var _t=0;_t<B.length;_t++)ft=B[_t],wt=Dt+j(ft,_t),Rt+=at(ft,$,ht,wt,xt);else if(_t=v(B),typeof _t=="function")for(B=_t.call(B),_t=0;!(ft=B.next()).done;)ft=ft.value,wt=Dt+j(ft,_t++),Rt+=at(ft,$,ht,wt,xt);else if(wt==="object"){if(typeof B.then=="function")return at(nt(B),$,ht,ft,xt);throw $=String(B),Error("Objects are not valid as a React child (found: "+($==="[object Object]"?"object with keys {"+Object.keys(B).join(", ")+"}":$)+"). If you meant to render a collection of children, use an array instead.")}return Rt}function V(B,$,ht){if(B==null)return B;var ft=[],xt=0;return at(B,ft,"","",function(wt){return $.call(ht,wt,xt++)}),ft}function X(B){if(B._status===-1){var $=B._result;$=$(),$.then(function(ht){(B._status===0||B._status===-1)&&(B._status=1,B._result=ht)},function(ht){(B._status===0||B._status===-1)&&(B._status=2,B._result=ht)}),B._status===-1&&(B._status=0,B._result=$)}if(B._status===1)return B._result.default;throw B._result}var Q=typeof reportError=="function"?reportError:function(B){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var $=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof B=="object"&&B!==null&&typeof B.message=="string"?String(B.message):String(B),error:B});if(!window.dispatchEvent($))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",B);return}console.error(B)};function ut(){}return ne.Children={map:V,forEach:function(B,$,ht){V(B,function(){$.apply(this,arguments)},ht)},count:function(B){var $=0;return V(B,function(){$++}),$},toArray:function(B){return V(B,function($){return $})||[]},only:function(B){if(!O(B))throw Error("React.Children.only expected to receive a single React element child.");return B}},ne.Component=E,ne.Fragment=e,ne.Profiler=a,ne.PureComponent=R,ne.StrictMode=n,ne.Suspense=l,ne.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=k,ne.__COMPILER_RUNTIME={__proto__:null,c:function(B){return k.H.useMemoCache(B)}},ne.cache=function(B){return function(){return B.apply(null,arguments)}},ne.cloneElement=function(B,$,ht){if(B==null)throw Error("The argument must be a React element, but you passed "+B+".");var ft=x({},B.props),xt=B.key,wt=void 0;if($!=null)for(Rt in $.ref!==void 0&&(wt=void 0),$.key!==void 0&&(xt=""+$.key),$)!D.call($,Rt)||Rt==="key"||Rt==="__self"||Rt==="__source"||Rt==="ref"&&$.ref===void 0||(ft[Rt]=$[Rt]);var Rt=arguments.length-2;if(Rt===1)ft.children=ht;else if(1<Rt){for(var Dt=Array(Rt),_t=0;_t<Rt;_t++)Dt[_t]=arguments[_t+2];ft.children=Dt}return P(B.type,xt,void 0,void 0,wt,ft)},ne.createContext=function(B){return B={$$typeof:o,_currentValue:B,_currentValue2:B,_threadCount:0,Provider:null,Consumer:null},B.Provider=B,B.Consumer={$$typeof:i,_context:B},B},ne.createElement=function(B,$,ht){var ft,xt={},wt=null;if($!=null)for(ft in $.key!==void 0&&(wt=""+$.key),$)D.call($,ft)&&ft!=="key"&&ft!=="__self"&&ft!=="__source"&&(xt[ft]=$[ft]);var Rt=arguments.length-2;if(Rt===1)xt.children=ht;else if(1<Rt){for(var Dt=Array(Rt),_t=0;_t<Rt;_t++)Dt[_t]=arguments[_t+2];xt.children=Dt}if(B&&B.defaultProps)for(ft in Rt=B.defaultProps,Rt)xt[ft]===void 0&&(xt[ft]=Rt[ft]);return P(B,wt,void 0,void 0,null,xt)},ne.createRef=function(){return{current:null}},ne.forwardRef=function(B){return{$$typeof:u,render:B}},ne.isValidElement=O,ne.lazy=function(B){return{$$typeof:f,_payload:{_status:-1,_result:B},_init:X}},ne.memo=function(B,$){return{$$typeof:h,type:B,compare:$===void 0?null:$}},ne.startTransition=function(B){var $=k.T,ht={};k.T=ht;try{var ft=B(),xt=k.S;xt!==null&&xt(ht,ft),typeof ft=="object"&&ft!==null&&typeof ft.then=="function"&&ft.then(ut,Q)}catch(wt){Q(wt)}finally{k.T=$}},ne.unstable_useCacheRefresh=function(){return k.H.useCacheRefresh()},ne.use=function(B){return k.H.use(B)},ne.useActionState=function(B,$,ht){return k.H.useActionState(B,$,ht)},ne.useCallback=function(B,$){return k.H.useCallback(B,$)},ne.useContext=function(B){return k.H.useContext(B)},ne.useDebugValue=function(){},ne.useDeferredValue=function(B,$){return k.H.useDeferredValue(B,$)},ne.useEffect=function(B,$,ht){var ft=k.H;if(typeof ht=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return ft.useEffect(B,$)},ne.useId=function(){return k.H.useId()},ne.useImperativeHandle=function(B,$,ht){return k.H.useImperativeHandle(B,$,ht)},ne.useInsertionEffect=function(B,$){return k.H.useInsertionEffect(B,$)},ne.useLayoutEffect=function(B,$){return k.H.useLayoutEffect(B,$)},ne.useMemo=function(B,$){return k.H.useMemo(B,$)},ne.useOptimistic=function(B,$){return k.H.useOptimistic(B,$)},ne.useReducer=function(B,$,ht){return k.H.useReducer(B,$,ht)},ne.useRef=function(B){return k.H.useRef(B)},ne.useState=function(B){return k.H.useState(B)},ne.useSyncExternalStore=function(B,$,ht){return k.H.useSyncExternalStore(B,$,ht)},ne.useTransition=function(){return k.H.useTransition()},ne.version="19.1.1",ne}var D1;function Bg(){return D1||(D1=1,Jv.exports=uk()),Jv.exports}var Lc=Bg();const Kt=Rd(Lc);var tm={exports:{}},yc={},em={exports:{}},nm={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var I1;function sk(){return I1||(I1=1,(function(r){function t(V,X){var Q=V.length;V.push(X);t:for(;0<Q;){var ut=Q-1>>>1,B=V[ut];if(0<a(B,X))V[ut]=X,V[Q]=B,Q=ut;else break t}}function e(V){return V.length===0?null:V[0]}function n(V){if(V.length===0)return null;var X=V[0],Q=V.pop();if(Q!==X){V[0]=Q;t:for(var ut=0,B=V.length,$=B>>>1;ut<$;){var ht=2*(ut+1)-1,ft=V[ht],xt=ht+1,wt=V[xt];if(0>a(ft,Q))xt<B&&0>a(wt,ft)?(V[ut]=wt,V[xt]=Q,ut=xt):(V[ut]=ft,V[ht]=Q,ut=ht);else if(xt<B&&0>a(wt,Q))V[ut]=wt,V[xt]=Q,ut=xt;else break t}}return X}function a(V,X){var Q=V.sortIndex-X.sortIndex;return Q!==0?Q:V.id-X.id}if(r.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var i=performance;r.unstable_now=function(){return i.now()}}else{var o=Date,u=o.now();r.unstable_now=function(){return o.now()-u}}var l=[],h=[],f=1,p=null,v=3,m=!1,x=!1,b=!1,E=!1,C=typeof setTimeout=="function"?setTimeout:null,R=typeof clearTimeout=="function"?clearTimeout:null,_=typeof setImmediate<"u"?setImmediate:null;function A(V){for(var X=e(h);X!==null;){if(X.callback===null)n(h);else if(X.startTime<=V)n(h),X.sortIndex=X.expirationTime,t(l,X);else break;X=e(h)}}function k(V){if(b=!1,A(V),!x)if(e(l)!==null)x=!0,D||(D=!0,j());else{var X=e(h);X!==null&&at(k,X.startTime-V)}}var D=!1,P=-1,M=5,O=-1;function F(){return E?!0:!(r.unstable_now()-O<M)}function W(){if(E=!1,D){var V=r.unstable_now();O=V;var X=!0;try{t:{x=!1,b&&(b=!1,R(P),P=-1),m=!0;var Q=v;try{e:{for(A(V),p=e(l);p!==null&&!(p.expirationTime>V&&F());){var ut=p.callback;if(typeof ut=="function"){p.callback=null,v=p.priorityLevel;var B=ut(p.expirationTime<=V);if(V=r.unstable_now(),typeof B=="function"){p.callback=B,A(V),X=!0;break e}p===e(l)&&n(l),A(V)}else n(l);p=e(l)}if(p!==null)X=!0;else{var $=e(h);$!==null&&at(k,$.startTime-V),X=!1}}break t}finally{p=null,v=Q,m=!1}X=void 0}}finally{X?j():D=!1}}}var j;if(typeof _=="function")j=function(){_(W)};else if(typeof MessageChannel<"u"){var ot=new MessageChannel,nt=ot.port2;ot.port1.onmessage=W,j=function(){nt.postMessage(null)}}else j=function(){C(W,0)};function at(V,X){P=C(function(){V(r.unstable_now())},X)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(V){V.callback=null},r.unstable_forceFrameRate=function(V){0>V||125<V?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):M=0<V?Math.floor(1e3/V):5},r.unstable_getCurrentPriorityLevel=function(){return v},r.unstable_next=function(V){switch(v){case 1:case 2:case 3:var X=3;break;default:X=v}var Q=v;v=X;try{return V()}finally{v=Q}},r.unstable_requestPaint=function(){E=!0},r.unstable_runWithPriority=function(V,X){switch(V){case 1:case 2:case 3:case 4:case 5:break;default:V=3}var Q=v;v=V;try{return X()}finally{v=Q}},r.unstable_scheduleCallback=function(V,X,Q){var ut=r.unstable_now();switch(typeof Q=="object"&&Q!==null?(Q=Q.delay,Q=typeof Q=="number"&&0<Q?ut+Q:ut):Q=ut,V){case 1:var B=-1;break;case 2:B=250;break;case 5:B=1073741823;break;case 4:B=1e4;break;default:B=5e3}return B=Q+B,V={id:f++,callback:X,priorityLevel:V,startTime:Q,expirationTime:B,sortIndex:-1},Q>ut?(V.sortIndex=Q,t(h,V),e(l)===null&&V===e(h)&&(b?(R(P),P=-1):b=!0,at(k,Q-ut))):(V.sortIndex=B,t(l,V),x||m||(x=!0,D||(D=!0,j()))),V},r.unstable_shouldYield=F,r.unstable_wrapCallback=function(V){var X=v;return function(){var Q=v;v=X;try{return V.apply(this,arguments)}finally{v=Q}}}})(nm)),nm}var N1;function lk(){return N1||(N1=1,em.exports=sk()),em.exports}var rm={exports:{}},tr={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var O1;function ck(){if(O1)return tr;O1=1;var r=Bg();function t(l){var h="https://react.dev/errors/"+l;if(1<arguments.length){h+="?args[]="+encodeURIComponent(arguments[1]);for(var f=2;f<arguments.length;f++)h+="&args[]="+encodeURIComponent(arguments[f])}return"Minified React error #"+l+"; visit "+h+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function e(){}var n={d:{f:e,r:function(){throw Error(t(522))},D:e,C:e,L:e,m:e,X:e,S:e,M:e},p:0,findDOMNode:null},a=Symbol.for("react.portal");function i(l,h,f){var p=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:a,key:p==null?null:""+p,children:l,containerInfo:h,implementation:f}}var o=r.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function u(l,h){if(l==="font")return"";if(typeof h=="string")return h==="use-credentials"?h:""}return tr.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=n,tr.createPortal=function(l,h){var f=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11)throw Error(t(299));return i(l,h,null,f)},tr.flushSync=function(l){var h=o.T,f=n.p;try{if(o.T=null,n.p=2,l)return l()}finally{o.T=h,n.p=f,n.d.f()}},tr.preconnect=function(l,h){typeof l=="string"&&(h?(h=h.crossOrigin,h=typeof h=="string"?h==="use-credentials"?h:"":void 0):h=null,n.d.C(l,h))},tr.prefetchDNS=function(l){typeof l=="string"&&n.d.D(l)},tr.preinit=function(l,h){if(typeof l=="string"&&h&&typeof h.as=="string"){var f=h.as,p=u(f,h.crossOrigin),v=typeof h.integrity=="string"?h.integrity:void 0,m=typeof h.fetchPriority=="string"?h.fetchPriority:void 0;f==="style"?n.d.S(l,typeof h.precedence=="string"?h.precedence:void 0,{crossOrigin:p,integrity:v,fetchPriority:m}):f==="script"&&n.d.X(l,{crossOrigin:p,integrity:v,fetchPriority:m,nonce:typeof h.nonce=="string"?h.nonce:void 0})}},tr.preinitModule=function(l,h){if(typeof l=="string")if(typeof h=="object"&&h!==null){if(h.as==null||h.as==="script"){var f=u(h.as,h.crossOrigin);n.d.M(l,{crossOrigin:f,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0})}}else h==null&&n.d.M(l)},tr.preload=function(l,h){if(typeof l=="string"&&typeof h=="object"&&h!==null&&typeof h.as=="string"){var f=h.as,p=u(f,h.crossOrigin);n.d.L(l,f,{crossOrigin:p,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0,type:typeof h.type=="string"?h.type:void 0,fetchPriority:typeof h.fetchPriority=="string"?h.fetchPriority:void 0,referrerPolicy:typeof h.referrerPolicy=="string"?h.referrerPolicy:void 0,imageSrcSet:typeof h.imageSrcSet=="string"?h.imageSrcSet:void 0,imageSizes:typeof h.imageSizes=="string"?h.imageSizes:void 0,media:typeof h.media=="string"?h.media:void 0})}},tr.preloadModule=function(l,h){if(typeof l=="string")if(h){var f=u(h.as,h.crossOrigin);n.d.m(l,{as:typeof h.as=="string"&&h.as!=="script"?h.as:void 0,crossOrigin:f,integrity:typeof h.integrity=="string"?h.integrity:void 0})}else n.d.m(l)},tr.requestFormReset=function(l){n.d.r(l)},tr.unstable_batchedUpdates=function(l,h){return l(h)},tr.useFormState=function(l,h,f){return o.H.useFormState(l,h,f)},tr.useFormStatus=function(){return o.H.useHostTransitionStatus()},tr.version="19.1.1",tr}var M1;function hk(){if(M1)return rm.exports;M1=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(t){console.error(t)}}return r(),rm.exports=ck(),rm.exports}var B1;function fk(){if(B1)return yc;B1=1;/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var r=lk(),t=Bg(),e=hk();function n(s){var c="https://react.dev/errors/"+s;if(1<arguments.length){c+="?args[]="+encodeURIComponent(arguments[1]);for(var d=2;d<arguments.length;d++)c+="&args[]="+encodeURIComponent(arguments[d])}return"Minified React error #"+s+"; visit "+c+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function a(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11)}function i(s){var c=s,d=s;if(s.alternate)for(;c.return;)c=c.return;else{s=c;do c=s,(c.flags&4098)!==0&&(d=c.return),s=c.return;while(s)}return c.tag===3?d:null}function o(s){if(s.tag===13){var c=s.memoizedState;if(c===null&&(s=s.alternate,s!==null&&(c=s.memoizedState)),c!==null)return c.dehydrated}return null}function u(s){if(i(s)!==s)throw Error(n(188))}function l(s){var c=s.alternate;if(!c){if(c=i(s),c===null)throw Error(n(188));return c!==s?null:s}for(var d=s,g=c;;){var w=d.return;if(w===null)break;var S=w.alternate;if(S===null){if(g=w.return,g!==null){d=g;continue}break}if(w.child===S.child){for(S=w.child;S;){if(S===d)return u(w),s;if(S===g)return u(w),c;S=S.sibling}throw Error(n(188))}if(d.return!==g.return)d=w,g=S;else{for(var N=!1,L=w.child;L;){if(L===d){N=!0,d=w,g=S;break}if(L===g){N=!0,g=w,d=S;break}L=L.sibling}if(!N){for(L=S.child;L;){if(L===d){N=!0,d=S,g=w;break}if(L===g){N=!0,g=S,d=w;break}L=L.sibling}if(!N)throw Error(n(189))}}if(d.alternate!==g)throw Error(n(190))}if(d.tag!==3)throw Error(n(188));return d.stateNode.current===d?s:c}function h(s){var c=s.tag;if(c===5||c===26||c===27||c===6)return s;for(s=s.child;s!==null;){if(c=h(s),c!==null)return c;s=s.sibling}return null}var f=Object.assign,p=Symbol.for("react.element"),v=Symbol.for("react.transitional.element"),m=Symbol.for("react.portal"),x=Symbol.for("react.fragment"),b=Symbol.for("react.strict_mode"),E=Symbol.for("react.profiler"),C=Symbol.for("react.provider"),R=Symbol.for("react.consumer"),_=Symbol.for("react.context"),A=Symbol.for("react.forward_ref"),k=Symbol.for("react.suspense"),D=Symbol.for("react.suspense_list"),P=Symbol.for("react.memo"),M=Symbol.for("react.lazy"),O=Symbol.for("react.activity"),F=Symbol.for("react.memo_cache_sentinel"),W=Symbol.iterator;function j(s){return s===null||typeof s!="object"?null:(s=W&&s[W]||s["@@iterator"],typeof s=="function"?s:null)}var ot=Symbol.for("react.client.reference");function nt(s){if(s==null)return null;if(typeof s=="function")return s.$$typeof===ot?null:s.displayName||s.name||null;if(typeof s=="string")return s;switch(s){case x:return"Fragment";case E:return"Profiler";case b:return"StrictMode";case k:return"Suspense";case D:return"SuspenseList";case O:return"Activity"}if(typeof s=="object")switch(s.$$typeof){case m:return"Portal";case _:return(s.displayName||"Context")+".Provider";case R:return(s._context.displayName||"Context")+".Consumer";case A:var c=s.render;return s=s.displayName,s||(s=c.displayName||c.name||"",s=s!==""?"ForwardRef("+s+")":"ForwardRef"),s;case P:return c=s.displayName||null,c!==null?c:nt(s.type)||"Memo";case M:c=s._payload,s=s._init;try{return nt(s(c))}catch{}}return null}var at=Array.isArray,V=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,X=e.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Q={pending:!1,data:null,method:null,action:null},ut=[],B=-1;function $(s){return{current:s}}function ht(s){0>B||(s.current=ut[B],ut[B]=null,B--)}function ft(s,c){B++,ut[B]=s.current,s.current=c}var xt=$(null),wt=$(null),Rt=$(null),Dt=$(null);function _t(s,c){switch(ft(Rt,c),ft(wt,s),ft(xt,null),c.nodeType){case 9:case 11:s=(s=c.documentElement)&&(s=s.namespaceURI)?t1(s):0;break;default:if(s=c.tagName,c=c.namespaceURI)c=t1(c),s=e1(c,s);else switch(s){case"svg":s=1;break;case"math":s=2;break;default:s=0}}ht(xt),ft(xt,s)}function Pt(){ht(xt),ht(wt),ht(Rt)}function jt(s){s.memoizedState!==null&&ft(Dt,s);var c=xt.current,d=e1(c,s.type);c!==d&&(ft(wt,s),ft(xt,d))}function Ft(s){wt.current===s&&(ht(xt),ht(wt)),Dt.current===s&&(ht(Dt),fc._currentValue=Q)}var Wt=Object.prototype.hasOwnProperty,Gt=r.unstable_scheduleCallback,$t=r.unstable_cancelCallback,ue=r.unstable_shouldYield,de=r.unstable_requestPaint,Te=r.unstable_now,je=r.unstable_getCurrentPriorityLevel,Se=r.unstable_ImmediatePriority,vn=r.unstable_UserBlockingPriority,Xe=r.unstable_NormalPriority,Ge=r.unstable_LowPriority,ln=r.unstable_IdlePriority,Gn=r.log,Nn=r.unstable_setDisableYieldValue,On=null,Be=null;function Fe(s){if(typeof Gn=="function"&&Nn(s),Be&&typeof Be.setStrictMode=="function")try{Be.setStrictMode(On,s)}catch{}}var En=Math.clz32?Math.clz32:Ha,Ga=Math.log,El=Math.LN2;function Ha(s){return s>>>=0,s===0?32:31-(Ga(s)/El|0)|0}var qa=256,ur=4194304;function Dr(s){var c=s&42;if(c!==0)return c;switch(s&-s){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return s&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return s}}function Ca(s,c,d){var g=s.pendingLanes;if(g===0)return 0;var w=0,S=s.suspendedLanes,N=s.pingedLanes;s=s.warmLanes;var L=g&134217727;return L!==0?(g=L&~S,g!==0?w=Dr(g):(N&=L,N!==0?w=Dr(N):d||(d=L&~s,d!==0&&(w=Dr(d))))):(L=g&~S,L!==0?w=Dr(L):N!==0?w=Dr(N):d||(d=g&~s,d!==0&&(w=Dr(d)))),w===0?0:c!==0&&c!==w&&(c&S)===0&&(S=w&-w,d=c&-c,S>=d||S===32&&(d&4194048)!==0)?c:w}function Cn(s,c){return(s.pendingLanes&~(s.suspendedLanes&~s.pingedLanes)&c)===0}function es(s,c){switch(s){case 1:case 2:case 4:case 8:case 64:return c+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return c+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Cl(){var s=qa;return qa<<=1,(qa&4194048)===0&&(qa=256),s}function Sa(){var s=ur;return ur<<=1,(ur&62914560)===0&&(ur=4194304),s}function ns(s){for(var c=[],d=0;31>d;d++)c.push(s);return c}function mr(s,c){s.pendingLanes|=c,c!==268435456&&(s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0)}function Qd(s,c,d,g,w,S){var N=s.pendingLanes;s.pendingLanes=d,s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0,s.expiredLanes&=d,s.entangledLanes&=d,s.errorRecoveryDisabledLanes&=d,s.shellSuspendCounter=0;var L=s.entanglements,K=s.expirationTimes,ct=s.hiddenUpdates;for(d=N&~d;0<d;){var bt=31-En(d),Ct=1<<bt;L[bt]=0,K[bt]=-1;var dt=ct[bt];if(dt!==null)for(ct[bt]=null,bt=0;bt<dt.length;bt++){var pt=dt[bt];pt!==null&&(pt.lane&=-536870913)}d&=~Ct}g!==0&&Ra(s,g,0),S!==0&&w===0&&s.tag!==0&&(s.suspendedLanes|=S&~(N&~c))}function Ra(s,c,d){s.pendingLanes|=c,s.suspendedLanes&=~c;var g=31-En(c);s.entangledLanes|=c,s.entanglements[g]=s.entanglements[g]|1073741824|d&4194090}function lh(s,c){var d=s.entangledLanes|=c;for(s=s.entanglements;d;){var g=31-En(d),w=1<<g;w&c|s[g]&c&&(s[g]|=c),d&=~w}}function na(s){switch(s){case 2:s=1;break;case 8:s=4;break;case 32:s=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:s=128;break;case 268435456:s=134217728;break;default:s=0}return s}function Sl(s){return s&=-s,2<s?8<s?(s&134217727)!==0?32:268435456:8:2}function _a(){var s=X.p;return s!==0?s:(s=window.event,s===void 0?32:b1(s.type))}function Zd(s,c){var d=X.p;try{return X.p=s,c()}finally{X.p=d}}var Hn=Math.random().toString(36).slice(2),Mn="__reactFiber$"+Hn,Ke="__reactProps$"+Hn,ho="__reactContainer$"+Hn,ra="__reactEvents$"+Hn,$d="__reactListeners$"+Hn,ja="__reactHandles$"+Hn,ch="__reactResources$"+Hn,gr="__reactMarker$"+Hn;function au(s){delete s[Mn],delete s[Ke],delete s[ra],delete s[$d],delete s[ja]}function fo(s){var c=s[Mn];if(c)return c;for(var d=s.parentNode;d;){if(c=d[ho]||d[Mn]){if(d=c.alternate,c.child!==null||d!==null&&d.child!==null)for(s=i1(s);s!==null;){if(d=s[Mn])return d;s=i1(s)}return c}s=d,d=s.parentNode}return null}function sr(s){if(s=s[Mn]||s[ho]){var c=s.tag;if(c===5||c===6||c===13||c===26||c===27||c===3)return s}return null}function iu(s){var c=s.tag;if(c===5||c===26||c===27||c===6)return s.stateNode;throw Error(n(33))}function lr(s){var c=s[ch];return c||(c=s[ch]={hoistableStyles:new Map,hoistableScripts:new Map}),c}function mn(s){s[gr]=!0}var Aa=new Set,hh={};function aa(s,c){Ir(s,c),Ir(s+"Capture",c)}function Ir(s,c){for(hh[s]=c,s=0;s<c.length;s++)Aa.add(c[s])}var Jd=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Ta={},fh={};function ia(s){return Wt.call(fh,s)?!0:Wt.call(Ta,s)?!1:Jd.test(s)?fh[s]=!0:(Ta[s]=!0,!1)}function yr(s,c,d){if(ia(c))if(d===null)s.removeAttribute(c);else{switch(typeof d){case"undefined":case"function":case"symbol":s.removeAttribute(c);return;case"boolean":var g=c.toLowerCase().slice(0,5);if(g!=="data-"&&g!=="aria-"){s.removeAttribute(c);return}}s.setAttribute(c,""+d)}}function po(s,c,d){if(d===null)s.removeAttribute(c);else{switch(typeof d){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(c);return}s.setAttribute(c,""+d)}}function ka(s,c,d,g){if(g===null)s.removeAttribute(d);else{switch(typeof g){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(d);return}s.setAttributeNS(c,d,""+g)}}var Xa,dh;function Nr(s){if(Xa===void 0)try{throw Error()}catch(d){var c=d.stack.trim().match(/\n( *(at )?)/);Xa=c&&c[1]||"",dh=-1<d.stack.indexOf(`
    at`)?" (<anonymous>)":-1<d.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Xa+s+dh}var Rl=!1;function Ka(s,c){if(!s||Rl)return"";Rl=!0;var d=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var g={DetermineComponentFrameRoot:function(){try{if(c){var Ct=function(){throw Error()};if(Object.defineProperty(Ct.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Ct,[])}catch(pt){var dt=pt}Reflect.construct(s,[],Ct)}else{try{Ct.call()}catch(pt){dt=pt}s.call(Ct.prototype)}}else{try{throw Error()}catch(pt){dt=pt}(Ct=s())&&typeof Ct.catch=="function"&&Ct.catch(function(){})}}catch(pt){if(pt&&dt&&typeof pt.stack=="string")return[pt.stack,dt.stack]}return[null,null]}};g.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var w=Object.getOwnPropertyDescriptor(g.DetermineComponentFrameRoot,"name");w&&w.configurable&&Object.defineProperty(g.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var S=g.DetermineComponentFrameRoot(),N=S[0],L=S[1];if(N&&L){var K=N.split(`
`),ct=L.split(`
`);for(w=g=0;g<K.length&&!K[g].includes("DetermineComponentFrameRoot");)g++;for(;w<ct.length&&!ct[w].includes("DetermineComponentFrameRoot");)w++;if(g===K.length||w===ct.length)for(g=K.length-1,w=ct.length-1;1<=g&&0<=w&&K[g]!==ct[w];)w--;for(;1<=g&&0<=w;g--,w--)if(K[g]!==ct[w]){if(g!==1||w!==1)do if(g--,w--,0>w||K[g]!==ct[w]){var bt=`
`+K[g].replace(" at new "," at ");return s.displayName&&bt.includes("<anonymous>")&&(bt=bt.replace("<anonymous>",s.displayName)),bt}while(1<=g&&0<=w);break}}}finally{Rl=!1,Error.prepareStackTrace=d}return(d=s?s.displayName||s.name:"")?Nr(d):""}function tp(s){switch(s.tag){case 26:case 27:case 5:return Nr(s.type);case 16:return Nr("Lazy");case 13:return Nr("Suspense");case 19:return Nr("SuspenseList");case 0:case 15:return Ka(s.type,!1);case 11:return Ka(s.type.render,!1);case 1:return Ka(s.type,!0);case 31:return Nr("Activity");default:return""}}function _i(s){try{var c="";do c+=tp(s),s=s.return;while(s);return c}catch(d){return`
Error generating stack: `+d.message+`
`+d.stack}}function Bn(s){switch(typeof s){case"bigint":case"boolean":case"number":case"string":case"undefined":return s;case"object":return s;default:return""}}function ph(s){var c=s.type;return(s=s.nodeName)&&s.toLowerCase()==="input"&&(c==="checkbox"||c==="radio")}function Ya(s){var c=ph(s)?"checked":"value",d=Object.getOwnPropertyDescriptor(s.constructor.prototype,c),g=""+s[c];if(!s.hasOwnProperty(c)&&typeof d<"u"&&typeof d.get=="function"&&typeof d.set=="function"){var w=d.get,S=d.set;return Object.defineProperty(s,c,{configurable:!0,get:function(){return w.call(this)},set:function(N){g=""+N,S.call(this,N)}}),Object.defineProperty(s,c,{enumerable:d.enumerable}),{getValue:function(){return g},setValue:function(N){g=""+N},stopTracking:function(){s._valueTracker=null,delete s[c]}}}}function rs(s){s._valueTracker||(s._valueTracker=Ya(s))}function as(s){if(!s)return!1;var c=s._valueTracker;if(!c)return!0;var d=c.getValue(),g="";return s&&(g=ph(s)?s.checked?"true":"false":s.value),s=g,s!==d?(c.setValue(s),!0):!1}function Or(s){if(s=s||(typeof document<"u"?document:void 0),typeof s>"u")return null;try{return s.activeElement||s.body}catch{return s.body}}var ou=/[\n"\\]/g;function cr(s){return s.replace(ou,function(c){return"\\"+c.charCodeAt(0).toString(16)+" "})}function Qa(s,c,d,g,w,S,N,L){s.name="",N!=null&&typeof N!="function"&&typeof N!="symbol"&&typeof N!="boolean"?s.type=N:s.removeAttribute("type"),c!=null?N==="number"?(c===0&&s.value===""||s.value!=c)&&(s.value=""+Bn(c)):s.value!==""+Bn(c)&&(s.value=""+Bn(c)):N!=="submit"&&N!=="reset"||s.removeAttribute("value"),c!=null?Za(s,N,Bn(c)):d!=null?Za(s,N,Bn(d)):g!=null&&s.removeAttribute("value"),w==null&&S!=null&&(s.defaultChecked=!!S),w!=null&&(s.checked=w&&typeof w!="function"&&typeof w!="symbol"),L!=null&&typeof L!="function"&&typeof L!="symbol"&&typeof L!="boolean"?s.name=""+Bn(L):s.removeAttribute("name")}function _l(s,c,d,g,w,S,N,L){if(S!=null&&typeof S!="function"&&typeof S!="symbol"&&typeof S!="boolean"&&(s.type=S),c!=null||d!=null){if(!(S!=="submit"&&S!=="reset"||c!=null))return;d=d!=null?""+Bn(d):"",c=c!=null?""+Bn(c):d,L||c===s.value||(s.value=c),s.defaultValue=c}g=g??w,g=typeof g!="function"&&typeof g!="symbol"&&!!g,s.checked=L?s.checked:!!g,s.defaultChecked=!!g,N!=null&&typeof N!="function"&&typeof N!="symbol"&&typeof N!="boolean"&&(s.name=N)}function Za(s,c,d){c==="number"&&Or(s.ownerDocument)===s||s.defaultValue===""+d||(s.defaultValue=""+d)}function Ai(s,c,d,g){if(s=s.options,c){c={};for(var w=0;w<d.length;w++)c["$"+d[w]]=!0;for(d=0;d<s.length;d++)w=c.hasOwnProperty("$"+s[d].value),s[d].selected!==w&&(s[d].selected=w),w&&g&&(s[d].defaultSelected=!0)}else{for(d=""+Bn(d),c=null,w=0;w<s.length;w++){if(s[w].value===d){s[w].selected=!0,g&&(s[w].defaultSelected=!0);return}c!==null||s[w].disabled||(c=s[w])}c!==null&&(c.selected=!0)}}function Ti(s,c,d){if(c!=null&&(c=""+Bn(c),c!==s.value&&(s.value=c),d==null)){s.defaultValue!==c&&(s.defaultValue=c);return}s.defaultValue=d!=null?""+Bn(d):""}function ki(s,c,d,g){if(c==null){if(g!=null){if(d!=null)throw Error(n(92));if(at(g)){if(1<g.length)throw Error(n(93));g=g[0]}d=g}d==null&&(d=""),c=d}d=Bn(c),s.defaultValue=d,g=s.textContent,g===d&&g!==""&&g!==null&&(s.value=g)}function y(s,c){if(c){var d=s.firstChild;if(d&&d===s.lastChild&&d.nodeType===3){d.nodeValue=c;return}}s.textContent=c}var T=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function I(s,c,d){var g=c.indexOf("--")===0;d==null||typeof d=="boolean"||d===""?g?s.setProperty(c,""):c==="float"?s.cssFloat="":s[c]="":g?s.setProperty(c,d):typeof d!="number"||d===0||T.has(c)?c==="float"?s.cssFloat=d:s[c]=(""+d).trim():s[c]=d+"px"}function U(s,c,d){if(c!=null&&typeof c!="object")throw Error(n(62));if(s=s.style,d!=null){for(var g in d)!d.hasOwnProperty(g)||c!=null&&c.hasOwnProperty(g)||(g.indexOf("--")===0?s.setProperty(g,""):g==="float"?s.cssFloat="":s[g]="");for(var w in c)g=c[w],c.hasOwnProperty(w)&&d[w]!==g&&I(s,w,g)}else for(var S in c)c.hasOwnProperty(S)&&I(s,S,c[S])}function J(s){if(s.indexOf("-")===-1)return!1;switch(s){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var At=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),$e=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Pn(s){return $e.test(""+s)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":s}var Je=null;function tn(s){return s=s.target||s.srcElement||window,s.correspondingUseElement&&(s=s.correspondingUseElement),s.nodeType===3?s.parentNode:s}var hr=null,cn=null;function Mr(s){var c=sr(s);if(c&&(s=c.stateNode)){var d=s[Ke]||null;t:switch(s=c.stateNode,c.type){case"input":if(Qa(s,d.value,d.defaultValue,d.defaultValue,d.checked,d.defaultChecked,d.type,d.name),c=d.name,d.type==="radio"&&c!=null){for(d=s;d.parentNode;)d=d.parentNode;for(d=d.querySelectorAll('input[name="'+cr(""+c)+'"][type="radio"]'),c=0;c<d.length;c++){var g=d[c];if(g!==s&&g.form===s.form){var w=g[Ke]||null;if(!w)throw Error(n(90));Qa(g,w.value,w.defaultValue,w.defaultValue,w.checked,w.defaultChecked,w.type,w.name)}}for(c=0;c<d.length;c++)g=d[c],g.form===s.form&&as(g)}break t;case"textarea":Ti(s,d.value,d.defaultValue);break t;case"select":c=d.value,c!=null&&Ai(s,!!d.multiple,c,!1)}}}var $a=!1;function Di(s,c,d){if($a)return s(c,d);$a=!0;try{var g=s(c);return g}finally{if($a=!1,(hr!==null||cn!==null)&&(Jh(),hr&&(c=hr,s=cn,cn=hr=null,Mr(c),s)))for(c=0;c<s.length;c++)Mr(s[c])}}function gn(s,c){var d=s.stateNode;if(d===null)return null;var g=d[Ke]||null;if(g===null)return null;d=g[c];t:switch(c){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(g=!g.disabled)||(s=s.type,g=!(s==="button"||s==="input"||s==="select"||s==="textarea")),s=!g;break t;default:s=!1}if(s)return null;if(d&&typeof d!="function")throw Error(n(231,c,typeof d));return d}var He=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),uu=!1;if(He)try{var Sn={};Object.defineProperty(Sn,"passive",{get:function(){uu=!0}}),window.addEventListener("test",Sn,Sn),window.removeEventListener("test",Sn,Sn)}catch{uu=!1}var en=null,ep=null,vh=null;function a0(){if(vh)return vh;var s,c=ep,d=c.length,g,w="value"in en?en.value:en.textContent,S=w.length;for(s=0;s<d&&c[s]===w[s];s++);var N=d-s;for(g=1;g<=N&&c[d-g]===w[S-g];g++);return vh=w.slice(s,1<g?1-g:void 0)}function mh(s){var c=s.keyCode;return"charCode"in s?(s=s.charCode,s===0&&c===13&&(s=13)):s=c,s===10&&(s=13),32<=s||s===13?s:0}function gh(){return!0}function i0(){return!1}function xr(s){function c(d,g,w,S,N){this._reactName=d,this._targetInst=w,this.type=g,this.nativeEvent=S,this.target=N,this.currentTarget=null;for(var L in s)s.hasOwnProperty(L)&&(d=s[L],this[L]=d?d(S):S[L]);return this.isDefaultPrevented=(S.defaultPrevented!=null?S.defaultPrevented:S.returnValue===!1)?gh:i0,this.isPropagationStopped=i0,this}return f(c.prototype,{preventDefault:function(){this.defaultPrevented=!0;var d=this.nativeEvent;d&&(d.preventDefault?d.preventDefault():typeof d.returnValue!="unknown"&&(d.returnValue=!1),this.isDefaultPrevented=gh)},stopPropagation:function(){var d=this.nativeEvent;d&&(d.stopPropagation?d.stopPropagation():typeof d.cancelBubble!="unknown"&&(d.cancelBubble=!0),this.isPropagationStopped=gh)},persist:function(){},isPersistent:gh}),c}var su={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(s){return s.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},yh=xr(su),Al=f({},su,{view:0,detail:0}),nA=xr(Al),np,rp,Tl,xh=f({},Al,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ip,button:0,buttons:0,relatedTarget:function(s){return s.relatedTarget===void 0?s.fromElement===s.srcElement?s.toElement:s.fromElement:s.relatedTarget},movementX:function(s){return"movementX"in s?s.movementX:(s!==Tl&&(Tl&&s.type==="mousemove"?(np=s.screenX-Tl.screenX,rp=s.screenY-Tl.screenY):rp=np=0,Tl=s),np)},movementY:function(s){return"movementY"in s?s.movementY:rp}}),o0=xr(xh),rA=f({},xh,{dataTransfer:0}),aA=xr(rA),iA=f({},Al,{relatedTarget:0}),ap=xr(iA),oA=f({},su,{animationName:0,elapsedTime:0,pseudoElement:0}),uA=xr(oA),sA=f({},su,{clipboardData:function(s){return"clipboardData"in s?s.clipboardData:window.clipboardData}}),lA=xr(sA),cA=f({},su,{data:0}),u0=xr(cA),hA={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},fA={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},dA={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function pA(s){var c=this.nativeEvent;return c.getModifierState?c.getModifierState(s):(s=dA[s])?!!c[s]:!1}function ip(){return pA}var vA=f({},Al,{key:function(s){if(s.key){var c=hA[s.key]||s.key;if(c!=="Unidentified")return c}return s.type==="keypress"?(s=mh(s),s===13?"Enter":String.fromCharCode(s)):s.type==="keydown"||s.type==="keyup"?fA[s.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ip,charCode:function(s){return s.type==="keypress"?mh(s):0},keyCode:function(s){return s.type==="keydown"||s.type==="keyup"?s.keyCode:0},which:function(s){return s.type==="keypress"?mh(s):s.type==="keydown"||s.type==="keyup"?s.keyCode:0}}),mA=xr(vA),gA=f({},xh,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),s0=xr(gA),yA=f({},Al,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ip}),xA=xr(yA),bA=f({},su,{propertyName:0,elapsedTime:0,pseudoElement:0}),wA=xr(bA),EA=f({},xh,{deltaX:function(s){return"deltaX"in s?s.deltaX:"wheelDeltaX"in s?-s.wheelDeltaX:0},deltaY:function(s){return"deltaY"in s?s.deltaY:"wheelDeltaY"in s?-s.wheelDeltaY:"wheelDelta"in s?-s.wheelDelta:0},deltaZ:0,deltaMode:0}),CA=xr(EA),SA=f({},su,{newState:0,oldState:0}),RA=xr(SA),_A=[9,13,27,32],op=He&&"CompositionEvent"in window,kl=null;He&&"documentMode"in document&&(kl=document.documentMode);var AA=He&&"TextEvent"in window&&!kl,l0=He&&(!op||kl&&8<kl&&11>=kl),c0=" ",h0=!1;function f0(s,c){switch(s){case"keyup":return _A.indexOf(c.keyCode)!==-1;case"keydown":return c.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function d0(s){return s=s.detail,typeof s=="object"&&"data"in s?s.data:null}var is=!1;function TA(s,c){switch(s){case"compositionend":return d0(c);case"keypress":return c.which!==32?null:(h0=!0,c0);case"textInput":return s=c.data,s===c0&&h0?null:s;default:return null}}function kA(s,c){if(is)return s==="compositionend"||!op&&f0(s,c)?(s=a0(),vh=ep=en=null,is=!1,s):null;switch(s){case"paste":return null;case"keypress":if(!(c.ctrlKey||c.altKey||c.metaKey)||c.ctrlKey&&c.altKey){if(c.char&&1<c.char.length)return c.char;if(c.which)return String.fromCharCode(c.which)}return null;case"compositionend":return l0&&c.locale!=="ko"?null:c.data;default:return null}}var DA={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function p0(s){var c=s&&s.nodeName&&s.nodeName.toLowerCase();return c==="input"?!!DA[s.type]:c==="textarea"}function v0(s,c,d,g){hr?cn?cn.push(g):cn=[g]:hr=g,c=of(c,"onChange"),0<c.length&&(d=new yh("onChange","change",null,d,g),s.push({event:d,listeners:c}))}var Dl=null,Il=null;function IA(s){Yb(s,0)}function bh(s){var c=iu(s);if(as(c))return s}function m0(s,c){if(s==="change")return c}var g0=!1;if(He){var up;if(He){var sp="oninput"in document;if(!sp){var y0=document.createElement("div");y0.setAttribute("oninput","return;"),sp=typeof y0.oninput=="function"}up=sp}else up=!1;g0=up&&(!document.documentMode||9<document.documentMode)}function x0(){Dl&&(Dl.detachEvent("onpropertychange",b0),Il=Dl=null)}function b0(s){if(s.propertyName==="value"&&bh(Il)){var c=[];v0(c,Il,s,tn(s)),Di(IA,c)}}function NA(s,c,d){s==="focusin"?(x0(),Dl=c,Il=d,Dl.attachEvent("onpropertychange",b0)):s==="focusout"&&x0()}function OA(s){if(s==="selectionchange"||s==="keyup"||s==="keydown")return bh(Il)}function MA(s,c){if(s==="click")return bh(c)}function BA(s,c){if(s==="input"||s==="change")return bh(c)}function PA(s,c){return s===c&&(s!==0||1/s===1/c)||s!==s&&c!==c}var Br=typeof Object.is=="function"?Object.is:PA;function Nl(s,c){if(Br(s,c))return!0;if(typeof s!="object"||s===null||typeof c!="object"||c===null)return!1;var d=Object.keys(s),g=Object.keys(c);if(d.length!==g.length)return!1;for(g=0;g<d.length;g++){var w=d[g];if(!Wt.call(c,w)||!Br(s[w],c[w]))return!1}return!0}function w0(s){for(;s&&s.firstChild;)s=s.firstChild;return s}function E0(s,c){var d=w0(s);s=0;for(var g;d;){if(d.nodeType===3){if(g=s+d.textContent.length,s<=c&&g>=c)return{node:d,offset:c-s};s=g}t:{for(;d;){if(d.nextSibling){d=d.nextSibling;break t}d=d.parentNode}d=void 0}d=w0(d)}}function C0(s,c){return s&&c?s===c?!0:s&&s.nodeType===3?!1:c&&c.nodeType===3?C0(s,c.parentNode):"contains"in s?s.contains(c):s.compareDocumentPosition?!!(s.compareDocumentPosition(c)&16):!1:!1}function S0(s){s=s!=null&&s.ownerDocument!=null&&s.ownerDocument.defaultView!=null?s.ownerDocument.defaultView:window;for(var c=Or(s.document);c instanceof s.HTMLIFrameElement;){try{var d=typeof c.contentWindow.location.href=="string"}catch{d=!1}if(d)s=c.contentWindow;else break;c=Or(s.document)}return c}function lp(s){var c=s&&s.nodeName&&s.nodeName.toLowerCase();return c&&(c==="input"&&(s.type==="text"||s.type==="search"||s.type==="tel"||s.type==="url"||s.type==="password")||c==="textarea"||s.contentEditable==="true")}var FA=He&&"documentMode"in document&&11>=document.documentMode,os=null,cp=null,Ol=null,hp=!1;function R0(s,c,d){var g=d.window===d?d.document:d.nodeType===9?d:d.ownerDocument;hp||os==null||os!==Or(g)||(g=os,"selectionStart"in g&&lp(g)?g={start:g.selectionStart,end:g.selectionEnd}:(g=(g.ownerDocument&&g.ownerDocument.defaultView||window).getSelection(),g={anchorNode:g.anchorNode,anchorOffset:g.anchorOffset,focusNode:g.focusNode,focusOffset:g.focusOffset}),Ol&&Nl(Ol,g)||(Ol=g,g=of(cp,"onSelect"),0<g.length&&(c=new yh("onSelect","select",null,c,d),s.push({event:c,listeners:g}),c.target=os)))}function lu(s,c){var d={};return d[s.toLowerCase()]=c.toLowerCase(),d["Webkit"+s]="webkit"+c,d["Moz"+s]="moz"+c,d}var us={animationend:lu("Animation","AnimationEnd"),animationiteration:lu("Animation","AnimationIteration"),animationstart:lu("Animation","AnimationStart"),transitionrun:lu("Transition","TransitionRun"),transitionstart:lu("Transition","TransitionStart"),transitioncancel:lu("Transition","TransitionCancel"),transitionend:lu("Transition","TransitionEnd")},fp={},_0={};He&&(_0=document.createElement("div").style,"AnimationEvent"in window||(delete us.animationend.animation,delete us.animationiteration.animation,delete us.animationstart.animation),"TransitionEvent"in window||delete us.transitionend.transition);function cu(s){if(fp[s])return fp[s];if(!us[s])return s;var c=us[s],d;for(d in c)if(c.hasOwnProperty(d)&&d in _0)return fp[s]=c[d];return s}var A0=cu("animationend"),T0=cu("animationiteration"),k0=cu("animationstart"),LA=cu("transitionrun"),zA=cu("transitionstart"),UA=cu("transitioncancel"),D0=cu("transitionend"),I0=new Map,dp="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");dp.push("scrollEnd");function Da(s,c){I0.set(s,c),aa(c,[s])}var N0=new WeakMap;function oa(s,c){if(typeof s=="object"&&s!==null){var d=N0.get(s);return d!==void 0?d:(c={value:s,source:c,stack:_i(c)},N0.set(s,c),c)}return{value:s,source:c,stack:_i(c)}}var ua=[],ss=0,pp=0;function wh(){for(var s=ss,c=pp=ss=0;c<s;){var d=ua[c];ua[c++]=null;var g=ua[c];ua[c++]=null;var w=ua[c];ua[c++]=null;var S=ua[c];if(ua[c++]=null,g!==null&&w!==null){var N=g.pending;N===null?w.next=w:(w.next=N.next,N.next=w),g.pending=w}S!==0&&O0(d,w,S)}}function Eh(s,c,d,g){ua[ss++]=s,ua[ss++]=c,ua[ss++]=d,ua[ss++]=g,pp|=g,s.lanes|=g,s=s.alternate,s!==null&&(s.lanes|=g)}function vp(s,c,d,g){return Eh(s,c,d,g),Ch(s)}function ls(s,c){return Eh(s,null,null,c),Ch(s)}function O0(s,c,d){s.lanes|=d;var g=s.alternate;g!==null&&(g.lanes|=d);for(var w=!1,S=s.return;S!==null;)S.childLanes|=d,g=S.alternate,g!==null&&(g.childLanes|=d),S.tag===22&&(s=S.stateNode,s===null||s._visibility&1||(w=!0)),s=S,S=S.return;return s.tag===3?(S=s.stateNode,w&&c!==null&&(w=31-En(d),s=S.hiddenUpdates,g=s[w],g===null?s[w]=[c]:g.push(c),c.lane=d|536870912),S):null}function Ch(s){if(50<ac)throw ac=0,wv=null,Error(n(185));for(var c=s.return;c!==null;)s=c,c=s.return;return s.tag===3?s.stateNode:null}var cs={};function WA(s,c,d,g){this.tag=s,this.key=d,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=c,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=g,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Pr(s,c,d,g){return new WA(s,c,d,g)}function mp(s){return s=s.prototype,!(!s||!s.isReactComponent)}function Ii(s,c){var d=s.alternate;return d===null?(d=Pr(s.tag,c,s.key,s.mode),d.elementType=s.elementType,d.type=s.type,d.stateNode=s.stateNode,d.alternate=s,s.alternate=d):(d.pendingProps=c,d.type=s.type,d.flags=0,d.subtreeFlags=0,d.deletions=null),d.flags=s.flags&65011712,d.childLanes=s.childLanes,d.lanes=s.lanes,d.child=s.child,d.memoizedProps=s.memoizedProps,d.memoizedState=s.memoizedState,d.updateQueue=s.updateQueue,c=s.dependencies,d.dependencies=c===null?null:{lanes:c.lanes,firstContext:c.firstContext},d.sibling=s.sibling,d.index=s.index,d.ref=s.ref,d.refCleanup=s.refCleanup,d}function M0(s,c){s.flags&=65011714;var d=s.alternate;return d===null?(s.childLanes=0,s.lanes=c,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=d.childLanes,s.lanes=d.lanes,s.child=d.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=d.memoizedProps,s.memoizedState=d.memoizedState,s.updateQueue=d.updateQueue,s.type=d.type,c=d.dependencies,s.dependencies=c===null?null:{lanes:c.lanes,firstContext:c.firstContext}),s}function Sh(s,c,d,g,w,S){var N=0;if(g=s,typeof s=="function")mp(s)&&(N=1);else if(typeof s=="string")N=GT(s,d,xt.current)?26:s==="html"||s==="head"||s==="body"?27:5;else t:switch(s){case O:return s=Pr(31,d,c,w),s.elementType=O,s.lanes=S,s;case x:return hu(d.children,w,S,c);case b:N=8,w|=24;break;case E:return s=Pr(12,d,c,w|2),s.elementType=E,s.lanes=S,s;case k:return s=Pr(13,d,c,w),s.elementType=k,s.lanes=S,s;case D:return s=Pr(19,d,c,w),s.elementType=D,s.lanes=S,s;default:if(typeof s=="object"&&s!==null)switch(s.$$typeof){case C:case _:N=10;break t;case R:N=9;break t;case A:N=11;break t;case P:N=14;break t;case M:N=16,g=null;break t}N=29,d=Error(n(130,s===null?"null":typeof s,"")),g=null}return c=Pr(N,d,c,w),c.elementType=s,c.type=g,c.lanes=S,c}function hu(s,c,d,g){return s=Pr(7,s,g,c),s.lanes=d,s}function gp(s,c,d){return s=Pr(6,s,null,c),s.lanes=d,s}function yp(s,c,d){return c=Pr(4,s.children!==null?s.children:[],s.key,c),c.lanes=d,c.stateNode={containerInfo:s.containerInfo,pendingChildren:null,implementation:s.implementation},c}var hs=[],fs=0,Rh=null,_h=0,sa=[],la=0,fu=null,Ni=1,Oi="";function du(s,c){hs[fs++]=_h,hs[fs++]=Rh,Rh=s,_h=c}function B0(s,c,d){sa[la++]=Ni,sa[la++]=Oi,sa[la++]=fu,fu=s;var g=Ni;s=Oi;var w=32-En(g)-1;g&=~(1<<w),d+=1;var S=32-En(c)+w;if(30<S){var N=w-w%5;S=(g&(1<<N)-1).toString(32),g>>=N,w-=N,Ni=1<<32-En(c)+w|d<<w|g,Oi=S+s}else Ni=1<<S|d<<w|g,Oi=s}function xp(s){s.return!==null&&(du(s,1),B0(s,1,0))}function bp(s){for(;s===Rh;)Rh=hs[--fs],hs[fs]=null,_h=hs[--fs],hs[fs]=null;for(;s===fu;)fu=sa[--la],sa[la]=null,Oi=sa[--la],sa[la]=null,Ni=sa[--la],sa[la]=null}var fr=null,nn=null,be=!1,pu=null,Ja=!1,wp=Error(n(519));function vu(s){var c=Error(n(418,""));throw Pl(oa(c,s)),wp}function P0(s){var c=s.stateNode,d=s.type,g=s.memoizedProps;switch(c[Mn]=s,c[Ke]=g,d){case"dialog":ce("cancel",c),ce("close",c);break;case"iframe":case"object":case"embed":ce("load",c);break;case"video":case"audio":for(d=0;d<oc.length;d++)ce(oc[d],c);break;case"source":ce("error",c);break;case"img":case"image":case"link":ce("error",c),ce("load",c);break;case"details":ce("toggle",c);break;case"input":ce("invalid",c),_l(c,g.value,g.defaultValue,g.checked,g.defaultChecked,g.type,g.name,!0),rs(c);break;case"select":ce("invalid",c);break;case"textarea":ce("invalid",c),ki(c,g.value,g.defaultValue,g.children),rs(c)}d=g.children,typeof d!="string"&&typeof d!="number"&&typeof d!="bigint"||c.textContent===""+d||g.suppressHydrationWarning===!0||Jb(c.textContent,d)?(g.popover!=null&&(ce("beforetoggle",c),ce("toggle",c)),g.onScroll!=null&&ce("scroll",c),g.onScrollEnd!=null&&ce("scrollend",c),g.onClick!=null&&(c.onclick=uf),c=!0):c=!1,c||vu(s)}function F0(s){for(fr=s.return;fr;)switch(fr.tag){case 5:case 13:Ja=!1;return;case 27:case 3:Ja=!0;return;default:fr=fr.return}}function Ml(s){if(s!==fr)return!1;if(!be)return F0(s),be=!0,!1;var c=s.tag,d;if((d=c!==3&&c!==27)&&((d=c===5)&&(d=s.type,d=!(d!=="form"&&d!=="button")||Fv(s.type,s.memoizedProps)),d=!d),d&&nn&&vu(s),F0(s),c===13){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(n(317));t:{for(s=s.nextSibling,c=0;s;){if(s.nodeType===8)if(d=s.data,d==="/$"){if(c===0){nn=Na(s.nextSibling);break t}c--}else d!=="$"&&d!=="$!"&&d!=="$?"||c++;s=s.nextSibling}nn=null}}else c===27?(c=nn,Do(s.type)?(s=Wv,Wv=null,nn=s):nn=c):nn=fr?Na(s.stateNode.nextSibling):null;return!0}function Bl(){nn=fr=null,be=!1}function L0(){var s=pu;return s!==null&&(Er===null?Er=s:Er.push.apply(Er,s),pu=null),s}function Pl(s){pu===null?pu=[s]:pu.push(s)}var Ep=$(null),mu=null,Mi=null;function vo(s,c,d){ft(Ep,c._currentValue),c._currentValue=d}function Bi(s){s._currentValue=Ep.current,ht(Ep)}function Cp(s,c,d){for(;s!==null;){var g=s.alternate;if((s.childLanes&c)!==c?(s.childLanes|=c,g!==null&&(g.childLanes|=c)):g!==null&&(g.childLanes&c)!==c&&(g.childLanes|=c),s===d)break;s=s.return}}function Sp(s,c,d,g){var w=s.child;for(w!==null&&(w.return=s);w!==null;){var S=w.dependencies;if(S!==null){var N=w.child;S=S.firstContext;t:for(;S!==null;){var L=S;S=w;for(var K=0;K<c.length;K++)if(L.context===c[K]){S.lanes|=d,L=S.alternate,L!==null&&(L.lanes|=d),Cp(S.return,d,s),g||(N=null);break t}S=L.next}}else if(w.tag===18){if(N=w.return,N===null)throw Error(n(341));N.lanes|=d,S=N.alternate,S!==null&&(S.lanes|=d),Cp(N,d,s),N=null}else N=w.child;if(N!==null)N.return=w;else for(N=w;N!==null;){if(N===s){N=null;break}if(w=N.sibling,w!==null){w.return=N.return,N=w;break}N=N.return}w=N}}function Fl(s,c,d,g){s=null;for(var w=c,S=!1;w!==null;){if(!S){if((w.flags&524288)!==0)S=!0;else if((w.flags&262144)!==0)break}if(w.tag===10){var N=w.alternate;if(N===null)throw Error(n(387));if(N=N.memoizedProps,N!==null){var L=w.type;Br(w.pendingProps.value,N.value)||(s!==null?s.push(L):s=[L])}}else if(w===Dt.current){if(N=w.alternate,N===null)throw Error(n(387));N.memoizedState.memoizedState!==w.memoizedState.memoizedState&&(s!==null?s.push(fc):s=[fc])}w=w.return}s!==null&&Sp(c,s,d,g),c.flags|=262144}function Ah(s){for(s=s.firstContext;s!==null;){if(!Br(s.context._currentValue,s.memoizedValue))return!0;s=s.next}return!1}function gu(s){mu=s,Mi=null,s=s.dependencies,s!==null&&(s.firstContext=null)}function Jn(s){return z0(mu,s)}function Th(s,c){return mu===null&&gu(s),z0(s,c)}function z0(s,c){var d=c._currentValue;if(c={context:c,memoizedValue:d,next:null},Mi===null){if(s===null)throw Error(n(308));Mi=c,s.dependencies={lanes:0,firstContext:c},s.flags|=524288}else Mi=Mi.next=c;return d}var VA=typeof AbortController<"u"?AbortController:function(){var s=[],c=this.signal={aborted:!1,addEventListener:function(d,g){s.push(g)}};this.abort=function(){c.aborted=!0,s.forEach(function(d){return d()})}},GA=r.unstable_scheduleCallback,HA=r.unstable_NormalPriority,Rn={$$typeof:_,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Rp(){return{controller:new VA,data:new Map,refCount:0}}function Ll(s){s.refCount--,s.refCount===0&&GA(HA,function(){s.controller.abort()})}var zl=null,_p=0,ds=0,ps=null;function qA(s,c){if(zl===null){var d=zl=[];_p=0,ds=Tv(),ps={status:"pending",value:void 0,then:function(g){d.push(g)}}}return _p++,c.then(U0,U0),c}function U0(){if(--_p===0&&zl!==null){ps!==null&&(ps.status="fulfilled");var s=zl;zl=null,ds=0,ps=null;for(var c=0;c<s.length;c++)(0,s[c])()}}function jA(s,c){var d=[],g={status:"pending",value:null,reason:null,then:function(w){d.push(w)}};return s.then(function(){g.status="fulfilled",g.value=c;for(var w=0;w<d.length;w++)(0,d[w])(c)},function(w){for(g.status="rejected",g.reason=w,w=0;w<d.length;w++)(0,d[w])(void 0)}),g}var W0=V.S;V.S=function(s,c){typeof c=="object"&&c!==null&&typeof c.then=="function"&&qA(s,c),W0!==null&&W0(s,c)};var yu=$(null);function Ap(){var s=yu.current;return s!==null?s:Le.pooledCache}function kh(s,c){c===null?ft(yu,yu.current):ft(yu,c.pool)}function V0(){var s=Ap();return s===null?null:{parent:Rn._currentValue,pool:s}}var Ul=Error(n(460)),G0=Error(n(474)),Dh=Error(n(542)),Tp={then:function(){}};function H0(s){return s=s.status,s==="fulfilled"||s==="rejected"}function Ih(){}function q0(s,c,d){switch(d=s[d],d===void 0?s.push(c):d!==c&&(c.then(Ih,Ih),c=d),c.status){case"fulfilled":return c.value;case"rejected":throw s=c.reason,X0(s),s;default:if(typeof c.status=="string")c.then(Ih,Ih);else{if(s=Le,s!==null&&100<s.shellSuspendCounter)throw Error(n(482));s=c,s.status="pending",s.then(function(g){if(c.status==="pending"){var w=c;w.status="fulfilled",w.value=g}},function(g){if(c.status==="pending"){var w=c;w.status="rejected",w.reason=g}})}switch(c.status){case"fulfilled":return c.value;case"rejected":throw s=c.reason,X0(s),s}throw Wl=c,Ul}}var Wl=null;function j0(){if(Wl===null)throw Error(n(459));var s=Wl;return Wl=null,s}function X0(s){if(s===Ul||s===Dh)throw Error(n(483))}var mo=!1;function kp(s){s.updateQueue={baseState:s.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Dp(s,c){s=s.updateQueue,c.updateQueue===s&&(c.updateQueue={baseState:s.baseState,firstBaseUpdate:s.firstBaseUpdate,lastBaseUpdate:s.lastBaseUpdate,shared:s.shared,callbacks:null})}function go(s){return{lane:s,tag:0,payload:null,callback:null,next:null}}function yo(s,c,d){var g=s.updateQueue;if(g===null)return null;if(g=g.shared,(_e&2)!==0){var w=g.pending;return w===null?c.next=c:(c.next=w.next,w.next=c),g.pending=c,c=Ch(s),O0(s,null,d),c}return Eh(s,g,c,d),Ch(s)}function Vl(s,c,d){if(c=c.updateQueue,c!==null&&(c=c.shared,(d&4194048)!==0)){var g=c.lanes;g&=s.pendingLanes,d|=g,c.lanes=d,lh(s,d)}}function Ip(s,c){var d=s.updateQueue,g=s.alternate;if(g!==null&&(g=g.updateQueue,d===g)){var w=null,S=null;if(d=d.firstBaseUpdate,d!==null){do{var N={lane:d.lane,tag:d.tag,payload:d.payload,callback:null,next:null};S===null?w=S=N:S=S.next=N,d=d.next}while(d!==null);S===null?w=S=c:S=S.next=c}else w=S=c;d={baseState:g.baseState,firstBaseUpdate:w,lastBaseUpdate:S,shared:g.shared,callbacks:g.callbacks},s.updateQueue=d;return}s=d.lastBaseUpdate,s===null?d.firstBaseUpdate=c:s.next=c,d.lastBaseUpdate=c}var Np=!1;function Gl(){if(Np){var s=ps;if(s!==null)throw s}}function Hl(s,c,d,g){Np=!1;var w=s.updateQueue;mo=!1;var S=w.firstBaseUpdate,N=w.lastBaseUpdate,L=w.shared.pending;if(L!==null){w.shared.pending=null;var K=L,ct=K.next;K.next=null,N===null?S=ct:N.next=ct,N=K;var bt=s.alternate;bt!==null&&(bt=bt.updateQueue,L=bt.lastBaseUpdate,L!==N&&(L===null?bt.firstBaseUpdate=ct:L.next=ct,bt.lastBaseUpdate=K))}if(S!==null){var Ct=w.baseState;N=0,bt=ct=K=null,L=S;do{var dt=L.lane&-536870913,pt=dt!==L.lane;if(pt?(pe&dt)===dt:(g&dt)===dt){dt!==0&&dt===ds&&(Np=!0),bt!==null&&(bt=bt.next={lane:0,tag:L.tag,payload:L.payload,callback:null,next:null});t:{var Qt=s,Xt=L;dt=c;var Ie=d;switch(Xt.tag){case 1:if(Qt=Xt.payload,typeof Qt=="function"){Ct=Qt.call(Ie,Ct,dt);break t}Ct=Qt;break t;case 3:Qt.flags=Qt.flags&-65537|128;case 0:if(Qt=Xt.payload,dt=typeof Qt=="function"?Qt.call(Ie,Ct,dt):Qt,dt==null)break t;Ct=f({},Ct,dt);break t;case 2:mo=!0}}dt=L.callback,dt!==null&&(s.flags|=64,pt&&(s.flags|=8192),pt=w.callbacks,pt===null?w.callbacks=[dt]:pt.push(dt))}else pt={lane:dt,tag:L.tag,payload:L.payload,callback:L.callback,next:null},bt===null?(ct=bt=pt,K=Ct):bt=bt.next=pt,N|=dt;if(L=L.next,L===null){if(L=w.shared.pending,L===null)break;pt=L,L=pt.next,pt.next=null,w.lastBaseUpdate=pt,w.shared.pending=null}}while(!0);bt===null&&(K=Ct),w.baseState=K,w.firstBaseUpdate=ct,w.lastBaseUpdate=bt,S===null&&(w.shared.lanes=0),_o|=N,s.lanes=N,s.memoizedState=Ct}}function K0(s,c){if(typeof s!="function")throw Error(n(191,s));s.call(c)}function Y0(s,c){var d=s.callbacks;if(d!==null)for(s.callbacks=null,s=0;s<d.length;s++)K0(d[s],c)}var vs=$(null),Nh=$(0);function Q0(s,c){s=Vi,ft(Nh,s),ft(vs,c),Vi=s|c.baseLanes}function Op(){ft(Nh,Vi),ft(vs,vs.current)}function Mp(){Vi=Nh.current,ht(vs),ht(Nh)}var xo=0,oe=null,ke=null,yn=null,Oh=!1,ms=!1,xu=!1,Mh=0,ql=0,gs=null,XA=0;function hn(){throw Error(n(321))}function Bp(s,c){if(c===null)return!1;for(var d=0;d<c.length&&d<s.length;d++)if(!Br(s[d],c[d]))return!1;return!0}function Pp(s,c,d,g,w,S){return xo=S,oe=c,c.memoizedState=null,c.updateQueue=null,c.lanes=0,V.H=s===null||s.memoizedState===null?Ox:Mx,xu=!1,S=d(g,w),xu=!1,ms&&(S=$0(c,d,g,w)),Z0(s),S}function Z0(s){V.H=Uh;var c=ke!==null&&ke.next!==null;if(xo=0,yn=ke=oe=null,Oh=!1,ql=0,gs=null,c)throw Error(n(300));s===null||Fn||(s=s.dependencies,s!==null&&Ah(s)&&(Fn=!0))}function $0(s,c,d,g){oe=s;var w=0;do{if(ms&&(gs=null),ql=0,ms=!1,25<=w)throw Error(n(301));if(w+=1,yn=ke=null,s.updateQueue!=null){var S=s.updateQueue;S.lastEffect=null,S.events=null,S.stores=null,S.memoCache!=null&&(S.memoCache.index=0)}V.H=tT,S=c(d,g)}while(ms);return S}function KA(){var s=V.H,c=s.useState()[0];return c=typeof c.then=="function"?jl(c):c,s=s.useState()[0],(ke!==null?ke.memoizedState:null)!==s&&(oe.flags|=1024),c}function Fp(){var s=Mh!==0;return Mh=0,s}function Lp(s,c,d){c.updateQueue=s.updateQueue,c.flags&=-2053,s.lanes&=~d}function zp(s){if(Oh){for(s=s.memoizedState;s!==null;){var c=s.queue;c!==null&&(c.pending=null),s=s.next}Oh=!1}xo=0,yn=ke=oe=null,ms=!1,ql=Mh=0,gs=null}function br(){var s={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return yn===null?oe.memoizedState=yn=s:yn=yn.next=s,yn}function xn(){if(ke===null){var s=oe.alternate;s=s!==null?s.memoizedState:null}else s=ke.next;var c=yn===null?oe.memoizedState:yn.next;if(c!==null)yn=c,ke=s;else{if(s===null)throw oe.alternate===null?Error(n(467)):Error(n(310));ke=s,s={memoizedState:ke.memoizedState,baseState:ke.baseState,baseQueue:ke.baseQueue,queue:ke.queue,next:null},yn===null?oe.memoizedState=yn=s:yn=yn.next=s}return yn}function Up(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function jl(s){var c=ql;return ql+=1,gs===null&&(gs=[]),s=q0(gs,s,c),c=oe,(yn===null?c.memoizedState:yn.next)===null&&(c=c.alternate,V.H=c===null||c.memoizedState===null?Ox:Mx),s}function Bh(s){if(s!==null&&typeof s=="object"){if(typeof s.then=="function")return jl(s);if(s.$$typeof===_)return Jn(s)}throw Error(n(438,String(s)))}function Wp(s){var c=null,d=oe.updateQueue;if(d!==null&&(c=d.memoCache),c==null){var g=oe.alternate;g!==null&&(g=g.updateQueue,g!==null&&(g=g.memoCache,g!=null&&(c={data:g.data.map(function(w){return w.slice()}),index:0})))}if(c==null&&(c={data:[],index:0}),d===null&&(d=Up(),oe.updateQueue=d),d.memoCache=c,d=c.data[c.index],d===void 0)for(d=c.data[c.index]=Array(s),g=0;g<s;g++)d[g]=F;return c.index++,d}function Pi(s,c){return typeof c=="function"?c(s):c}function Ph(s){var c=xn();return Vp(c,ke,s)}function Vp(s,c,d){var g=s.queue;if(g===null)throw Error(n(311));g.lastRenderedReducer=d;var w=s.baseQueue,S=g.pending;if(S!==null){if(w!==null){var N=w.next;w.next=S.next,S.next=N}c.baseQueue=w=S,g.pending=null}if(S=s.baseState,w===null)s.memoizedState=S;else{c=w.next;var L=N=null,K=null,ct=c,bt=!1;do{var Ct=ct.lane&-536870913;if(Ct!==ct.lane?(pe&Ct)===Ct:(xo&Ct)===Ct){var dt=ct.revertLane;if(dt===0)K!==null&&(K=K.next={lane:0,revertLane:0,action:ct.action,hasEagerState:ct.hasEagerState,eagerState:ct.eagerState,next:null}),Ct===ds&&(bt=!0);else if((xo&dt)===dt){ct=ct.next,dt===ds&&(bt=!0);continue}else Ct={lane:0,revertLane:ct.revertLane,action:ct.action,hasEagerState:ct.hasEagerState,eagerState:ct.eagerState,next:null},K===null?(L=K=Ct,N=S):K=K.next=Ct,oe.lanes|=dt,_o|=dt;Ct=ct.action,xu&&d(S,Ct),S=ct.hasEagerState?ct.eagerState:d(S,Ct)}else dt={lane:Ct,revertLane:ct.revertLane,action:ct.action,hasEagerState:ct.hasEagerState,eagerState:ct.eagerState,next:null},K===null?(L=K=dt,N=S):K=K.next=dt,oe.lanes|=Ct,_o|=Ct;ct=ct.next}while(ct!==null&&ct!==c);if(K===null?N=S:K.next=L,!Br(S,s.memoizedState)&&(Fn=!0,bt&&(d=ps,d!==null)))throw d;s.memoizedState=S,s.baseState=N,s.baseQueue=K,g.lastRenderedState=S}return w===null&&(g.lanes=0),[s.memoizedState,g.dispatch]}function Gp(s){var c=xn(),d=c.queue;if(d===null)throw Error(n(311));d.lastRenderedReducer=s;var g=d.dispatch,w=d.pending,S=c.memoizedState;if(w!==null){d.pending=null;var N=w=w.next;do S=s(S,N.action),N=N.next;while(N!==w);Br(S,c.memoizedState)||(Fn=!0),c.memoizedState=S,c.baseQueue===null&&(c.baseState=S),d.lastRenderedState=S}return[S,g]}function J0(s,c,d){var g=oe,w=xn(),S=be;if(S){if(d===void 0)throw Error(n(407));d=d()}else d=c();var N=!Br((ke||w).memoizedState,d);N&&(w.memoizedState=d,Fn=!0),w=w.queue;var L=nx.bind(null,g,w,s);if(Xl(2048,8,L,[s]),w.getSnapshot!==c||N||yn!==null&&yn.memoizedState.tag&1){if(g.flags|=2048,ys(9,Fh(),ex.bind(null,g,w,d,c),null),Le===null)throw Error(n(349));S||(xo&124)!==0||tx(g,c,d)}return d}function tx(s,c,d){s.flags|=16384,s={getSnapshot:c,value:d},c=oe.updateQueue,c===null?(c=Up(),oe.updateQueue=c,c.stores=[s]):(d=c.stores,d===null?c.stores=[s]:d.push(s))}function ex(s,c,d,g){c.value=d,c.getSnapshot=g,rx(c)&&ax(s)}function nx(s,c,d){return d(function(){rx(c)&&ax(s)})}function rx(s){var c=s.getSnapshot;s=s.value;try{var d=c();return!Br(s,d)}catch{return!0}}function ax(s){var c=ls(s,2);c!==null&&Wr(c,s,2)}function Hp(s){var c=br();if(typeof s=="function"){var d=s;if(s=d(),xu){Fe(!0);try{d()}finally{Fe(!1)}}}return c.memoizedState=c.baseState=s,c.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Pi,lastRenderedState:s},c}function ix(s,c,d,g){return s.baseState=d,Vp(s,ke,typeof g=="function"?g:Pi)}function YA(s,c,d,g,w){if(zh(s))throw Error(n(485));if(s=c.action,s!==null){var S={payload:w,action:s,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(N){S.listeners.push(N)}};V.T!==null?d(!0):S.isTransition=!1,g(S),d=c.pending,d===null?(S.next=c.pending=S,ox(c,S)):(S.next=d.next,c.pending=d.next=S)}}function ox(s,c){var d=c.action,g=c.payload,w=s.state;if(c.isTransition){var S=V.T,N={};V.T=N;try{var L=d(w,g),K=V.S;K!==null&&K(N,L),ux(s,c,L)}catch(ct){qp(s,c,ct)}finally{V.T=S}}else try{S=d(w,g),ux(s,c,S)}catch(ct){qp(s,c,ct)}}function ux(s,c,d){d!==null&&typeof d=="object"&&typeof d.then=="function"?d.then(function(g){sx(s,c,g)},function(g){return qp(s,c,g)}):sx(s,c,d)}function sx(s,c,d){c.status="fulfilled",c.value=d,lx(c),s.state=d,c=s.pending,c!==null&&(d=c.next,d===c?s.pending=null:(d=d.next,c.next=d,ox(s,d)))}function qp(s,c,d){var g=s.pending;if(s.pending=null,g!==null){g=g.next;do c.status="rejected",c.reason=d,lx(c),c=c.next;while(c!==g)}s.action=null}function lx(s){s=s.listeners;for(var c=0;c<s.length;c++)(0,s[c])()}function cx(s,c){return c}function hx(s,c){if(be){var d=Le.formState;if(d!==null){t:{var g=oe;if(be){if(nn){e:{for(var w=nn,S=Ja;w.nodeType!==8;){if(!S){w=null;break e}if(w=Na(w.nextSibling),w===null){w=null;break e}}S=w.data,w=S==="F!"||S==="F"?w:null}if(w){nn=Na(w.nextSibling),g=w.data==="F!";break t}}vu(g)}g=!1}g&&(c=d[0])}}return d=br(),d.memoizedState=d.baseState=c,g={pending:null,lanes:0,dispatch:null,lastRenderedReducer:cx,lastRenderedState:c},d.queue=g,d=Dx.bind(null,oe,g),g.dispatch=d,g=Hp(!1),S=Qp.bind(null,oe,!1,g.queue),g=br(),w={state:c,dispatch:null,action:s,pending:null},g.queue=w,d=YA.bind(null,oe,w,S,d),w.dispatch=d,g.memoizedState=s,[c,d,!1]}function fx(s){var c=xn();return dx(c,ke,s)}function dx(s,c,d){if(c=Vp(s,c,cx)[0],s=Ph(Pi)[0],typeof c=="object"&&c!==null&&typeof c.then=="function")try{var g=jl(c)}catch(N){throw N===Ul?Dh:N}else g=c;c=xn();var w=c.queue,S=w.dispatch;return d!==c.memoizedState&&(oe.flags|=2048,ys(9,Fh(),QA.bind(null,w,d),null)),[g,S,s]}function QA(s,c){s.action=c}function px(s){var c=xn(),d=ke;if(d!==null)return dx(c,d,s);xn(),c=c.memoizedState,d=xn();var g=d.queue.dispatch;return d.memoizedState=s,[c,g,!1]}function ys(s,c,d,g){return s={tag:s,create:d,deps:g,inst:c,next:null},c=oe.updateQueue,c===null&&(c=Up(),oe.updateQueue=c),d=c.lastEffect,d===null?c.lastEffect=s.next=s:(g=d.next,d.next=s,s.next=g,c.lastEffect=s),s}function Fh(){return{destroy:void 0,resource:void 0}}function vx(){return xn().memoizedState}function Lh(s,c,d,g){var w=br();g=g===void 0?null:g,oe.flags|=s,w.memoizedState=ys(1|c,Fh(),d,g)}function Xl(s,c,d,g){var w=xn();g=g===void 0?null:g;var S=w.memoizedState.inst;ke!==null&&g!==null&&Bp(g,ke.memoizedState.deps)?w.memoizedState=ys(c,S,d,g):(oe.flags|=s,w.memoizedState=ys(1|c,S,d,g))}function mx(s,c){Lh(8390656,8,s,c)}function gx(s,c){Xl(2048,8,s,c)}function yx(s,c){return Xl(4,2,s,c)}function xx(s,c){return Xl(4,4,s,c)}function bx(s,c){if(typeof c=="function"){s=s();var d=c(s);return function(){typeof d=="function"?d():c(null)}}if(c!=null)return s=s(),c.current=s,function(){c.current=null}}function wx(s,c,d){d=d!=null?d.concat([s]):null,Xl(4,4,bx.bind(null,c,s),d)}function jp(){}function Ex(s,c){var d=xn();c=c===void 0?null:c;var g=d.memoizedState;return c!==null&&Bp(c,g[1])?g[0]:(d.memoizedState=[s,c],s)}function Cx(s,c){var d=xn();c=c===void 0?null:c;var g=d.memoizedState;if(c!==null&&Bp(c,g[1]))return g[0];if(g=s(),xu){Fe(!0);try{s()}finally{Fe(!1)}}return d.memoizedState=[g,c],g}function Xp(s,c,d){return d===void 0||(xo&1073741824)!==0?s.memoizedState=c:(s.memoizedState=d,s=_b(),oe.lanes|=s,_o|=s,d)}function Sx(s,c,d,g){return Br(d,c)?d:vs.current!==null?(s=Xp(s,d,g),Br(s,c)||(Fn=!0),s):(xo&42)===0?(Fn=!0,s.memoizedState=d):(s=_b(),oe.lanes|=s,_o|=s,c)}function Rx(s,c,d,g,w){var S=X.p;X.p=S!==0&&8>S?S:8;var N=V.T,L={};V.T=L,Qp(s,!1,c,d);try{var K=w(),ct=V.S;if(ct!==null&&ct(L,K),K!==null&&typeof K=="object"&&typeof K.then=="function"){var bt=jA(K,g);Kl(s,c,bt,Ur(s))}else Kl(s,c,g,Ur(s))}catch(Ct){Kl(s,c,{then:function(){},status:"rejected",reason:Ct},Ur())}finally{X.p=S,V.T=N}}function ZA(){}function Kp(s,c,d,g){if(s.tag!==5)throw Error(n(476));var w=_x(s).queue;Rx(s,w,c,Q,d===null?ZA:function(){return Ax(s),d(g)})}function _x(s){var c=s.memoizedState;if(c!==null)return c;c={memoizedState:Q,baseState:Q,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Pi,lastRenderedState:Q},next:null};var d={};return c.next={memoizedState:d,baseState:d,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Pi,lastRenderedState:d},next:null},s.memoizedState=c,s=s.alternate,s!==null&&(s.memoizedState=c),c}function Ax(s){var c=_x(s).next.queue;Kl(s,c,{},Ur())}function Yp(){return Jn(fc)}function Tx(){return xn().memoizedState}function kx(){return xn().memoizedState}function $A(s){for(var c=s.return;c!==null;){switch(c.tag){case 24:case 3:var d=Ur();s=go(d);var g=yo(c,s,d);g!==null&&(Wr(g,c,d),Vl(g,c,d)),c={cache:Rp()},s.payload=c;return}c=c.return}}function JA(s,c,d){var g=Ur();d={lane:g,revertLane:0,action:d,hasEagerState:!1,eagerState:null,next:null},zh(s)?Ix(c,d):(d=vp(s,c,d,g),d!==null&&(Wr(d,s,g),Nx(d,c,g)))}function Dx(s,c,d){var g=Ur();Kl(s,c,d,g)}function Kl(s,c,d,g){var w={lane:g,revertLane:0,action:d,hasEagerState:!1,eagerState:null,next:null};if(zh(s))Ix(c,w);else{var S=s.alternate;if(s.lanes===0&&(S===null||S.lanes===0)&&(S=c.lastRenderedReducer,S!==null))try{var N=c.lastRenderedState,L=S(N,d);if(w.hasEagerState=!0,w.eagerState=L,Br(L,N))return Eh(s,c,w,0),Le===null&&wh(),!1}catch{}finally{}if(d=vp(s,c,w,g),d!==null)return Wr(d,s,g),Nx(d,c,g),!0}return!1}function Qp(s,c,d,g){if(g={lane:2,revertLane:Tv(),action:g,hasEagerState:!1,eagerState:null,next:null},zh(s)){if(c)throw Error(n(479))}else c=vp(s,d,g,2),c!==null&&Wr(c,s,2)}function zh(s){var c=s.alternate;return s===oe||c!==null&&c===oe}function Ix(s,c){ms=Oh=!0;var d=s.pending;d===null?c.next=c:(c.next=d.next,d.next=c),s.pending=c}function Nx(s,c,d){if((d&4194048)!==0){var g=c.lanes;g&=s.pendingLanes,d|=g,c.lanes=d,lh(s,d)}}var Uh={readContext:Jn,use:Bh,useCallback:hn,useContext:hn,useEffect:hn,useImperativeHandle:hn,useLayoutEffect:hn,useInsertionEffect:hn,useMemo:hn,useReducer:hn,useRef:hn,useState:hn,useDebugValue:hn,useDeferredValue:hn,useTransition:hn,useSyncExternalStore:hn,useId:hn,useHostTransitionStatus:hn,useFormState:hn,useActionState:hn,useOptimistic:hn,useMemoCache:hn,useCacheRefresh:hn},Ox={readContext:Jn,use:Bh,useCallback:function(s,c){return br().memoizedState=[s,c===void 0?null:c],s},useContext:Jn,useEffect:mx,useImperativeHandle:function(s,c,d){d=d!=null?d.concat([s]):null,Lh(4194308,4,bx.bind(null,c,s),d)},useLayoutEffect:function(s,c){return Lh(4194308,4,s,c)},useInsertionEffect:function(s,c){Lh(4,2,s,c)},useMemo:function(s,c){var d=br();c=c===void 0?null:c;var g=s();if(xu){Fe(!0);try{s()}finally{Fe(!1)}}return d.memoizedState=[g,c],g},useReducer:function(s,c,d){var g=br();if(d!==void 0){var w=d(c);if(xu){Fe(!0);try{d(c)}finally{Fe(!1)}}}else w=c;return g.memoizedState=g.baseState=w,s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:s,lastRenderedState:w},g.queue=s,s=s.dispatch=JA.bind(null,oe,s),[g.memoizedState,s]},useRef:function(s){var c=br();return s={current:s},c.memoizedState=s},useState:function(s){s=Hp(s);var c=s.queue,d=Dx.bind(null,oe,c);return c.dispatch=d,[s.memoizedState,d]},useDebugValue:jp,useDeferredValue:function(s,c){var d=br();return Xp(d,s,c)},useTransition:function(){var s=Hp(!1);return s=Rx.bind(null,oe,s.queue,!0,!1),br().memoizedState=s,[!1,s]},useSyncExternalStore:function(s,c,d){var g=oe,w=br();if(be){if(d===void 0)throw Error(n(407));d=d()}else{if(d=c(),Le===null)throw Error(n(349));(pe&124)!==0||tx(g,c,d)}w.memoizedState=d;var S={value:d,getSnapshot:c};return w.queue=S,mx(nx.bind(null,g,S,s),[s]),g.flags|=2048,ys(9,Fh(),ex.bind(null,g,S,d,c),null),d},useId:function(){var s=br(),c=Le.identifierPrefix;if(be){var d=Oi,g=Ni;d=(g&~(1<<32-En(g)-1)).toString(32)+d,c=""+c+"R"+d,d=Mh++,0<d&&(c+="H"+d.toString(32)),c+=""}else d=XA++,c=""+c+"r"+d.toString(32)+"";return s.memoizedState=c},useHostTransitionStatus:Yp,useFormState:hx,useActionState:hx,useOptimistic:function(s){var c=br();c.memoizedState=c.baseState=s;var d={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return c.queue=d,c=Qp.bind(null,oe,!0,d),d.dispatch=c,[s,c]},useMemoCache:Wp,useCacheRefresh:function(){return br().memoizedState=$A.bind(null,oe)}},Mx={readContext:Jn,use:Bh,useCallback:Ex,useContext:Jn,useEffect:gx,useImperativeHandle:wx,useInsertionEffect:yx,useLayoutEffect:xx,useMemo:Cx,useReducer:Ph,useRef:vx,useState:function(){return Ph(Pi)},useDebugValue:jp,useDeferredValue:function(s,c){var d=xn();return Sx(d,ke.memoizedState,s,c)},useTransition:function(){var s=Ph(Pi)[0],c=xn().memoizedState;return[typeof s=="boolean"?s:jl(s),c]},useSyncExternalStore:J0,useId:Tx,useHostTransitionStatus:Yp,useFormState:fx,useActionState:fx,useOptimistic:function(s,c){var d=xn();return ix(d,ke,s,c)},useMemoCache:Wp,useCacheRefresh:kx},tT={readContext:Jn,use:Bh,useCallback:Ex,useContext:Jn,useEffect:gx,useImperativeHandle:wx,useInsertionEffect:yx,useLayoutEffect:xx,useMemo:Cx,useReducer:Gp,useRef:vx,useState:function(){return Gp(Pi)},useDebugValue:jp,useDeferredValue:function(s,c){var d=xn();return ke===null?Xp(d,s,c):Sx(d,ke.memoizedState,s,c)},useTransition:function(){var s=Gp(Pi)[0],c=xn().memoizedState;return[typeof s=="boolean"?s:jl(s),c]},useSyncExternalStore:J0,useId:Tx,useHostTransitionStatus:Yp,useFormState:px,useActionState:px,useOptimistic:function(s,c){var d=xn();return ke!==null?ix(d,ke,s,c):(d.baseState=s,[s,d.queue.dispatch])},useMemoCache:Wp,useCacheRefresh:kx},xs=null,Yl=0;function Wh(s){var c=Yl;return Yl+=1,xs===null&&(xs=[]),q0(xs,s,c)}function Ql(s,c){c=c.props.ref,s.ref=c!==void 0?c:null}function Vh(s,c){throw c.$$typeof===p?Error(n(525)):(s=Object.prototype.toString.call(c),Error(n(31,s==="[object Object]"?"object with keys {"+Object.keys(c).join(", ")+"}":s)))}function Bx(s){var c=s._init;return c(s._payload)}function Px(s){function c(st,et){if(s){var lt=st.deletions;lt===null?(st.deletions=[et],st.flags|=16):lt.push(et)}}function d(st,et){if(!s)return null;for(;et!==null;)c(st,et),et=et.sibling;return null}function g(st){for(var et=new Map;st!==null;)st.key!==null?et.set(st.key,st):et.set(st.index,st),st=st.sibling;return et}function w(st,et){return st=Ii(st,et),st.index=0,st.sibling=null,st}function S(st,et,lt){return st.index=lt,s?(lt=st.alternate,lt!==null?(lt=lt.index,lt<et?(st.flags|=67108866,et):lt):(st.flags|=67108866,et)):(st.flags|=1048576,et)}function N(st){return s&&st.alternate===null&&(st.flags|=67108866),st}function L(st,et,lt,Et){return et===null||et.tag!==6?(et=gp(lt,st.mode,Et),et.return=st,et):(et=w(et,lt),et.return=st,et)}function K(st,et,lt,Et){var Nt=lt.type;return Nt===x?bt(st,et,lt.props.children,Et,lt.key):et!==null&&(et.elementType===Nt||typeof Nt=="object"&&Nt!==null&&Nt.$$typeof===M&&Bx(Nt)===et.type)?(et=w(et,lt.props),Ql(et,lt),et.return=st,et):(et=Sh(lt.type,lt.key,lt.props,null,st.mode,Et),Ql(et,lt),et.return=st,et)}function ct(st,et,lt,Et){return et===null||et.tag!==4||et.stateNode.containerInfo!==lt.containerInfo||et.stateNode.implementation!==lt.implementation?(et=yp(lt,st.mode,Et),et.return=st,et):(et=w(et,lt.children||[]),et.return=st,et)}function bt(st,et,lt,Et,Nt){return et===null||et.tag!==7?(et=hu(lt,st.mode,Et,Nt),et.return=st,et):(et=w(et,lt),et.return=st,et)}function Ct(st,et,lt){if(typeof et=="string"&&et!==""||typeof et=="number"||typeof et=="bigint")return et=gp(""+et,st.mode,lt),et.return=st,et;if(typeof et=="object"&&et!==null){switch(et.$$typeof){case v:return lt=Sh(et.type,et.key,et.props,null,st.mode,lt),Ql(lt,et),lt.return=st,lt;case m:return et=yp(et,st.mode,lt),et.return=st,et;case M:var Et=et._init;return et=Et(et._payload),Ct(st,et,lt)}if(at(et)||j(et))return et=hu(et,st.mode,lt,null),et.return=st,et;if(typeof et.then=="function")return Ct(st,Wh(et),lt);if(et.$$typeof===_)return Ct(st,Th(st,et),lt);Vh(st,et)}return null}function dt(st,et,lt,Et){var Nt=et!==null?et.key:null;if(typeof lt=="string"&&lt!==""||typeof lt=="number"||typeof lt=="bigint")return Nt!==null?null:L(st,et,""+lt,Et);if(typeof lt=="object"&&lt!==null){switch(lt.$$typeof){case v:return lt.key===Nt?K(st,et,lt,Et):null;case m:return lt.key===Nt?ct(st,et,lt,Et):null;case M:return Nt=lt._init,lt=Nt(lt._payload),dt(st,et,lt,Et)}if(at(lt)||j(lt))return Nt!==null?null:bt(st,et,lt,Et,null);if(typeof lt.then=="function")return dt(st,et,Wh(lt),Et);if(lt.$$typeof===_)return dt(st,et,Th(st,lt),Et);Vh(st,lt)}return null}function pt(st,et,lt,Et,Nt){if(typeof Et=="string"&&Et!==""||typeof Et=="number"||typeof Et=="bigint")return st=st.get(lt)||null,L(et,st,""+Et,Nt);if(typeof Et=="object"&&Et!==null){switch(Et.$$typeof){case v:return st=st.get(Et.key===null?lt:Et.key)||null,K(et,st,Et,Nt);case m:return st=st.get(Et.key===null?lt:Et.key)||null,ct(et,st,Et,Nt);case M:var se=Et._init;return Et=se(Et._payload),pt(st,et,lt,Et,Nt)}if(at(Et)||j(Et))return st=st.get(lt)||null,bt(et,st,Et,Nt,null);if(typeof Et.then=="function")return pt(st,et,lt,Wh(Et),Nt);if(Et.$$typeof===_)return pt(st,et,lt,Th(et,Et),Nt);Vh(et,Et)}return null}function Qt(st,et,lt,Et){for(var Nt=null,se=null,Vt=et,Yt=et=0,zn=null;Vt!==null&&Yt<lt.length;Yt++){Vt.index>Yt?(zn=Vt,Vt=null):zn=Vt.sibling;var ye=dt(st,Vt,lt[Yt],Et);if(ye===null){Vt===null&&(Vt=zn);break}s&&Vt&&ye.alternate===null&&c(st,Vt),et=S(ye,et,Yt),se===null?Nt=ye:se.sibling=ye,se=ye,Vt=zn}if(Yt===lt.length)return d(st,Vt),be&&du(st,Yt),Nt;if(Vt===null){for(;Yt<lt.length;Yt++)Vt=Ct(st,lt[Yt],Et),Vt!==null&&(et=S(Vt,et,Yt),se===null?Nt=Vt:se.sibling=Vt,se=Vt);return be&&du(st,Yt),Nt}for(Vt=g(Vt);Yt<lt.length;Yt++)zn=pt(Vt,st,Yt,lt[Yt],Et),zn!==null&&(s&&zn.alternate!==null&&Vt.delete(zn.key===null?Yt:zn.key),et=S(zn,et,Yt),se===null?Nt=zn:se.sibling=zn,se=zn);return s&&Vt.forEach(function(Bo){return c(st,Bo)}),be&&du(st,Yt),Nt}function Xt(st,et,lt,Et){if(lt==null)throw Error(n(151));for(var Nt=null,se=null,Vt=et,Yt=et=0,zn=null,ye=lt.next();Vt!==null&&!ye.done;Yt++,ye=lt.next()){Vt.index>Yt?(zn=Vt,Vt=null):zn=Vt.sibling;var Bo=dt(st,Vt,ye.value,Et);if(Bo===null){Vt===null&&(Vt=zn);break}s&&Vt&&Bo.alternate===null&&c(st,Vt),et=S(Bo,et,Yt),se===null?Nt=Bo:se.sibling=Bo,se=Bo,Vt=zn}if(ye.done)return d(st,Vt),be&&du(st,Yt),Nt;if(Vt===null){for(;!ye.done;Yt++,ye=lt.next())ye=Ct(st,ye.value,Et),ye!==null&&(et=S(ye,et,Yt),se===null?Nt=ye:se.sibling=ye,se=ye);return be&&du(st,Yt),Nt}for(Vt=g(Vt);!ye.done;Yt++,ye=lt.next())ye=pt(Vt,st,Yt,ye.value,Et),ye!==null&&(s&&ye.alternate!==null&&Vt.delete(ye.key===null?Yt:ye.key),et=S(ye,et,Yt),se===null?Nt=ye:se.sibling=ye,se=ye);return s&&Vt.forEach(function(ek){return c(st,ek)}),be&&du(st,Yt),Nt}function Ie(st,et,lt,Et){if(typeof lt=="object"&&lt!==null&&lt.type===x&&lt.key===null&&(lt=lt.props.children),typeof lt=="object"&&lt!==null){switch(lt.$$typeof){case v:t:{for(var Nt=lt.key;et!==null;){if(et.key===Nt){if(Nt=lt.type,Nt===x){if(et.tag===7){d(st,et.sibling),Et=w(et,lt.props.children),Et.return=st,st=Et;break t}}else if(et.elementType===Nt||typeof Nt=="object"&&Nt!==null&&Nt.$$typeof===M&&Bx(Nt)===et.type){d(st,et.sibling),Et=w(et,lt.props),Ql(Et,lt),Et.return=st,st=Et;break t}d(st,et);break}else c(st,et);et=et.sibling}lt.type===x?(Et=hu(lt.props.children,st.mode,Et,lt.key),Et.return=st,st=Et):(Et=Sh(lt.type,lt.key,lt.props,null,st.mode,Et),Ql(Et,lt),Et.return=st,st=Et)}return N(st);case m:t:{for(Nt=lt.key;et!==null;){if(et.key===Nt)if(et.tag===4&&et.stateNode.containerInfo===lt.containerInfo&&et.stateNode.implementation===lt.implementation){d(st,et.sibling),Et=w(et,lt.children||[]),Et.return=st,st=Et;break t}else{d(st,et);break}else c(st,et);et=et.sibling}Et=yp(lt,st.mode,Et),Et.return=st,st=Et}return N(st);case M:return Nt=lt._init,lt=Nt(lt._payload),Ie(st,et,lt,Et)}if(at(lt))return Qt(st,et,lt,Et);if(j(lt)){if(Nt=j(lt),typeof Nt!="function")throw Error(n(150));return lt=Nt.call(lt),Xt(st,et,lt,Et)}if(typeof lt.then=="function")return Ie(st,et,Wh(lt),Et);if(lt.$$typeof===_)return Ie(st,et,Th(st,lt),Et);Vh(st,lt)}return typeof lt=="string"&&lt!==""||typeof lt=="number"||typeof lt=="bigint"?(lt=""+lt,et!==null&&et.tag===6?(d(st,et.sibling),Et=w(et,lt),Et.return=st,st=Et):(d(st,et),Et=gp(lt,st.mode,Et),Et.return=st,st=Et),N(st)):d(st,et)}return function(st,et,lt,Et){try{Yl=0;var Nt=Ie(st,et,lt,Et);return xs=null,Nt}catch(Vt){if(Vt===Ul||Vt===Dh)throw Vt;var se=Pr(29,Vt,null,st.mode);return se.lanes=Et,se.return=st,se}finally{}}}var bs=Px(!0),Fx=Px(!1),ca=$(null),ti=null;function bo(s){var c=s.alternate;ft(_n,_n.current&1),ft(ca,s),ti===null&&(c===null||vs.current!==null||c.memoizedState!==null)&&(ti=s)}function Lx(s){if(s.tag===22){if(ft(_n,_n.current),ft(ca,s),ti===null){var c=s.alternate;c!==null&&c.memoizedState!==null&&(ti=s)}}else wo()}function wo(){ft(_n,_n.current),ft(ca,ca.current)}function Fi(s){ht(ca),ti===s&&(ti=null),ht(_n)}var _n=$(0);function Gh(s){for(var c=s;c!==null;){if(c.tag===13){var d=c.memoizedState;if(d!==null&&(d=d.dehydrated,d===null||d.data==="$?"||Uv(d)))return c}else if(c.tag===19&&c.memoizedProps.revealOrder!==void 0){if((c.flags&128)!==0)return c}else if(c.child!==null){c.child.return=c,c=c.child;continue}if(c===s)break;for(;c.sibling===null;){if(c.return===null||c.return===s)return null;c=c.return}c.sibling.return=c.return,c=c.sibling}return null}function Zp(s,c,d,g){c=s.memoizedState,d=d(g,c),d=d==null?c:f({},c,d),s.memoizedState=d,s.lanes===0&&(s.updateQueue.baseState=d)}var $p={enqueueSetState:function(s,c,d){s=s._reactInternals;var g=Ur(),w=go(g);w.payload=c,d!=null&&(w.callback=d),c=yo(s,w,g),c!==null&&(Wr(c,s,g),Vl(c,s,g))},enqueueReplaceState:function(s,c,d){s=s._reactInternals;var g=Ur(),w=go(g);w.tag=1,w.payload=c,d!=null&&(w.callback=d),c=yo(s,w,g),c!==null&&(Wr(c,s,g),Vl(c,s,g))},enqueueForceUpdate:function(s,c){s=s._reactInternals;var d=Ur(),g=go(d);g.tag=2,c!=null&&(g.callback=c),c=yo(s,g,d),c!==null&&(Wr(c,s,d),Vl(c,s,d))}};function zx(s,c,d,g,w,S,N){return s=s.stateNode,typeof s.shouldComponentUpdate=="function"?s.shouldComponentUpdate(g,S,N):c.prototype&&c.prototype.isPureReactComponent?!Nl(d,g)||!Nl(w,S):!0}function Ux(s,c,d,g){s=c.state,typeof c.componentWillReceiveProps=="function"&&c.componentWillReceiveProps(d,g),typeof c.UNSAFE_componentWillReceiveProps=="function"&&c.UNSAFE_componentWillReceiveProps(d,g),c.state!==s&&$p.enqueueReplaceState(c,c.state,null)}function bu(s,c){var d=c;if("ref"in c){d={};for(var g in c)g!=="ref"&&(d[g]=c[g])}if(s=s.defaultProps){d===c&&(d=f({},d));for(var w in s)d[w]===void 0&&(d[w]=s[w])}return d}var Hh=typeof reportError=="function"?reportError:function(s){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var c=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof s=="object"&&s!==null&&typeof s.message=="string"?String(s.message):String(s),error:s});if(!window.dispatchEvent(c))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",s);return}console.error(s)};function Wx(s){Hh(s)}function Vx(s){console.error(s)}function Gx(s){Hh(s)}function qh(s,c){try{var d=s.onUncaughtError;d(c.value,{componentStack:c.stack})}catch(g){setTimeout(function(){throw g})}}function Hx(s,c,d){try{var g=s.onCaughtError;g(d.value,{componentStack:d.stack,errorBoundary:c.tag===1?c.stateNode:null})}catch(w){setTimeout(function(){throw w})}}function Jp(s,c,d){return d=go(d),d.tag=3,d.payload={element:null},d.callback=function(){qh(s,c)},d}function qx(s){return s=go(s),s.tag=3,s}function jx(s,c,d,g){var w=d.type.getDerivedStateFromError;if(typeof w=="function"){var S=g.value;s.payload=function(){return w(S)},s.callback=function(){Hx(c,d,g)}}var N=d.stateNode;N!==null&&typeof N.componentDidCatch=="function"&&(s.callback=function(){Hx(c,d,g),typeof w!="function"&&(Ao===null?Ao=new Set([this]):Ao.add(this));var L=g.stack;this.componentDidCatch(g.value,{componentStack:L!==null?L:""})})}function eT(s,c,d,g,w){if(d.flags|=32768,g!==null&&typeof g=="object"&&typeof g.then=="function"){if(c=d.alternate,c!==null&&Fl(c,d,w,!0),d=ca.current,d!==null){switch(d.tag){case 13:return ti===null?Cv():d.alternate===null&&rn===0&&(rn=3),d.flags&=-257,d.flags|=65536,d.lanes=w,g===Tp?d.flags|=16384:(c=d.updateQueue,c===null?d.updateQueue=new Set([g]):c.add(g),Rv(s,g,w)),!1;case 22:return d.flags|=65536,g===Tp?d.flags|=16384:(c=d.updateQueue,c===null?(c={transitions:null,markerInstances:null,retryQueue:new Set([g])},d.updateQueue=c):(d=c.retryQueue,d===null?c.retryQueue=new Set([g]):d.add(g)),Rv(s,g,w)),!1}throw Error(n(435,d.tag))}return Rv(s,g,w),Cv(),!1}if(be)return c=ca.current,c!==null?((c.flags&65536)===0&&(c.flags|=256),c.flags|=65536,c.lanes=w,g!==wp&&(s=Error(n(422),{cause:g}),Pl(oa(s,d)))):(g!==wp&&(c=Error(n(423),{cause:g}),Pl(oa(c,d))),s=s.current.alternate,s.flags|=65536,w&=-w,s.lanes|=w,g=oa(g,d),w=Jp(s.stateNode,g,w),Ip(s,w),rn!==4&&(rn=2)),!1;var S=Error(n(520),{cause:g});if(S=oa(S,d),rc===null?rc=[S]:rc.push(S),rn!==4&&(rn=2),c===null)return!0;g=oa(g,d),d=c;do{switch(d.tag){case 3:return d.flags|=65536,s=w&-w,d.lanes|=s,s=Jp(d.stateNode,g,s),Ip(d,s),!1;case 1:if(c=d.type,S=d.stateNode,(d.flags&128)===0&&(typeof c.getDerivedStateFromError=="function"||S!==null&&typeof S.componentDidCatch=="function"&&(Ao===null||!Ao.has(S))))return d.flags|=65536,w&=-w,d.lanes|=w,w=qx(w),jx(w,s,d,g),Ip(d,w),!1}d=d.return}while(d!==null);return!1}var Xx=Error(n(461)),Fn=!1;function qn(s,c,d,g){c.child=s===null?Fx(c,null,d,g):bs(c,s.child,d,g)}function Kx(s,c,d,g,w){d=d.render;var S=c.ref;if("ref"in g){var N={};for(var L in g)L!=="ref"&&(N[L]=g[L])}else N=g;return gu(c),g=Pp(s,c,d,N,S,w),L=Fp(),s!==null&&!Fn?(Lp(s,c,w),Li(s,c,w)):(be&&L&&xp(c),c.flags|=1,qn(s,c,g,w),c.child)}function Yx(s,c,d,g,w){if(s===null){var S=d.type;return typeof S=="function"&&!mp(S)&&S.defaultProps===void 0&&d.compare===null?(c.tag=15,c.type=S,Qx(s,c,S,g,w)):(s=Sh(d.type,null,g,c,c.mode,w),s.ref=c.ref,s.return=c,c.child=s)}if(S=s.child,!uv(s,w)){var N=S.memoizedProps;if(d=d.compare,d=d!==null?d:Nl,d(N,g)&&s.ref===c.ref)return Li(s,c,w)}return c.flags|=1,s=Ii(S,g),s.ref=c.ref,s.return=c,c.child=s}function Qx(s,c,d,g,w){if(s!==null){var S=s.memoizedProps;if(Nl(S,g)&&s.ref===c.ref)if(Fn=!1,c.pendingProps=g=S,uv(s,w))(s.flags&131072)!==0&&(Fn=!0);else return c.lanes=s.lanes,Li(s,c,w)}return tv(s,c,d,g,w)}function Zx(s,c,d){var g=c.pendingProps,w=g.children,S=s!==null?s.memoizedState:null;if(g.mode==="hidden"){if((c.flags&128)!==0){if(g=S!==null?S.baseLanes|d:d,s!==null){for(w=c.child=s.child,S=0;w!==null;)S=S|w.lanes|w.childLanes,w=w.sibling;c.childLanes=S&~g}else c.childLanes=0,c.child=null;return $x(s,c,g,d)}if((d&536870912)!==0)c.memoizedState={baseLanes:0,cachePool:null},s!==null&&kh(c,S!==null?S.cachePool:null),S!==null?Q0(c,S):Op(),Lx(c);else return c.lanes=c.childLanes=536870912,$x(s,c,S!==null?S.baseLanes|d:d,d)}else S!==null?(kh(c,S.cachePool),Q0(c,S),wo(),c.memoizedState=null):(s!==null&&kh(c,null),Op(),wo());return qn(s,c,w,d),c.child}function $x(s,c,d,g){var w=Ap();return w=w===null?null:{parent:Rn._currentValue,pool:w},c.memoizedState={baseLanes:d,cachePool:w},s!==null&&kh(c,null),Op(),Lx(c),s!==null&&Fl(s,c,g,!0),null}function jh(s,c){var d=c.ref;if(d===null)s!==null&&s.ref!==null&&(c.flags|=4194816);else{if(typeof d!="function"&&typeof d!="object")throw Error(n(284));(s===null||s.ref!==d)&&(c.flags|=4194816)}}function tv(s,c,d,g,w){return gu(c),d=Pp(s,c,d,g,void 0,w),g=Fp(),s!==null&&!Fn?(Lp(s,c,w),Li(s,c,w)):(be&&g&&xp(c),c.flags|=1,qn(s,c,d,w),c.child)}function Jx(s,c,d,g,w,S){return gu(c),c.updateQueue=null,d=$0(c,g,d,w),Z0(s),g=Fp(),s!==null&&!Fn?(Lp(s,c,S),Li(s,c,S)):(be&&g&&xp(c),c.flags|=1,qn(s,c,d,S),c.child)}function tb(s,c,d,g,w){if(gu(c),c.stateNode===null){var S=cs,N=d.contextType;typeof N=="object"&&N!==null&&(S=Jn(N)),S=new d(g,S),c.memoizedState=S.state!==null&&S.state!==void 0?S.state:null,S.updater=$p,c.stateNode=S,S._reactInternals=c,S=c.stateNode,S.props=g,S.state=c.memoizedState,S.refs={},kp(c),N=d.contextType,S.context=typeof N=="object"&&N!==null?Jn(N):cs,S.state=c.memoizedState,N=d.getDerivedStateFromProps,typeof N=="function"&&(Zp(c,d,N,g),S.state=c.memoizedState),typeof d.getDerivedStateFromProps=="function"||typeof S.getSnapshotBeforeUpdate=="function"||typeof S.UNSAFE_componentWillMount!="function"&&typeof S.componentWillMount!="function"||(N=S.state,typeof S.componentWillMount=="function"&&S.componentWillMount(),typeof S.UNSAFE_componentWillMount=="function"&&S.UNSAFE_componentWillMount(),N!==S.state&&$p.enqueueReplaceState(S,S.state,null),Hl(c,g,S,w),Gl(),S.state=c.memoizedState),typeof S.componentDidMount=="function"&&(c.flags|=4194308),g=!0}else if(s===null){S=c.stateNode;var L=c.memoizedProps,K=bu(d,L);S.props=K;var ct=S.context,bt=d.contextType;N=cs,typeof bt=="object"&&bt!==null&&(N=Jn(bt));var Ct=d.getDerivedStateFromProps;bt=typeof Ct=="function"||typeof S.getSnapshotBeforeUpdate=="function",L=c.pendingProps!==L,bt||typeof S.UNSAFE_componentWillReceiveProps!="function"&&typeof S.componentWillReceiveProps!="function"||(L||ct!==N)&&Ux(c,S,g,N),mo=!1;var dt=c.memoizedState;S.state=dt,Hl(c,g,S,w),Gl(),ct=c.memoizedState,L||dt!==ct||mo?(typeof Ct=="function"&&(Zp(c,d,Ct,g),ct=c.memoizedState),(K=mo||zx(c,d,K,g,dt,ct,N))?(bt||typeof S.UNSAFE_componentWillMount!="function"&&typeof S.componentWillMount!="function"||(typeof S.componentWillMount=="function"&&S.componentWillMount(),typeof S.UNSAFE_componentWillMount=="function"&&S.UNSAFE_componentWillMount()),typeof S.componentDidMount=="function"&&(c.flags|=4194308)):(typeof S.componentDidMount=="function"&&(c.flags|=4194308),c.memoizedProps=g,c.memoizedState=ct),S.props=g,S.state=ct,S.context=N,g=K):(typeof S.componentDidMount=="function"&&(c.flags|=4194308),g=!1)}else{S=c.stateNode,Dp(s,c),N=c.memoizedProps,bt=bu(d,N),S.props=bt,Ct=c.pendingProps,dt=S.context,ct=d.contextType,K=cs,typeof ct=="object"&&ct!==null&&(K=Jn(ct)),L=d.getDerivedStateFromProps,(ct=typeof L=="function"||typeof S.getSnapshotBeforeUpdate=="function")||typeof S.UNSAFE_componentWillReceiveProps!="function"&&typeof S.componentWillReceiveProps!="function"||(N!==Ct||dt!==K)&&Ux(c,S,g,K),mo=!1,dt=c.memoizedState,S.state=dt,Hl(c,g,S,w),Gl();var pt=c.memoizedState;N!==Ct||dt!==pt||mo||s!==null&&s.dependencies!==null&&Ah(s.dependencies)?(typeof L=="function"&&(Zp(c,d,L,g),pt=c.memoizedState),(bt=mo||zx(c,d,bt,g,dt,pt,K)||s!==null&&s.dependencies!==null&&Ah(s.dependencies))?(ct||typeof S.UNSAFE_componentWillUpdate!="function"&&typeof S.componentWillUpdate!="function"||(typeof S.componentWillUpdate=="function"&&S.componentWillUpdate(g,pt,K),typeof S.UNSAFE_componentWillUpdate=="function"&&S.UNSAFE_componentWillUpdate(g,pt,K)),typeof S.componentDidUpdate=="function"&&(c.flags|=4),typeof S.getSnapshotBeforeUpdate=="function"&&(c.flags|=1024)):(typeof S.componentDidUpdate!="function"||N===s.memoizedProps&&dt===s.memoizedState||(c.flags|=4),typeof S.getSnapshotBeforeUpdate!="function"||N===s.memoizedProps&&dt===s.memoizedState||(c.flags|=1024),c.memoizedProps=g,c.memoizedState=pt),S.props=g,S.state=pt,S.context=K,g=bt):(typeof S.componentDidUpdate!="function"||N===s.memoizedProps&&dt===s.memoizedState||(c.flags|=4),typeof S.getSnapshotBeforeUpdate!="function"||N===s.memoizedProps&&dt===s.memoizedState||(c.flags|=1024),g=!1)}return S=g,jh(s,c),g=(c.flags&128)!==0,S||g?(S=c.stateNode,d=g&&typeof d.getDerivedStateFromError!="function"?null:S.render(),c.flags|=1,s!==null&&g?(c.child=bs(c,s.child,null,w),c.child=bs(c,null,d,w)):qn(s,c,d,w),c.memoizedState=S.state,s=c.child):s=Li(s,c,w),s}function eb(s,c,d,g){return Bl(),c.flags|=256,qn(s,c,d,g),c.child}var ev={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function nv(s){return{baseLanes:s,cachePool:V0()}}function rv(s,c,d){return s=s!==null?s.childLanes&~d:0,c&&(s|=ha),s}function nb(s,c,d){var g=c.pendingProps,w=!1,S=(c.flags&128)!==0,N;if((N=S)||(N=s!==null&&s.memoizedState===null?!1:(_n.current&2)!==0),N&&(w=!0,c.flags&=-129),N=(c.flags&32)!==0,c.flags&=-33,s===null){if(be){if(w?bo(c):wo(),be){var L=nn,K;if(K=L){t:{for(K=L,L=Ja;K.nodeType!==8;){if(!L){L=null;break t}if(K=Na(K.nextSibling),K===null){L=null;break t}}L=K}L!==null?(c.memoizedState={dehydrated:L,treeContext:fu!==null?{id:Ni,overflow:Oi}:null,retryLane:536870912,hydrationErrors:null},K=Pr(18,null,null,0),K.stateNode=L,K.return=c,c.child=K,fr=c,nn=null,K=!0):K=!1}K||vu(c)}if(L=c.memoizedState,L!==null&&(L=L.dehydrated,L!==null))return Uv(L)?c.lanes=32:c.lanes=536870912,null;Fi(c)}return L=g.children,g=g.fallback,w?(wo(),w=c.mode,L=Xh({mode:"hidden",children:L},w),g=hu(g,w,d,null),L.return=c,g.return=c,L.sibling=g,c.child=L,w=c.child,w.memoizedState=nv(d),w.childLanes=rv(s,N,d),c.memoizedState=ev,g):(bo(c),av(c,L))}if(K=s.memoizedState,K!==null&&(L=K.dehydrated,L!==null)){if(S)c.flags&256?(bo(c),c.flags&=-257,c=iv(s,c,d)):c.memoizedState!==null?(wo(),c.child=s.child,c.flags|=128,c=null):(wo(),w=g.fallback,L=c.mode,g=Xh({mode:"visible",children:g.children},L),w=hu(w,L,d,null),w.flags|=2,g.return=c,w.return=c,g.sibling=w,c.child=g,bs(c,s.child,null,d),g=c.child,g.memoizedState=nv(d),g.childLanes=rv(s,N,d),c.memoizedState=ev,c=w);else if(bo(c),Uv(L)){if(N=L.nextSibling&&L.nextSibling.dataset,N)var ct=N.dgst;N=ct,g=Error(n(419)),g.stack="",g.digest=N,Pl({value:g,source:null,stack:null}),c=iv(s,c,d)}else if(Fn||Fl(s,c,d,!1),N=(d&s.childLanes)!==0,Fn||N){if(N=Le,N!==null&&(g=d&-d,g=(g&42)!==0?1:na(g),g=(g&(N.suspendedLanes|d))!==0?0:g,g!==0&&g!==K.retryLane))throw K.retryLane=g,ls(s,g),Wr(N,s,g),Xx;L.data==="$?"||Cv(),c=iv(s,c,d)}else L.data==="$?"?(c.flags|=192,c.child=s.child,c=null):(s=K.treeContext,nn=Na(L.nextSibling),fr=c,be=!0,pu=null,Ja=!1,s!==null&&(sa[la++]=Ni,sa[la++]=Oi,sa[la++]=fu,Ni=s.id,Oi=s.overflow,fu=c),c=av(c,g.children),c.flags|=4096);return c}return w?(wo(),w=g.fallback,L=c.mode,K=s.child,ct=K.sibling,g=Ii(K,{mode:"hidden",children:g.children}),g.subtreeFlags=K.subtreeFlags&65011712,ct!==null?w=Ii(ct,w):(w=hu(w,L,d,null),w.flags|=2),w.return=c,g.return=c,g.sibling=w,c.child=g,g=w,w=c.child,L=s.child.memoizedState,L===null?L=nv(d):(K=L.cachePool,K!==null?(ct=Rn._currentValue,K=K.parent!==ct?{parent:ct,pool:ct}:K):K=V0(),L={baseLanes:L.baseLanes|d,cachePool:K}),w.memoizedState=L,w.childLanes=rv(s,N,d),c.memoizedState=ev,g):(bo(c),d=s.child,s=d.sibling,d=Ii(d,{mode:"visible",children:g.children}),d.return=c,d.sibling=null,s!==null&&(N=c.deletions,N===null?(c.deletions=[s],c.flags|=16):N.push(s)),c.child=d,c.memoizedState=null,d)}function av(s,c){return c=Xh({mode:"visible",children:c},s.mode),c.return=s,s.child=c}function Xh(s,c){return s=Pr(22,s,null,c),s.lanes=0,s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},s}function iv(s,c,d){return bs(c,s.child,null,d),s=av(c,c.pendingProps.children),s.flags|=2,c.memoizedState=null,s}function rb(s,c,d){s.lanes|=c;var g=s.alternate;g!==null&&(g.lanes|=c),Cp(s.return,c,d)}function ov(s,c,d,g,w){var S=s.memoizedState;S===null?s.memoizedState={isBackwards:c,rendering:null,renderingStartTime:0,last:g,tail:d,tailMode:w}:(S.isBackwards=c,S.rendering=null,S.renderingStartTime=0,S.last=g,S.tail=d,S.tailMode=w)}function ab(s,c,d){var g=c.pendingProps,w=g.revealOrder,S=g.tail;if(qn(s,c,g.children,d),g=_n.current,(g&2)!==0)g=g&1|2,c.flags|=128;else{if(s!==null&&(s.flags&128)!==0)t:for(s=c.child;s!==null;){if(s.tag===13)s.memoizedState!==null&&rb(s,d,c);else if(s.tag===19)rb(s,d,c);else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===c)break t;for(;s.sibling===null;){if(s.return===null||s.return===c)break t;s=s.return}s.sibling.return=s.return,s=s.sibling}g&=1}switch(ft(_n,g),w){case"forwards":for(d=c.child,w=null;d!==null;)s=d.alternate,s!==null&&Gh(s)===null&&(w=d),d=d.sibling;d=w,d===null?(w=c.child,c.child=null):(w=d.sibling,d.sibling=null),ov(c,!1,w,d,S);break;case"backwards":for(d=null,w=c.child,c.child=null;w!==null;){if(s=w.alternate,s!==null&&Gh(s)===null){c.child=w;break}s=w.sibling,w.sibling=d,d=w,w=s}ov(c,!0,d,null,S);break;case"together":ov(c,!1,null,null,void 0);break;default:c.memoizedState=null}return c.child}function Li(s,c,d){if(s!==null&&(c.dependencies=s.dependencies),_o|=c.lanes,(d&c.childLanes)===0)if(s!==null){if(Fl(s,c,d,!1),(d&c.childLanes)===0)return null}else return null;if(s!==null&&c.child!==s.child)throw Error(n(153));if(c.child!==null){for(s=c.child,d=Ii(s,s.pendingProps),c.child=d,d.return=c;s.sibling!==null;)s=s.sibling,d=d.sibling=Ii(s,s.pendingProps),d.return=c;d.sibling=null}return c.child}function uv(s,c){return(s.lanes&c)!==0?!0:(s=s.dependencies,!!(s!==null&&Ah(s)))}function nT(s,c,d){switch(c.tag){case 3:_t(c,c.stateNode.containerInfo),vo(c,Rn,s.memoizedState.cache),Bl();break;case 27:case 5:jt(c);break;case 4:_t(c,c.stateNode.containerInfo);break;case 10:vo(c,c.type,c.memoizedProps.value);break;case 13:var g=c.memoizedState;if(g!==null)return g.dehydrated!==null?(bo(c),c.flags|=128,null):(d&c.child.childLanes)!==0?nb(s,c,d):(bo(c),s=Li(s,c,d),s!==null?s.sibling:null);bo(c);break;case 19:var w=(s.flags&128)!==0;if(g=(d&c.childLanes)!==0,g||(Fl(s,c,d,!1),g=(d&c.childLanes)!==0),w){if(g)return ab(s,c,d);c.flags|=128}if(w=c.memoizedState,w!==null&&(w.rendering=null,w.tail=null,w.lastEffect=null),ft(_n,_n.current),g)break;return null;case 22:case 23:return c.lanes=0,Zx(s,c,d);case 24:vo(c,Rn,s.memoizedState.cache)}return Li(s,c,d)}function ib(s,c,d){if(s!==null)if(s.memoizedProps!==c.pendingProps)Fn=!0;else{if(!uv(s,d)&&(c.flags&128)===0)return Fn=!1,nT(s,c,d);Fn=(s.flags&131072)!==0}else Fn=!1,be&&(c.flags&1048576)!==0&&B0(c,_h,c.index);switch(c.lanes=0,c.tag){case 16:t:{s=c.pendingProps;var g=c.elementType,w=g._init;if(g=w(g._payload),c.type=g,typeof g=="function")mp(g)?(s=bu(g,s),c.tag=1,c=tb(null,c,g,s,d)):(c.tag=0,c=tv(null,c,g,s,d));else{if(g!=null){if(w=g.$$typeof,w===A){c.tag=11,c=Kx(null,c,g,s,d);break t}else if(w===P){c.tag=14,c=Yx(null,c,g,s,d);break t}}throw c=nt(g)||g,Error(n(306,c,""))}}return c;case 0:return tv(s,c,c.type,c.pendingProps,d);case 1:return g=c.type,w=bu(g,c.pendingProps),tb(s,c,g,w,d);case 3:t:{if(_t(c,c.stateNode.containerInfo),s===null)throw Error(n(387));g=c.pendingProps;var S=c.memoizedState;w=S.element,Dp(s,c),Hl(c,g,null,d);var N=c.memoizedState;if(g=N.cache,vo(c,Rn,g),g!==S.cache&&Sp(c,[Rn],d,!0),Gl(),g=N.element,S.isDehydrated)if(S={element:g,isDehydrated:!1,cache:N.cache},c.updateQueue.baseState=S,c.memoizedState=S,c.flags&256){c=eb(s,c,g,d);break t}else if(g!==w){w=oa(Error(n(424)),c),Pl(w),c=eb(s,c,g,d);break t}else{switch(s=c.stateNode.containerInfo,s.nodeType){case 9:s=s.body;break;default:s=s.nodeName==="HTML"?s.ownerDocument.body:s}for(nn=Na(s.firstChild),fr=c,be=!0,pu=null,Ja=!0,d=Fx(c,null,g,d),c.child=d;d;)d.flags=d.flags&-3|4096,d=d.sibling}else{if(Bl(),g===w){c=Li(s,c,d);break t}qn(s,c,g,d)}c=c.child}return c;case 26:return jh(s,c),s===null?(d=l1(c.type,null,c.pendingProps,null))?c.memoizedState=d:be||(d=c.type,s=c.pendingProps,g=sf(Rt.current).createElement(d),g[Mn]=c,g[Ke]=s,Xn(g,d,s),mn(g),c.stateNode=g):c.memoizedState=l1(c.type,s.memoizedProps,c.pendingProps,s.memoizedState),null;case 27:return jt(c),s===null&&be&&(g=c.stateNode=o1(c.type,c.pendingProps,Rt.current),fr=c,Ja=!0,w=nn,Do(c.type)?(Wv=w,nn=Na(g.firstChild)):nn=w),qn(s,c,c.pendingProps.children,d),jh(s,c),s===null&&(c.flags|=4194304),c.child;case 5:return s===null&&be&&((w=g=nn)&&(g=DT(g,c.type,c.pendingProps,Ja),g!==null?(c.stateNode=g,fr=c,nn=Na(g.firstChild),Ja=!1,w=!0):w=!1),w||vu(c)),jt(c),w=c.type,S=c.pendingProps,N=s!==null?s.memoizedProps:null,g=S.children,Fv(w,S)?g=null:N!==null&&Fv(w,N)&&(c.flags|=32),c.memoizedState!==null&&(w=Pp(s,c,KA,null,null,d),fc._currentValue=w),jh(s,c),qn(s,c,g,d),c.child;case 6:return s===null&&be&&((s=d=nn)&&(d=IT(d,c.pendingProps,Ja),d!==null?(c.stateNode=d,fr=c,nn=null,s=!0):s=!1),s||vu(c)),null;case 13:return nb(s,c,d);case 4:return _t(c,c.stateNode.containerInfo),g=c.pendingProps,s===null?c.child=bs(c,null,g,d):qn(s,c,g,d),c.child;case 11:return Kx(s,c,c.type,c.pendingProps,d);case 7:return qn(s,c,c.pendingProps,d),c.child;case 8:return qn(s,c,c.pendingProps.children,d),c.child;case 12:return qn(s,c,c.pendingProps.children,d),c.child;case 10:return g=c.pendingProps,vo(c,c.type,g.value),qn(s,c,g.children,d),c.child;case 9:return w=c.type._context,g=c.pendingProps.children,gu(c),w=Jn(w),g=g(w),c.flags|=1,qn(s,c,g,d),c.child;case 14:return Yx(s,c,c.type,c.pendingProps,d);case 15:return Qx(s,c,c.type,c.pendingProps,d);case 19:return ab(s,c,d);case 31:return g=c.pendingProps,d=c.mode,g={mode:g.mode,children:g.children},s===null?(d=Xh(g,d),d.ref=c.ref,c.child=d,d.return=c,c=d):(d=Ii(s.child,g),d.ref=c.ref,c.child=d,d.return=c,c=d),c;case 22:return Zx(s,c,d);case 24:return gu(c),g=Jn(Rn),s===null?(w=Ap(),w===null&&(w=Le,S=Rp(),w.pooledCache=S,S.refCount++,S!==null&&(w.pooledCacheLanes|=d),w=S),c.memoizedState={parent:g,cache:w},kp(c),vo(c,Rn,w)):((s.lanes&d)!==0&&(Dp(s,c),Hl(c,null,null,d),Gl()),w=s.memoizedState,S=c.memoizedState,w.parent!==g?(w={parent:g,cache:g},c.memoizedState=w,c.lanes===0&&(c.memoizedState=c.updateQueue.baseState=w),vo(c,Rn,g)):(g=S.cache,vo(c,Rn,g),g!==w.cache&&Sp(c,[Rn],d,!0))),qn(s,c,c.pendingProps.children,d),c.child;case 29:throw c.pendingProps}throw Error(n(156,c.tag))}function zi(s){s.flags|=4}function ob(s,c){if(c.type!=="stylesheet"||(c.state.loading&4)!==0)s.flags&=-16777217;else if(s.flags|=16777216,!p1(c)){if(c=ca.current,c!==null&&((pe&4194048)===pe?ti!==null:(pe&62914560)!==pe&&(pe&536870912)===0||c!==ti))throw Wl=Tp,G0;s.flags|=8192}}function Kh(s,c){c!==null&&(s.flags|=4),s.flags&16384&&(c=s.tag!==22?Sa():536870912,s.lanes|=c,Ss|=c)}function Zl(s,c){if(!be)switch(s.tailMode){case"hidden":c=s.tail;for(var d=null;c!==null;)c.alternate!==null&&(d=c),c=c.sibling;d===null?s.tail=null:d.sibling=null;break;case"collapsed":d=s.tail;for(var g=null;d!==null;)d.alternate!==null&&(g=d),d=d.sibling;g===null?c||s.tail===null?s.tail=null:s.tail.sibling=null:g.sibling=null}}function Ye(s){var c=s.alternate!==null&&s.alternate.child===s.child,d=0,g=0;if(c)for(var w=s.child;w!==null;)d|=w.lanes|w.childLanes,g|=w.subtreeFlags&65011712,g|=w.flags&65011712,w.return=s,w=w.sibling;else for(w=s.child;w!==null;)d|=w.lanes|w.childLanes,g|=w.subtreeFlags,g|=w.flags,w.return=s,w=w.sibling;return s.subtreeFlags|=g,s.childLanes=d,c}function rT(s,c,d){var g=c.pendingProps;switch(bp(c),c.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ye(c),null;case 1:return Ye(c),null;case 3:return d=c.stateNode,g=null,s!==null&&(g=s.memoizedState.cache),c.memoizedState.cache!==g&&(c.flags|=2048),Bi(Rn),Pt(),d.pendingContext&&(d.context=d.pendingContext,d.pendingContext=null),(s===null||s.child===null)&&(Ml(c)?zi(c):s===null||s.memoizedState.isDehydrated&&(c.flags&256)===0||(c.flags|=1024,L0())),Ye(c),null;case 26:return d=c.memoizedState,s===null?(zi(c),d!==null?(Ye(c),ob(c,d)):(Ye(c),c.flags&=-16777217)):d?d!==s.memoizedState?(zi(c),Ye(c),ob(c,d)):(Ye(c),c.flags&=-16777217):(s.memoizedProps!==g&&zi(c),Ye(c),c.flags&=-16777217),null;case 27:Ft(c),d=Rt.current;var w=c.type;if(s!==null&&c.stateNode!=null)s.memoizedProps!==g&&zi(c);else{if(!g){if(c.stateNode===null)throw Error(n(166));return Ye(c),null}s=xt.current,Ml(c)?P0(c):(s=o1(w,g,d),c.stateNode=s,zi(c))}return Ye(c),null;case 5:if(Ft(c),d=c.type,s!==null&&c.stateNode!=null)s.memoizedProps!==g&&zi(c);else{if(!g){if(c.stateNode===null)throw Error(n(166));return Ye(c),null}if(s=xt.current,Ml(c))P0(c);else{switch(w=sf(Rt.current),s){case 1:s=w.createElementNS("http://www.w3.org/2000/svg",d);break;case 2:s=w.createElementNS("http://www.w3.org/1998/Math/MathML",d);break;default:switch(d){case"svg":s=w.createElementNS("http://www.w3.org/2000/svg",d);break;case"math":s=w.createElementNS("http://www.w3.org/1998/Math/MathML",d);break;case"script":s=w.createElement("div"),s.innerHTML="<script><\/script>",s=s.removeChild(s.firstChild);break;case"select":s=typeof g.is=="string"?w.createElement("select",{is:g.is}):w.createElement("select"),g.multiple?s.multiple=!0:g.size&&(s.size=g.size);break;default:s=typeof g.is=="string"?w.createElement(d,{is:g.is}):w.createElement(d)}}s[Mn]=c,s[Ke]=g;t:for(w=c.child;w!==null;){if(w.tag===5||w.tag===6)s.appendChild(w.stateNode);else if(w.tag!==4&&w.tag!==27&&w.child!==null){w.child.return=w,w=w.child;continue}if(w===c)break t;for(;w.sibling===null;){if(w.return===null||w.return===c)break t;w=w.return}w.sibling.return=w.return,w=w.sibling}c.stateNode=s;t:switch(Xn(s,d,g),d){case"button":case"input":case"select":case"textarea":s=!!g.autoFocus;break t;case"img":s=!0;break t;default:s=!1}s&&zi(c)}}return Ye(c),c.flags&=-16777217,null;case 6:if(s&&c.stateNode!=null)s.memoizedProps!==g&&zi(c);else{if(typeof g!="string"&&c.stateNode===null)throw Error(n(166));if(s=Rt.current,Ml(c)){if(s=c.stateNode,d=c.memoizedProps,g=null,w=fr,w!==null)switch(w.tag){case 27:case 5:g=w.memoizedProps}s[Mn]=c,s=!!(s.nodeValue===d||g!==null&&g.suppressHydrationWarning===!0||Jb(s.nodeValue,d)),s||vu(c)}else s=sf(s).createTextNode(g),s[Mn]=c,c.stateNode=s}return Ye(c),null;case 13:if(g=c.memoizedState,s===null||s.memoizedState!==null&&s.memoizedState.dehydrated!==null){if(w=Ml(c),g!==null&&g.dehydrated!==null){if(s===null){if(!w)throw Error(n(318));if(w=c.memoizedState,w=w!==null?w.dehydrated:null,!w)throw Error(n(317));w[Mn]=c}else Bl(),(c.flags&128)===0&&(c.memoizedState=null),c.flags|=4;Ye(c),w=!1}else w=L0(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=w),w=!0;if(!w)return c.flags&256?(Fi(c),c):(Fi(c),null)}if(Fi(c),(c.flags&128)!==0)return c.lanes=d,c;if(d=g!==null,s=s!==null&&s.memoizedState!==null,d){g=c.child,w=null,g.alternate!==null&&g.alternate.memoizedState!==null&&g.alternate.memoizedState.cachePool!==null&&(w=g.alternate.memoizedState.cachePool.pool);var S=null;g.memoizedState!==null&&g.memoizedState.cachePool!==null&&(S=g.memoizedState.cachePool.pool),S!==w&&(g.flags|=2048)}return d!==s&&d&&(c.child.flags|=8192),Kh(c,c.updateQueue),Ye(c),null;case 4:return Pt(),s===null&&Nv(c.stateNode.containerInfo),Ye(c),null;case 10:return Bi(c.type),Ye(c),null;case 19:if(ht(_n),w=c.memoizedState,w===null)return Ye(c),null;if(g=(c.flags&128)!==0,S=w.rendering,S===null)if(g)Zl(w,!1);else{if(rn!==0||s!==null&&(s.flags&128)!==0)for(s=c.child;s!==null;){if(S=Gh(s),S!==null){for(c.flags|=128,Zl(w,!1),s=S.updateQueue,c.updateQueue=s,Kh(c,s),c.subtreeFlags=0,s=d,d=c.child;d!==null;)M0(d,s),d=d.sibling;return ft(_n,_n.current&1|2),c.child}s=s.sibling}w.tail!==null&&Te()>Zh&&(c.flags|=128,g=!0,Zl(w,!1),c.lanes=4194304)}else{if(!g)if(s=Gh(S),s!==null){if(c.flags|=128,g=!0,s=s.updateQueue,c.updateQueue=s,Kh(c,s),Zl(w,!0),w.tail===null&&w.tailMode==="hidden"&&!S.alternate&&!be)return Ye(c),null}else 2*Te()-w.renderingStartTime>Zh&&d!==536870912&&(c.flags|=128,g=!0,Zl(w,!1),c.lanes=4194304);w.isBackwards?(S.sibling=c.child,c.child=S):(s=w.last,s!==null?s.sibling=S:c.child=S,w.last=S)}return w.tail!==null?(c=w.tail,w.rendering=c,w.tail=c.sibling,w.renderingStartTime=Te(),c.sibling=null,s=_n.current,ft(_n,g?s&1|2:s&1),c):(Ye(c),null);case 22:case 23:return Fi(c),Mp(),g=c.memoizedState!==null,s!==null?s.memoizedState!==null!==g&&(c.flags|=8192):g&&(c.flags|=8192),g?(d&536870912)!==0&&(c.flags&128)===0&&(Ye(c),c.subtreeFlags&6&&(c.flags|=8192)):Ye(c),d=c.updateQueue,d!==null&&Kh(c,d.retryQueue),d=null,s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(d=s.memoizedState.cachePool.pool),g=null,c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(g=c.memoizedState.cachePool.pool),g!==d&&(c.flags|=2048),s!==null&&ht(yu),null;case 24:return d=null,s!==null&&(d=s.memoizedState.cache),c.memoizedState.cache!==d&&(c.flags|=2048),Bi(Rn),Ye(c),null;case 25:return null;case 30:return null}throw Error(n(156,c.tag))}function aT(s,c){switch(bp(c),c.tag){case 1:return s=c.flags,s&65536?(c.flags=s&-65537|128,c):null;case 3:return Bi(Rn),Pt(),s=c.flags,(s&65536)!==0&&(s&128)===0?(c.flags=s&-65537|128,c):null;case 26:case 27:case 5:return Ft(c),null;case 13:if(Fi(c),s=c.memoizedState,s!==null&&s.dehydrated!==null){if(c.alternate===null)throw Error(n(340));Bl()}return s=c.flags,s&65536?(c.flags=s&-65537|128,c):null;case 19:return ht(_n),null;case 4:return Pt(),null;case 10:return Bi(c.type),null;case 22:case 23:return Fi(c),Mp(),s!==null&&ht(yu),s=c.flags,s&65536?(c.flags=s&-65537|128,c):null;case 24:return Bi(Rn),null;case 25:return null;default:return null}}function ub(s,c){switch(bp(c),c.tag){case 3:Bi(Rn),Pt();break;case 26:case 27:case 5:Ft(c);break;case 4:Pt();break;case 13:Fi(c);break;case 19:ht(_n);break;case 10:Bi(c.type);break;case 22:case 23:Fi(c),Mp(),s!==null&&ht(yu);break;case 24:Bi(Rn)}}function $l(s,c){try{var d=c.updateQueue,g=d!==null?d.lastEffect:null;if(g!==null){var w=g.next;d=w;do{if((d.tag&s)===s){g=void 0;var S=d.create,N=d.inst;g=S(),N.destroy=g}d=d.next}while(d!==w)}}catch(L){Pe(c,c.return,L)}}function Eo(s,c,d){try{var g=c.updateQueue,w=g!==null?g.lastEffect:null;if(w!==null){var S=w.next;g=S;do{if((g.tag&s)===s){var N=g.inst,L=N.destroy;if(L!==void 0){N.destroy=void 0,w=c;var K=d,ct=L;try{ct()}catch(bt){Pe(w,K,bt)}}}g=g.next}while(g!==S)}}catch(bt){Pe(c,c.return,bt)}}function sb(s){var c=s.updateQueue;if(c!==null){var d=s.stateNode;try{Y0(c,d)}catch(g){Pe(s,s.return,g)}}}function lb(s,c,d){d.props=bu(s.type,s.memoizedProps),d.state=s.memoizedState;try{d.componentWillUnmount()}catch(g){Pe(s,c,g)}}function Jl(s,c){try{var d=s.ref;if(d!==null){switch(s.tag){case 26:case 27:case 5:var g=s.stateNode;break;case 30:g=s.stateNode;break;default:g=s.stateNode}typeof d=="function"?s.refCleanup=d(g):d.current=g}}catch(w){Pe(s,c,w)}}function ei(s,c){var d=s.ref,g=s.refCleanup;if(d!==null)if(typeof g=="function")try{g()}catch(w){Pe(s,c,w)}finally{s.refCleanup=null,s=s.alternate,s!=null&&(s.refCleanup=null)}else if(typeof d=="function")try{d(null)}catch(w){Pe(s,c,w)}else d.current=null}function cb(s){var c=s.type,d=s.memoizedProps,g=s.stateNode;try{t:switch(c){case"button":case"input":case"select":case"textarea":d.autoFocus&&g.focus();break t;case"img":d.src?g.src=d.src:d.srcSet&&(g.srcset=d.srcSet)}}catch(w){Pe(s,s.return,w)}}function sv(s,c,d){try{var g=s.stateNode;RT(g,s.type,d,c),g[Ke]=c}catch(w){Pe(s,s.return,w)}}function hb(s){return s.tag===5||s.tag===3||s.tag===26||s.tag===27&&Do(s.type)||s.tag===4}function lv(s){t:for(;;){for(;s.sibling===null;){if(s.return===null||hb(s.return))return null;s=s.return}for(s.sibling.return=s.return,s=s.sibling;s.tag!==5&&s.tag!==6&&s.tag!==18;){if(s.tag===27&&Do(s.type)||s.flags&2||s.child===null||s.tag===4)continue t;s.child.return=s,s=s.child}if(!(s.flags&2))return s.stateNode}}function cv(s,c,d){var g=s.tag;if(g===5||g===6)s=s.stateNode,c?(d.nodeType===9?d.body:d.nodeName==="HTML"?d.ownerDocument.body:d).insertBefore(s,c):(c=d.nodeType===9?d.body:d.nodeName==="HTML"?d.ownerDocument.body:d,c.appendChild(s),d=d._reactRootContainer,d!=null||c.onclick!==null||(c.onclick=uf));else if(g!==4&&(g===27&&Do(s.type)&&(d=s.stateNode,c=null),s=s.child,s!==null))for(cv(s,c,d),s=s.sibling;s!==null;)cv(s,c,d),s=s.sibling}function Yh(s,c,d){var g=s.tag;if(g===5||g===6)s=s.stateNode,c?d.insertBefore(s,c):d.appendChild(s);else if(g!==4&&(g===27&&Do(s.type)&&(d=s.stateNode),s=s.child,s!==null))for(Yh(s,c,d),s=s.sibling;s!==null;)Yh(s,c,d),s=s.sibling}function fb(s){var c=s.stateNode,d=s.memoizedProps;try{for(var g=s.type,w=c.attributes;w.length;)c.removeAttributeNode(w[0]);Xn(c,g,d),c[Mn]=s,c[Ke]=d}catch(S){Pe(s,s.return,S)}}var Ui=!1,fn=!1,hv=!1,db=typeof WeakSet=="function"?WeakSet:Set,Ln=null;function iT(s,c){if(s=s.containerInfo,Bv=pf,s=S0(s),lp(s)){if("selectionStart"in s)var d={start:s.selectionStart,end:s.selectionEnd};else t:{d=(d=s.ownerDocument)&&d.defaultView||window;var g=d.getSelection&&d.getSelection();if(g&&g.rangeCount!==0){d=g.anchorNode;var w=g.anchorOffset,S=g.focusNode;g=g.focusOffset;try{d.nodeType,S.nodeType}catch{d=null;break t}var N=0,L=-1,K=-1,ct=0,bt=0,Ct=s,dt=null;e:for(;;){for(var pt;Ct!==d||w!==0&&Ct.nodeType!==3||(L=N+w),Ct!==S||g!==0&&Ct.nodeType!==3||(K=N+g),Ct.nodeType===3&&(N+=Ct.nodeValue.length),(pt=Ct.firstChild)!==null;)dt=Ct,Ct=pt;for(;;){if(Ct===s)break e;if(dt===d&&++ct===w&&(L=N),dt===S&&++bt===g&&(K=N),(pt=Ct.nextSibling)!==null)break;Ct=dt,dt=Ct.parentNode}Ct=pt}d=L===-1||K===-1?null:{start:L,end:K}}else d=null}d=d||{start:0,end:0}}else d=null;for(Pv={focusedElem:s,selectionRange:d},pf=!1,Ln=c;Ln!==null;)if(c=Ln,s=c.child,(c.subtreeFlags&1024)!==0&&s!==null)s.return=c,Ln=s;else for(;Ln!==null;){switch(c=Ln,S=c.alternate,s=c.flags,c.tag){case 0:break;case 11:case 15:break;case 1:if((s&1024)!==0&&S!==null){s=void 0,d=c,w=S.memoizedProps,S=S.memoizedState,g=d.stateNode;try{var Qt=bu(d.type,w,d.elementType===d.type);s=g.getSnapshotBeforeUpdate(Qt,S),g.__reactInternalSnapshotBeforeUpdate=s}catch(Xt){Pe(d,d.return,Xt)}}break;case 3:if((s&1024)!==0){if(s=c.stateNode.containerInfo,d=s.nodeType,d===9)zv(s);else if(d===1)switch(s.nodeName){case"HEAD":case"HTML":case"BODY":zv(s);break;default:s.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((s&1024)!==0)throw Error(n(163))}if(s=c.sibling,s!==null){s.return=c.return,Ln=s;break}Ln=c.return}}function pb(s,c,d){var g=d.flags;switch(d.tag){case 0:case 11:case 15:Co(s,d),g&4&&$l(5,d);break;case 1:if(Co(s,d),g&4)if(s=d.stateNode,c===null)try{s.componentDidMount()}catch(N){Pe(d,d.return,N)}else{var w=bu(d.type,c.memoizedProps);c=c.memoizedState;try{s.componentDidUpdate(w,c,s.__reactInternalSnapshotBeforeUpdate)}catch(N){Pe(d,d.return,N)}}g&64&&sb(d),g&512&&Jl(d,d.return);break;case 3:if(Co(s,d),g&64&&(s=d.updateQueue,s!==null)){if(c=null,d.child!==null)switch(d.child.tag){case 27:case 5:c=d.child.stateNode;break;case 1:c=d.child.stateNode}try{Y0(s,c)}catch(N){Pe(d,d.return,N)}}break;case 27:c===null&&g&4&&fb(d);case 26:case 5:Co(s,d),c===null&&g&4&&cb(d),g&512&&Jl(d,d.return);break;case 12:Co(s,d);break;case 13:Co(s,d),g&4&&gb(s,d),g&64&&(s=d.memoizedState,s!==null&&(s=s.dehydrated,s!==null&&(d=pT.bind(null,d),NT(s,d))));break;case 22:if(g=d.memoizedState!==null||Ui,!g){c=c!==null&&c.memoizedState!==null||fn,w=Ui;var S=fn;Ui=g,(fn=c)&&!S?So(s,d,(d.subtreeFlags&8772)!==0):Co(s,d),Ui=w,fn=S}break;case 30:break;default:Co(s,d)}}function vb(s){var c=s.alternate;c!==null&&(s.alternate=null,vb(c)),s.child=null,s.deletions=null,s.sibling=null,s.tag===5&&(c=s.stateNode,c!==null&&au(c)),s.stateNode=null,s.return=null,s.dependencies=null,s.memoizedProps=null,s.memoizedState=null,s.pendingProps=null,s.stateNode=null,s.updateQueue=null}var qe=null,wr=!1;function Wi(s,c,d){for(d=d.child;d!==null;)mb(s,c,d),d=d.sibling}function mb(s,c,d){if(Be&&typeof Be.onCommitFiberUnmount=="function")try{Be.onCommitFiberUnmount(On,d)}catch{}switch(d.tag){case 26:fn||ei(d,c),Wi(s,c,d),d.memoizedState?d.memoizedState.count--:d.stateNode&&(d=d.stateNode,d.parentNode.removeChild(d));break;case 27:fn||ei(d,c);var g=qe,w=wr;Do(d.type)&&(qe=d.stateNode,wr=!1),Wi(s,c,d),sc(d.stateNode),qe=g,wr=w;break;case 5:fn||ei(d,c);case 6:if(g=qe,w=wr,qe=null,Wi(s,c,d),qe=g,wr=w,qe!==null)if(wr)try{(qe.nodeType===9?qe.body:qe.nodeName==="HTML"?qe.ownerDocument.body:qe).removeChild(d.stateNode)}catch(S){Pe(d,c,S)}else try{qe.removeChild(d.stateNode)}catch(S){Pe(d,c,S)}break;case 18:qe!==null&&(wr?(s=qe,a1(s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s,d.stateNode),mc(s)):a1(qe,d.stateNode));break;case 4:g=qe,w=wr,qe=d.stateNode.containerInfo,wr=!0,Wi(s,c,d),qe=g,wr=w;break;case 0:case 11:case 14:case 15:fn||Eo(2,d,c),fn||Eo(4,d,c),Wi(s,c,d);break;case 1:fn||(ei(d,c),g=d.stateNode,typeof g.componentWillUnmount=="function"&&lb(d,c,g)),Wi(s,c,d);break;case 21:Wi(s,c,d);break;case 22:fn=(g=fn)||d.memoizedState!==null,Wi(s,c,d),fn=g;break;default:Wi(s,c,d)}}function gb(s,c){if(c.memoizedState===null&&(s=c.alternate,s!==null&&(s=s.memoizedState,s!==null&&(s=s.dehydrated,s!==null))))try{mc(s)}catch(d){Pe(c,c.return,d)}}function oT(s){switch(s.tag){case 13:case 19:var c=s.stateNode;return c===null&&(c=s.stateNode=new db),c;case 22:return s=s.stateNode,c=s._retryCache,c===null&&(c=s._retryCache=new db),c;default:throw Error(n(435,s.tag))}}function fv(s,c){var d=oT(s);c.forEach(function(g){var w=vT.bind(null,s,g);d.has(g)||(d.add(g),g.then(w,w))})}function Fr(s,c){var d=c.deletions;if(d!==null)for(var g=0;g<d.length;g++){var w=d[g],S=s,N=c,L=N;t:for(;L!==null;){switch(L.tag){case 27:if(Do(L.type)){qe=L.stateNode,wr=!1;break t}break;case 5:qe=L.stateNode,wr=!1;break t;case 3:case 4:qe=L.stateNode.containerInfo,wr=!0;break t}L=L.return}if(qe===null)throw Error(n(160));mb(S,N,w),qe=null,wr=!1,S=w.alternate,S!==null&&(S.return=null),w.return=null}if(c.subtreeFlags&13878)for(c=c.child;c!==null;)yb(c,s),c=c.sibling}var Ia=null;function yb(s,c){var d=s.alternate,g=s.flags;switch(s.tag){case 0:case 11:case 14:case 15:Fr(c,s),Lr(s),g&4&&(Eo(3,s,s.return),$l(3,s),Eo(5,s,s.return));break;case 1:Fr(c,s),Lr(s),g&512&&(fn||d===null||ei(d,d.return)),g&64&&Ui&&(s=s.updateQueue,s!==null&&(g=s.callbacks,g!==null&&(d=s.shared.hiddenCallbacks,s.shared.hiddenCallbacks=d===null?g:d.concat(g))));break;case 26:var w=Ia;if(Fr(c,s),Lr(s),g&512&&(fn||d===null||ei(d,d.return)),g&4){var S=d!==null?d.memoizedState:null;if(g=s.memoizedState,d===null)if(g===null)if(s.stateNode===null){t:{g=s.type,d=s.memoizedProps,w=w.ownerDocument||w;e:switch(g){case"title":S=w.getElementsByTagName("title")[0],(!S||S[gr]||S[Mn]||S.namespaceURI==="http://www.w3.org/2000/svg"||S.hasAttribute("itemprop"))&&(S=w.createElement(g),w.head.insertBefore(S,w.querySelector("head > title"))),Xn(S,g,d),S[Mn]=s,mn(S),g=S;break t;case"link":var N=f1("link","href",w).get(g+(d.href||""));if(N){for(var L=0;L<N.length;L++)if(S=N[L],S.getAttribute("href")===(d.href==null||d.href===""?null:d.href)&&S.getAttribute("rel")===(d.rel==null?null:d.rel)&&S.getAttribute("title")===(d.title==null?null:d.title)&&S.getAttribute("crossorigin")===(d.crossOrigin==null?null:d.crossOrigin)){N.splice(L,1);break e}}S=w.createElement(g),Xn(S,g,d),w.head.appendChild(S);break;case"meta":if(N=f1("meta","content",w).get(g+(d.content||""))){for(L=0;L<N.length;L++)if(S=N[L],S.getAttribute("content")===(d.content==null?null:""+d.content)&&S.getAttribute("name")===(d.name==null?null:d.name)&&S.getAttribute("property")===(d.property==null?null:d.property)&&S.getAttribute("http-equiv")===(d.httpEquiv==null?null:d.httpEquiv)&&S.getAttribute("charset")===(d.charSet==null?null:d.charSet)){N.splice(L,1);break e}}S=w.createElement(g),Xn(S,g,d),w.head.appendChild(S);break;default:throw Error(n(468,g))}S[Mn]=s,mn(S),g=S}s.stateNode=g}else d1(w,s.type,s.stateNode);else s.stateNode=h1(w,g,s.memoizedProps);else S!==g?(S===null?d.stateNode!==null&&(d=d.stateNode,d.parentNode.removeChild(d)):S.count--,g===null?d1(w,s.type,s.stateNode):h1(w,g,s.memoizedProps)):g===null&&s.stateNode!==null&&sv(s,s.memoizedProps,d.memoizedProps)}break;case 27:Fr(c,s),Lr(s),g&512&&(fn||d===null||ei(d,d.return)),d!==null&&g&4&&sv(s,s.memoizedProps,d.memoizedProps);break;case 5:if(Fr(c,s),Lr(s),g&512&&(fn||d===null||ei(d,d.return)),s.flags&32){w=s.stateNode;try{y(w,"")}catch(pt){Pe(s,s.return,pt)}}g&4&&s.stateNode!=null&&(w=s.memoizedProps,sv(s,w,d!==null?d.memoizedProps:w)),g&1024&&(hv=!0);break;case 6:if(Fr(c,s),Lr(s),g&4){if(s.stateNode===null)throw Error(n(162));g=s.memoizedProps,d=s.stateNode;try{d.nodeValue=g}catch(pt){Pe(s,s.return,pt)}}break;case 3:if(hf=null,w=Ia,Ia=lf(c.containerInfo),Fr(c,s),Ia=w,Lr(s),g&4&&d!==null&&d.memoizedState.isDehydrated)try{mc(c.containerInfo)}catch(pt){Pe(s,s.return,pt)}hv&&(hv=!1,xb(s));break;case 4:g=Ia,Ia=lf(s.stateNode.containerInfo),Fr(c,s),Lr(s),Ia=g;break;case 12:Fr(c,s),Lr(s);break;case 13:Fr(c,s),Lr(s),s.child.flags&8192&&s.memoizedState!==null!=(d!==null&&d.memoizedState!==null)&&(yv=Te()),g&4&&(g=s.updateQueue,g!==null&&(s.updateQueue=null,fv(s,g)));break;case 22:w=s.memoizedState!==null;var K=d!==null&&d.memoizedState!==null,ct=Ui,bt=fn;if(Ui=ct||w,fn=bt||K,Fr(c,s),fn=bt,Ui=ct,Lr(s),g&8192)t:for(c=s.stateNode,c._visibility=w?c._visibility&-2:c._visibility|1,w&&(d===null||K||Ui||fn||wu(s)),d=null,c=s;;){if(c.tag===5||c.tag===26){if(d===null){K=d=c;try{if(S=K.stateNode,w)N=S.style,typeof N.setProperty=="function"?N.setProperty("display","none","important"):N.display="none";else{L=K.stateNode;var Ct=K.memoizedProps.style,dt=Ct!=null&&Ct.hasOwnProperty("display")?Ct.display:null;L.style.display=dt==null||typeof dt=="boolean"?"":(""+dt).trim()}}catch(pt){Pe(K,K.return,pt)}}}else if(c.tag===6){if(d===null){K=c;try{K.stateNode.nodeValue=w?"":K.memoizedProps}catch(pt){Pe(K,K.return,pt)}}}else if((c.tag!==22&&c.tag!==23||c.memoizedState===null||c===s)&&c.child!==null){c.child.return=c,c=c.child;continue}if(c===s)break t;for(;c.sibling===null;){if(c.return===null||c.return===s)break t;d===c&&(d=null),c=c.return}d===c&&(d=null),c.sibling.return=c.return,c=c.sibling}g&4&&(g=s.updateQueue,g!==null&&(d=g.retryQueue,d!==null&&(g.retryQueue=null,fv(s,d))));break;case 19:Fr(c,s),Lr(s),g&4&&(g=s.updateQueue,g!==null&&(s.updateQueue=null,fv(s,g)));break;case 30:break;case 21:break;default:Fr(c,s),Lr(s)}}function Lr(s){var c=s.flags;if(c&2){try{for(var d,g=s.return;g!==null;){if(hb(g)){d=g;break}g=g.return}if(d==null)throw Error(n(160));switch(d.tag){case 27:var w=d.stateNode,S=lv(s);Yh(s,S,w);break;case 5:var N=d.stateNode;d.flags&32&&(y(N,""),d.flags&=-33);var L=lv(s);Yh(s,L,N);break;case 3:case 4:var K=d.stateNode.containerInfo,ct=lv(s);cv(s,ct,K);break;default:throw Error(n(161))}}catch(bt){Pe(s,s.return,bt)}s.flags&=-3}c&4096&&(s.flags&=-4097)}function xb(s){if(s.subtreeFlags&1024)for(s=s.child;s!==null;){var c=s;xb(c),c.tag===5&&c.flags&1024&&c.stateNode.reset(),s=s.sibling}}function Co(s,c){if(c.subtreeFlags&8772)for(c=c.child;c!==null;)pb(s,c.alternate,c),c=c.sibling}function wu(s){for(s=s.child;s!==null;){var c=s;switch(c.tag){case 0:case 11:case 14:case 15:Eo(4,c,c.return),wu(c);break;case 1:ei(c,c.return);var d=c.stateNode;typeof d.componentWillUnmount=="function"&&lb(c,c.return,d),wu(c);break;case 27:sc(c.stateNode);case 26:case 5:ei(c,c.return),wu(c);break;case 22:c.memoizedState===null&&wu(c);break;case 30:wu(c);break;default:wu(c)}s=s.sibling}}function So(s,c,d){for(d=d&&(c.subtreeFlags&8772)!==0,c=c.child;c!==null;){var g=c.alternate,w=s,S=c,N=S.flags;switch(S.tag){case 0:case 11:case 15:So(w,S,d),$l(4,S);break;case 1:if(So(w,S,d),g=S,w=g.stateNode,typeof w.componentDidMount=="function")try{w.componentDidMount()}catch(ct){Pe(g,g.return,ct)}if(g=S,w=g.updateQueue,w!==null){var L=g.stateNode;try{var K=w.shared.hiddenCallbacks;if(K!==null)for(w.shared.hiddenCallbacks=null,w=0;w<K.length;w++)K0(K[w],L)}catch(ct){Pe(g,g.return,ct)}}d&&N&64&&sb(S),Jl(S,S.return);break;case 27:fb(S);case 26:case 5:So(w,S,d),d&&g===null&&N&4&&cb(S),Jl(S,S.return);break;case 12:So(w,S,d);break;case 13:So(w,S,d),d&&N&4&&gb(w,S);break;case 22:S.memoizedState===null&&So(w,S,d),Jl(S,S.return);break;case 30:break;default:So(w,S,d)}c=c.sibling}}function dv(s,c){var d=null;s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(d=s.memoizedState.cachePool.pool),s=null,c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(s=c.memoizedState.cachePool.pool),s!==d&&(s!=null&&s.refCount++,d!=null&&Ll(d))}function pv(s,c){s=null,c.alternate!==null&&(s=c.alternate.memoizedState.cache),c=c.memoizedState.cache,c!==s&&(c.refCount++,s!=null&&Ll(s))}function ni(s,c,d,g){if(c.subtreeFlags&10256)for(c=c.child;c!==null;)bb(s,c,d,g),c=c.sibling}function bb(s,c,d,g){var w=c.flags;switch(c.tag){case 0:case 11:case 15:ni(s,c,d,g),w&2048&&$l(9,c);break;case 1:ni(s,c,d,g);break;case 3:ni(s,c,d,g),w&2048&&(s=null,c.alternate!==null&&(s=c.alternate.memoizedState.cache),c=c.memoizedState.cache,c!==s&&(c.refCount++,s!=null&&Ll(s)));break;case 12:if(w&2048){ni(s,c,d,g),s=c.stateNode;try{var S=c.memoizedProps,N=S.id,L=S.onPostCommit;typeof L=="function"&&L(N,c.alternate===null?"mount":"update",s.passiveEffectDuration,-0)}catch(K){Pe(c,c.return,K)}}else ni(s,c,d,g);break;case 13:ni(s,c,d,g);break;case 23:break;case 22:S=c.stateNode,N=c.alternate,c.memoizedState!==null?S._visibility&2?ni(s,c,d,g):tc(s,c):S._visibility&2?ni(s,c,d,g):(S._visibility|=2,ws(s,c,d,g,(c.subtreeFlags&10256)!==0)),w&2048&&dv(N,c);break;case 24:ni(s,c,d,g),w&2048&&pv(c.alternate,c);break;default:ni(s,c,d,g)}}function ws(s,c,d,g,w){for(w=w&&(c.subtreeFlags&10256)!==0,c=c.child;c!==null;){var S=s,N=c,L=d,K=g,ct=N.flags;switch(N.tag){case 0:case 11:case 15:ws(S,N,L,K,w),$l(8,N);break;case 23:break;case 22:var bt=N.stateNode;N.memoizedState!==null?bt._visibility&2?ws(S,N,L,K,w):tc(S,N):(bt._visibility|=2,ws(S,N,L,K,w)),w&&ct&2048&&dv(N.alternate,N);break;case 24:ws(S,N,L,K,w),w&&ct&2048&&pv(N.alternate,N);break;default:ws(S,N,L,K,w)}c=c.sibling}}function tc(s,c){if(c.subtreeFlags&10256)for(c=c.child;c!==null;){var d=s,g=c,w=g.flags;switch(g.tag){case 22:tc(d,g),w&2048&&dv(g.alternate,g);break;case 24:tc(d,g),w&2048&&pv(g.alternate,g);break;default:tc(d,g)}c=c.sibling}}var ec=8192;function Es(s){if(s.subtreeFlags&ec)for(s=s.child;s!==null;)wb(s),s=s.sibling}function wb(s){switch(s.tag){case 26:Es(s),s.flags&ec&&s.memoizedState!==null&&qT(Ia,s.memoizedState,s.memoizedProps);break;case 5:Es(s);break;case 3:case 4:var c=Ia;Ia=lf(s.stateNode.containerInfo),Es(s),Ia=c;break;case 22:s.memoizedState===null&&(c=s.alternate,c!==null&&c.memoizedState!==null?(c=ec,ec=16777216,Es(s),ec=c):Es(s));break;default:Es(s)}}function Eb(s){var c=s.alternate;if(c!==null&&(s=c.child,s!==null)){c.child=null;do c=s.sibling,s.sibling=null,s=c;while(s!==null)}}function nc(s){var c=s.deletions;if((s.flags&16)!==0){if(c!==null)for(var d=0;d<c.length;d++){var g=c[d];Ln=g,Sb(g,s)}Eb(s)}if(s.subtreeFlags&10256)for(s=s.child;s!==null;)Cb(s),s=s.sibling}function Cb(s){switch(s.tag){case 0:case 11:case 15:nc(s),s.flags&2048&&Eo(9,s,s.return);break;case 3:nc(s);break;case 12:nc(s);break;case 22:var c=s.stateNode;s.memoizedState!==null&&c._visibility&2&&(s.return===null||s.return.tag!==13)?(c._visibility&=-3,Qh(s)):nc(s);break;default:nc(s)}}function Qh(s){var c=s.deletions;if((s.flags&16)!==0){if(c!==null)for(var d=0;d<c.length;d++){var g=c[d];Ln=g,Sb(g,s)}Eb(s)}for(s=s.child;s!==null;){switch(c=s,c.tag){case 0:case 11:case 15:Eo(8,c,c.return),Qh(c);break;case 22:d=c.stateNode,d._visibility&2&&(d._visibility&=-3,Qh(c));break;default:Qh(c)}s=s.sibling}}function Sb(s,c){for(;Ln!==null;){var d=Ln;switch(d.tag){case 0:case 11:case 15:Eo(8,d,c);break;case 23:case 22:if(d.memoizedState!==null&&d.memoizedState.cachePool!==null){var g=d.memoizedState.cachePool.pool;g!=null&&g.refCount++}break;case 24:Ll(d.memoizedState.cache)}if(g=d.child,g!==null)g.return=d,Ln=g;else t:for(d=s;Ln!==null;){g=Ln;var w=g.sibling,S=g.return;if(vb(g),g===d){Ln=null;break t}if(w!==null){w.return=S,Ln=w;break t}Ln=S}}}var uT={getCacheForType:function(s){var c=Jn(Rn),d=c.data.get(s);return d===void 0&&(d=s(),c.data.set(s,d)),d}},sT=typeof WeakMap=="function"?WeakMap:Map,_e=0,Le=null,le=null,pe=0,Ae=0,zr=null,Ro=!1,Cs=!1,vv=!1,Vi=0,rn=0,_o=0,Eu=0,mv=0,ha=0,Ss=0,rc=null,Er=null,gv=!1,yv=0,Zh=1/0,$h=null,Ao=null,jn=0,To=null,Rs=null,_s=0,xv=0,bv=null,Rb=null,ac=0,wv=null;function Ur(){if((_e&2)!==0&&pe!==0)return pe&-pe;if(V.T!==null){var s=ds;return s!==0?s:Tv()}return _a()}function _b(){ha===0&&(ha=(pe&536870912)===0||be?Cl():536870912);var s=ca.current;return s!==null&&(s.flags|=32),ha}function Wr(s,c,d){(s===Le&&(Ae===2||Ae===9)||s.cancelPendingCommit!==null)&&(As(s,0),ko(s,pe,ha,!1)),mr(s,d),((_e&2)===0||s!==Le)&&(s===Le&&((_e&2)===0&&(Eu|=d),rn===4&&ko(s,pe,ha,!1)),ri(s))}function Ab(s,c,d){if((_e&6)!==0)throw Error(n(327));var g=!d&&(c&124)===0&&(c&s.expiredLanes)===0||Cn(s,c),w=g?hT(s,c):Sv(s,c,!0),S=g;do{if(w===0){Cs&&!g&&ko(s,c,0,!1);break}else{if(d=s.current.alternate,S&&!lT(d)){w=Sv(s,c,!1),S=!1;continue}if(w===2){if(S=c,s.errorRecoveryDisabledLanes&S)var N=0;else N=s.pendingLanes&-536870913,N=N!==0?N:N&536870912?536870912:0;if(N!==0){c=N;t:{var L=s;w=rc;var K=L.current.memoizedState.isDehydrated;if(K&&(As(L,N).flags|=256),N=Sv(L,N,!1),N!==2){if(vv&&!K){L.errorRecoveryDisabledLanes|=S,Eu|=S,w=4;break t}S=Er,Er=w,S!==null&&(Er===null?Er=S:Er.push.apply(Er,S))}w=N}if(S=!1,w!==2)continue}}if(w===1){As(s,0),ko(s,c,0,!0);break}t:{switch(g=s,S=w,S){case 0:case 1:throw Error(n(345));case 4:if((c&4194048)!==c)break;case 6:ko(g,c,ha,!Ro);break t;case 2:Er=null;break;case 3:case 5:break;default:throw Error(n(329))}if((c&62914560)===c&&(w=yv+300-Te(),10<w)){if(ko(g,c,ha,!Ro),Ca(g,0,!0)!==0)break t;g.timeoutHandle=n1(Tb.bind(null,g,d,Er,$h,gv,c,ha,Eu,Ss,Ro,S,2,-0,0),w);break t}Tb(g,d,Er,$h,gv,c,ha,Eu,Ss,Ro,S,0,-0,0)}}break}while(!0);ri(s)}function Tb(s,c,d,g,w,S,N,L,K,ct,bt,Ct,dt,pt){if(s.timeoutHandle=-1,Ct=c.subtreeFlags,(Ct&8192||(Ct&16785408)===16785408)&&(hc={stylesheets:null,count:0,unsuspend:HT},wb(c),Ct=jT(),Ct!==null)){s.cancelPendingCommit=Ct(Bb.bind(null,s,c,S,d,g,w,N,L,K,bt,1,dt,pt)),ko(s,S,N,!ct);return}Bb(s,c,S,d,g,w,N,L,K)}function lT(s){for(var c=s;;){var d=c.tag;if((d===0||d===11||d===15)&&c.flags&16384&&(d=c.updateQueue,d!==null&&(d=d.stores,d!==null)))for(var g=0;g<d.length;g++){var w=d[g],S=w.getSnapshot;w=w.value;try{if(!Br(S(),w))return!1}catch{return!1}}if(d=c.child,c.subtreeFlags&16384&&d!==null)d.return=c,c=d;else{if(c===s)break;for(;c.sibling===null;){if(c.return===null||c.return===s)return!0;c=c.return}c.sibling.return=c.return,c=c.sibling}}return!0}function ko(s,c,d,g){c&=~mv,c&=~Eu,s.suspendedLanes|=c,s.pingedLanes&=~c,g&&(s.warmLanes|=c),g=s.expirationTimes;for(var w=c;0<w;){var S=31-En(w),N=1<<S;g[S]=-1,w&=~N}d!==0&&Ra(s,d,c)}function Jh(){return(_e&6)===0?(ic(0),!1):!0}function Ev(){if(le!==null){if(Ae===0)var s=le.return;else s=le,Mi=mu=null,zp(s),xs=null,Yl=0,s=le;for(;s!==null;)ub(s.alternate,s),s=s.return;le=null}}function As(s,c){var d=s.timeoutHandle;d!==-1&&(s.timeoutHandle=-1,AT(d)),d=s.cancelPendingCommit,d!==null&&(s.cancelPendingCommit=null,d()),Ev(),Le=s,le=d=Ii(s.current,null),pe=c,Ae=0,zr=null,Ro=!1,Cs=Cn(s,c),vv=!1,Ss=ha=mv=Eu=_o=rn=0,Er=rc=null,gv=!1,(c&8)!==0&&(c|=c&32);var g=s.entangledLanes;if(g!==0)for(s=s.entanglements,g&=c;0<g;){var w=31-En(g),S=1<<w;c|=s[w],g&=~S}return Vi=c,wh(),d}function kb(s,c){oe=null,V.H=Uh,c===Ul||c===Dh?(c=j0(),Ae=3):c===G0?(c=j0(),Ae=4):Ae=c===Xx?8:c!==null&&typeof c=="object"&&typeof c.then=="function"?6:1,zr=c,le===null&&(rn=1,qh(s,oa(c,s.current)))}function Db(){var s=V.H;return V.H=Uh,s===null?Uh:s}function Ib(){var s=V.A;return V.A=uT,s}function Cv(){rn=4,Ro||(pe&4194048)!==pe&&ca.current!==null||(Cs=!0),(_o&134217727)===0&&(Eu&134217727)===0||Le===null||ko(Le,pe,ha,!1)}function Sv(s,c,d){var g=_e;_e|=2;var w=Db(),S=Ib();(Le!==s||pe!==c)&&($h=null,As(s,c)),c=!1;var N=rn;t:do try{if(Ae!==0&&le!==null){var L=le,K=zr;switch(Ae){case 8:Ev(),N=6;break t;case 3:case 2:case 9:case 6:ca.current===null&&(c=!0);var ct=Ae;if(Ae=0,zr=null,Ts(s,L,K,ct),d&&Cs){N=0;break t}break;default:ct=Ae,Ae=0,zr=null,Ts(s,L,K,ct)}}cT(),N=rn;break}catch(bt){kb(s,bt)}while(!0);return c&&s.shellSuspendCounter++,Mi=mu=null,_e=g,V.H=w,V.A=S,le===null&&(Le=null,pe=0,wh()),N}function cT(){for(;le!==null;)Nb(le)}function hT(s,c){var d=_e;_e|=2;var g=Db(),w=Ib();Le!==s||pe!==c?($h=null,Zh=Te()+500,As(s,c)):Cs=Cn(s,c);t:do try{if(Ae!==0&&le!==null){c=le;var S=zr;e:switch(Ae){case 1:Ae=0,zr=null,Ts(s,c,S,1);break;case 2:case 9:if(H0(S)){Ae=0,zr=null,Ob(c);break}c=function(){Ae!==2&&Ae!==9||Le!==s||(Ae=7),ri(s)},S.then(c,c);break t;case 3:Ae=7;break t;case 4:Ae=5;break t;case 7:H0(S)?(Ae=0,zr=null,Ob(c)):(Ae=0,zr=null,Ts(s,c,S,7));break;case 5:var N=null;switch(le.tag){case 26:N=le.memoizedState;case 5:case 27:var L=le;if(!N||p1(N)){Ae=0,zr=null;var K=L.sibling;if(K!==null)le=K;else{var ct=L.return;ct!==null?(le=ct,tf(ct)):le=null}break e}}Ae=0,zr=null,Ts(s,c,S,5);break;case 6:Ae=0,zr=null,Ts(s,c,S,6);break;case 8:Ev(),rn=6;break t;default:throw Error(n(462))}}fT();break}catch(bt){kb(s,bt)}while(!0);return Mi=mu=null,V.H=g,V.A=w,_e=d,le!==null?0:(Le=null,pe=0,wh(),rn)}function fT(){for(;le!==null&&!ue();)Nb(le)}function Nb(s){var c=ib(s.alternate,s,Vi);s.memoizedProps=s.pendingProps,c===null?tf(s):le=c}function Ob(s){var c=s,d=c.alternate;switch(c.tag){case 15:case 0:c=Jx(d,c,c.pendingProps,c.type,void 0,pe);break;case 11:c=Jx(d,c,c.pendingProps,c.type.render,c.ref,pe);break;case 5:zp(c);default:ub(d,c),c=le=M0(c,Vi),c=ib(d,c,Vi)}s.memoizedProps=s.pendingProps,c===null?tf(s):le=c}function Ts(s,c,d,g){Mi=mu=null,zp(c),xs=null,Yl=0;var w=c.return;try{if(eT(s,w,c,d,pe)){rn=1,qh(s,oa(d,s.current)),le=null;return}}catch(S){if(w!==null)throw le=w,S;rn=1,qh(s,oa(d,s.current)),le=null;return}c.flags&32768?(be||g===1?s=!0:Cs||(pe&536870912)!==0?s=!1:(Ro=s=!0,(g===2||g===9||g===3||g===6)&&(g=ca.current,g!==null&&g.tag===13&&(g.flags|=16384))),Mb(c,s)):tf(c)}function tf(s){var c=s;do{if((c.flags&32768)!==0){Mb(c,Ro);return}s=c.return;var d=rT(c.alternate,c,Vi);if(d!==null){le=d;return}if(c=c.sibling,c!==null){le=c;return}le=c=s}while(c!==null);rn===0&&(rn=5)}function Mb(s,c){do{var d=aT(s.alternate,s);if(d!==null){d.flags&=32767,le=d;return}if(d=s.return,d!==null&&(d.flags|=32768,d.subtreeFlags=0,d.deletions=null),!c&&(s=s.sibling,s!==null)){le=s;return}le=s=d}while(s!==null);rn=6,le=null}function Bb(s,c,d,g,w,S,N,L,K){s.cancelPendingCommit=null;do ef();while(jn!==0);if((_e&6)!==0)throw Error(n(327));if(c!==null){if(c===s.current)throw Error(n(177));if(S=c.lanes|c.childLanes,S|=pp,Qd(s,d,S,N,L,K),s===Le&&(le=Le=null,pe=0),Rs=c,To=s,_s=d,xv=S,bv=w,Rb=g,(c.subtreeFlags&10256)!==0||(c.flags&10256)!==0?(s.callbackNode=null,s.callbackPriority=0,mT(Xe,function(){return Ub(),null})):(s.callbackNode=null,s.callbackPriority=0),g=(c.flags&13878)!==0,(c.subtreeFlags&13878)!==0||g){g=V.T,V.T=null,w=X.p,X.p=2,N=_e,_e|=4;try{iT(s,c,d)}finally{_e=N,X.p=w,V.T=g}}jn=1,Pb(),Fb(),Lb()}}function Pb(){if(jn===1){jn=0;var s=To,c=Rs,d=(c.flags&13878)!==0;if((c.subtreeFlags&13878)!==0||d){d=V.T,V.T=null;var g=X.p;X.p=2;var w=_e;_e|=4;try{yb(c,s);var S=Pv,N=S0(s.containerInfo),L=S.focusedElem,K=S.selectionRange;if(N!==L&&L&&L.ownerDocument&&C0(L.ownerDocument.documentElement,L)){if(K!==null&&lp(L)){var ct=K.start,bt=K.end;if(bt===void 0&&(bt=ct),"selectionStart"in L)L.selectionStart=ct,L.selectionEnd=Math.min(bt,L.value.length);else{var Ct=L.ownerDocument||document,dt=Ct&&Ct.defaultView||window;if(dt.getSelection){var pt=dt.getSelection(),Qt=L.textContent.length,Xt=Math.min(K.start,Qt),Ie=K.end===void 0?Xt:Math.min(K.end,Qt);!pt.extend&&Xt>Ie&&(N=Ie,Ie=Xt,Xt=N);var st=E0(L,Xt),et=E0(L,Ie);if(st&&et&&(pt.rangeCount!==1||pt.anchorNode!==st.node||pt.anchorOffset!==st.offset||pt.focusNode!==et.node||pt.focusOffset!==et.offset)){var lt=Ct.createRange();lt.setStart(st.node,st.offset),pt.removeAllRanges(),Xt>Ie?(pt.addRange(lt),pt.extend(et.node,et.offset)):(lt.setEnd(et.node,et.offset),pt.addRange(lt))}}}}for(Ct=[],pt=L;pt=pt.parentNode;)pt.nodeType===1&&Ct.push({element:pt,left:pt.scrollLeft,top:pt.scrollTop});for(typeof L.focus=="function"&&L.focus(),L=0;L<Ct.length;L++){var Et=Ct[L];Et.element.scrollLeft=Et.left,Et.element.scrollTop=Et.top}}pf=!!Bv,Pv=Bv=null}finally{_e=w,X.p=g,V.T=d}}s.current=c,jn=2}}function Fb(){if(jn===2){jn=0;var s=To,c=Rs,d=(c.flags&8772)!==0;if((c.subtreeFlags&8772)!==0||d){d=V.T,V.T=null;var g=X.p;X.p=2;var w=_e;_e|=4;try{pb(s,c.alternate,c)}finally{_e=w,X.p=g,V.T=d}}jn=3}}function Lb(){if(jn===4||jn===3){jn=0,de();var s=To,c=Rs,d=_s,g=Rb;(c.subtreeFlags&10256)!==0||(c.flags&10256)!==0?jn=5:(jn=0,Rs=To=null,zb(s,s.pendingLanes));var w=s.pendingLanes;if(w===0&&(Ao=null),Sl(d),c=c.stateNode,Be&&typeof Be.onCommitFiberRoot=="function")try{Be.onCommitFiberRoot(On,c,void 0,(c.current.flags&128)===128)}catch{}if(g!==null){c=V.T,w=X.p,X.p=2,V.T=null;try{for(var S=s.onRecoverableError,N=0;N<g.length;N++){var L=g[N];S(L.value,{componentStack:L.stack})}}finally{V.T=c,X.p=w}}(_s&3)!==0&&ef(),ri(s),w=s.pendingLanes,(d&4194090)!==0&&(w&42)!==0?s===wv?ac++:(ac=0,wv=s):ac=0,ic(0)}}function zb(s,c){(s.pooledCacheLanes&=c)===0&&(c=s.pooledCache,c!=null&&(s.pooledCache=null,Ll(c)))}function ef(s){return Pb(),Fb(),Lb(),Ub()}function Ub(){if(jn!==5)return!1;var s=To,c=xv;xv=0;var d=Sl(_s),g=V.T,w=X.p;try{X.p=32>d?32:d,V.T=null,d=bv,bv=null;var S=To,N=_s;if(jn=0,Rs=To=null,_s=0,(_e&6)!==0)throw Error(n(331));var L=_e;if(_e|=4,Cb(S.current),bb(S,S.current,N,d),_e=L,ic(0,!1),Be&&typeof Be.onPostCommitFiberRoot=="function")try{Be.onPostCommitFiberRoot(On,S)}catch{}return!0}finally{X.p=w,V.T=g,zb(s,c)}}function Wb(s,c,d){c=oa(d,c),c=Jp(s.stateNode,c,2),s=yo(s,c,2),s!==null&&(mr(s,2),ri(s))}function Pe(s,c,d){if(s.tag===3)Wb(s,s,d);else for(;c!==null;){if(c.tag===3){Wb(c,s,d);break}else if(c.tag===1){var g=c.stateNode;if(typeof c.type.getDerivedStateFromError=="function"||typeof g.componentDidCatch=="function"&&(Ao===null||!Ao.has(g))){s=oa(d,s),d=qx(2),g=yo(c,d,2),g!==null&&(jx(d,g,c,s),mr(g,2),ri(g));break}}c=c.return}}function Rv(s,c,d){var g=s.pingCache;if(g===null){g=s.pingCache=new sT;var w=new Set;g.set(c,w)}else w=g.get(c),w===void 0&&(w=new Set,g.set(c,w));w.has(d)||(vv=!0,w.add(d),s=dT.bind(null,s,c,d),c.then(s,s))}function dT(s,c,d){var g=s.pingCache;g!==null&&g.delete(c),s.pingedLanes|=s.suspendedLanes&d,s.warmLanes&=~d,Le===s&&(pe&d)===d&&(rn===4||rn===3&&(pe&62914560)===pe&&300>Te()-yv?(_e&2)===0&&As(s,0):mv|=d,Ss===pe&&(Ss=0)),ri(s)}function Vb(s,c){c===0&&(c=Sa()),s=ls(s,c),s!==null&&(mr(s,c),ri(s))}function pT(s){var c=s.memoizedState,d=0;c!==null&&(d=c.retryLane),Vb(s,d)}function vT(s,c){var d=0;switch(s.tag){case 13:var g=s.stateNode,w=s.memoizedState;w!==null&&(d=w.retryLane);break;case 19:g=s.stateNode;break;case 22:g=s.stateNode._retryCache;break;default:throw Error(n(314))}g!==null&&g.delete(c),Vb(s,d)}function mT(s,c){return Gt(s,c)}var nf=null,ks=null,_v=!1,rf=!1,Av=!1,Cu=0;function ri(s){s!==ks&&s.next===null&&(ks===null?nf=ks=s:ks=ks.next=s),rf=!0,_v||(_v=!0,yT())}function ic(s,c){if(!Av&&rf){Av=!0;do for(var d=!1,g=nf;g!==null;){if(s!==0){var w=g.pendingLanes;if(w===0)var S=0;else{var N=g.suspendedLanes,L=g.pingedLanes;S=(1<<31-En(42|s)+1)-1,S&=w&~(N&~L),S=S&201326741?S&201326741|1:S?S|2:0}S!==0&&(d=!0,jb(g,S))}else S=pe,S=Ca(g,g===Le?S:0,g.cancelPendingCommit!==null||g.timeoutHandle!==-1),(S&3)===0||Cn(g,S)||(d=!0,jb(g,S));g=g.next}while(d);Av=!1}}function gT(){Gb()}function Gb(){rf=_v=!1;var s=0;Cu!==0&&(_T()&&(s=Cu),Cu=0);for(var c=Te(),d=null,g=nf;g!==null;){var w=g.next,S=Hb(g,c);S===0?(g.next=null,d===null?nf=w:d.next=w,w===null&&(ks=d)):(d=g,(s!==0||(S&3)!==0)&&(rf=!0)),g=w}ic(s)}function Hb(s,c){for(var d=s.suspendedLanes,g=s.pingedLanes,w=s.expirationTimes,S=s.pendingLanes&-62914561;0<S;){var N=31-En(S),L=1<<N,K=w[N];K===-1?((L&d)===0||(L&g)!==0)&&(w[N]=es(L,c)):K<=c&&(s.expiredLanes|=L),S&=~L}if(c=Le,d=pe,d=Ca(s,s===c?d:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),g=s.callbackNode,d===0||s===c&&(Ae===2||Ae===9)||s.cancelPendingCommit!==null)return g!==null&&g!==null&&$t(g),s.callbackNode=null,s.callbackPriority=0;if((d&3)===0||Cn(s,d)){if(c=d&-d,c===s.callbackPriority)return c;switch(g!==null&&$t(g),Sl(d)){case 2:case 8:d=vn;break;case 32:d=Xe;break;case 268435456:d=ln;break;default:d=Xe}return g=qb.bind(null,s),d=Gt(d,g),s.callbackPriority=c,s.callbackNode=d,c}return g!==null&&g!==null&&$t(g),s.callbackPriority=2,s.callbackNode=null,2}function qb(s,c){if(jn!==0&&jn!==5)return s.callbackNode=null,s.callbackPriority=0,null;var d=s.callbackNode;if(ef()&&s.callbackNode!==d)return null;var g=pe;return g=Ca(s,s===Le?g:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),g===0?null:(Ab(s,g,c),Hb(s,Te()),s.callbackNode!=null&&s.callbackNode===d?qb.bind(null,s):null)}function jb(s,c){if(ef())return null;Ab(s,c,!0)}function yT(){TT(function(){(_e&6)!==0?Gt(Se,gT):Gb()})}function Tv(){return Cu===0&&(Cu=Cl()),Cu}function Xb(s){return s==null||typeof s=="symbol"||typeof s=="boolean"?null:typeof s=="function"?s:Pn(""+s)}function Kb(s,c){var d=c.ownerDocument.createElement("input");return d.name=c.name,d.value=c.value,s.id&&d.setAttribute("form",s.id),c.parentNode.insertBefore(d,c),s=new FormData(s),d.parentNode.removeChild(d),s}function xT(s,c,d,g,w){if(c==="submit"&&d&&d.stateNode===w){var S=Xb((w[Ke]||null).action),N=g.submitter;N&&(c=(c=N[Ke]||null)?Xb(c.formAction):N.getAttribute("formAction"),c!==null&&(S=c,N=null));var L=new yh("action","action",null,g,w);s.push({event:L,listeners:[{instance:null,listener:function(){if(g.defaultPrevented){if(Cu!==0){var K=N?Kb(w,N):new FormData(w);Kp(d,{pending:!0,data:K,method:w.method,action:S},null,K)}}else typeof S=="function"&&(L.preventDefault(),K=N?Kb(w,N):new FormData(w),Kp(d,{pending:!0,data:K,method:w.method,action:S},S,K))},currentTarget:w}]})}}for(var kv=0;kv<dp.length;kv++){var Dv=dp[kv],bT=Dv.toLowerCase(),wT=Dv[0].toUpperCase()+Dv.slice(1);Da(bT,"on"+wT)}Da(A0,"onAnimationEnd"),Da(T0,"onAnimationIteration"),Da(k0,"onAnimationStart"),Da("dblclick","onDoubleClick"),Da("focusin","onFocus"),Da("focusout","onBlur"),Da(LA,"onTransitionRun"),Da(zA,"onTransitionStart"),Da(UA,"onTransitionCancel"),Da(D0,"onTransitionEnd"),Ir("onMouseEnter",["mouseout","mouseover"]),Ir("onMouseLeave",["mouseout","mouseover"]),Ir("onPointerEnter",["pointerout","pointerover"]),Ir("onPointerLeave",["pointerout","pointerover"]),aa("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),aa("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),aa("onBeforeInput",["compositionend","keypress","textInput","paste"]),aa("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),aa("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),aa("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var oc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),ET=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(oc));function Yb(s,c){c=(c&4)!==0;for(var d=0;d<s.length;d++){var g=s[d],w=g.event;g=g.listeners;t:{var S=void 0;if(c)for(var N=g.length-1;0<=N;N--){var L=g[N],K=L.instance,ct=L.currentTarget;if(L=L.listener,K!==S&&w.isPropagationStopped())break t;S=L,w.currentTarget=ct;try{S(w)}catch(bt){Hh(bt)}w.currentTarget=null,S=K}else for(N=0;N<g.length;N++){if(L=g[N],K=L.instance,ct=L.currentTarget,L=L.listener,K!==S&&w.isPropagationStopped())break t;S=L,w.currentTarget=ct;try{S(w)}catch(bt){Hh(bt)}w.currentTarget=null,S=K}}}}function ce(s,c){var d=c[ra];d===void 0&&(d=c[ra]=new Set);var g=s+"__bubble";d.has(g)||(Qb(c,s,2,!1),d.add(g))}function Iv(s,c,d){var g=0;c&&(g|=4),Qb(d,s,g,c)}var af="_reactListening"+Math.random().toString(36).slice(2);function Nv(s){if(!s[af]){s[af]=!0,Aa.forEach(function(d){d!=="selectionchange"&&(ET.has(d)||Iv(d,!1,s),Iv(d,!0,s))});var c=s.nodeType===9?s:s.ownerDocument;c===null||c[af]||(c[af]=!0,Iv("selectionchange",!1,c))}}function Qb(s,c,d,g){switch(b1(c)){case 2:var w=YT;break;case 8:w=QT;break;default:w=jv}d=w.bind(null,c,d,s),w=void 0,!uu||c!=="touchstart"&&c!=="touchmove"&&c!=="wheel"||(w=!0),g?w!==void 0?s.addEventListener(c,d,{capture:!0,passive:w}):s.addEventListener(c,d,!0):w!==void 0?s.addEventListener(c,d,{passive:w}):s.addEventListener(c,d,!1)}function Ov(s,c,d,g,w){var S=g;if((c&1)===0&&(c&2)===0&&g!==null)t:for(;;){if(g===null)return;var N=g.tag;if(N===3||N===4){var L=g.stateNode.containerInfo;if(L===w)break;if(N===4)for(N=g.return;N!==null;){var K=N.tag;if((K===3||K===4)&&N.stateNode.containerInfo===w)return;N=N.return}for(;L!==null;){if(N=fo(L),N===null)return;if(K=N.tag,K===5||K===6||K===26||K===27){g=S=N;continue t}L=L.parentNode}}g=g.return}Di(function(){var ct=S,bt=tn(d),Ct=[];t:{var dt=I0.get(s);if(dt!==void 0){var pt=yh,Qt=s;switch(s){case"keypress":if(mh(d)===0)break t;case"keydown":case"keyup":pt=mA;break;case"focusin":Qt="focus",pt=ap;break;case"focusout":Qt="blur",pt=ap;break;case"beforeblur":case"afterblur":pt=ap;break;case"click":if(d.button===2)break t;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":pt=o0;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":pt=aA;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":pt=xA;break;case A0:case T0:case k0:pt=uA;break;case D0:pt=wA;break;case"scroll":case"scrollend":pt=nA;break;case"wheel":pt=CA;break;case"copy":case"cut":case"paste":pt=lA;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":pt=s0;break;case"toggle":case"beforetoggle":pt=RA}var Xt=(c&4)!==0,Ie=!Xt&&(s==="scroll"||s==="scrollend"),st=Xt?dt!==null?dt+"Capture":null:dt;Xt=[];for(var et=ct,lt;et!==null;){var Et=et;if(lt=Et.stateNode,Et=Et.tag,Et!==5&&Et!==26&&Et!==27||lt===null||st===null||(Et=gn(et,st),Et!=null&&Xt.push(uc(et,Et,lt))),Ie)break;et=et.return}0<Xt.length&&(dt=new pt(dt,Qt,null,d,bt),Ct.push({event:dt,listeners:Xt}))}}if((c&7)===0){t:{if(dt=s==="mouseover"||s==="pointerover",pt=s==="mouseout"||s==="pointerout",dt&&d!==Je&&(Qt=d.relatedTarget||d.fromElement)&&(fo(Qt)||Qt[ho]))break t;if((pt||dt)&&(dt=bt.window===bt?bt:(dt=bt.ownerDocument)?dt.defaultView||dt.parentWindow:window,pt?(Qt=d.relatedTarget||d.toElement,pt=ct,Qt=Qt?fo(Qt):null,Qt!==null&&(Ie=i(Qt),Xt=Qt.tag,Qt!==Ie||Xt!==5&&Xt!==27&&Xt!==6)&&(Qt=null)):(pt=null,Qt=ct),pt!==Qt)){if(Xt=o0,Et="onMouseLeave",st="onMouseEnter",et="mouse",(s==="pointerout"||s==="pointerover")&&(Xt=s0,Et="onPointerLeave",st="onPointerEnter",et="pointer"),Ie=pt==null?dt:iu(pt),lt=Qt==null?dt:iu(Qt),dt=new Xt(Et,et+"leave",pt,d,bt),dt.target=Ie,dt.relatedTarget=lt,Et=null,fo(bt)===ct&&(Xt=new Xt(st,et+"enter",Qt,d,bt),Xt.target=lt,Xt.relatedTarget=Ie,Et=Xt),Ie=Et,pt&&Qt)e:{for(Xt=pt,st=Qt,et=0,lt=Xt;lt;lt=Ds(lt))et++;for(lt=0,Et=st;Et;Et=Ds(Et))lt++;for(;0<et-lt;)Xt=Ds(Xt),et--;for(;0<lt-et;)st=Ds(st),lt--;for(;et--;){if(Xt===st||st!==null&&Xt===st.alternate)break e;Xt=Ds(Xt),st=Ds(st)}Xt=null}else Xt=null;pt!==null&&Zb(Ct,dt,pt,Xt,!1),Qt!==null&&Ie!==null&&Zb(Ct,Ie,Qt,Xt,!0)}}t:{if(dt=ct?iu(ct):window,pt=dt.nodeName&&dt.nodeName.toLowerCase(),pt==="select"||pt==="input"&&dt.type==="file")var Nt=m0;else if(p0(dt))if(g0)Nt=BA;else{Nt=OA;var se=NA}else pt=dt.nodeName,!pt||pt.toLowerCase()!=="input"||dt.type!=="checkbox"&&dt.type!=="radio"?ct&&J(ct.elementType)&&(Nt=m0):Nt=MA;if(Nt&&(Nt=Nt(s,ct))){v0(Ct,Nt,d,bt);break t}se&&se(s,dt,ct),s==="focusout"&&ct&&dt.type==="number"&&ct.memoizedProps.value!=null&&Za(dt,"number",dt.value)}switch(se=ct?iu(ct):window,s){case"focusin":(p0(se)||se.contentEditable==="true")&&(os=se,cp=ct,Ol=null);break;case"focusout":Ol=cp=os=null;break;case"mousedown":hp=!0;break;case"contextmenu":case"mouseup":case"dragend":hp=!1,R0(Ct,d,bt);break;case"selectionchange":if(FA)break;case"keydown":case"keyup":R0(Ct,d,bt)}var Vt;if(op)t:{switch(s){case"compositionstart":var Yt="onCompositionStart";break t;case"compositionend":Yt="onCompositionEnd";break t;case"compositionupdate":Yt="onCompositionUpdate";break t}Yt=void 0}else is?f0(s,d)&&(Yt="onCompositionEnd"):s==="keydown"&&d.keyCode===229&&(Yt="onCompositionStart");Yt&&(l0&&d.locale!=="ko"&&(is||Yt!=="onCompositionStart"?Yt==="onCompositionEnd"&&is&&(Vt=a0()):(en=bt,ep="value"in en?en.value:en.textContent,is=!0)),se=of(ct,Yt),0<se.length&&(Yt=new u0(Yt,s,null,d,bt),Ct.push({event:Yt,listeners:se}),Vt?Yt.data=Vt:(Vt=d0(d),Vt!==null&&(Yt.data=Vt)))),(Vt=AA?TA(s,d):kA(s,d))&&(Yt=of(ct,"onBeforeInput"),0<Yt.length&&(se=new u0("onBeforeInput","beforeinput",null,d,bt),Ct.push({event:se,listeners:Yt}),se.data=Vt)),xT(Ct,s,ct,d,bt)}Yb(Ct,c)})}function uc(s,c,d){return{instance:s,listener:c,currentTarget:d}}function of(s,c){for(var d=c+"Capture",g=[];s!==null;){var w=s,S=w.stateNode;if(w=w.tag,w!==5&&w!==26&&w!==27||S===null||(w=gn(s,d),w!=null&&g.unshift(uc(s,w,S)),w=gn(s,c),w!=null&&g.push(uc(s,w,S))),s.tag===3)return g;s=s.return}return[]}function Ds(s){if(s===null)return null;do s=s.return;while(s&&s.tag!==5&&s.tag!==27);return s||null}function Zb(s,c,d,g,w){for(var S=c._reactName,N=[];d!==null&&d!==g;){var L=d,K=L.alternate,ct=L.stateNode;if(L=L.tag,K!==null&&K===g)break;L!==5&&L!==26&&L!==27||ct===null||(K=ct,w?(ct=gn(d,S),ct!=null&&N.unshift(uc(d,ct,K))):w||(ct=gn(d,S),ct!=null&&N.push(uc(d,ct,K)))),d=d.return}N.length!==0&&s.push({event:c,listeners:N})}var CT=/\r\n?/g,ST=/\u0000|\uFFFD/g;function $b(s){return(typeof s=="string"?s:""+s).replace(CT,`
`).replace(ST,"")}function Jb(s,c){return c=$b(c),$b(s)===c}function uf(){}function De(s,c,d,g,w,S){switch(d){case"children":typeof g=="string"?c==="body"||c==="textarea"&&g===""||y(s,g):(typeof g=="number"||typeof g=="bigint")&&c!=="body"&&y(s,""+g);break;case"className":po(s,"class",g);break;case"tabIndex":po(s,"tabindex",g);break;case"dir":case"role":case"viewBox":case"width":case"height":po(s,d,g);break;case"style":U(s,g,S);break;case"data":if(c!=="object"){po(s,"data",g);break}case"src":case"href":if(g===""&&(c!=="a"||d!=="href")){s.removeAttribute(d);break}if(g==null||typeof g=="function"||typeof g=="symbol"||typeof g=="boolean"){s.removeAttribute(d);break}g=Pn(""+g),s.setAttribute(d,g);break;case"action":case"formAction":if(typeof g=="function"){s.setAttribute(d,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof S=="function"&&(d==="formAction"?(c!=="input"&&De(s,c,"name",w.name,w,null),De(s,c,"formEncType",w.formEncType,w,null),De(s,c,"formMethod",w.formMethod,w,null),De(s,c,"formTarget",w.formTarget,w,null)):(De(s,c,"encType",w.encType,w,null),De(s,c,"method",w.method,w,null),De(s,c,"target",w.target,w,null)));if(g==null||typeof g=="symbol"||typeof g=="boolean"){s.removeAttribute(d);break}g=Pn(""+g),s.setAttribute(d,g);break;case"onClick":g!=null&&(s.onclick=uf);break;case"onScroll":g!=null&&ce("scroll",s);break;case"onScrollEnd":g!=null&&ce("scrollend",s);break;case"dangerouslySetInnerHTML":if(g!=null){if(typeof g!="object"||!("__html"in g))throw Error(n(61));if(d=g.__html,d!=null){if(w.children!=null)throw Error(n(60));s.innerHTML=d}}break;case"multiple":s.multiple=g&&typeof g!="function"&&typeof g!="symbol";break;case"muted":s.muted=g&&typeof g!="function"&&typeof g!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(g==null||typeof g=="function"||typeof g=="boolean"||typeof g=="symbol"){s.removeAttribute("xlink:href");break}d=Pn(""+g),s.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",d);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":g!=null&&typeof g!="function"&&typeof g!="symbol"?s.setAttribute(d,""+g):s.removeAttribute(d);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":g&&typeof g!="function"&&typeof g!="symbol"?s.setAttribute(d,""):s.removeAttribute(d);break;case"capture":case"download":g===!0?s.setAttribute(d,""):g!==!1&&g!=null&&typeof g!="function"&&typeof g!="symbol"?s.setAttribute(d,g):s.removeAttribute(d);break;case"cols":case"rows":case"size":case"span":g!=null&&typeof g!="function"&&typeof g!="symbol"&&!isNaN(g)&&1<=g?s.setAttribute(d,g):s.removeAttribute(d);break;case"rowSpan":case"start":g==null||typeof g=="function"||typeof g=="symbol"||isNaN(g)?s.removeAttribute(d):s.setAttribute(d,g);break;case"popover":ce("beforetoggle",s),ce("toggle",s),yr(s,"popover",g);break;case"xlinkActuate":ka(s,"http://www.w3.org/1999/xlink","xlink:actuate",g);break;case"xlinkArcrole":ka(s,"http://www.w3.org/1999/xlink","xlink:arcrole",g);break;case"xlinkRole":ka(s,"http://www.w3.org/1999/xlink","xlink:role",g);break;case"xlinkShow":ka(s,"http://www.w3.org/1999/xlink","xlink:show",g);break;case"xlinkTitle":ka(s,"http://www.w3.org/1999/xlink","xlink:title",g);break;case"xlinkType":ka(s,"http://www.w3.org/1999/xlink","xlink:type",g);break;case"xmlBase":ka(s,"http://www.w3.org/XML/1998/namespace","xml:base",g);break;case"xmlLang":ka(s,"http://www.w3.org/XML/1998/namespace","xml:lang",g);break;case"xmlSpace":ka(s,"http://www.w3.org/XML/1998/namespace","xml:space",g);break;case"is":yr(s,"is",g);break;case"innerText":case"textContent":break;default:(!(2<d.length)||d[0]!=="o"&&d[0]!=="O"||d[1]!=="n"&&d[1]!=="N")&&(d=At.get(d)||d,yr(s,d,g))}}function Mv(s,c,d,g,w,S){switch(d){case"style":U(s,g,S);break;case"dangerouslySetInnerHTML":if(g!=null){if(typeof g!="object"||!("__html"in g))throw Error(n(61));if(d=g.__html,d!=null){if(w.children!=null)throw Error(n(60));s.innerHTML=d}}break;case"children":typeof g=="string"?y(s,g):(typeof g=="number"||typeof g=="bigint")&&y(s,""+g);break;case"onScroll":g!=null&&ce("scroll",s);break;case"onScrollEnd":g!=null&&ce("scrollend",s);break;case"onClick":g!=null&&(s.onclick=uf);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!hh.hasOwnProperty(d))t:{if(d[0]==="o"&&d[1]==="n"&&(w=d.endsWith("Capture"),c=d.slice(2,w?d.length-7:void 0),S=s[Ke]||null,S=S!=null?S[d]:null,typeof S=="function"&&s.removeEventListener(c,S,w),typeof g=="function")){typeof S!="function"&&S!==null&&(d in s?s[d]=null:s.hasAttribute(d)&&s.removeAttribute(d)),s.addEventListener(c,g,w);break t}d in s?s[d]=g:g===!0?s.setAttribute(d,""):yr(s,d,g)}}}function Xn(s,c,d){switch(c){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":ce("error",s),ce("load",s);var g=!1,w=!1,S;for(S in d)if(d.hasOwnProperty(S)){var N=d[S];if(N!=null)switch(S){case"src":g=!0;break;case"srcSet":w=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(n(137,c));default:De(s,c,S,N,d,null)}}w&&De(s,c,"srcSet",d.srcSet,d,null),g&&De(s,c,"src",d.src,d,null);return;case"input":ce("invalid",s);var L=S=N=w=null,K=null,ct=null;for(g in d)if(d.hasOwnProperty(g)){var bt=d[g];if(bt!=null)switch(g){case"name":w=bt;break;case"type":N=bt;break;case"checked":K=bt;break;case"defaultChecked":ct=bt;break;case"value":S=bt;break;case"defaultValue":L=bt;break;case"children":case"dangerouslySetInnerHTML":if(bt!=null)throw Error(n(137,c));break;default:De(s,c,g,bt,d,null)}}_l(s,S,L,K,ct,N,w,!1),rs(s);return;case"select":ce("invalid",s),g=N=S=null;for(w in d)if(d.hasOwnProperty(w)&&(L=d[w],L!=null))switch(w){case"value":S=L;break;case"defaultValue":N=L;break;case"multiple":g=L;default:De(s,c,w,L,d,null)}c=S,d=N,s.multiple=!!g,c!=null?Ai(s,!!g,c,!1):d!=null&&Ai(s,!!g,d,!0);return;case"textarea":ce("invalid",s),S=w=g=null;for(N in d)if(d.hasOwnProperty(N)&&(L=d[N],L!=null))switch(N){case"value":g=L;break;case"defaultValue":w=L;break;case"children":S=L;break;case"dangerouslySetInnerHTML":if(L!=null)throw Error(n(91));break;default:De(s,c,N,L,d,null)}ki(s,g,w,S),rs(s);return;case"option":for(K in d)if(d.hasOwnProperty(K)&&(g=d[K],g!=null))switch(K){case"selected":s.selected=g&&typeof g!="function"&&typeof g!="symbol";break;default:De(s,c,K,g,d,null)}return;case"dialog":ce("beforetoggle",s),ce("toggle",s),ce("cancel",s),ce("close",s);break;case"iframe":case"object":ce("load",s);break;case"video":case"audio":for(g=0;g<oc.length;g++)ce(oc[g],s);break;case"image":ce("error",s),ce("load",s);break;case"details":ce("toggle",s);break;case"embed":case"source":case"link":ce("error",s),ce("load",s);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(ct in d)if(d.hasOwnProperty(ct)&&(g=d[ct],g!=null))switch(ct){case"children":case"dangerouslySetInnerHTML":throw Error(n(137,c));default:De(s,c,ct,g,d,null)}return;default:if(J(c)){for(bt in d)d.hasOwnProperty(bt)&&(g=d[bt],g!==void 0&&Mv(s,c,bt,g,d,void 0));return}}for(L in d)d.hasOwnProperty(L)&&(g=d[L],g!=null&&De(s,c,L,g,d,null))}function RT(s,c,d,g){switch(c){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var w=null,S=null,N=null,L=null,K=null,ct=null,bt=null;for(pt in d){var Ct=d[pt];if(d.hasOwnProperty(pt)&&Ct!=null)switch(pt){case"checked":break;case"value":break;case"defaultValue":K=Ct;default:g.hasOwnProperty(pt)||De(s,c,pt,null,g,Ct)}}for(var dt in g){var pt=g[dt];if(Ct=d[dt],g.hasOwnProperty(dt)&&(pt!=null||Ct!=null))switch(dt){case"type":S=pt;break;case"name":w=pt;break;case"checked":ct=pt;break;case"defaultChecked":bt=pt;break;case"value":N=pt;break;case"defaultValue":L=pt;break;case"children":case"dangerouslySetInnerHTML":if(pt!=null)throw Error(n(137,c));break;default:pt!==Ct&&De(s,c,dt,pt,g,Ct)}}Qa(s,N,L,K,ct,bt,S,w);return;case"select":pt=N=L=dt=null;for(S in d)if(K=d[S],d.hasOwnProperty(S)&&K!=null)switch(S){case"value":break;case"multiple":pt=K;default:g.hasOwnProperty(S)||De(s,c,S,null,g,K)}for(w in g)if(S=g[w],K=d[w],g.hasOwnProperty(w)&&(S!=null||K!=null))switch(w){case"value":dt=S;break;case"defaultValue":L=S;break;case"multiple":N=S;default:S!==K&&De(s,c,w,S,g,K)}c=L,d=N,g=pt,dt!=null?Ai(s,!!d,dt,!1):!!g!=!!d&&(c!=null?Ai(s,!!d,c,!0):Ai(s,!!d,d?[]:"",!1));return;case"textarea":pt=dt=null;for(L in d)if(w=d[L],d.hasOwnProperty(L)&&w!=null&&!g.hasOwnProperty(L))switch(L){case"value":break;case"children":break;default:De(s,c,L,null,g,w)}for(N in g)if(w=g[N],S=d[N],g.hasOwnProperty(N)&&(w!=null||S!=null))switch(N){case"value":dt=w;break;case"defaultValue":pt=w;break;case"children":break;case"dangerouslySetInnerHTML":if(w!=null)throw Error(n(91));break;default:w!==S&&De(s,c,N,w,g,S)}Ti(s,dt,pt);return;case"option":for(var Qt in d)if(dt=d[Qt],d.hasOwnProperty(Qt)&&dt!=null&&!g.hasOwnProperty(Qt))switch(Qt){case"selected":s.selected=!1;break;default:De(s,c,Qt,null,g,dt)}for(K in g)if(dt=g[K],pt=d[K],g.hasOwnProperty(K)&&dt!==pt&&(dt!=null||pt!=null))switch(K){case"selected":s.selected=dt&&typeof dt!="function"&&typeof dt!="symbol";break;default:De(s,c,K,dt,g,pt)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Xt in d)dt=d[Xt],d.hasOwnProperty(Xt)&&dt!=null&&!g.hasOwnProperty(Xt)&&De(s,c,Xt,null,g,dt);for(ct in g)if(dt=g[ct],pt=d[ct],g.hasOwnProperty(ct)&&dt!==pt&&(dt!=null||pt!=null))switch(ct){case"children":case"dangerouslySetInnerHTML":if(dt!=null)throw Error(n(137,c));break;default:De(s,c,ct,dt,g,pt)}return;default:if(J(c)){for(var Ie in d)dt=d[Ie],d.hasOwnProperty(Ie)&&dt!==void 0&&!g.hasOwnProperty(Ie)&&Mv(s,c,Ie,void 0,g,dt);for(bt in g)dt=g[bt],pt=d[bt],!g.hasOwnProperty(bt)||dt===pt||dt===void 0&&pt===void 0||Mv(s,c,bt,dt,g,pt);return}}for(var st in d)dt=d[st],d.hasOwnProperty(st)&&dt!=null&&!g.hasOwnProperty(st)&&De(s,c,st,null,g,dt);for(Ct in g)dt=g[Ct],pt=d[Ct],!g.hasOwnProperty(Ct)||dt===pt||dt==null&&pt==null||De(s,c,Ct,dt,g,pt)}var Bv=null,Pv=null;function sf(s){return s.nodeType===9?s:s.ownerDocument}function t1(s){switch(s){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function e1(s,c){if(s===0)switch(c){case"svg":return 1;case"math":return 2;default:return 0}return s===1&&c==="foreignObject"?0:s}function Fv(s,c){return s==="textarea"||s==="noscript"||typeof c.children=="string"||typeof c.children=="number"||typeof c.children=="bigint"||typeof c.dangerouslySetInnerHTML=="object"&&c.dangerouslySetInnerHTML!==null&&c.dangerouslySetInnerHTML.__html!=null}var Lv=null;function _T(){var s=window.event;return s&&s.type==="popstate"?s===Lv?!1:(Lv=s,!0):(Lv=null,!1)}var n1=typeof setTimeout=="function"?setTimeout:void 0,AT=typeof clearTimeout=="function"?clearTimeout:void 0,r1=typeof Promise=="function"?Promise:void 0,TT=typeof queueMicrotask=="function"?queueMicrotask:typeof r1<"u"?function(s){return r1.resolve(null).then(s).catch(kT)}:n1;function kT(s){setTimeout(function(){throw s})}function Do(s){return s==="head"}function a1(s,c){var d=c,g=0,w=0;do{var S=d.nextSibling;if(s.removeChild(d),S&&S.nodeType===8)if(d=S.data,d==="/$"){if(0<g&&8>g){d=g;var N=s.ownerDocument;if(d&1&&sc(N.documentElement),d&2&&sc(N.body),d&4)for(d=N.head,sc(d),N=d.firstChild;N;){var L=N.nextSibling,K=N.nodeName;N[gr]||K==="SCRIPT"||K==="STYLE"||K==="LINK"&&N.rel.toLowerCase()==="stylesheet"||d.removeChild(N),N=L}}if(w===0){s.removeChild(S),mc(c);return}w--}else d==="$"||d==="$?"||d==="$!"?w++:g=d.charCodeAt(0)-48;else g=0;d=S}while(d);mc(c)}function zv(s){var c=s.firstChild;for(c&&c.nodeType===10&&(c=c.nextSibling);c;){var d=c;switch(c=c.nextSibling,d.nodeName){case"HTML":case"HEAD":case"BODY":zv(d),au(d);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(d.rel.toLowerCase()==="stylesheet")continue}s.removeChild(d)}}function DT(s,c,d,g){for(;s.nodeType===1;){var w=d;if(s.nodeName.toLowerCase()!==c.toLowerCase()){if(!g&&(s.nodeName!=="INPUT"||s.type!=="hidden"))break}else if(g){if(!s[gr])switch(c){case"meta":if(!s.hasAttribute("itemprop"))break;return s;case"link":if(S=s.getAttribute("rel"),S==="stylesheet"&&s.hasAttribute("data-precedence"))break;if(S!==w.rel||s.getAttribute("href")!==(w.href==null||w.href===""?null:w.href)||s.getAttribute("crossorigin")!==(w.crossOrigin==null?null:w.crossOrigin)||s.getAttribute("title")!==(w.title==null?null:w.title))break;return s;case"style":if(s.hasAttribute("data-precedence"))break;return s;case"script":if(S=s.getAttribute("src"),(S!==(w.src==null?null:w.src)||s.getAttribute("type")!==(w.type==null?null:w.type)||s.getAttribute("crossorigin")!==(w.crossOrigin==null?null:w.crossOrigin))&&S&&s.hasAttribute("async")&&!s.hasAttribute("itemprop"))break;return s;default:return s}}else if(c==="input"&&s.type==="hidden"){var S=w.name==null?null:""+w.name;if(w.type==="hidden"&&s.getAttribute("name")===S)return s}else return s;if(s=Na(s.nextSibling),s===null)break}return null}function IT(s,c,d){if(c==="")return null;for(;s.nodeType!==3;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!d||(s=Na(s.nextSibling),s===null))return null;return s}function Uv(s){return s.data==="$!"||s.data==="$?"&&s.ownerDocument.readyState==="complete"}function NT(s,c){var d=s.ownerDocument;if(s.data!=="$?"||d.readyState==="complete")c();else{var g=function(){c(),d.removeEventListener("DOMContentLoaded",g)};d.addEventListener("DOMContentLoaded",g),s._reactRetry=g}}function Na(s){for(;s!=null;s=s.nextSibling){var c=s.nodeType;if(c===1||c===3)break;if(c===8){if(c=s.data,c==="$"||c==="$!"||c==="$?"||c==="F!"||c==="F")break;if(c==="/$")return null}}return s}var Wv=null;function i1(s){s=s.previousSibling;for(var c=0;s;){if(s.nodeType===8){var d=s.data;if(d==="$"||d==="$!"||d==="$?"){if(c===0)return s;c--}else d==="/$"&&c++}s=s.previousSibling}return null}function o1(s,c,d){switch(c=sf(d),s){case"html":if(s=c.documentElement,!s)throw Error(n(452));return s;case"head":if(s=c.head,!s)throw Error(n(453));return s;case"body":if(s=c.body,!s)throw Error(n(454));return s;default:throw Error(n(451))}}function sc(s){for(var c=s.attributes;c.length;)s.removeAttributeNode(c[0]);au(s)}var fa=new Map,u1=new Set;function lf(s){return typeof s.getRootNode=="function"?s.getRootNode():s.nodeType===9?s:s.ownerDocument}var Gi=X.d;X.d={f:OT,r:MT,D:BT,C:PT,L:FT,m:LT,X:UT,S:zT,M:WT};function OT(){var s=Gi.f(),c=Jh();return s||c}function MT(s){var c=sr(s);c!==null&&c.tag===5&&c.type==="form"?Ax(c):Gi.r(s)}var Is=typeof document>"u"?null:document;function s1(s,c,d){var g=Is;if(g&&typeof c=="string"&&c){var w=cr(c);w='link[rel="'+s+'"][href="'+w+'"]',typeof d=="string"&&(w+='[crossorigin="'+d+'"]'),u1.has(w)||(u1.add(w),s={rel:s,crossOrigin:d,href:c},g.querySelector(w)===null&&(c=g.createElement("link"),Xn(c,"link",s),mn(c),g.head.appendChild(c)))}}function BT(s){Gi.D(s),s1("dns-prefetch",s,null)}function PT(s,c){Gi.C(s,c),s1("preconnect",s,c)}function FT(s,c,d){Gi.L(s,c,d);var g=Is;if(g&&s&&c){var w='link[rel="preload"][as="'+cr(c)+'"]';c==="image"&&d&&d.imageSrcSet?(w+='[imagesrcset="'+cr(d.imageSrcSet)+'"]',typeof d.imageSizes=="string"&&(w+='[imagesizes="'+cr(d.imageSizes)+'"]')):w+='[href="'+cr(s)+'"]';var S=w;switch(c){case"style":S=Ns(s);break;case"script":S=Os(s)}fa.has(S)||(s=f({rel:"preload",href:c==="image"&&d&&d.imageSrcSet?void 0:s,as:c},d),fa.set(S,s),g.querySelector(w)!==null||c==="style"&&g.querySelector(lc(S))||c==="script"&&g.querySelector(cc(S))||(c=g.createElement("link"),Xn(c,"link",s),mn(c),g.head.appendChild(c)))}}function LT(s,c){Gi.m(s,c);var d=Is;if(d&&s){var g=c&&typeof c.as=="string"?c.as:"script",w='link[rel="modulepreload"][as="'+cr(g)+'"][href="'+cr(s)+'"]',S=w;switch(g){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":S=Os(s)}if(!fa.has(S)&&(s=f({rel:"modulepreload",href:s},c),fa.set(S,s),d.querySelector(w)===null)){switch(g){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(d.querySelector(cc(S)))return}g=d.createElement("link"),Xn(g,"link",s),mn(g),d.head.appendChild(g)}}}function zT(s,c,d){Gi.S(s,c,d);var g=Is;if(g&&s){var w=lr(g).hoistableStyles,S=Ns(s);c=c||"default";var N=w.get(S);if(!N){var L={loading:0,preload:null};if(N=g.querySelector(lc(S)))L.loading=5;else{s=f({rel:"stylesheet",href:s,"data-precedence":c},d),(d=fa.get(S))&&Vv(s,d);var K=N=g.createElement("link");mn(K),Xn(K,"link",s),K._p=new Promise(function(ct,bt){K.onload=ct,K.onerror=bt}),K.addEventListener("load",function(){L.loading|=1}),K.addEventListener("error",function(){L.loading|=2}),L.loading|=4,cf(N,c,g)}N={type:"stylesheet",instance:N,count:1,state:L},w.set(S,N)}}}function UT(s,c){Gi.X(s,c);var d=Is;if(d&&s){var g=lr(d).hoistableScripts,w=Os(s),S=g.get(w);S||(S=d.querySelector(cc(w)),S||(s=f({src:s,async:!0},c),(c=fa.get(w))&&Gv(s,c),S=d.createElement("script"),mn(S),Xn(S,"link",s),d.head.appendChild(S)),S={type:"script",instance:S,count:1,state:null},g.set(w,S))}}function WT(s,c){Gi.M(s,c);var d=Is;if(d&&s){var g=lr(d).hoistableScripts,w=Os(s),S=g.get(w);S||(S=d.querySelector(cc(w)),S||(s=f({src:s,async:!0,type:"module"},c),(c=fa.get(w))&&Gv(s,c),S=d.createElement("script"),mn(S),Xn(S,"link",s),d.head.appendChild(S)),S={type:"script",instance:S,count:1,state:null},g.set(w,S))}}function l1(s,c,d,g){var w=(w=Rt.current)?lf(w):null;if(!w)throw Error(n(446));switch(s){case"meta":case"title":return null;case"style":return typeof d.precedence=="string"&&typeof d.href=="string"?(c=Ns(d.href),d=lr(w).hoistableStyles,g=d.get(c),g||(g={type:"style",instance:null,count:0,state:null},d.set(c,g)),g):{type:"void",instance:null,count:0,state:null};case"link":if(d.rel==="stylesheet"&&typeof d.href=="string"&&typeof d.precedence=="string"){s=Ns(d.href);var S=lr(w).hoistableStyles,N=S.get(s);if(N||(w=w.ownerDocument||w,N={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},S.set(s,N),(S=w.querySelector(lc(s)))&&!S._p&&(N.instance=S,N.state.loading=5),fa.has(s)||(d={rel:"preload",as:"style",href:d.href,crossOrigin:d.crossOrigin,integrity:d.integrity,media:d.media,hrefLang:d.hrefLang,referrerPolicy:d.referrerPolicy},fa.set(s,d),S||VT(w,s,d,N.state))),c&&g===null)throw Error(n(528,""));return N}if(c&&g!==null)throw Error(n(529,""));return null;case"script":return c=d.async,d=d.src,typeof d=="string"&&c&&typeof c!="function"&&typeof c!="symbol"?(c=Os(d),d=lr(w).hoistableScripts,g=d.get(c),g||(g={type:"script",instance:null,count:0,state:null},d.set(c,g)),g):{type:"void",instance:null,count:0,state:null};default:throw Error(n(444,s))}}function Ns(s){return'href="'+cr(s)+'"'}function lc(s){return'link[rel="stylesheet"]['+s+"]"}function c1(s){return f({},s,{"data-precedence":s.precedence,precedence:null})}function VT(s,c,d,g){s.querySelector('link[rel="preload"][as="style"]['+c+"]")?g.loading=1:(c=s.createElement("link"),g.preload=c,c.addEventListener("load",function(){return g.loading|=1}),c.addEventListener("error",function(){return g.loading|=2}),Xn(c,"link",d),mn(c),s.head.appendChild(c))}function Os(s){return'[src="'+cr(s)+'"]'}function cc(s){return"script[async]"+s}function h1(s,c,d){if(c.count++,c.instance===null)switch(c.type){case"style":var g=s.querySelector('style[data-href~="'+cr(d.href)+'"]');if(g)return c.instance=g,mn(g),g;var w=f({},d,{"data-href":d.href,"data-precedence":d.precedence,href:null,precedence:null});return g=(s.ownerDocument||s).createElement("style"),mn(g),Xn(g,"style",w),cf(g,d.precedence,s),c.instance=g;case"stylesheet":w=Ns(d.href);var S=s.querySelector(lc(w));if(S)return c.state.loading|=4,c.instance=S,mn(S),S;g=c1(d),(w=fa.get(w))&&Vv(g,w),S=(s.ownerDocument||s).createElement("link"),mn(S);var N=S;return N._p=new Promise(function(L,K){N.onload=L,N.onerror=K}),Xn(S,"link",g),c.state.loading|=4,cf(S,d.precedence,s),c.instance=S;case"script":return S=Os(d.src),(w=s.querySelector(cc(S)))?(c.instance=w,mn(w),w):(g=d,(w=fa.get(S))&&(g=f({},d),Gv(g,w)),s=s.ownerDocument||s,w=s.createElement("script"),mn(w),Xn(w,"link",g),s.head.appendChild(w),c.instance=w);case"void":return null;default:throw Error(n(443,c.type))}else c.type==="stylesheet"&&(c.state.loading&4)===0&&(g=c.instance,c.state.loading|=4,cf(g,d.precedence,s));return c.instance}function cf(s,c,d){for(var g=d.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),w=g.length?g[g.length-1]:null,S=w,N=0;N<g.length;N++){var L=g[N];if(L.dataset.precedence===c)S=L;else if(S!==w)break}S?S.parentNode.insertBefore(s,S.nextSibling):(c=d.nodeType===9?d.head:d,c.insertBefore(s,c.firstChild))}function Vv(s,c){s.crossOrigin==null&&(s.crossOrigin=c.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=c.referrerPolicy),s.title==null&&(s.title=c.title)}function Gv(s,c){s.crossOrigin==null&&(s.crossOrigin=c.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=c.referrerPolicy),s.integrity==null&&(s.integrity=c.integrity)}var hf=null;function f1(s,c,d){if(hf===null){var g=new Map,w=hf=new Map;w.set(d,g)}else w=hf,g=w.get(d),g||(g=new Map,w.set(d,g));if(g.has(s))return g;for(g.set(s,null),d=d.getElementsByTagName(s),w=0;w<d.length;w++){var S=d[w];if(!(S[gr]||S[Mn]||s==="link"&&S.getAttribute("rel")==="stylesheet")&&S.namespaceURI!=="http://www.w3.org/2000/svg"){var N=S.getAttribute(c)||"";N=s+N;var L=g.get(N);L?L.push(S):g.set(N,[S])}}return g}function d1(s,c,d){s=s.ownerDocument||s,s.head.insertBefore(d,c==="title"?s.querySelector("head > title"):null)}function GT(s,c,d){if(d===1||c.itemProp!=null)return!1;switch(s){case"meta":case"title":return!0;case"style":if(typeof c.precedence!="string"||typeof c.href!="string"||c.href==="")break;return!0;case"link":if(typeof c.rel!="string"||typeof c.href!="string"||c.href===""||c.onLoad||c.onError)break;switch(c.rel){case"stylesheet":return s=c.disabled,typeof c.precedence=="string"&&s==null;default:return!0}case"script":if(c.async&&typeof c.async!="function"&&typeof c.async!="symbol"&&!c.onLoad&&!c.onError&&c.src&&typeof c.src=="string")return!0}return!1}function p1(s){return!(s.type==="stylesheet"&&(s.state.loading&3)===0)}var hc=null;function HT(){}function qT(s,c,d){if(hc===null)throw Error(n(475));var g=hc;if(c.type==="stylesheet"&&(typeof d.media!="string"||matchMedia(d.media).matches!==!1)&&(c.state.loading&4)===0){if(c.instance===null){var w=Ns(d.href),S=s.querySelector(lc(w));if(S){s=S._p,s!==null&&typeof s=="object"&&typeof s.then=="function"&&(g.count++,g=ff.bind(g),s.then(g,g)),c.state.loading|=4,c.instance=S,mn(S);return}S=s.ownerDocument||s,d=c1(d),(w=fa.get(w))&&Vv(d,w),S=S.createElement("link"),mn(S);var N=S;N._p=new Promise(function(L,K){N.onload=L,N.onerror=K}),Xn(S,"link",d),c.instance=S}g.stylesheets===null&&(g.stylesheets=new Map),g.stylesheets.set(c,s),(s=c.state.preload)&&(c.state.loading&3)===0&&(g.count++,c=ff.bind(g),s.addEventListener("load",c),s.addEventListener("error",c))}}function jT(){if(hc===null)throw Error(n(475));var s=hc;return s.stylesheets&&s.count===0&&Hv(s,s.stylesheets),0<s.count?function(c){var d=setTimeout(function(){if(s.stylesheets&&Hv(s,s.stylesheets),s.unsuspend){var g=s.unsuspend;s.unsuspend=null,g()}},6e4);return s.unsuspend=c,function(){s.unsuspend=null,clearTimeout(d)}}:null}function ff(){if(this.count--,this.count===0){if(this.stylesheets)Hv(this,this.stylesheets);else if(this.unsuspend){var s=this.unsuspend;this.unsuspend=null,s()}}}var df=null;function Hv(s,c){s.stylesheets=null,s.unsuspend!==null&&(s.count++,df=new Map,c.forEach(XT,s),df=null,ff.call(s))}function XT(s,c){if(!(c.state.loading&4)){var d=df.get(s);if(d)var g=d.get(null);else{d=new Map,df.set(s,d);for(var w=s.querySelectorAll("link[data-precedence],style[data-precedence]"),S=0;S<w.length;S++){var N=w[S];(N.nodeName==="LINK"||N.getAttribute("media")!=="not all")&&(d.set(N.dataset.precedence,N),g=N)}g&&d.set(null,g)}w=c.instance,N=w.getAttribute("data-precedence"),S=d.get(N)||g,S===g&&d.set(null,w),d.set(N,w),this.count++,g=ff.bind(this),w.addEventListener("load",g),w.addEventListener("error",g),S?S.parentNode.insertBefore(w,S.nextSibling):(s=s.nodeType===9?s.head:s,s.insertBefore(w,s.firstChild)),c.state.loading|=4}}var fc={$$typeof:_,Provider:null,Consumer:null,_currentValue:Q,_currentValue2:Q,_threadCount:0};function KT(s,c,d,g,w,S,N,L){this.tag=1,this.containerInfo=s,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=ns(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ns(0),this.hiddenUpdates=ns(null),this.identifierPrefix=g,this.onUncaughtError=w,this.onCaughtError=S,this.onRecoverableError=N,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=L,this.incompleteTransitions=new Map}function v1(s,c,d,g,w,S,N,L,K,ct,bt,Ct){return s=new KT(s,c,d,N,L,K,ct,Ct),c=1,S===!0&&(c|=24),S=Pr(3,null,null,c),s.current=S,S.stateNode=s,c=Rp(),c.refCount++,s.pooledCache=c,c.refCount++,S.memoizedState={element:g,isDehydrated:d,cache:c},kp(S),s}function m1(s){return s?(s=cs,s):cs}function g1(s,c,d,g,w,S){w=m1(w),g.context===null?g.context=w:g.pendingContext=w,g=go(c),g.payload={element:d},S=S===void 0?null:S,S!==null&&(g.callback=S),d=yo(s,g,c),d!==null&&(Wr(d,s,c),Vl(d,s,c))}function y1(s,c){if(s=s.memoizedState,s!==null&&s.dehydrated!==null){var d=s.retryLane;s.retryLane=d!==0&&d<c?d:c}}function qv(s,c){y1(s,c),(s=s.alternate)&&y1(s,c)}function x1(s){if(s.tag===13){var c=ls(s,67108864);c!==null&&Wr(c,s,67108864),qv(s,67108864)}}var pf=!0;function YT(s,c,d,g){var w=V.T;V.T=null;var S=X.p;try{X.p=2,jv(s,c,d,g)}finally{X.p=S,V.T=w}}function QT(s,c,d,g){var w=V.T;V.T=null;var S=X.p;try{X.p=8,jv(s,c,d,g)}finally{X.p=S,V.T=w}}function jv(s,c,d,g){if(pf){var w=Xv(g);if(w===null)Ov(s,c,g,vf,d),w1(s,g);else if($T(w,s,c,d,g))g.stopPropagation();else if(w1(s,g),c&4&&-1<ZT.indexOf(s)){for(;w!==null;){var S=sr(w);if(S!==null)switch(S.tag){case 3:if(S=S.stateNode,S.current.memoizedState.isDehydrated){var N=Dr(S.pendingLanes);if(N!==0){var L=S;for(L.pendingLanes|=2,L.entangledLanes|=2;N;){var K=1<<31-En(N);L.entanglements[1]|=K,N&=~K}ri(S),(_e&6)===0&&(Zh=Te()+500,ic(0))}}break;case 13:L=ls(S,2),L!==null&&Wr(L,S,2),Jh(),qv(S,2)}if(S=Xv(g),S===null&&Ov(s,c,g,vf,d),S===w)break;w=S}w!==null&&g.stopPropagation()}else Ov(s,c,g,null,d)}}function Xv(s){return s=tn(s),Kv(s)}var vf=null;function Kv(s){if(vf=null,s=fo(s),s!==null){var c=i(s);if(c===null)s=null;else{var d=c.tag;if(d===13){if(s=o(c),s!==null)return s;s=null}else if(d===3){if(c.stateNode.current.memoizedState.isDehydrated)return c.tag===3?c.stateNode.containerInfo:null;s=null}else c!==s&&(s=null)}}return vf=s,null}function b1(s){switch(s){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(je()){case Se:return 2;case vn:return 8;case Xe:case Ge:return 32;case ln:return 268435456;default:return 32}default:return 32}}var Yv=!1,Io=null,No=null,Oo=null,dc=new Map,pc=new Map,Mo=[],ZT="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function w1(s,c){switch(s){case"focusin":case"focusout":Io=null;break;case"dragenter":case"dragleave":No=null;break;case"mouseover":case"mouseout":Oo=null;break;case"pointerover":case"pointerout":dc.delete(c.pointerId);break;case"gotpointercapture":case"lostpointercapture":pc.delete(c.pointerId)}}function vc(s,c,d,g,w,S){return s===null||s.nativeEvent!==S?(s={blockedOn:c,domEventName:d,eventSystemFlags:g,nativeEvent:S,targetContainers:[w]},c!==null&&(c=sr(c),c!==null&&x1(c)),s):(s.eventSystemFlags|=g,c=s.targetContainers,w!==null&&c.indexOf(w)===-1&&c.push(w),s)}function $T(s,c,d,g,w){switch(c){case"focusin":return Io=vc(Io,s,c,d,g,w),!0;case"dragenter":return No=vc(No,s,c,d,g,w),!0;case"mouseover":return Oo=vc(Oo,s,c,d,g,w),!0;case"pointerover":var S=w.pointerId;return dc.set(S,vc(dc.get(S)||null,s,c,d,g,w)),!0;case"gotpointercapture":return S=w.pointerId,pc.set(S,vc(pc.get(S)||null,s,c,d,g,w)),!0}return!1}function E1(s){var c=fo(s.target);if(c!==null){var d=i(c);if(d!==null){if(c=d.tag,c===13){if(c=o(d),c!==null){s.blockedOn=c,Zd(s.priority,function(){if(d.tag===13){var g=Ur();g=na(g);var w=ls(d,g);w!==null&&Wr(w,d,g),qv(d,g)}});return}}else if(c===3&&d.stateNode.current.memoizedState.isDehydrated){s.blockedOn=d.tag===3?d.stateNode.containerInfo:null;return}}}s.blockedOn=null}function mf(s){if(s.blockedOn!==null)return!1;for(var c=s.targetContainers;0<c.length;){var d=Xv(s.nativeEvent);if(d===null){d=s.nativeEvent;var g=new d.constructor(d.type,d);Je=g,d.target.dispatchEvent(g),Je=null}else return c=sr(d),c!==null&&x1(c),s.blockedOn=d,!1;c.shift()}return!0}function C1(s,c,d){mf(s)&&d.delete(c)}function JT(){Yv=!1,Io!==null&&mf(Io)&&(Io=null),No!==null&&mf(No)&&(No=null),Oo!==null&&mf(Oo)&&(Oo=null),dc.forEach(C1),pc.forEach(C1)}function gf(s,c){s.blockedOn===c&&(s.blockedOn=null,Yv||(Yv=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,JT)))}var yf=null;function S1(s){yf!==s&&(yf=s,r.unstable_scheduleCallback(r.unstable_NormalPriority,function(){yf===s&&(yf=null);for(var c=0;c<s.length;c+=3){var d=s[c],g=s[c+1],w=s[c+2];if(typeof g!="function"){if(Kv(g||d)===null)continue;break}var S=sr(d);S!==null&&(s.splice(c,3),c-=3,Kp(S,{pending:!0,data:w,method:d.method,action:g},g,w))}}))}function mc(s){function c(K){return gf(K,s)}Io!==null&&gf(Io,s),No!==null&&gf(No,s),Oo!==null&&gf(Oo,s),dc.forEach(c),pc.forEach(c);for(var d=0;d<Mo.length;d++){var g=Mo[d];g.blockedOn===s&&(g.blockedOn=null)}for(;0<Mo.length&&(d=Mo[0],d.blockedOn===null);)E1(d),d.blockedOn===null&&Mo.shift();if(d=(s.ownerDocument||s).$$reactFormReplay,d!=null)for(g=0;g<d.length;g+=3){var w=d[g],S=d[g+1],N=w[Ke]||null;if(typeof S=="function")N||S1(d);else if(N){var L=null;if(S&&S.hasAttribute("formAction")){if(w=S,N=S[Ke]||null)L=N.formAction;else if(Kv(w)!==null)continue}else L=N.action;typeof L=="function"?d[g+1]=L:(d.splice(g,3),g-=3),S1(d)}}}function Qv(s){this._internalRoot=s}xf.prototype.render=Qv.prototype.render=function(s){var c=this._internalRoot;if(c===null)throw Error(n(409));var d=c.current,g=Ur();g1(d,g,s,c,null,null)},xf.prototype.unmount=Qv.prototype.unmount=function(){var s=this._internalRoot;if(s!==null){this._internalRoot=null;var c=s.containerInfo;g1(s.current,2,null,s,null,null),Jh(),c[ho]=null}};function xf(s){this._internalRoot=s}xf.prototype.unstable_scheduleHydration=function(s){if(s){var c=_a();s={blockedOn:null,target:s,priority:c};for(var d=0;d<Mo.length&&c!==0&&c<Mo[d].priority;d++);Mo.splice(d,0,s),d===0&&E1(s)}};var R1=t.version;if(R1!=="19.1.1")throw Error(n(527,R1,"19.1.1"));X.findDOMNode=function(s){var c=s._reactInternals;if(c===void 0)throw typeof s.render=="function"?Error(n(188)):(s=Object.keys(s).join(","),Error(n(268,s)));return s=l(c),s=s!==null?h(s):null,s=s===null?null:s.stateNode,s};var tk={bundleType:0,version:"19.1.1",rendererPackageName:"react-dom",currentDispatcherRef:V,reconcilerVersion:"19.1.1"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var bf=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!bf.isDisabled&&bf.supportsFiber)try{On=bf.inject(tk),Be=bf}catch{}}return yc.createRoot=function(s,c){if(!a(s))throw Error(n(299));var d=!1,g="",w=Wx,S=Vx,N=Gx,L=null;return c!=null&&(c.unstable_strictMode===!0&&(d=!0),c.identifierPrefix!==void 0&&(g=c.identifierPrefix),c.onUncaughtError!==void 0&&(w=c.onUncaughtError),c.onCaughtError!==void 0&&(S=c.onCaughtError),c.onRecoverableError!==void 0&&(N=c.onRecoverableError),c.unstable_transitionCallbacks!==void 0&&(L=c.unstable_transitionCallbacks)),c=v1(s,1,!1,null,null,d,g,w,S,N,L,null),s[ho]=c.current,Nv(s),new Qv(c)},yc.hydrateRoot=function(s,c,d){if(!a(s))throw Error(n(299));var g=!1,w="",S=Wx,N=Vx,L=Gx,K=null,ct=null;return d!=null&&(d.unstable_strictMode===!0&&(g=!0),d.identifierPrefix!==void 0&&(w=d.identifierPrefix),d.onUncaughtError!==void 0&&(S=d.onUncaughtError),d.onCaughtError!==void 0&&(N=d.onCaughtError),d.onRecoverableError!==void 0&&(L=d.onRecoverableError),d.unstable_transitionCallbacks!==void 0&&(K=d.unstable_transitionCallbacks),d.formState!==void 0&&(ct=d.formState)),c=v1(s,1,!0,c,d??null,g,w,S,N,L,K,ct),c.context=m1(null),d=c.current,g=Ur(),g=na(g),w=go(g),w.callback=null,yo(d,w,g),d=g,c.current.lanes=d,mr(c,d),ri(c),s[ho]=c.current,Nv(s),new xf(c)},yc.version="19.1.1",yc}var P1;function dk(){if(P1)return tm.exports;P1=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(t){console.error(t)}}return r(),tm.exports=fk(),tm.exports}var pk=dk();/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Xm=function(r,t){return Xm=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var a in n)n.hasOwnProperty(a)&&(e[a]=n[a])},Xm(r,t)};function ie(r,t){Xm(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var Ji=function(){return Ji=Object.assign||function(t){for(var e,n=1,a=arguments.length;n<a;n++){e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},Ji.apply(this,arguments)};function Jt(r,t,e,n){function a(i){return i instanceof e?i:new e(function(o){o(i)})}return new(e||(e=Promise))(function(i,o){function u(f){try{h(n.next(f))}catch(p){o(p)}}function l(f){try{h(n.throw(f))}catch(p){o(p)}}function h(f){f.done?i(f.value):a(f.value).then(u,l)}h((n=n.apply(r,[])).next())})}function te(r,t){var e={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,a,i,o;return o={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function u(h){return function(f){return l([h,f])}}function l(h){if(n)throw new TypeError("Generator is already executing.");for(;e;)try{if(n=1,a&&(i=h[0]&2?a.return:h[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,h[1])).done)return i;switch(a=0,i&&(h=[h[0]&2,i.value]),h[0]){case 0:case 1:i=h;break;case 4:return e.label++,{value:h[1],done:!1};case 5:e.label++,a=h[1],h=[0];continue;case 7:h=e.ops.pop(),e.trys.pop();continue;default:if(i=e.trys,!(i=i.length>0&&i[i.length-1])&&(h[0]===6||h[0]===2)){e=0;continue}if(h[0]===3&&(!i||h[1]>i[0]&&h[1]<i[3])){e.label=h[1];break}if(h[0]===6&&e.label<i[1]){e.label=i[1],i=h;break}if(i&&e.label<i[2]){e.label=i[2],e.ops.push(h);break}i[2]&&e.ops.pop(),e.trys.pop();continue}h=t.call(r,e)}catch(f){h=[6,f],a=0}finally{n=i=0}if(h[0]&5)throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var BE=function(r,t){return(BE=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var a in n)n.hasOwnProperty(a)&&(e[a]=n[a])})(r,t)};function eo(r,t){function e(){this.constructor=r}BE(r,t),r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}function Ne(r,t,e,n){return new(e||(e=Promise))(function(a,i){function o(h){try{l(n.next(h))}catch(f){i(f)}}function u(h){try{l(n.throw(h))}catch(f){i(f)}}function l(h){h.done?a(h.value):new e(function(f){f(h.value)}).then(o,u)}l((n=n.apply(r,[])).next())})}function Oe(r,t){var e,n,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(i[Symbol.iterator]=function(){return this}),i;function u(l){return function(h){return(function(f){if(e)throw new TypeError("Generator is already executing.");for(;o;)try{if(e=1,n&&(a=2&f[0]?n.return:f[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,f[1])).done)return a;switch(n=0,a&&(f=[2&f[0],a.value]),f[0]){case 0:case 1:a=f;break;case 4:return o.label++,{value:f[1],done:!1};case 5:o.label++,n=f[1],f=[0];continue;case 7:f=o.ops.pop(),o.trys.pop();continue;default:if(!(a=(a=o.trys).length>0&&a[a.length-1])&&(f[0]===6||f[0]===2)){o=0;continue}if(f[0]===3&&(!a||f[1]>a[0]&&f[1]<a[3])){o.label=f[1];break}if(f[0]===6&&o.label<a[1]){o.label=a[1],a=f;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(f);break}a[2]&&o.ops.pop(),o.trys.pop();continue}f=t.call(r,o)}catch(p){f=[6,p],n=0}finally{e=a=0}if(5&f[0])throw f[1];return{value:f[0]?f[1]:void 0,done:!0}})([l,h])}}}var Tu={},am={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function vk(r,t){Tu[r]=t}function yi(r){r in Tu||(Tu[r]=mk(r));var t=Tu[r];return t.isContextLost()?(delete Tu[r],yi(r)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),Tu[r])}function mk(r){if(r!==1&&r!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var t=document.createElement("canvas");return t.addEventListener("webglcontextlost",function(e){e.preventDefault(),delete Tu[r]},!1),r===1?t.getContext("webgl",am)||t.getContext("experimental-webgl",am):t.getContext("webgl2",am)}function gk(){var r=navigator.userAgent||navigator.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(r)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(r.substr(0,4))}function Km(r,t,e){return Math.max(r,Math.min(t,e))}function nl(r){return r%2==0?r:r+1}function yk(r){for(var t=0,e=0;e<r.length;e++)t+=r[e];return t}function xk(r,t){var e=Math.random();return t*e+(1-e)*r}function Y(r,t){if(!r)throw new Error(typeof t=="string"?t:t())}function Me(r,t,e){e===void 0&&(e=""),Y(pr(r,t),function(){return e+" Shapes "+r+" and "+t+" must match"})}function pl(r){Y(r!=null,function(){return"The input to the tensor constructor must be a non-null value."})}function rl(r,t){if(t===void 0&&(t=[]),t==null&&(t=[]),Array.isArray(r)||to(r))for(var e=0;e<r.length;++e)rl(r[e],t);else t.push(r);return t}function qt(r){if(r.length===0)return 1;for(var t=r[0],e=1;e<r.length;e++)t*=r[e];return t}function pr(r,t){if(r===t)return!0;if(r==null||t==null||r.length!==t.length)return!1;for(var e=0;e<r.length;e++)if(r[e]!==t[e])return!1;return!0}function xa(r){return r%1==0}function bk(r){if(Math.tanh!=null)return Math.tanh(r);if(r===1/0)return 1;if(r===-1/0)return-1;var t=Math.exp(2*r);return(t-1)/(t+1)}function F1(r){var t=Math.ceil(Math.sqrt(r));return[t,Math.ceil(r/t)]}function js(r,t){return t<=r.length?r:r+" ".repeat(t-r.length)}function L1(r,t,e){return t===void 0&&(t=function(n){return 0}),new Promise(function(n,a){var i=0,o=function(){if(r())n();else{var u=t(++i);e!=null&&i>=e?a():setTimeout(o,u)}};o()})}function wk(r,t){for(var e=1,n=-1,a=0;a<r.length;++a)if(r[a]>=0)e*=r[a];else if(r[a]===-1){if(n!==-1)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+n+" and dim "+a);n=a}else if(r[a]<0)throw Error("Shapes can not be < 0. Found "+r[a]+" at dim "+a);if(n===-1){if(t>0&&t!==e)throw Error("Size("+t+") must match the product of shape "+r);return r}if(e===0)throw Error("Cannot infer the missing size in ["+r+"] when there are 0 elements");if(t%e!=0)throw Error("The implicit shape can't be a fractional number. Got "+t+" / "+e);var i=r.slice();return i[n]=t/e,i}function $n(r,t){var e=t.length;return Y((r=r==null?t.map(function(n,a){return a}):[].concat(r)).every(function(n){return n>=-e&&n<e}),function(){return"All values in axis param must be in range [-"+e+", "+e+") but got axis "+r}),Y(r.every(function(n){return xa(n)}),function(){return"All values in axis param must be integers but got axis "+r}),r.map(function(n){return n<0?e+n:n})}function Vu(r,t){for(var e=[],n=[],a=t==null?null:$n(t,r).sort(),i=0,o=0;o<r.length;++o){if(a!=null){if(a[i]===o&&r[o]!==1)throw new Error("Can't squeeze axis "+o+" since its dim '"+r[o]+"' is not 1");(a[i]==null||a[i]>o)&&r[o]===1&&(e.push(r[o]),n.push(o)),a[i]<=o&&i++}r[o]!==1&&(e.push(r[o]),n.push(o))}return{newShape:e,keptDims:n}}function Ym(r,t){var e=null;if(r==null||r==="float32")e=new Float32Array(t);else if(r==="int32")e=new Int32Array(t);else{if(r!=="bool")throw new Error("Unknown data type "+r);e=new Uint8Array(t)}return e}function qf(r,t){var e=null;if(r==null||r==="float32")e=new Float32Array(t);else if(r==="int32")e=new Int32Array(t);else if(r==="bool")e=new Uint8Array(t);else{if(r!=="string")throw new Error("Unknown data type "+r);e=new Array(t)}return e}function Ek(r,t,e){if(t==="float32")for(var n=0;n<r.length;n++){var a=r[n];if(isNaN(a)||!isFinite(a))throw Error("The result of the '"+e+"' is "+a+".")}}function Ck(r,t){for(var e=0;e<r.length;e++){var n=r[e];if(isNaN(n)||!isFinite(n))throw Error("A tensor of type "+t+" being uploaded contains "+n+".")}}function Sk(r,t){return t!=="complex64"&&(t!=="float32"||r==="complex64")&&(t!=="int32"||r==="float32"||r==="complex64")&&(t!=="bool"||r!=="bool")}function to(r){return r instanceof Float32Array||r instanceof Int32Array||r instanceof Uint8Array}function PE(r){if(r==="float32"||r==="int32")return 4;if(r==="complex64")return 8;if(r==="bool")return 1;throw new Error("Unknown dtype "+r)}function Rk(r){if(r==null)return 0;var t=0;return r.forEach(function(e){return t+=2*e.length}),t}function FE(r){return typeof r=="string"||r instanceof String}function _k(r){return typeof r=="boolean"}function Ak(r){return typeof r=="number"}function zc(r){return Array.isArray(r)?zc(r[0]):r instanceof Float32Array?"float32":r instanceof Int32Array||r instanceof Uint8Array?"int32":Ak(r)?"float32":FE(r)?"string":_k(r)?"bool":"float32"}function Qm(r){return!!(r&&r.constructor&&r.call&&r.apply)}function Zm(r,t){for(var e=t;e<r;++e)if(r%e==0)return e;return r}function Gu(r){var t=r.length;if(t<2)return[];var e=new Array(t-1);e[t-2]=r[t-1];for(var n=t-3;n>=0;--n)e[n]=e[n+1]*r[n+1];return e}function LE(r,t,e){if(t==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(r)&&(r=rl(r)),e&&Ck(r,t),Tk(r,t))return r;if(t==null||t==="float32"||t==="complex64")return new Float32Array(r);if(t==="int32")return new Int32Array(r);if(t==="bool"){for(var n=new Uint8Array(r.length),a=0;a<n.length;++a)Math.round(r[a])!==0&&(n[a]=1);return n}throw new Error("Unknown data type "+t)}function zE(r,t,e){var n=new Array;if(t.length===1)for(var a=t[0],i=0;i<a;i++)n[i]=e[r+i];else{a=t[0];var o=t.slice(1),u=o.reduce(function(l,h){return l*h});for(i=0;i<a;i++)n[i]=zE(r+i*u,o,e)}return n}function z1(r,t){if(r.length===0)return t[0];var e=r.reduce(function(n,a){return n*a});if(e===0)return[];if(e!==t.length)throw new Error("["+r+"] does not match the input size.");return zE(0,r,t)}function Tk(r,t){return r instanceof Float32Array&&t==="float32"||r instanceof Int32Array&&t==="int32"||r instanceof Uint8Array&&t==="bool"}function UE(r,t){for(var e=Uc(r,t),n=0;n<e.length;n++)e[n]=1;return e}function Uc(r,t){if(t==null||t==="float32"||t==="complex64")return new Float32Array(r);if(t==="int32")return new Int32Array(r);if(t==="bool")return new Uint8Array(r);throw new Error("Unknown data type "+t)}function jf(){if(typeof performance<"u")return performance.now();if(typeof process<"u"){var r=process.hrtime();return 1e3*r[0]+r[1]/1e6}throw new Error("Cannot measure time in this environment. You should run tf.js in the browser or in Node.js")}function WE(r){r.forEach(function(t){Y(Number.isInteger(t)&&t>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+r+"]."})})}var kk=(function(){function r(t,e){this.backendTimer=t,this.logger=e,e==null&&(this.logger=new Dk)}return r.prototype.profileKernel=function(t,e){var n,a=this,i=this.backendTimer.time(function(){n=e()});return(Array.isArray(n)?n:[n]).forEach(function(o){var u=o.dataSync();Ek(u,o.dtype,t),i.then(function(l){var h="";l.getExtraProfileInfo!=null&&(h=l.getExtraProfileInfo()),a.logger.logKernelProfile(t,o,u,l.kernelMs,h)})}),n},r})(),Dk=(function(){function r(){}return r.prototype.logKernelProfile=function(t,e,n,a,i){var o=js(a+"ms",9),u=js(t,25),l=e.rank,h=e.size,f=js(e.shape.toString(),14);console.log("%c"+u+"	%c"+o+"	%c"+l+"D "+f+"	%c"+h+"	%c"+i,"font-weight:bold","color:red","color:blue","color: orange","color: green")},r})(),U1=20,xc=3,im=7;function Ik(r,t,e,n){var a=Gu(t),i=Nk(r,t,e,a),o=t.length,u=Wf(r,t,e,a,i),l=["Tensor"];return n&&(l.push("  dtype: "+e),l.push("  rank: "+o),l.push("  shape: ["+t+"]"),l.push("  values:")),l.push(u.map(function(h){return"    "+h}).join(`
`)),l.join(`
`)}function Nk(r,t,e,n){var a=qt(t),i=n[n.length-1],o=new Array(i).fill(0),u=t.length,l=e==="complex64"?Rc(r):r;if(u>1)for(var h=0;h<a/i;h++)for(var f=h*i,p=0;p<i;p++)o[p]=Math.max(o[p],Sc(l[f+p],0,e).length);return o}function Sc(r,t,e){return js(Array.isArray(r)?parseFloat(r[0].toFixed(im))+" + "+parseFloat(r[1].toFixed(im))+"j":FE(r)?"'"+r+"'":e==="bool"?VE(r):parseFloat(r.toFixed(im)).toString(),t)}function VE(r){return r===0?"false":"true"}function Wf(r,t,e,n,a,i){i===void 0&&(i=!0);var o=e==="complex64"?2:1,u=t[0],l=t.length;if(l===0)return e==="complex64"?[Sc(Rc(r)[0],0,e)]:e==="bool"?[VE(r[0])]:[r[0].toString()];if(l===1){if(u>U1){var h=xc*o,f=Array.from(r.slice(0,h)),p=Array.from(r.slice(u-xc*o,u));return e==="complex64"&&(f=Rc(f),p=Rc(p)),["["+f.map(function(k,D){return Sc(k,a[D],e)}).join(", ")+", ..., "+p.map(function(k,D){return Sc(k,a[u-xc+D],e)}).join(", ")+"]"]}return["["+(e==="complex64"?Rc(r):Array.from(r)).map(function(k,D){return Sc(k,a[D],e)}).join(", ")+"]"]}var v=t.slice(1),m=n.slice(1),x=n[0]*o,b=[];if(u>U1){for(var E=0;E<xc;E++){var C=(R=E*x)+x;b.push.apply(b,Wf(r.slice(R,C),v,e,m,a,!1))}for(b.push("..."),E=u-xc;E<u;E++)C=(R=E*x)+x,b.push.apply(b,Wf(r.slice(R,C),v,e,m,a,E===u-1))}else for(E=0;E<u;E++){var R;C=(R=E*x)+x,b.push.apply(b,Wf(r.slice(R,C),v,e,m,a,E===u-1))}var _=l===2?",":"";for(b[0]="["+b[0]+_,E=1;E<b.length-1;E++)b[E]=" "+b[E]+_;var A=`,
`;for(E=2;E<l;E++)A+=`
`;return b[b.length-1]=" "+b[b.length-1]+"]"+(i?"":A),b}function Rc(r){for(var t=[],e=0;e<r.length;e+=2)t.push([r[e],r[e+1]]);return t}var Dc=(function(){function r(t,e,n){var a=this;if(this.dtype=e,this.shape=t.slice(),this.size=qt(t),n!=null){var i=n.length;Y(i===this.size,function(){return"Length of values '"+i+"' does not match the size inferred by the shape '"+a.size+"'."})}if(e==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||qf(e,this.size),this.strides=Gu(t)}return r.prototype.set=function(t){for(var e=this,n=[],a=1;a<arguments.length;a++)n[a-1]=arguments[a];n.length===0&&(n=[0]),Y(n.length===this.rank,function(){return"The number of provided coordinates ("+n.length+") must match the rank ("+e.rank+")"});var i=this.locToIndex(n);this.values[i]=t},r.prototype.get=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];t.length===0&&(t=[0]);for(var n=0,a=0,i=t;a<i.length;a++){var o=i[a];if(o<0||o>=this.shape[n]){var u="Requested out of range element at "+t+".   Buffer shape="+this.shape;throw new Error(u)}n++}for(var l=t[t.length-1],h=0;h<t.length-1;++h)l+=this.strides[h]*t[h];return this.values[l]},r.prototype.locToIndex=function(t){if(this.rank===0)return 0;if(this.rank===1)return t[0];for(var e=t[t.length-1],n=0;n<t.length-1;++n)e+=this.strides[n]*t[n];return e},r.prototype.indexToLoc=function(t){if(this.rank===0)return[];if(this.rank===1)return[t];for(var e=new Array(this.shape.length),n=0;n<e.length-1;++n)e[n]=Math.floor(t/this.strides[n]),t-=e[n]*this.strides[n];return e[e.length-1]=t,e},Object.defineProperty(r.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),r.prototype.toTensor=function(){return kt.make(this.shape,{values:this.values},this.dtype)},r})(),da=null,mt=null,GE=null;function Ok(r){da=r}function Mk(r){mt=r}function Bk(r){GE=r}var kt=(function(){function r(t,e,n,a,i){this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=e||"float32",this.size=qt(t),this.strides=Gu(t),this.dataId=a??{},this.id=da().nextTensorId(),this.rankType=this.rank<5?this.rank.toString():"higher",da().registerTensor(this,i),n!=null&&da().write(this.dataId,n)}return r.make=function(t,e,n,a){return new r(t,n,e.values,e.dataId,a)},r.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},r.prototype.asScalar=function(){return this.throwIfDisposed(),Y(this.size===1,function(){return"The array must have only 1 element."}),this.reshape([])},r.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},r.prototype.as2D=function(t,e){return this.throwIfDisposed(),this.reshape([t,e])},r.prototype.as3D=function(t,e,n){return this.throwIfDisposed(),this.reshape([t,e,n])},r.prototype.as4D=function(t,e,n,a){return this.throwIfDisposed(),this.reshape([t,e,n,a])},r.prototype.as5D=function(t,e,n,a,i){return this.throwIfDisposed(),this.reshape([t,e,n,a,i])},r.prototype.asType=function(t){return this.throwIfDisposed(),mt.cast(this,t)},Object.defineProperty(r.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),r.prototype.buffer=function(){return Ne(this,void 0,void 0,function(){var t;return Oe(this,function(e){switch(e.label){case 0:return[4,this.data()];case 1:return t=e.sent(),[2,mt.buffer(this.shape,this.dtype,t)]}})})},r.prototype.bufferSync=function(){return mt.buffer(this.shape,this.dtype,this.dataSync())},r.prototype.array=function(){return Ne(this,void 0,void 0,function(){var t;return Oe(this,function(e){switch(e.label){case 0:return[4,this.data()];case 1:return t=e.sent(),[2,z1(this.shape,t)]}})})},r.prototype.arraySync=function(){return z1(this.shape,this.dataSync())},r.prototype.data=function(){return Ne(this,void 0,void 0,function(){return Oe(this,function(t){return this.throwIfDisposed(),[2,da().read(this.dataId)]})})},r.prototype.dataSync=function(){return this.throwIfDisposed(),da().readSync(this.dataId)},r.prototype.dispose=function(){this.isDisposed||(da().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(r.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),r.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},r.prototype.toFloat=function(){return this.asType("float32")},r.prototype.toInt=function(){return this.asType("int32")},r.prototype.toBool=function(){return this.asType("bool")},r.prototype.print=function(t){return t===void 0&&(t=!1),mt.print(this,t)},r.prototype.reshape=function(t){return this.throwIfDisposed(),mt.reshape(this,t)},r.prototype.reshapeAs=function(t){return this.throwIfDisposed(),this.reshape(t.shape)},r.prototype.expandDims=function(t){return t===void 0&&(t=0),mt.expandDims(this,t)},r.prototype.cumsum=function(t,e,n){return t===void 0&&(t=0),e===void 0&&(e=!1),n===void 0&&(n=!1),mt.cumsum(this,t,e,n)},r.prototype.squeeze=function(t){return this.throwIfDisposed(),mt.squeeze(this,t)},r.prototype.clone=function(){return this.throwIfDisposed(),mt.clone(this)},r.prototype.oneHot=function(t,e,n){return this.throwIfDisposed(),mt.oneHot(this,t,e,n)},r.prototype.toString=function(t){return t===void 0&&(t=!1),Ik(this.dataSync(),this.shape,this.dtype,t)},r.prototype.tile=function(t){return this.throwIfDisposed(),mt.tile(this,t)},r.prototype.gather=function(t,e){return e===void 0&&(e=0),this.throwIfDisposed(),mt.gather(this,t,e)},r.prototype.matMul=function(t,e,n){return e===void 0&&(e=!1),n===void 0&&(n=!1),this.throwIfDisposed(),mt.matMul(this,t,e,n)},r.prototype.dot=function(t){return this.throwIfDisposed(),mt.dot(this,t)},r.prototype.norm=function(t,e,n){return t===void 0&&(t="euclidean"),e===void 0&&(e=null),n===void 0&&(n=!1),this.throwIfDisposed(),mt.norm(this,t,e,n)},r.prototype.slice=function(t,e){return this.throwIfDisposed(),mt.slice(this,t,e)},r.prototype.reverse=function(t){return this.throwIfDisposed(),mt.reverse(this,t)},r.prototype.concat=function(t,e){return e===void 0&&(e=0),this.throwIfDisposed(),t instanceof r&&(t=[t]),mt.concat([this].concat(t),e)},r.prototype.split=function(t,e){return e===void 0&&(e=0),this.throwIfDisposed(),mt.split(this,t,e)},r.prototype.stack=function(t,e){return e===void 0&&(e=0),mt.stack([this,t],e)},r.prototype.unstack=function(t){return t===void 0&&(t=0),mt.unstack(this,t)},r.prototype.pad=function(t,e){return e===void 0&&(e=0),mt.pad(this,t,e)},r.prototype.batchNormalization=function(t,e,n,a,i){return n===void 0&&(n=.001),GE("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(t,e,i,a,n)},r.prototype.batchNorm=function(t,e,n,a,i){return i===void 0&&(i=.001),this.throwIfDisposed(),mt.batchNorm(this,t,e,n,a,i)},r.prototype.all=function(t,e){return t===void 0&&(t=null),e===void 0&&(e=!1),this.throwIfDisposed(),mt.all(this,t,e)},r.prototype.any=function(t,e){return t===void 0&&(t=null),e===void 0&&(e=!1),this.throwIfDisposed(),mt.any(this,t,e)},r.prototype.logSumExp=function(t,e){return t===void 0&&(t=null),e===void 0&&(e=!1),this.throwIfDisposed(),mt.logSumExp(this,t,e)},r.prototype.sum=function(t,e){return t===void 0&&(t=null),e===void 0&&(e=!1),this.throwIfDisposed(),mt.sum(this,t,e)},r.prototype.prod=function(t,e){return t===void 0&&(t=null),e===void 0&&(e=!1),this.throwIfDisposed(),mt.prod(this,t,e)},r.prototype.mean=function(t,e){return t===void 0&&(t=null),e===void 0&&(e=!1),this.throwIfDisposed(),mt.mean(this,t,e)},r.prototype.min=function(t,e){return t===void 0&&(t=null),e===void 0&&(e=!1),this.throwIfDisposed(),mt.min(this,t,e)},r.prototype.max=function(t,e){return t===void 0&&(t=null),e===void 0&&(e=!1),this.throwIfDisposed(),mt.max(this,t,e)},r.prototype.argMin=function(t){return t===void 0&&(t=null),this.throwIfDisposed(),mt.argMin(this,t)},r.prototype.argMax=function(t){return t===void 0&&(t=null),this.throwIfDisposed(),mt.argMax(this,t)},r.prototype.cast=function(t){return this.throwIfDisposed(),mt.cast(this,t)},r.prototype.add=function(t){return this.throwIfDisposed(),mt.add(this,t)},r.prototype.addStrict=function(t){return this.throwIfDisposed(),mt.addStrict(this,t)},r.prototype.atan2=function(t){return this.throwIfDisposed(),mt.atan2(this,t)},r.prototype.sub=function(t){return this.throwIfDisposed(),mt.sub(this,t)},r.prototype.subStrict=function(t){return this.throwIfDisposed(),mt.subStrict(this,t)},r.prototype.pow=function(t){return this.throwIfDisposed(),mt.pow(this,t)},r.prototype.powStrict=function(t){return this.throwIfDisposed(),mt.powStrict(this,t)},r.prototype.mul=function(t){return this.throwIfDisposed(),mt.mul(this,t)},r.prototype.mulStrict=function(t){return this.throwIfDisposed(),mt.mulStrict(this,t)},r.prototype.div=function(t){return this.throwIfDisposed(),mt.div(this,t)},r.prototype.floorDiv=function(t){return this.throwIfDisposed(),mt.floorDiv(this,t)},r.prototype.divStrict=function(t){return this.throwIfDisposed(),mt.divStrict(this,t)},r.prototype.minimum=function(t){return this.throwIfDisposed(),mt.minimum(this,t)},r.prototype.minimumStrict=function(t){return this.throwIfDisposed(),mt.minimumStrict(this,t)},r.prototype.maximum=function(t){return this.throwIfDisposed(),mt.maximum(this,t)},r.prototype.maximumStrict=function(t){return this.throwIfDisposed(),mt.maximumStrict(this,t)},r.prototype.mod=function(t){return this.throwIfDisposed(),mt.mod(this,t)},r.prototype.modStrict=function(t){return this.throwIfDisposed(),mt.modStrict(this,t)},r.prototype.squaredDifference=function(t){return this.throwIfDisposed(),mt.squaredDifference(this,t)},r.prototype.squaredDifferenceStrict=function(t){return this.throwIfDisposed(),mt.squaredDifferenceStrict(this,t)},r.prototype.transpose=function(t){return this.throwIfDisposed(),mt.transpose(this,t)},r.prototype.notEqual=function(t){return this.throwIfDisposed(),mt.notEqual(this,t)},r.prototype.notEqualStrict=function(t){return this.throwIfDisposed(),mt.notEqualStrict(this,t)},r.prototype.less=function(t){return this.throwIfDisposed(),mt.less(this,t)},r.prototype.lessStrict=function(t){return this.throwIfDisposed(),mt.lessStrict(this,t)},r.prototype.equal=function(t){return this.throwIfDisposed(),mt.equal(this,t)},r.prototype.equalStrict=function(t){return this.throwIfDisposed(),mt.equalStrict(this,t)},r.prototype.lessEqual=function(t){return this.throwIfDisposed(),mt.lessEqual(this,t)},r.prototype.lessEqualStrict=function(t){return this.throwIfDisposed(),mt.lessEqualStrict(this,t)},r.prototype.greater=function(t){return this.throwIfDisposed(),mt.greater(this,t)},r.prototype.greaterStrict=function(t){return this.throwIfDisposed(),mt.greaterStrict(this,t)},r.prototype.greaterEqual=function(t){return this.throwIfDisposed(),mt.greaterEqual(this,t)},r.prototype.greaterEqualStrict=function(t){return this.throwIfDisposed(),mt.greaterEqualStrict(this,t)},r.prototype.logicalAnd=function(t){return this.throwIfDisposed(),mt.logicalAnd(this,t)},r.prototype.logicalOr=function(t){return this.throwIfDisposed(),mt.logicalOr(this,t)},r.prototype.logicalNot=function(){return this.throwIfDisposed(),mt.logicalNot(this)},r.prototype.logicalXor=function(t){return this.throwIfDisposed(),mt.logicalXor(this,t)},r.prototype.where=function(t,e){return this.throwIfDisposed(),mt.where(t,this,e)},r.prototype.neg=function(){return this.throwIfDisposed(),mt.neg(this)},r.prototype.ceil=function(){return this.throwIfDisposed(),mt.ceil(this)},r.prototype.floor=function(){return this.throwIfDisposed(),mt.floor(this)},r.prototype.sign=function(){return this.throwIfDisposed(),mt.sign(this)},r.prototype.exp=function(){return this.throwIfDisposed(),mt.exp(this)},r.prototype.expm1=function(){return this.throwIfDisposed(),mt.expm1(this)},r.prototype.log=function(){return this.throwIfDisposed(),mt.log(this)},r.prototype.log1p=function(){return this.throwIfDisposed(),mt.log1p(this)},r.prototype.sqrt=function(){return this.throwIfDisposed(),mt.sqrt(this)},r.prototype.rsqrt=function(){return this.throwIfDisposed(),mt.rsqrt(this)},r.prototype.square=function(){return this.throwIfDisposed(),mt.square(this)},r.prototype.reciprocal=function(){return this.throwIfDisposed(),mt.reciprocal(this)},r.prototype.abs=function(){return this.throwIfDisposed(),mt.abs(this)},r.prototype.clipByValue=function(t,e){return this.throwIfDisposed(),mt.clipByValue(this,t,e)},r.prototype.relu=function(){return this.throwIfDisposed(),mt.relu(this)},r.prototype.elu=function(){return this.throwIfDisposed(),mt.elu(this)},r.prototype.selu=function(){return this.throwIfDisposed(),mt.selu(this)},r.prototype.leakyRelu=function(t){return t===void 0&&(t=.2),this.throwIfDisposed(),mt.leakyRelu(this,t)},r.prototype.prelu=function(t){return this.throwIfDisposed(),mt.prelu(this,t)},r.prototype.sigmoid=function(){return this.throwIfDisposed(),mt.sigmoid(this)},r.prototype.logSigmoid=function(){return this.throwIfDisposed(),mt.logSigmoid(this)},r.prototype.softplus=function(){return this.throwIfDisposed(),mt.softplus(this)},r.prototype.zerosLike=function(){return this.throwIfDisposed(),mt.zerosLike(this)},r.prototype.onesLike=function(){return this.throwIfDisposed(),mt.onesLike(this)},r.prototype.sin=function(){return this.throwIfDisposed(),mt.sin(this)},r.prototype.cos=function(){return this.throwIfDisposed(),mt.cos(this)},r.prototype.tan=function(){return this.throwIfDisposed(),mt.tan(this)},r.prototype.asin=function(){return this.throwIfDisposed(),mt.asin(this)},r.prototype.acos=function(){return this.throwIfDisposed(),mt.acos(this)},r.prototype.atan=function(){return this.throwIfDisposed(),mt.atan(this)},r.prototype.sinh=function(){return this.throwIfDisposed(),mt.sinh(this)},r.prototype.cosh=function(){return this.throwIfDisposed(),mt.cosh(this)},r.prototype.tanh=function(){return this.throwIfDisposed(),mt.tanh(this)},r.prototype.asinh=function(){return this.throwIfDisposed(),mt.asinh(this)},r.prototype.acosh=function(){return this.throwIfDisposed(),mt.acosh(this)},r.prototype.atanh=function(){return this.throwIfDisposed(),mt.atanh(this)},r.prototype.erf=function(){return this.throwIfDisposed(),mt.erf(this)},r.prototype.round=function(){return this.throwIfDisposed(),mt.round(this)},r.prototype.step=function(t){return t===void 0&&(t=0),this.throwIfDisposed(),mt.step(this,t)},r.prototype.softmax=function(t){return t===void 0&&(t=-1),this.throwIfDisposed(),mt.softmax(this,t)},r.prototype.logSoftmax=function(t){return t===void 0&&(t=-1),this.throwIfDisposed(),mt.logSoftmax(this,t)},r.prototype.resizeBilinear=function(t,e){return e===void 0&&(e=!1),this.throwIfDisposed(),mt.image.resizeBilinear(this,t,e)},r.prototype.resizeNearestNeighbor=function(t,e){return e===void 0&&(e=!1),this.throwIfDisposed(),mt.image.resizeNearestNeighbor(this,t,e)},r.prototype.conv1d=function(t,e,n,a,i,o){return a===void 0&&(a="NWC"),i===void 0&&(i=1),this.throwIfDisposed(),mt.conv1d(this,t,e,n,a,i,o)},r.prototype.conv2d=function(t,e,n,a,i,o){return a===void 0&&(a="NHWC"),i===void 0&&(i=[1,1]),this.throwIfDisposed(),mt.conv2d(this,t,e,n,a,i,o)},r.prototype.conv2dTranspose=function(t,e,n,a,i){return this.throwIfDisposed(),mt.conv2dTranspose(this,t,e,n,a,i)},r.prototype.depthwiseConv2D=function(t,e,n,a,i,o){return a===void 0&&(a="NHWC"),i===void 0&&(i=[1,1]),this.throwIfDisposed(),mt.depthwiseConv2d(this,t,e,n,a,i,o)},r.prototype.separableConv2d=function(t,e,n,a,i,o){return i===void 0&&(i=[1,1]),o===void 0&&(o="NHWC"),this.throwIfDisposed(),mt.separableConv2d(this,t,e,n,a,i,o)},r.prototype.avgPool=function(t,e,n,a){return this.throwIfDisposed(),mt.avgPool(this,t,e,n,a)},r.prototype.maxPool=function(t,e,n,a){return this.throwIfDisposed(),mt.maxPool(this,t,e,n,a)},r.prototype.localResponseNormalization=function(t,e,n,a){return t===void 0&&(t=5),e===void 0&&(e=1),n===void 0&&(n=1),a===void 0&&(a=.5),mt.localResponseNormalization(this,t,e,n,a)},r.prototype.pool=function(t,e,n,a,i){return this.throwIfDisposed(),mt.pool(this,t,e,n,a,i)},r.prototype.variable=function(t,e,n){return t===void 0&&(t=!0),this.throwIfDisposed(),Wc.variable(this,t,e,n)},r.prototype.unsortedSegmentSum=function(t,e){return this.throwIfDisposed(),mt.unsortedSegmentSum(this,t,e)},r.prototype.batchToSpaceND=function(t,e){return this.throwIfDisposed(),mt.batchToSpaceND(this,t,e)},r.prototype.spaceToBatchND=function(t,e){return this.throwIfDisposed(),mt.spaceToBatchND(this,t,e)},r.prototype.topk=function(t,e){return t===void 0&&(t=1),e===void 0&&(e=!0),this.throwIfDisposed(),mt.topk(this,t,e)},r.prototype.stridedSlice=function(t,e,n,a,i,o,u,l){return a===void 0&&(a=0),i===void 0&&(i=0),o===void 0&&(o=0),u===void 0&&(u=0),l===void 0&&(l=0),this.throwIfDisposed(),mt.stridedSlice(this,t,e,n,a,i,o,u,l)},r.prototype.depthToSpace=function(t,e){return this.throwIfDisposed(),mt.depthToSpace(this,t,e)},r.prototype.fft=function(){return this.throwIfDisposed(),mt.spectral.fft(this)},r.prototype.ifft=function(){return this.throwIfDisposed(),mt.spectral.ifft(this)},r.prototype.rfft=function(){return this.throwIfDisposed(),mt.spectral.rfft(this)},r.prototype.irfft=function(){return this.throwIfDisposed(),mt.spectral.irfft(this)},r})();Object.defineProperty(kt,Symbol.hasInstance,{value:function(r){return!!r&&r.dataId!=null&&r.shape!=null&&r.dtype!=null}});var Wc=(function(r){function t(e,n,a){n===void 0&&(n=!0);var i=r.call(this,e.shape,e.dtype,null,e.dataId)||this;i.trainable=n,i.name=a,i.name==null&&(i.name=da().nextVariableId().toString());try{da().registerVariable(i)}catch(o){throw da().disposeTensor(i),o}return i}return eo(t,r),t.variable=function(e,n,a,i){return n===void 0&&(n=!0),i!=null&&i!==e.dtype&&(e=e.asType(i)),new t(e,n,a)},t.prototype.assign=function(e){if(e.dtype!==this.dtype)throw new Error("dtype of the new value ("+e.dtype+") and previous value ("+this.dtype+") must match");if(!pr(e.shape,this.shape))throw new Error("shape of the new value ("+e.shape+") and previous value ("+this.shape+") must match");da().disposeTensor(this),this.dataId=e.dataId,da().registerTensor(this)},t})(kt);Object.defineProperty(Wc,Symbol.hasInstance,{value:function(r){return r instanceof kt&&r.assign!=null&&r.assign instanceof Function}});var W1,$m,Jm,tg,eg;Wc.variable;function Pk(r,t,e){for(var n={},a={},i=0;i<t.length;i++)n[t[i].id]=!0;for(i=0;i<r.length;i++){var o=(x=r[i]).inputs;for(var u in o){for(var l=o[u],h=!1,f=0;f<t.length;f++)if(n[l.id]){x.outputs.forEach(function(R){return n[R.id]=!0}),h=!0,a[x.id]=!0;break}if(h)break}}var p={};p[e.id]=!0;var v={};for(i=r.length-1;i>=0;i--)for(o=(x=r[i]).inputs,f=0;f<x.outputs.length;f++)if(p[x.outputs[f].id]){for(var u in o)p[o[u].id]=!0,v[x.id]=!0;break}var m=[];for(i=0;i<r.length;i++){var x;if(a[(x=r[i]).id]&&v[x.id]){var b={};for(var u in x.inputs){var E=x.inputs[u];n[E.id]&&(b[u]=E)}var C=Object.assign({},x);C.inputs=b,C.outputs=x.outputs,m.push(C)}}return m}function Fk(r,t,e){for(var n=function(i){var o=t[i],u=[];if(o.outputs.forEach(function(p){var v=r[p.id];if(v!=null)u.push(v);else{var m=kt.make(p.shape,{values:Uc(p.size,p.dtype)},p.dtype);u.push(m)}}),o.gradient==null)throw new Error("Cannot compute gradient: gradient function not found for "+o.name+".");var l=o.gradient(o.outputs.length===1?u[0]:u),h=function(p){if(!(p in l))throw new Error("Cannot backprop through input "+p+". Available gradients found: "+Object.keys(l)+".");var v=e(function(){return l[p]()});if(v.dtype!=="float32")throw new Error("Error in gradient for op "+o.name+". The gradient of input "+p+" must have 'float32' dtype, but has '"+v.dtype+"'");var m=o.inputs[p];if(!pr(v.shape,m.shape))throw new Error("Error in gradient for op "+o.name+". The gradient of input '"+p+"' has shape '"+v.shape+"', which does not match the shape of the input '"+m.shape+"'");if(r[m.id]==null)r[m.id]=v;else{var x=r[m.id];r[m.id]=x.add(v),x.dispose()}};for(var f in o.inputs)h(f)},a=t.length-1;a>=0;a--)n(a)}(function(r){r.R0="R0",r.R1="R1",r.R2="R2",r.R3="R3",r.R4="R4",r.R5="R5",r.R6="R6"})(W1||(W1={})),(function(r){r.float32="float32",r.int32="int32",r.bool="int32",r.complex64="complex64"})($m||($m={})),(function(r){r.float32="float32",r.int32="int32",r.bool="bool",r.complex64="complex64"})(Jm||(Jm={})),(function(r){r.float32="float32",r.int32="float32",r.bool="float32",r.complex64="complex64"})(tg||(tg={})),(function(r){r.float32="complex64",r.int32="complex64",r.bool="complex64",r.complex64="complex64"})(eg||(eg={}));var Lk={float32:tg,int32:$m,bool:Jm,complex64:eg};function Un(r,t){if(r==="string"||t==="string"){if(r==="string"&&t==="string")return"string";throw new Error("Can not upcast "+r+" with "+t)}return Lk[r][t]}function om(r){return Un(r,"int32")}function kn(r,t){if(r.dtype===t.dtype)return[r,t];var e=Un(r.dtype,t.dtype);return[r.cast(e),t.cast(e)]}function zk(r,t){Y(r.dtype===t.dtype,function(){return"The dtypes of the first("+r.dtype+") and second("+t.dtype+") input must match"})}function HE(r){var t=[];return qE(r,t,new Set),t}function qE(r,t,e){if(r!=null){if(r instanceof kt)t.push(r);else if(Uk(r)){var n=r;for(var a in n){var i=n[a];e.has(i)||(e.add(i),qE(i,t,e))}}}}function Uk(r){return Array.isArray(r)||typeof r=="object"}var ge,Wk=(function(){function r(t,e,n){this.backend=t,this.safeMode=e,this.debugMode=n,this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.profiling=!1,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiler=new kk(t),this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return r.prototype.moveData=function(t){this.write(t,this.readSync(t))},r.prototype.tidy=function(t,e){var n,a=this,i=null;if(e==null){if(typeof t!="function")throw new Error("Please provide a function to tidy()");e=t}else{if(typeof t!="string"&&!(t instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof e!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");i=t}return this.scopedRun(function(){return a.startScope(i)},function(){return a.endScope(n)},function(){return(n=e())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n})},r.prototype.scopedRun=function(t,e,n){t();try{var a=n();return e(),a}catch(i){throw e(),i}},r.prototype.nextTensorId=function(){return r.nextTensorId++},r.prototype.nextVariableId=function(){return r.nextVariableId++},r.prototype.clone=function(t){var e=kt.make(t.shape,{dataId:t.dataId},t.dtype);return this.addTapeNode([t],e,function(n){return[n.toFloat()]}),e},r.prototype.runKernel=function(t,e,n){var a,i=this,o=[],u=this.isTapeOn(),l=this.activeScope!=null?this.activeScope.name:"",h=function(m){u&&(o=m.map(function(x){return i.keep(i.clone(x))}))},f=this.numBytes,p=this.numTensors;if(this.scopedRun(function(){return i.kernelDepth++},function(){return i.kernelDepth--},function(){a=i.debugMode()?i.profiler.profileKernel(l,function(){return t(i.backend,h)}):t(i.backend,h)}),u){var v={id:this.nextTapeNodeId++,name:l,inputs:e,outputs:Array.isArray(a)?a:[a],saved:o};n!=null&&(v.gradient=function(m){return n(m,o)}),this.activeTape.push(v)}return this.profiling&&this.activeProfile.kernels.push({name:l,bytesAdded:this.numBytes-f,totalBytesSnapshot:this.numBytes,tensorsAdded:this.numTensors-p,totalTensorsSnapshot:this.numTensors,inputShapes:Object.keys(e).map(function(m){return e[m].shape}),outputShape:Array.isArray(a)?a.map(function(m){return m.shape}):a.shape}),a},r.prototype.registerTensor=function(t,e){var n=this.tensorInfo.has(t.dataId)?this.tensorInfo.get(t.dataId).refCount:0;if(this.numTensors++,t.dtype==="string"&&this.numStringTensors++,n===0){this.numDataBuffers++;var a=0;t.dtype!=="complex64"&&t.dtype!=="string"&&(a=t.size*PE(t.dtype)),this.tensorInfo.set(t.dataId,{backend:e??this.backend,dtype:t.dtype,shape:t.shape,bytes:a,refCount:0}),this.numBytes+=a,e!=null?e.register(t.dataId,t.shape,t.dtype):this.backend.register(t.dataId,t.shape,t.dtype)}this.tensorInfo.get(t.dataId).refCount++,t instanceof Wc||this.track(t)},r.prototype.registerVariable=function(t){if(this.registeredVariables[t.name]!=null)throw new Error("Variable with name "+t.name+" was already registered");this.registeredVariables[t.name]=t},r.prototype.disposeTensor=function(t){if(this.tensorInfo.has(t.dataId)){this.numTensors--,t.dtype==="string"&&this.numStringTensors--;var e=this.tensorInfo.get(t.dataId);e.refCount<=1?(t.dtype!=="complex64"&&(this.numBytes-=e.bytes),this.numDataBuffers--,e.backend.disposeData(t.dataId),this.tensorInfo.delete(t.dataId)):this.tensorInfo.get(t.dataId).refCount--}},r.prototype.disposeVariables=function(){for(var t in this.registeredVariables){var e=this.registeredVariables[t];this.disposeTensor(e),delete this.registeredVariables[t]}},r.prototype.memory=function(){var t=this.backend.memory();return t.numTensors=this.numTensors,t.numDataBuffers=this.numDataBuffers,t.numBytes=this.numBytes,this.numStringTensors>0&&(t.unreliable=!0,t.reasons==null&&(t.reasons=[]),t.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),t},r.prototype.profile=function(t){return Ne(this,void 0,void 0,function(){var e,n;return Oe(this,function(a){return this.profiling=!0,e=this.numBytes,n=this.numTensors,this.activeProfile.kernels=[],this.activeProfile.result=t(),this.profiling=!1,this.activeProfile.peakBytes=Math.max.apply(Math,this.activeProfile.kernels.map(function(i){return i.totalBytesSnapshot})),this.activeProfile.newBytes=this.numBytes-e,this.activeProfile.newTensors=this.numTensors-n,[2,this.activeProfile]})})},r.prototype.isTapeOn=function(){return this.gradientDepth>0&&this.kernelDepth===0},r.prototype.addTapeNode=function(t,e,n){var a={};t.forEach(function(o,u){a[u]=o});var i={id:this.nextTapeNodeId++,name:this.activeScope.name,inputs:a,outputs:[e],gradient:function(o){var u={};return n(o).forEach(function(l,h){u[h]=function(){return l}}),u}};this.activeTape.push(i)},r.prototype.keep=function(t){if(this.scopeStack.length===1&&this.safeMode)throw new Error("Safe mode is ON. Enclose all tensor operations inside tf.tidy(): tf.tidy(() => {...}) to avoid memory leaks.");return t.kept=!0,t},r.prototype.startTape=function(){this.gradientDepth===0&&(this.activeTape=[]),this.gradientDepth++},r.prototype.endTape=function(){this.gradientDepth--},r.prototype.startScope=function(t){var e={track:[],name:"unnamed scope",id:this.nextScopeId++};t&&(e.name=t),this.scopeStack.push(e),this.activeScope=e},r.prototype.endScope=function(t){for(var e=this,n=HE(t),a=new Set(n.map(function(l){return l.id})),i=0;i<this.activeScope.track.length;i++){var o=this.activeScope.track[i];o.kept||a.has(o.id)||o.dispose()}var u=this.scopeStack.pop();this.activeScope=this.scopeStack.length===0?null:this.scopeStack[this.scopeStack.length-1],n.forEach(function(l){l.kept||l.scopeId!==u.id||e.track(l)})},r.prototype.gradients=function(t,e,n,a){var i=this;if(a===void 0&&(a=!1),Y(e.length>0,function(){return"gradients() received an empty list of xs."}),n!=null&&n.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '"+n.dtype+"'");var o=this.scopedRun(function(){return i.startTape()},function(){return i.endTape()},function(){return i.tidy("forward",t)});Y(o instanceof kt,function(){return"The result y returned by f() must be a tensor."});var u=Pk(this.activeTape,e,o);if(!a&&u.length===0&&e.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var l={};l[o.id]=n??Vk(o.shape),Fk(l,u,function(f){return i.tidy(f)});var h=e.map(function(f){return l[f.id]});return i.gradientDepth===0&&(i.activeTape.forEach(function(f){for(var p in f.saved)f.saved[p].dispose()}),i.activeTape=null),{value:o,grads:h}})},r.prototype.customGrad=function(t){var e=this;return Y(Qm(t),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var n,a=[],i=0;i<arguments.length;i++)a[i]=arguments[i];Y(a.every(function(u){return u instanceof kt}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var o={};return a.forEach(function(u,l){o[l]=u}),e.runKernel(function(u,l){return Y((n=t.apply(void 0,a.concat([l]))).value instanceof kt,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),Y(Qm(n.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),n.value},o,function(u,l){var h=n.gradFunc(u,l),f=Array.isArray(h)?h:[h];Y(f.length===a.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),Y(f.every(function(v){return v instanceof kt}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var p={};return f.forEach(function(v,m){p[m]=function(){return v}}),p})}},r.prototype.write=function(t,e){var n=this.tensorInfo.get(t);if(n.dtype==="string"){var a=Rk(e);this.numBytes+=a-n.bytes,n.bytes=a}this.backend!==n.backend&&(n.backend.disposeData(t),n.backend=this.backend,this.backend.register(t,n.shape,n.dtype)),this.backend.write(t,e)},r.prototype.readSync=function(t){return this.tensorInfo.get(t).backend.readSync(t)},r.prototype.read=function(t){return this.tensorInfo.get(t).backend.read(t)},r.prototype.fromPixels=function(t,e){return this.backend.fromPixels(t,e)},r.prototype.time=function(t){return Ne(this,void 0,void 0,function(){var e,n;return Oe(this,function(a){switch(a.label){case 0:return e=jf(),[4,this.backend.time(t)];case 1:return(n=a.sent()).wallMs=jf()-e,[2,n]}})})},r.prototype.track=function(t){if(this.scopeStack.length===1&&this.safeMode)throw new Error("Safe mode is ON. Enclose all tensor operations inside tf.tidy(): tf.tidy(() => {op();...}); to avoid memory leaks.");return this.activeScope!=null&&(t.scopeId=this.activeScope.id,this.activeScope.track.push(t)),t},r.nextTensorId=0,r.nextVariableId=0,r})();function Vk(r){var t=UE(qt(r),"float32");return kt.make(r,{values:t})}(function(r){r[r.NUMBER=0]="NUMBER",r[r.BOOLEAN=1]="BOOLEAN",r[r.STRING=2]="STRING"})(ge||(ge={}));var um,sm,Gk=[{name:"DEBUG",type:ge.BOOLEAN},{name:"IS_BROWSER",type:ge.BOOLEAN},{name:"WEBGL_LAZILY_UNPACK",type:ge.BOOLEAN},{name:"WEBGL_CPU_FORWARD",type:ge.BOOLEAN},{name:"WEBGL_PACK",type:ge.BOOLEAN},{name:"WEBGL_PACK_BATCHNORMALIZATION",type:ge.BOOLEAN},{name:"WEBGL_PACK_CLIP",type:ge.BOOLEAN},{name:"WEBGL_PACK_DEPTHWISECONV",type:ge.BOOLEAN},{name:"WEBGL_PACK_BINARY_OPERATIONS",type:ge.BOOLEAN},{name:"WEBGL_PACK_ARRAY_OPERATIONS",type:ge.BOOLEAN},{name:"WEBGL_PACK_IMAGE_OPERATIONS",type:ge.BOOLEAN},{name:"WEBGL_PACK_REDUCE",type:ge.BOOLEAN},{name:"WEBGL_CONV_IM2COL",type:ge.BOOLEAN},{name:"WEBGL_MAX_TEXTURE_SIZE",type:ge.NUMBER},{name:"WEBGL_NUM_MB_BEFORE_PAGING",type:ge.NUMBER},{name:"WEBGL_MAX_TEXTURES_IN_SHADER",type:ge.NUMBER},{name:"WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",type:ge.NUMBER},{name:"WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",type:ge.BOOLEAN},{name:"WEBGL_VERSION",type:ge.NUMBER},{name:"WEBGL_RENDER_FLOAT32_ENABLED",type:ge.BOOLEAN},{name:"WEBGL_DOWNLOAD_FLOAT_ENABLED",type:ge.BOOLEAN},{name:"WEBGL_FENCE_API_ENABLED",type:ge.BOOLEAN},{name:"WEBGL_SIZE_UPLOAD_UNIFORM",type:ge.NUMBER},{name:"BACKEND",type:ge.STRING},{name:"EPSILON",type:ge.NUMBER},{name:"PROD",type:ge.BOOLEAN},{name:"TENSORLIKE_CHECK_SHAPE_CONSISTENCY",type:ge.BOOLEAN},{name:"DEPRECATION_WARNINGS_ENABLED",type:ge.BOOLEAN}];function V1(r){try{if(yi(r)!=null)return!0}catch{return!1}return!1}function Hk(r){if(um==null){var t=yi(r);um=t.getParameter(t.MAX_TEXTURE_SIZE)}return um}function qk(r){if(sm==null){var t=yi(r);sm=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,sm)}function jk(r){if(r===0)return 0;var t=yi(r);return Ou(t,"EXT_disjoint_timer_query_webgl2")&&r===2?2:Ou(t,"EXT_disjoint_timer_query")?1:0}function Xk(r){if(r===0)return!1;var t=yi(r);if(r===1){if(!Ou(t,"OES_texture_float"))return!1}else if(!Ou(t,"EXT_color_buffer_float"))return!1;return XE(t,r)}function Kk(r){if(r===0)return!1;var t=yi(r);if(r===1){if(!Ou(t,"OES_texture_float")||!Ou(t,"WEBGL_color_buffer_float"))return!1}else if(!Ou(t,"EXT_color_buffer_float"))return!1;return XE(t,r)}function Yk(r){return r===2&&yi(r).fenceSync!=null}function Qk(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}var G1="tfjsflags";function jE(){var r={};if(typeof window>"u"||window.location===void 0||window.location.search===void 0)return r;var t=Zk(window.location.search);if(G1 in t){var e={};t[G1].split(",").forEach(function(n){var a=n.split(":"),i=a[0],o=a[1];e[i]=o}),Gk.forEach(function(n){n.name in e&&(console.log("Setting feature override from URL "+n.name+": "+e[n.name]),n.type===ge.NUMBER?r[n.name]=+e[n.name]:n.type===ge.BOOLEAN?r[n.name]=e[n.name]==="true":n.type===ge.STRING?r[n.name]=e[n.name]:console.warn("Unknown URL param: "+n.name+"."))})}return r}function Ou(r,t){return r.getExtension(t)!=null}function XE(r,t){var e=r.createFramebuffer(),n=r.createTexture();r.bindTexture(r.TEXTURE_2D,n);var a=t===2?r.RGBA32F:r.RGBA;r.texImage2D(r.TEXTURE_2D,0,a,1,1,0,r.RGBA,r.FLOAT,null),r.bindFramebuffer(r.FRAMEBUFFER,e),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,n,0);var i=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;return r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,null),r.deleteTexture(n),r.deleteFramebuffer(e),i}function Zk(r){var t={};return r.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(e){for(var n=[],a=1;a<arguments.length;a++)n[a-1]=arguments[a];return $k(t,n[0],n[1]),n.join("=")}),t}function $k(r,t,e){r[decodeURIComponent(t)]=decodeURIComponent(e||"")}var Jk=600;function tD(){return window.screen.height*window.screen.width*window.devicePixelRatio*Jk/1024}var lm,eD=1e-4,nD=.1,rD=1e-7,aD=.001,xi=(function(){function r(t){this.features={},this.registry={},this.registryFactory={},t!=null&&(this.features=t),this.get("DEBUG")&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}return r.setBackend=function(t,e){if(!(t in q.registry))throw new Error("Backend name '"+t+"' not found in registry");q.engine.backend=q.findBackend(t),q.backendName=t},r.getBackend=function(){return q.initEngine(),q.backendName},r.disposeVariables=function(){q.engine.disposeVariables()},r.memory=function(){return q.engine.memory()},r.profile=function(t){return q.engine.profile(t)},r.tidy=function(t,e){return q.engine.tidy(t,e)},r.dispose=function(t){HE(t).forEach(function(e){return e.dispose()})},r.keep=function(t){return q.engine.keep(t)},r.time=function(t){return q.engine.time(t)},r.prototype.get=function(t){return t in this.features?this.features[t]:(this.features[t]=this.evaluateFeature(t),this.features[t])},r.prototype.getFeatures=function(){return this.features},r.prototype.set=function(t,e){this.features[t]=e},r.prototype.getBestBackendName=function(){var t=this;if(Object.keys(this.registry).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registry).map(function(e){return{name:e,entry:t.registry[e]}}).sort(function(e,n){return n.entry.priority-e.entry.priority})[0].name},r.prototype.evaluateFeature=function(t){if(t==="DEBUG")return!1;if(t==="IS_BROWSER")return typeof window<"u";if(t==="IS_NODE")return typeof process<"u"&&process.versions!==void 0&&process.versions.node!==void 0;if(t==="IS_CHROME")return Qk();if(t==="WEBGL_CPU_FORWARD")return!0;if(t==="WEBGL_PACK")return this.get("WEBGL_VERSION")!==0;if(t==="WEBGL_PACK_BATCHNORMALIZATION")return this.get("WEBGL_PACK");if(t==="WEBGL_PACK_CLIP")return this.get("WEBGL_PACK");if(t==="WEBGL_PACK_DEPTHWISECONV")return this.get("WEBGL_PACK");if(t==="WEBGL_PACK_BINARY_OPERATIONS")return this.get("WEBGL_PACK");if(t==="WEBGL_PACK_ARRAY_OPERATIONS")return this.get("WEBGL_PACK");if(t==="WEBGL_PACK_IMAGE_OPERATIONS")return this.get("WEBGL_PACK");if(t==="WEBGL_PACK_REDUCE")return this.get("WEBGL_PACK");if(t==="WEBGL_LAZILY_UNPACK")return this.get("WEBGL_PACK");if(t==="WEBGL_CONV_IM2COL")return this.get("WEBGL_PACK");if(t==="WEBGL_NUM_MB_BEFORE_PAGING")return this.get("PROD")||!this.get("IS_BROWSER")?Number.POSITIVE_INFINITY:tD();if(t==="WEBGL_MAX_TEXTURE_SIZE")return Hk(this.get("WEBGL_VERSION"));if(t==="WEBGL_MAX_TEXTURES_IN_SHADER")return qk(this.get("WEBGL_VERSION"));if(t==="IS_TEST")return!1;if(t==="BACKEND")return this.getBestBackendName();if(t==="WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"){var e=this.get("WEBGL_VERSION");return e===0?0:jk(e)}if(t==="WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")return this.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!gk();if(t==="HAS_WEBGL")return this.get("WEBGL_VERSION")>0;if(t==="WEBGL_VERSION")return V1(2)?2:V1(1)?1:0;if(t==="WEBGL_RENDER_FLOAT32_ENABLED")return Xk(this.get("WEBGL_VERSION"));if(t==="WEBGL_DOWNLOAD_FLOAT_ENABLED")return Kk(this.get("WEBGL_VERSION"));if(t==="WEBGL_FENCE_API_ENABLED")return Yk(this.get("WEBGL_VERSION"));if(t==="WEBGL_SIZE_UPLOAD_UNIFORM")return this.get("WEBGL_RENDER_FLOAT32_ENABLED")?4:0;if(t==="TEST_EPSILON")return this.backend.floatPrecision()===32?aD:nD;if(t==="EPSILON")return this.backend.floatPrecision()===32?rD:eD;if(t==="PROD")return!1;if(t==="TENSORLIKE_CHECK_SHAPE_CONSISTENCY")return!this.get("PROD");if(t==="DEPRECATION_WARNINGS_ENABLED")return!0;throw new Error("Unknown feature "+t+".")},r.prototype.setFeatures=function(t){this.features=Object.assign({},t)},r.prototype.reset=function(){this.features=jE(),this.globalEngine!=null&&(this.globalEngine=null)},Object.defineProperty(r.prototype,"backend",{get:function(){return this.engine.backend},enumerable:!0,configurable:!0}),r.prototype.findBackend=function(t){return t in this.registry?this.registry[t].backend:null},r.prototype.findBackendFactory=function(t){return t in this.registryFactory?this.registryFactory[t]:null},r.prototype.registerBackend=function(t,e,n){var a=this;if(n===void 0&&(n=1),t in this.registry)return console.warn(t+" backend was already registered. Reusing existing backend"),!1;try{var i=e();return i.setDataMover({moveData:function(o){return a.engine.moveData(o)}}),this.registry[t]={backend:i,priority:n},this.registryFactory[t]=e,!0}catch(o){return console.warn("Registration of backend "+t+" failed"),console.warn(o.stack||o.message),!1}},r.prototype.removeBackend=function(t){if(!(t in this.registry))throw new Error(t+" backend not found in registry");this.registry[t].backend.dispose(),delete this.registry[t]},Object.defineProperty(r.prototype,"engine",{get:function(){return this.initEngine(),this.globalEngine},enumerable:!0,configurable:!0}),r.prototype.initEngine=function(){var t=this;if(this.globalEngine==null){this.backendName=this.get("BACKEND");var e=this.findBackend(this.backendName);this.globalEngine=new Wk(e,!1,function(){return t.get("DEBUG")})}},Object.defineProperty(r.prototype,"global",{get:function(){return KE()},enumerable:!0,configurable:!0}),r})();function KE(){if(lm==null){var r=void 0;if(typeof window<"u")r=window;else if(typeof window<"u")r=window;else{if(typeof process>"u")throw new Error("Could not find a global object");r=process}lm=r}return lm}function iD(){var r=KE();return r.ENV==null&&(r.ENV=new xi(jE())),Ok(function(){return r.ENV.engine}),r.ENV}function YE(r){q.get("DEPRECATION_WARNINGS_ENABLED")&&console.warn(r+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}Bk(YE);var q=iD();function $o(r){var t=r;if(to(r))return[r.length];if(!Array.isArray(r))return[];for(var e=[];Array.isArray(t)||to(t);)e.push(t.length),t=t[0];return Array.isArray(r)&&q.get("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&QE(r,e,[]),e}function QE(r,t,e){if(e=e||[],Array.isArray(r)||to(r)){Y(t.length>0,function(){return"Element arr["+e.join("][")+"] should be a primitive, but is an array of "+r.length+" elements"}),Y(r.length===t[0],function(){return"Element arr["+e.join("][")+"] should have "+t[0]+" elements, but has "+r.length+" elements"});for(var n=t.slice(1),a=0;a<r.length;++a)QE(r[a],n,e.concat(a))}else Y(t.length===0,function(){return"Element arr["+e.join("][")+"] is a primitive, but should be an array/TypedArray of "+t[0]+" elements"})}function H1(r,t,e,n){if(r!=null&&(r!=="numeric"&&r!==t||r==="numeric"&&t==="string"))throw new Error("Argument '"+e+"' passed to '"+n+"' must be "+r+" tensor, but got "+t+" tensor")}function H(r,t,e,n){if(n===void 0&&(n="numeric"),r instanceof kt)return H1(n,r.dtype,t,e),r;var a=zc(r);if(a!=="string"&&["bool","int32","float32"].indexOf(n)>=0&&(a=n),H1(n,a,t,e),r==null||!to(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string"){var i=r==null?"null":r.constructor.name;throw new Error("Argument '"+t+"' passed to '"+e+"' must be a Tensor or TensorLike, but got '"+i+"'")}var o=$o(r);to(r)||Array.isArray(r)||(r=[r]);var u=a!=="string"?LE(r,a,q.get("DEBUG")):rl(r);return kt.make(o,{values:u},a)}function Xf(r,t,e,n){if(n===void 0&&(n="numeric"),!Array.isArray(r))throw new Error("Argument "+t+" passed to "+e+" must be a `Tensor[]` or `TensorLike[]`");return r.map(function(a,i){return H(a,t+"["+i+"]",e)},n)}function oD(r,t){if(Y(Qm(r),function(){return"The f passed in variableGrads(f) must be a function"}),Y(t==null||Array.isArray(t)&&t.every(function(l){return l instanceof Wc}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"}),t==null)for(var e in t=[],q.engine.registeredVariables)t.push(q.engine.registeredVariables[e]);var n=t.length;Y((t=t.filter(function(l){return l.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+n+" variables is trainable."});var a=q.engine.gradients(r,t,null,!0),i=a.value,o=a.grads;Y(o.some(function(l){return l!=null}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),Y(i.rank===0,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+i.rank+" tensor"});var u={};return t.forEach(function(l,h){o[h]!=null&&(u[l.name]=o[h])}),{value:i,grads:u}}function Vc(r){return q.engine.customGrad(r)}var Ht=xi.tidy,Ue=xi.keep,uD=xi.dispose;xi.time;xi.profile;function ng(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];q.get("IS_TEST")||console.warn.apply(console,r)}function Kf(r,t,e,n){n===void 0&&(n=!0);var a=[];if(n)(a=a.concat(t.slice(0))).push(r[0]/e),a=a.concat(r.slice(1));else{a=a.concat(r[0]);for(var i=t.length,o=0;o<i;++o)a=a.concat([r[o+1]/t[o],t[o]]);a=a.concat(r.slice(i+1))}return a}function Yf(r,t,e){e===void 0&&(e=!0);var n=[];if(e){n.push(t);for(var a=t+1;a<r;++a)a<=2*t?(n.push(a),n.push(a-(t+1))):n.push(a)}else{var i=[],o=[];for(a=1;a<r;++a)a>=2*t+1||a%2==1?o.push(a):i.push(a);n.push.apply(n,i),n.push(0),n.push.apply(n,o)}return n}function Qf(r,t,e,n){n===void 0&&(n=!0);var a=[];n?a.push(r[0]/e):a.push(r[0]*e);for(var i=1;i<r.length;++i)i<=t.length?n?a.push(t[i-1]*r[i]):a.push(r[i]/t[i-1]):a.push(r[i]);return a}function ZE(r,t){for(var e=[0],n=0;n<t;++n)e.push(r[n][0]);return e}function $E(r,t,e){for(var n=r.slice(0,1),a=0;a<e;++a)n.push(r[a+1]-t[a][0]-t[a][1]);return n}function JE(r,t){for(var e=0;e<r.length;++e)if(r[r.length-e-1]!==t-1-e)return!1;return!0}function sD(r,t,e){for(var n=r.length+t.length,a=[],i=0,o=0,u=0;u<n;u++)e.indexOf(u)===-1?a.push(r[i++]):a.push(t[o++]);return a}function er(r,t){for(var e=[],n=r.length,a=0;a<n;a++)t.indexOf(a)===-1&&e.push(r[a]);return[e,t.map(function(i){return r[i]})]}function ba(r,t){return sD(r,t.map(function(e){return 1}),t)}function Gr(r,t,e){Y(JE(t,e),function(){return r+" supports only inner-most axes for now. Got axes "+t+" and rank-"+e+" input."})}function bi(r,t){if(JE(r,t))return null;for(var e=[],n=0;n<t;++n)r.indexOf(n)===-1&&e.push(n);return r.forEach(function(a){return e.push(a)}),e}function Pg(r){return r.map(function(t,e){return[e,t]}).sort(function(t,e){return t[1]-e[1]}).map(function(t){return t[0]})}function wi(r,t){for(var e=[],n=t-r;n<t;++n)e.push(n);return e}function lD(r,t){var e=r[0].length;r.forEach(function(a,i){Y(a.length===e,function(){return"Error in concat"+e+"D: rank of tensors["+i+"] must be the same as the rank of the rest ("+e+")"})}),Y(t>=0&&t<e,function(){return"Error in concat"+e+"D: axis must be between 0 and "+(e-1)+"."});var n=r[0];r.forEach(function(a,i){for(var o=0;o<e;o++)Y(o===t||a[o]===n[o],function(){return"Error in concat"+e+"D: Shape of tensors["+i+"] ("+a+") does not match the shape of the rest ("+n+") along the non-concatenated axis "+i+"."})})}function al(r,t){for(var e=r[0].slice(),n=1;n<r.length;n++)e[t]+=r[n][t];return e}function tC(r,t){if(r.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+r.rank+".");if(t.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if(t.dtype!=="int32")throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+t.dtype+".");if(t.shape[t.rank-1]>r.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+t.shape[t.rank-1]+" vs. "+r.rank);if(r.size===0)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+r.shape+".");for(var e=t.shape,n=e[e.length-1],a=1,i=0;i<e.length-1;++i)a*=e[i];var o=r.shape,u=e.slice();u.pop();var l=1;for(i=n;i<r.rank;++i)l*=o[i],u.push(o[i]);var h=Gu(r.shape).map(function(f){return f/l}).concat([1]).slice(0,n);return[u,a,l,h]}var eC=30;function cm(r){return r<=eC?r:Zm(r,Math.floor(Math.sqrt(r)))}function cD(r,t,e){var n=t.rank>1?t.shape[t.rank-1]:1,a=t.rank>1?t.rank-1:1,i="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+e.shape+", indices.shape: "+t.shape+", shape: "+r+", sliceDim: "+n+", and batchDim: "+a+".";if(e.rank<a)throw new Error(i+" update.rank < "+a+". ");if(r.length<n+(e.rank-a))throw new Error(i+" Output shape length < "+(n+(e.rank-a)));if(e.rank!==a+r.length-n)throw new Error(i+" update.rank != "+(a+r.length-n));for(var o=0;o<a;++o)if(e.shape[o]!==t.shape[o])throw new Error(i+" updates.shape["+o+"] ("+e.shape[o]+") != indices.shape["+o+"] ("+t.shape[o]+").");for(o=0;o<e.rank-a;++o)if(e.shape[o+a]!==r[o+n])throw new Error(i+" updates.shape["+(o+a)+"] ("+e.shape[o+a]+") != shape["+(o+a)+"] ("+r[o+a]+")")}function hD(r,t,e){if(t.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if(r.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+r.rank+".");if(t.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: "+t.dtype);if(e.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+e);if(e.length===0){if(t.size===0)throw new Error("Indices specified for empty output. indices shape: "+t.shape);if(r.size===0)throw new Error("Updates specified for empty output. updates shape: "+r.shape)}cD(e,t,r)}function Zf(r,t,e){for(var n=t.rank>1?t.shape[t.rank-1]:1,a=e.length,i=1,o=n;o<a;++o)i*=e[o];var u=n<1?1:n;return{sliceRank:n,numUpdates:t.size/u,sliceSize:i,strides:Gu(e.slice(0,n)).concat([1]),outputSize:qt(e)}}function fD(r,t){var e,n=!1;for(r<=eC?(e=r,n=!0):e=Zm(r,Math.floor(Math.sqrt(r)));!n;)e>t||e===r?n=!0:e=Zm(r,e+1);return e}function dD(r,t,e){for(var n=[],a=r.length,i=0;i<a;i++)i!==t?n.push(r[i]):n.push(e);return n}function pD(r,t,e){for(var n=r.shape[e],a=[],i=1,o=1,u=0;u<e;u++)a.push(r.shape[u]),i*=r.shape[u];for(u=0;u<t.rank;u++)a.push(t.shape[u]);for(u=e+1;u<r.rank;u++)a.push(r.shape[u]),o*=r.shape[u];return{batchSize:i,sliceSize:o,dimSize:n,outputShape:a}}function vD(r,t,e){Y(r.rank===t.length,function(){return"Error in slice"+r.rank+"D: Length of begin "+t+" must match the rank of the array ("+r.rank+")."}),Y(r.rank===e.length,function(){return"Error in slice"+r.rank+"D: Length of size "+e+" must match the rank of the array ("+r.rank+")."});for(var n=function(i){Y(t[i]+e[i]<=r.shape[i],function(){return"Error in slice"+r.rank+"D: begin["+i+"] + size["+i+"] ("+(t[i]+e[i])+") would overflow input.shape["+i+"] ("+r.shape[i]+")"})},a=0;a<r.rank;++a)n(a)}function Fg(r,t,e,n,a,i,o,u,l){if(a===void 0&&(a=0),i===void 0&&(i=0),o===void 0&&(o=0),u===void 0&&(u=0),l===void 0&&(l=0),o!==0)throw new Error("ellipsis mask is not yet supported");if(u!==0)throw new Error("new axis mask is not yet supported");for(var h=[],f=[],p=[],v=0;v<r.length;v++)h[v]=mD(a,t,n,r,v),f[v]=gD(i,e,n,r,v),l&1<<v&&(f[v]=h[v]+1,p.push(v));var m=new Array(r.length).fill(0);return m=m.map(function(x,b){for(var E=0,C=n[b]||1,R=h[b];!(C>0?R>=f[b]:R<=f[b]);R+=C)E+=1;return E}),[h,m,p]}function mD(r,t,e,n,a){var i=t[a],o=e[a]||1;(r&1<<a||i==null)&&(i=o>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var u=n[a];return i<0&&(i+=u),i=Km(0,i,u-1)}function gD(r,t,e,n,a){var i=t[a],o=e[a]||1;(r&1<<a||i==null)&&(i=o>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var u=n[a];return i<0&&(i+=u),i=o>0?Km(0,i,u):Km(-1,i,u-1)}function nC(r,t,e){for(var n=e.length,a=0;a<e.length;a++)if(e[a]>1){n=a;break}for(a=n+1;a<e.length;a++)if(t[a]>0||e[a]!==r[a])return!1;return!0}function rC(r,t){for(var e=r.length>0?r[r.length-1]:1,n=0;n<r.length-1;n++)e+=r[n]*t[n];return e}function it(r){var t=Object.keys(r);if(t.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+t.length+" keys.");var e=t[0],n=r[e];e.endsWith("_")&&(e=e.substring(0,e.length-1));var a=function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];q.engine.startScope(e);try{var u=n.apply(void 0,i);return u instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),q.engine.endScope(u),u}catch(l){throw q.engine.endScope(null),l}};return Object.defineProperty(a,"name",{value:e,configurable:!0}),a}function yD(r,t){t===void 0&&(t=-1);var e=H(r,"logits","softmax");if(t===-1&&(t=e.rank-1),t!==e.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+e.rank+" and dim was "+t);return Vc(function(n,a){var i=n.logSumExp([t],!0),o=n.toFloat().sub(i).exp();return a([o]),{value:o,gradFunc:function(u,l){var h=l[0],f=u.mul(h);return f.sub(f.sum([t],!0).mul(h))}}})(e)}function xD(r,t){t===void 0&&(t=-1);var e=H(r,"logits","logSoftmax");if(t===-1&&(t=e.rank-1),t!==e.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+e.rank+" and axis was "+t);return Vc(function(n,a){var i=n.max(t,!0),o=n.sub(i),u=o.toFloat().sub(o.exp().sum(t,!0).log());return a([u]),{value:u,gradFunc:function(l,h){var f=h[0].exp();return l.sub(l.sum(t,!0).mul(f))}}})(e)}var Jo=it({softmax_:yD}),bD=it({logSoftmax_:xD});function wD(r,t){var e=H(r,"real","complex"),n=H(t,"imag","complex");return Me(e.shape,n.shape,"real and imag shapes, "+e.shape+" and "+n.shape+", must match in call to tf.complex()."),q.engine.runKernel(function(a){return a.complex(e,n)},{$real:e,$imag:n})}function ED(r){var t=H(r,"input","real");return q.engine.runKernel(function(e){return e.real(t)},{$input:t})}function CD(r){var t=H(r,"input","imag");return q.engine.runKernel(function(e){return e.imag(t)},{$input:t})}var dr=it({complex_:wD}),hi=it({real_:ED}),Wo=it({imag_:CD});function bn(r,t,e){if(e==null&&(e=zc(r)),e==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!to(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");var n=$o(r);if(t!=null){WE(t);var a=qt(t),i=qt(n);Y(a===i,function(){return"Based on the provided shape, ["+t+"], the tensor should have "+a+" values but has "+i});for(var o=0;o<n.length;++o){var u=n[o],l=o!==n.length-1||u!==qt(t.slice(o));Y(n[o]===t[o]||!l,function(){return"Error creating a new Tensor. Inferred shape ("+n+") does not match the provided shape ("+t+"). "})}}return to(r)||Array.isArray(r)||(r=[r]),t=t||n,r=e!=="string"?LE(r,e,q.get("DEBUG")):rl(r),kt.make(t,{values:r},e)}function Tt(r,t){if((to(r)||Array.isArray(r))&&t!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");return bn(r,[],t)}function jr(r,t){pl(r);var e=$o(r);if(e.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return bn(r,e,t)}function _d(r,t,e){if(pl(r),t!=null&&t.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var n=$o(r);if(n.length!==2&&n.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(n.length===1&&t==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return bn(r,t=t||n,e)}function Lg(r,t,e){if(pl(r),t!=null&&t.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var n=$o(r);if(n.length!==3&&n.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(n.length===1&&t==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return bn(r,t=t||n,e)}function Oa(r,t,e){if(pl(r),t!=null&&t.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var n=$o(r);if(n.length!==4&&n.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(n.length===1&&t==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return bn(r,t=t||n,e)}function SD(r,t,e){if(pl(r),t!=null&&t.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var n=$o(r);if(n.length!==5&&n.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(n.length===1&&t==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return bn(r,t=t||n,e)}function RD(r,t,e){if(pl(r),t!=null&&t.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var n=$o(r);if(n.length!==6&&n.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(n.length===1&&t==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return bn(r,t=t||n,e)}function Lu(r,t){if(t===void 0&&(t="float32"),t==="complex64"){var e=Lu(r,"float32"),n=Lu(r,"float32");return dr(e,n)}var a=UE(qt(r),t);return kt.make(r,{values:a},t)}function dn(r,t){if(t===void 0&&(t="float32"),t==="complex64"){var e=dn(r,"float32"),n=dn(r,"float32");return dr(e,n)}var a=Uc(qt(r),t);return kt.make(r,{values:a},t)}function _c(r,t,e){return q.engine.runKernel(function(n){return n.fill(r,t,e)},{})}function _D(r){var t=H(r,"x","onesLike");if(t.dtype==="complex64"){var e=iC(hi(t)),n=Ce(Wo(t));return dr(e,n)}return q.engine.runKernel(function(a){return a.onesLike(t)},{$x:t},null)}function AD(r){var t=H(r,"x","zerosLike");return q.engine.runKernel(function(e){return e.zerosLike(t)},{$x:t},null)}function TD(r,t,e){if(e===0)throw new Error("Cannot request zero samples");var n=(t-r)/(e-1),a=Uc(e,"float32");a[0]=r;for(var i=1;i<a.length;i++)a[i]=a[i-1]+n;return jr(a,"float32")}function aC(r,t,e,n){if(e===void 0&&(e=1),n===void 0&&(n="float32"),e===0)throw new Error("Cannot have a step of zero");if(r===t||r<t&&e<0||t<r&&e>1)return dn([0],n);var a=Uc(Math.abs(Math.ceil((t-r)/e)),n);t<r&&e===1&&(e=-1),a[0]=r;for(var i=1;i<a.length;i++)a[i]=a[i-1]+e;return jr(a,n)}var iC=it({onesLike_:_D}),Ce=it({zerosLike_:AD}),oC=(function(){function r(t){this.dataMover=t,this.data=new WeakMap}return r.prototype.get=function(t){return this.data.has(t)||this.dataMover.moveData(t),this.data.get(t)},r.prototype.set=function(t,e){this.data.set(t,e)},r.prototype.has=function(t){return this.data.has(t)},r.prototype.delete=function(t){return this.data.delete(t)},r})();function uC(r,t,e){if(t==="complex64"){if(r.dtype==="complex64")return r.clone();var n=dn(r.shape),a=r.toFloat(),i=e.complex(a,n);return n.dispose(),a.dispose(),i}if(!Sk(r.dtype,t))return kt.make(r.shape,{dataId:r.dataId},t);if(r.dtype==="complex64"){var o=e.real(r);return i=o.cast(t),o.dispose(),i}if(t==="int32")return e.int(r);if(t==="bool"){var u=Tt(0,r.dtype);return i=e.notEqual(r,u),u.dispose(),i}throw new Error("Error in Cast: unknown dtype argument ("+t+")")}function rg(r,t){return kt.make(t,{dataId:r.dataId},r.dtype)}function sC(r,t){if(r.length!==t.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+r.length+", imag: "+t.length+".");for(var e=new Float32Array(2*r.length),n=0;n<e.length;n+=2)e[n]=r[n/2],e[n+1]=t[n/2];return e}function kD(r){for(var t=new Float32Array(r.length/2),e=new Float32Array(r.length/2),n=0;n<r.length;n+=2)t[n/2]=r[n],e[n/2]=r[n+1];return{real:t,imag:e}}function DD(r){for(var t=Math.ceil(r.length/4),e=new Float32Array(t),n=new Float32Array(t),a=0;a<r.length;a+=4)e[Math.floor(a/4)]=r[a],n[Math.floor(a/4)]=r[a+1];return{real:e,imag:n}}function ID(r){for(var t=Math.floor(r.length/4),e=new Float32Array(t),n=new Float32Array(t),a=2;a<r.length;a+=4)e[Math.floor(a/4)]=r[a],n[Math.floor(a/4)]=r[a+1];return{real:e,imag:n}}function q1(r,t){return{real:r[2*t],imag:r[2*t+1]}}function ND(r,t,e,n){r[2*n]=t,r[2*n+1]=e}function OD(r,t){for(var e=new Float32Array(r/2),n=new Float32Array(r/2),a=0;a<Math.ceil(r/2);a++){var i=(t?2:-2)*Math.PI*(a/r);e[a]=Math.cos(i),n[a]=Math.sin(i)}return{real:e,imag:n}}function MD(r,t,e){var n=(e?2:-2)*Math.PI*(r/t);return{real:Math.cos(n),imag:Math.sin(n)}}function zg(r,t,e,n,a){for(var i=Array.from(t).map(function(m,x){return{score:m,boxIndex:x}}).filter(function(m){return m.score>a}).sort(function(m,x){return x.score-m.score}),o=[],u=0;u<i.length;u++){var l=i[u],h=l.score,f=l.boxIndex;if(h<a)break;for(var p=!1,v=o.length-1;v>=0;--v)if(BD(r,f,o[v])>=n){p=!0;break}if(!p&&(o.push(f),o.length>=e))break}return jr(o,"int32")}function BD(r,t,e){var n=r.subarray(4*t,4*t+4),a=r.subarray(4*e,4*e+4),i=Math.min(n[0],n[2]),o=Math.min(n[1],n[3]),u=Math.max(n[0],n[2]),l=Math.max(n[1],n[3]),h=Math.min(a[0],a[2]),f=Math.min(a[1],a[3]),p=Math.max(a[0],a[2]),v=Math.max(a[1],a[3]),m=(u-i)*(l-o),x=(p-h)*(v-f);if(m<=0||x<=0)return 0;var b=Math.max(i,h),E=Math.max(o,f),C=Math.min(u,p),R=Math.min(l,v),_=Math.max(C-b,0)*Math.max(R-E,0);return _/(m+x-_)}function lC(r,t,e){var n=new Array(r.rank).fill(0),a=r.shape.slice();return t.map(function(i){a[e]=i;var o=r.slice(n,a);return n[e]+=i,o})}function cC(r,t,e,n,a){for(var i=t[t.length-1],o=[r.length/i,i],u=o[0],l=o[1],h=Ym(e,u*n),f=Ym("int32",u*n),p=0;p<u;p++){for(var v=p*l,m=r.subarray(v,v+l),x=[],b=0;b<m.length;b++)x.push({value:m[b],index:b});x.sort(function(A,k){return k.value-A.value});var E=p*n,C=h.subarray(E,E+n),R=f.subarray(E,E+n);for(b=0;b<n;b++)C[b]=x[b].value,R[b]=x[b].index}var _=t.slice();return _[_.length-1]=n,[bn(h,_,e),bn(f,_,"int32")]}var PD=(function(){return function(r,t,e){this.variableNames=["A"];var n=r.windowSize,a=r.batchSize,i=r.inSize,o=Math.ceil(i/n);e||this.variableNames.push("bestIndicesA"),this.outputShape=[a,o];var u=t==="max"?">":"<",l=e?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+n+`;

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < `+n+`; i++) {
          int inIdx = `+l+`;
          float candidate = getA(batch, inIdx);
          if (candidate `+u+` bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}})();function hC(r,t){return["x","y","z","w","u","v"].slice(0,t).map(function(e){return r+"."+e})}function Xr(r,t){return t===1?[r]:hC(r,t)}function FD(r,t){if(r===1)return"rc";for(var e="",n=0;n<r;n++)e+=t[n],n<r-1&&(e+=",");return e}function qs(r,t){for(var e=r.length,n=[],a=0;a<e;a++){var i=e-1-a,o=r[i]||1;(t[t.length-1-a]||1)>1&&o===1&&n.unshift(i)}return n}function Dn(r,t){for(var e=[],n=0;n<t.length;n++){var a=r[r.length-n-1],i=t.length-n-1,o=t[i];(a==null||a===1&&o>1)&&e.unshift(i)}return e}function ve(r,t){for(var e=[],n=Math.max(r.length,t.length),a=0;a<n;a++){var i=r[r.length-a-1];i==null&&(i=1);var o=t[t.length-a-1];if(o==null&&(o=1),i===1)e.unshift(o);else if(o===1)e.unshift(i);else{if(i!==o)throw Error("Operands could not be broadcast together with shapes "+r+" and "+t+".");e.unshift(i)}}return e}function Ei(){var r,t,e,n,a,i,o,u,l,h;return q.get("WEBGL_VERSION")===2?(r="#version 300 es",t="in",e="out",n="in",a="texture",i="outputColor",o="out vec4 outputColor;",u=`
      const float NAN = uintBitsToFloat(uint(0x7fc00000));
    `,l=`
      const float INFINITY = uintBitsToFloat(uint(0x7f800000));
    `,h=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(r="",t="attribute",e="varying",n="varying",a="texture2D",i="gl_FragColor",o="",u=`
      uniform float NAN;

      bool isnan(float val) {
        return (val < 1.0 || 0.0 < val || val == 0.0) ? false : true;
      }
      bvec4 isnan(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,l=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,h=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:r,attribute:t,varyingVs:e,varyingFs:n,texture2D:a,output:i,defineOutput:o,defineSpecialNaN:u,defineSpecialInf:l,defineRound:h}}function Gc(r,t,e){e===void 0&&(e="index");var n=Gu(t);return n.map(function(a,i){return"int "+r[i]+" = "+e+" / "+a+"; "+(i===n.length-1?"int "+r[i+1]+" = "+e+" - "+r[i]+" * "+a:"index -= "+r[i]+" * "+a)+";"}).join("")}function wf(r){return r.length===1?""+r[0]:"vec"+r.length+"("+r.join(",")+")"}function LD(r,t){if(r.length!==t.length)throw new Error("Vectors to be dotted must be of the same length -got "+r.length+" and "+t.length);for(var e=[],n=Math.floor(r.length/4),a=r.length%4,i=0;i<n;i++){var o=r.slice(4*i,4*i+4),u=t.slice(4*i,4*i+4);e.push(wf(o)+", "+wf(u))}return a!==0&&(o=r.slice(4*n),u=t.slice(4*n),o.length===1&&(o=o.map(function(l){return"float("+l+")"}),u=u.map(function(l){return"float("+l+")"})),e.push(wf(o)+", "+wf(u))),e.map(function(l,h){return"dot("+l+")"}).join("+")}function zD(r,t,e,n){var a=[];r.forEach(function(m){var x=qt(m.shapeInfo.logicalShape);m.shapeInfo.isUniform?a.push("uniform float "+m.name+(x>1?"["+x+"]":"")+";"):(a.push("uniform sampler2D "+m.name+";"),a.push("uniform int offset"+m.name+";"))});var i,o,u=a.join(`
`),l=r.map(function(m){return UD(m,t,n)}).join(`
`),h=t.texShape,f=Ei(),p=GD(f),v=jD(f);return t.isPacked?(i=WD(t.logicalShape,h),o=qD(f)):(i=VD(t.logicalShape,h),o=HD(f)),n&&(v+=QD),[v,p,o,u,i,l,e].join(`
`)}function vl(r){var t=r.shapeInfo.logicalShape;switch(t.length){case 0:return sI(r);case 1:return cI(r);case 2:return fI(r);case 3:return pI(r);case 4:return mI(r);case 5:return gI(r);case 6:return yI(r);default:throw new Error(t.length+"-D input sampling is not yet supported")}}function fC(r){switch(r.shapeInfo.logicalShape.length){case 0:return uI(r);case 1:return lI(r);case 2:return hI(r);case 3:return dI(r);default:return vI(r)}}function UD(r,t,e){e===void 0&&(e=!1);var n="";n+=e?fC(r):vl(r);var a=r.shapeInfo.logicalShape,i=t.logicalShape;return a.length<=i.length&&(n+=e?xI(r,t):bI(r,t)),n}function WD(r,t){switch(r.length){case 0:return dC();case 1:return ZD(r,t);case 2:return iI(r,t);case 3:return JD(r,t);default:return eI(r,t)}}function VD(r,t){switch(r.length){case 0:return dC();case 1:return $D(r,t);case 2:return oI(r,t);case 3:return tI(r,t);case 4:return nI(r,t);case 5:return rI(r,t);case 6:return aI(r,t);default:throw new Error(r.length+"-D output sampling is not yet supported")}}function GD(r){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return `+r.texture2D+`(textureSampler, uv).r;
    }
  `}function HD(r){return`
    void setOutput(float val) {
      `+r.output+` = vec4(val, 0, 0, 0);
    }
  `}function qD(r){return`
    void setOutput(vec4 val) {
      `+r.output+` = val;
    }
  `}function jD(r){return r.version+`
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    `+r.varyingFs+` vec2 resultUV;
    `+r.defineOutput+`
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    `+r.defineSpecialNaN+`
    `+r.defineSpecialInf+`
    `+r.defineRound+`

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    `+XD+`
    `+KD+`
    `+YD+`
  `}var XD=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,KD=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,YD=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,QD=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function dC(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function ZD(r,t){var e=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];return e[0]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * `+e[1]+`.0);
      }
    `:e[1]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * `+e[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+e[0]+", "+e[1]+`));
      return resTexRC.x * `+e[1]+` + resTexRC.y;
    }
  `}function $D(r,t){return t[0]===1?`
      int getOutputCoords() {
        return int(resultUV.x * `+t[1]+`.0);
      }
    `:t[1]===1?`
      int getOutputCoords() {
        return int(resultUV.y * `+t[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+t[0]+", "+t[1]+`));
      return resTexRC.x * `+t[1]+` + resTexRC.y;
    }
  `}function JD(r,t){var e=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],n=Math.ceil(r[2]/2),a=n*Math.ceil(r[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+e[0]+", "+e[1]+`));
      int index = resTexRC.x * `+e[1]+` + resTexRC.y;

      int b = index / `+a+`;
      index -= b * `+a+`;

      int r = 2 * (index / `+n+`);
      int c = imod(index, `+n+`) * 2;

      return ivec3(b, r, c);
    }
  `}function tI(r,t){var e=Gc(["r","c","d"],r);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+t[0]+", "+t[1]+`));
      int index = resTexRC.x * `+t[1]+` + resTexRC.y;
      `+e+`
      return ivec3(r, c, d);
    }
  `}function eI(r,t){for(var e=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],n=Math.ceil(r[r.length-1]/2),a=n*Math.ceil(r[r.length-2]/2),i=a,o="",u="b, r, c",l=2;l<r.length-1;l++)o=`
      int b`+l+" = index / "+(i*=r[r.length-l-1])+`;
      index -= b`+l+" * "+i+`;
    `+o,u="b"+l+", "+u;return`
    ivec`+r.length+` getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+e[0]+", "+e[1]+`));
      int index = resTexRC.x * `+e[1]+` + resTexRC.y;

      `+o+`

      int b = index / `+a+`;
      index -= b * `+a+`;

      int r = 2 * (index / `+n+`);
      int c = imod(index, `+n+`) * 2;

      return ivec`+r.length+"("+u+`);
    }
  `}function nI(r,t){var e=Gc(["r","c","d","d2"],r);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+t[0]+", "+t[1]+`));
      int index = resTexRC.x * `+t[1]+` + resTexRC.y;
      `+e+`
      return ivec4(r, c, d, d2);
    }
  `}function rI(r,t){var e=Gc(["r","c","d","d2","d3"],r);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(`+t[0]+`,
                             `+t[1]+`));

      int index = resTexRC.x * `+t[1]+` + resTexRC.y;

      `+e+`

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function aI(r,t){var e=Gc(["r","c","d","d2","d3","d4"],r);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+t[0]+", "+t[1]+`));
      int index = resTexRC.x * `+t[1]+` + resTexRC.y;

      `+e+`

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function iI(r,t){var e=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(pr(r,t))return`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(`+e[0]+", "+e[1]+`));
      }
    `;var n=Math.ceil(r[1]/2);return`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+e[0]+", "+e[1]+`));

      int index = resTexRC.x * `+e[1]+` + resTexRC.y;
      int r = 2 * (index / `+n+`);
      int c = imod(index, `+n+`) * 2;

      return ivec2(r, c);
    }
  `}function oI(r,t){return pr(r,t)?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(`+t[0]+", "+t[1]+`));
      }
    `:r[1]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+t[0]+", "+t[1]+`));
        int index = resTexRC.x * `+t[1]+` + resTexRC.y;
        return ivec2(index, 0);
      }
    `:r[0]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+t[0]+", "+t[1]+`));
        int index = resTexRC.x * `+t[1]+` + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+t[0]+", "+t[1]+`));
      int index = resTexRC.x * `+t[1]+` + resTexRC.y;
      int r = index / `+r[1]+`;
      int c = index - r * `+r[1]+`;
      return ivec2(r, c);
    }
  `}function Hu(r){return"offset"+r}function uI(r){var t=r.name;return`
    vec4 `+("get"+t.charAt(0).toUpperCase()+t.slice(1))+`() {
      return `+Ei().texture2D+"("+t+`, halfCR);
    }
  `}function sI(r){var t=r.name,e="get"+t.charAt(0).toUpperCase()+t.slice(1);if(r.shapeInfo.isUniform)return"float "+e+"() {return "+t+";}";var n=r.shapeInfo.texShape,a=n[0],i=n[1];if(a===1&&i===1)return`
      float `+e+`() {
        return sampleTexture(`+t+`, halfCR);
      }
    `;var o=r.shapeInfo.texShape;return`
    float `+e+`() {
      vec2 uv = uvFromFlat(`+o[0]+", "+o[1]+", "+Hu(t)+`);
      return sampleTexture(`+t+`, uv);
    }
  `}function lI(r){var t=r.name,e="get"+t.charAt(0).toUpperCase()+t.slice(1),n=r.shapeInfo.texShape,a=[Math.ceil(n[0]/2),Math.ceil(n[1]/2)],i=Ei();return`
    vec4 `+e+`(int index) {
      vec2 uv = packedUVfrom1D(
        `+a[0]+", "+a[1]+`, index);
      return `+i.texture2D+"("+t+`, uv);
    }
  `}function cI(r){var t=r.name,e="get"+t.charAt(0).toUpperCase()+t.slice(1);if(r.shapeInfo.isUniform)return`
      float `+e+`(int index) {
        `+ml(r)+`
      }
    `;var n=r.shapeInfo.texShape,a=n[0],i=n[1];if(i===1&&a===1)return`
      float `+e+`(int index) {
        return sampleTexture(`+t+`, halfCR);
      }
    `;var o=Hu(t);return i===1?`
      float `+e+`(int index) {
        vec2 uv = vec2(0.5, (float(index + `+o+") + 0.5) / "+a+`.0);
        return sampleTexture(`+t+`, uv);
      }
    `:a===1?`
      float `+e+`(int index) {
        vec2 uv = vec2((float(index + `+o+") + 0.5) / "+i+`.0, 0.5);
        return sampleTexture(`+t+`, uv);
      }
    `:`
    float `+e+`(int index) {
      vec2 uv = uvFromFlat(`+a+", "+i+", index + "+o+`);
      return sampleTexture(`+t+`, uv);
    }
  `}function hI(r){var t=r.shapeInfo.logicalShape,e=r.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1),a=r.shapeInfo.texShape,i=a[0],o=a[1],u=Ei();if(a!=null&&pr(t,a))return`
      vec4 `+n+`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`+o+".0, "+i+`.0);

        return `+u.texture2D+"("+e+`, uv);
      }
    `;var l=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)];return`
    vec4 `+n+`(int row, int col) {
      vec2 uv = packedUVfrom2D(`+Math.ceil(t[1]/2)+", "+l[0]+", "+l[1]+`, row, col);
      return `+u.texture2D+"("+e+`, uv);
    }
  `}function fI(r){var t=r.shapeInfo.logicalShape,e=r.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1),a=r.shapeInfo.texShape;if(a!=null&&pr(t,a)){var i=a[0];return`
    float `+n+`(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(`+a[1]+".0, "+i+`.0);
      return sampleTexture(`+e+`, uv);
    }
  `}var o=Vu(t),u=o.newShape,l=o.keptDims,h=u;if(h.length<t.length)return`
      `+vl(gl(r,h))+`
      float `+n+`(int row, int col) {
        return `+n+"("+yl(["row","col"],l)+`);
      }
    `;if(r.shapeInfo.isUniform)return`
      float `+n+`(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(`+t[1]+`, 1)));
        `+ml(r)+`
      }
    `;var f=a[0],p=a[1],v=Hu(e);return p===1?`
    float `+n+`(int row, int col) {
      float index = dot(vec3(row, col, `+v+"), vec3("+t[1]+`, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / `+f+`.0);
      return sampleTexture(`+e+`, uv);
    }
  `:f===1?`
    float `+n+`(int row, int col) {
      float index = dot(vec3(row, col, `+v+"), vec3("+t[1]+`, 1, 1));
      vec2 uv = vec2((index + 0.5) / `+p+`.0, 0.5);
      return sampleTexture(`+e+`, uv);
    }
  `:`
  float `+n+`(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * `+t[1]+" + col + "+v+`;
    vec2 uv = uvFromFlat(`+f+", "+p+`, index);
    return sampleTexture(`+e+`, uv);
  }
`}function dI(r){var t=r.shapeInfo.logicalShape,e=r.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1),a=r.shapeInfo.texShape,i=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)];if(t[0]===1)return`
        `+fC(gl(r,t.slice(1)))+`
        vec4 `+n+`(int b, int row, int col) {
          return `+n+"("+yl(["b","row","col"],[1,2])+`);
        }
      `;var o=i[0],u=i[1],l=Math.ceil(t[2]/2);return`
    vec4 `+n+`(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        `+o+", "+u+", "+l*Math.ceil(t[1]/2)+", "+l+`, b, row, col);
      return `+Ei().texture2D+"("+e+`, uv);
    }
  `}function pI(r){var t=r.shapeInfo.logicalShape,e=r.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1),a=t[1]*t[2],i=t[2],o=Vu(t),u=o.newShape,l=o.keptDims,h=u;if(h.length<t.length)return`
        `+vl(gl(r,h))+`
        float `+n+`(int row, int col, int depth) {
          return `+n+"("+yl(["row","col","depth"],l)+`);
        }
      `;if(r.shapeInfo.isUniform)return`
      float `+n+`(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(`+a+", "+i+`, 1)));
        `+ml(r)+`
      }
    `;var f=r.shapeInfo.texShape,p=f[0],v=f[1],m=r.shapeInfo.flatOffset;return v===a&&m==null?`
        float `+n+`(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(`+i+`, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(`+v+".0, "+p+`.0);
          return sampleTexture(`+e+`, uv);
        }
      `:v===i&&m==null?`
    float `+n+`(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(`+t[1]+`, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+v+".0, "+p+`.0);
      return sampleTexture(`+e+`, uv);
    }
  `:`
      float `+n+`(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * `+a+" + col * "+i+" + depth + "+Hu(e)+`;
        vec2 uv = uvFromFlat(`+p+", "+v+`, index);
        return sampleTexture(`+e+`, uv);
      }
  `}function vI(r){for(var t=r.shapeInfo.logicalShape,e=t.length,n=r.name,a="get"+n.charAt(0).toUpperCase()+n.slice(1),i=r.shapeInfo.texShape,o=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],u=o[0],l=o[1],h=Math.ceil(t[e-1]/2),f=h*Math.ceil(t[e-2]/2),p="int b, int row, int col",v="b * "+f+" + (row / 2) * "+h+" + (col / 2)",m=2;m<e-1;m++)p="int b"+m+", "+p,v="b"+m+" * "+(f*=t[e-m-1])+" + "+v;return`
    vec4 `+a+"("+p+`) {
      int index = `+v+`;
      int texR = index / `+l+`;
      int texC = index - texR * `+l+`;
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+l+", "+u+`);
      return `+Ei().texture2D+"("+n+`, uv);
    }
  `}function mI(r){var t=r.shapeInfo.logicalShape,e=r.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1),a=t[3],i=t[2]*a,o=t[1]*i,u=Vu(t),l=u.newShape,h=u.keptDims;if(l.length<t.length)return`
      `+vl(gl(r,l))+`
      float `+n+`(int row, int col, int depth, int depth2) {
        return `+n+"("+yl(["row","col","depth","depth2"],h)+`);
      }
    `;if(r.shapeInfo.isUniform)return`
      float `+n+`(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(`+o+", "+i+", "+a+`, 1)));
        `+ml(r)+`
      }
    `;var f=r.shapeInfo.flatOffset,p=r.shapeInfo.texShape,v=p[0],m=p[1];return m===o&&f==null?`
      float `+n+`(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(`+i+", "+a+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+m+".0, "+v+`.0);
        return sampleTexture(`+e+`, uv);
      }
    `:m===a&&f==null?`
      float `+n+`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`+t[1]*t[2]+", "+t[2]+`, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+m+".0, "+v+`.0);
        return sampleTexture(`+e+`, uv);
      }
    `:`
    float `+n+`(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+o+" + col * "+i+` +
          depth * `+a+` + depth2;
      vec2 uv = uvFromFlat(`+v+", "+m+", index + "+Hu(e)+`);
      return sampleTexture(`+e+`, uv);
    }
  `}function gI(r){var t=r.shapeInfo.logicalShape,e=r.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1),a=t[4],i=t[3]*a,o=t[2]*i,u=t[1]*o,l=Vu(t),h=l.newShape,f=l.keptDims;if(h.length<t.length)return`
      `+vl(gl(r,h))+`
      float `+n+`(int row, int col, int depth, int depth2, int depth3) {
        return `+n+"("+yl(["row","col","depth","depth2","depth3"],f)+`);
      }
    `;if(r.shapeInfo.isUniform)return`
      float `+n+`(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(`+u+", "+o+", "+i+", "+a+`)) +
          depth3;
        `+ml(r)+`
      }
    `;var p=r.shapeInfo.flatOffset,v=r.shapeInfo.texShape,m=v[0],x=v[1];return x===u&&p==null?`
      float `+n+`(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(`+o+", "+i+", "+a+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+x+".0, "+m+`.0);
        return sampleTexture(`+e+`, uv);
      }
    `:x===a&&p==null?`
      float `+n+`(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(`+t[1]*t[2]*t[3]+`,
               `+t[2]*t[3]+", "+t[3]+`, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+x+".0, "+m+`.0);
        return sampleTexture(`+e+`, uv);
      }
    `:`
    float `+n+`(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+u+" + col * "+o+" + depth * "+i+` +
          depth2 * `+a+" + depth3 + "+Hu(e)+`;
      vec2 uv = uvFromFlat(`+m+", "+x+`, index);
      return sampleTexture(`+e+`, uv);
    }
  `}function yI(r){var t=r.shapeInfo.logicalShape,e=r.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1),a=Vu(t),i=a.newShape,o=a.keptDims;if(i.length<t.length)return`
      `+vl(gl(r,i))+`
      float `+n+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return `+n+"("+yl(["row","col","depth","depth2","depth3","depth4"],o)+`);
      }
    `;var u=t[5],l=t[4]*u,h=t[3]*l,f=t[2]*h,p=t[1]*f;if(r.shapeInfo.isUniform)return`
      float `+n+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(`+p+", "+f+", "+h+", "+l+`)) +
          dot(
            vec2(depth3, depth4),
            vec2(`+u+`, 1)));
        `+ml(r)+`
      }
    `;var v=r.shapeInfo.flatOffset,m=r.shapeInfo.texShape,x=m[0],b=m[1];return b===p&&v==null?`
      float `+n+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(`+f+", "+h+", "+l+", "+u+`)) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+b+".0, "+x+`.0);
        return sampleTexture(`+e+`, uv);
      }
    `:b===u&&v==null?`
      float `+n+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(`+t[1]*t[2]*t[3]*t[4]+`,
               `+t[2]*t[3]*t[4]+`,
               `+t[3]*t[4]+`,
               `+t[4]+`)) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+b+".0, "+x+`.0);
        return sampleTexture(`+e+`, uv);
      }
    `:`
    float `+n+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+p+" + col * "+f+" + depth * "+h+` +
          depth2 * `+l+" + depth3 * "+u+" + depth4 + "+Hu(e)+`;
      vec2 uv = uvFromFlat(`+x+", "+b+`, index);
      return sampleTexture(`+e+`, uv);
    }
  `}function ml(r){var t=r.name,e=qt(r.shapeInfo.logicalShape);return e<2?"return "+t+";":`
    for (int i = 0; i < `+e+`; i++) {
      if (i == index) {
        return `+t+`[i];
      }
    }
  `}function xI(r,t){var e,n=r.name,a=n.charAt(0).toUpperCase()+n.slice(1),i="get"+a+"AtOutCoords",o=r.shapeInfo.logicalShape.length,u=t.logicalShape.length,l=qs(r.shapeInfo.logicalShape,t.logicalShape),h=Ve(u),f=u-o,p=["x","y","z","w","u","v"];e=o===0?"":u<2&&l.length>=1?"coords = 0;":l.map(function(E){return"coords."+p[E+f]+" = 0;"}).join(`
`);var v="";v=u<2&&o>0?"coords":r.shapeInfo.logicalShape.map(function(E,C){return"coords."+p[C+f]}).join(", ");var m="return outputValue;";if(o===1&&u>1)m=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(o===0&&u>0)m=u===1?`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:`
        return vec4(outputValue.x);
      `;else if(l.length){var x=o-2,b=o-1;l.indexOf(x)>-1&&l.indexOf(b)>-1?m="return vec4(outputValue.x);":l.indexOf(x)>-1?m="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":l.indexOf(b)>-1&&(m="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 `+i+`() {
      `+h+` coords = getOutputCoords();
      `+e+`
      vec4 outputValue = get`+a+"("+v+`);
      `+m+`
    }
  `}function bI(r,t){var e=r.name,n=e.charAt(0).toUpperCase()+e.slice(1),a="get"+n+"AtOutCoords",i=t.texShape,o=r.shapeInfo.texShape,u=r.shapeInfo.logicalShape.length,l=t.logicalShape.length;if(!r.shapeInfo.isUniform&&u===l&&r.shapeInfo.flatOffset==null&&pr(o,i))return`
      float `+a+`() {
        return sampleTexture(`+e+`, resultUV);
      }
    `;var h=Ve(l),f=qs(r.shapeInfo.logicalShape,t.logicalShape),p=l-u,v=["x","y","z","w","u","v"];return`
    float `+a+`() {
      `+h+` coords = getOutputCoords();
      `+(u===0?"":l<2&&f.length>=1?"coords = 0;":f.map(function(m){return"coords."+v[m+p]+" = 0;"}).join(`
`))+`
      return get`+n+"("+(l<2&&u>0?"coords":r.shapeInfo.logicalShape.map(function(m,x){return"coords."+v[x+p]}).join(", "))+`);
    }
  `}function Ve(r){if(r<=1)return"int";if(r===2)return"ivec2";if(r===3)return"ivec3";if(r===4)return"ivec4";if(r===5)return"ivec5";if(r===6)return"ivec6";throw Error("GPU for rank "+r+" is not yet supported")}function gl(r,t){var e=JSON.parse(JSON.stringify(r));return e.shapeInfo.logicalShape=t,e}function yl(r,t){return t.map(function(e){return r[e]}).join(", ")}var wI=(function(){return function(r,t,e,n){this.variableNames=["A"],this.usesPackedTextures=!0,Y(r.length>2,function(){return"Packed arg"+(e.charAt(0).toUpperCase()+e.slice(1))+" supports only inputs with rank above 2."});var a=r[r.length-1],i=Math.ceil(a/t);this.outputShape=r.slice(0,-1),i>1&&this.outputShape.push(i),n||this.variableNames.push("bestIndicesA");var o,u,l=this.outputShape,h=l.length,f=Ve(h),p=Xr("coords",h);if(i===1){var v=Ve(u=h+1);o=`
        `+v+" sourceLocR = "+v+"("+p.join()+`, 0);
        ++`+p[h-1]+`;
        `+v+" sourceLocG = "+v+"("+p.join()+`, 0);
        ++`+p[h-2]+`;
        `+v+" sourceLocA = "+v+"("+p.join()+`, 0);
        --`+p[h-1]+`;
        `+v+" sourceLocB = "+v+"("+p.join()+`, 0);
        --`+p[h-2]+";"}else u=h,o=`
        `+f+` sourceLocR = coords;
        ++`+p[h-1]+`;
        `+f+` sourceLocG = coords;
        ++`+p[h-2]+`;
        `+f+` sourceLocA = coords;
        --`+p[h-1]+`;
        `+f+` sourceLocB = coords;
        --`+p[h-2]+";";var m=["x","y","z","w","u","v"].slice(0,u),x="."+m[u-1],b=m.map(function(M){return"int "+M}),E=Xr("sourceLocR",u-1).concat("inIdx.r"),C=Xr("sourceLocG",u-1).concat("inIdx.g"),R=Xr("sourceLocB",u-1).concat("inIdx.b"),_=Xr("sourceLocA",u-1).concat("inIdx.a"),A=e==="max"?"greaterThan":"lessThan",k=n?"":`
          inIdx = round(vec4(getBestIndicesAChannel(`+E.join()+`),
                             getBestIndicesAChannel(`+C.join()+`),
                             getBestIndicesAChannel(`+R.join()+`),
                             getBestIndicesAChannel(`+_.join()+")));",D=`vec4(
            getAChannel(`+E.join()+`),
            hasNextCol ? getAChannel(`+C.join()+`) : 0.,
            hasNextRow ? getAChannel(`+R.join()+`) : 0.,
            hasNextRow && hasNextCol ? getAChannel(`+_.join()+") : 0.)",P=n?"":`
      float getBestIndicesAChannel(`+b.join()+`) {
        return getChannel(getBestIndicesA(`+m.join()+`),
                                          vec2(`+m.slice(-2).join()+`));
      }`;this.userCode=`
      float getAChannel(`+b.join()+`) {
        return getChannel(getA(`+m.join()+`),
                               vec2(`+m.slice(-2).join()+`));
      }
      `+P+`
      void main() {
        `+f+` coords = getOutputCoords();
        bool hasNextCol = `+p[h-1]+" < "+(l[h-1]-1)+`;
        bool hasNextRow = `+p[h-2]+" < "+(l[h-2]-1)+`;
        `+o+`
        ivec4 srcIdx = ivec4(sourceLocR`+x+", sourceLocG"+x+`,
          sourceLocB`+x+", sourceLocA"+x+") * "+t+`;
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = `+D+`;

        for (int i = 0; i < `+t+`; i++) {
          inIdx = srcIdx;
          `+k+`
          vec4 candidate = `+D+`;
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(`+A+`(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}})(),EI=(function(){return function(r){this.variableNames=["dy"],this.outputShape=r.inShape;var t=r.filterHeight,e=r.filterWidth,n=r.strideHeight,a=r.strideWidth,i=r.dilationHeight,o=r.dilationWidth,u=r.effectiveFilterHeight,l=r.effectiveFilterWidth,h=u-1-r.padInfo.top,f=l-1-r.padInfo.left,p=1/(t*e);this.userCode=`
      const ivec2 pads = ivec2(`+h+", "+f+`);
      const float avgMultiplier = float(`+p+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+u+`;
            wR += `+i+`) {
          float dyR = float(dyRCorner + wR) / `+n+`.0;

          if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+l+`;
            wC+= `+o+`) {
            float dyC = float(dyCCorner + wC) / `+a+`.0;

            if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}})(),CI=(function(){return function(r,t,e,n,a,i){this.outputShape=[],this.variableNames=["x","mean","variance"],ve(r,t),ve(r,e);var o="0.0";n!=null&&(ve(r,n),this.variableNames.push("offset"),o="getOffsetAtOutCoords()");var u="1.0";a!=null&&(ve(r,a),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=r,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = `+o+`;
        float scale = `+u+`;
        float inv = scale * inversesqrt(variance + float(`+i+`));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}})(),SI=(function(){return function(r,t,e,n,a,i){this.usesPackedTextures=!0,this.variableNames=["x","mean","variance"],ve(r,t),ve(r,e);var o="vec4(0.0)";n!=null&&(ve(r,n),this.variableNames.push("offset"),o="getOffsetAtOutCoords()");var u="vec4(1.0)";a!=null&&(ve(r,a),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=r,this.userCode=`
      void main() {
        vec4 offset = `+o+`;
        vec4 scale = `+u+`;

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(`+i+`));

        setOutput((x - mean) * inv + offset);
      }
    `}})(),j1={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"},X1=(function(){return function(r,t,e){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=ve(t,e),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        `+r+`
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}})(),Ug=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`,hm="return a + b;",fm="return a - b;",K1="return a * b;",RI=`if (a == b) return 1.0;
  return a / b;`,_I=`
  float resultSign = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  int result = ia / ib;
  int amodb = ia - ib * result;

  if (resultSign < 0.0 && amodb != 0) {
    result -= 1;
  }
  return float(result);
`,AI=`
if(a < 0.0 && floor(b) < b){
  return NAN;
}
return (round(mod(b, 2.0)) != 1) ?
    pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,Y1="return (a - b) * (a - b);",TI="return float(a == b);",kI="return float(a != b);",DI="return float(a < b);",II="return float(a <= b);",NI="return float(a > b);",OI="return float(a >= b);",MI="return float(a >= 1.0 && b >= 1.0);",BI="return float(a >= 1.0 || b >= 1.0);",PI=Ug+`
  return max(a, b);
`,FI=Ug+`
  return min(a, b);
`,LI=`if (b == 0.0) return NAN;
  return mod(a, b);`,zI=Ug+`
  return atan(a, b);
`,UI="return (b >= 1.0) ? a : a * (b + 1.0);",WI="return (a < 0.) ? b * a : a;",an=(function(){return function(r,t,e){this.variableNames=["A","B"],this.outputShape=ve(t,e),this.userCode=`
      float binaryOperation(float a, float b) {
        `+r+`
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}})(),Hc=`
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;
`,VI=`
  vec4 resultSign = sign(a) * sign(b);
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  ivec4 result = ia / ib;
  ivec4 amodb = ia - ib * result;

  // Vectorize INT_DIV
  // if (resultSign < 0.0 && amodb != 0) result -= 1;
  // return float(result);
  return vec4(result -
     ivec4(lessThan(resultSign, vec4(0.0))) * ivec4(notEqual(amodb, ivec4(0))));
`,GI=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));
  `+Hc+`
  return result;
`,HI=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`,qI=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,jI=`
  vec4 result = atan(a, b);
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  `+Hc+`
  return result;
`,XI=`
  return vec4(equal(a, b));
`,KI=`
  return vec4(notEqual(a, b));
`,YI=`
  return vec4(lessThan(a, b));
`,QI=`
  return vec4(lessThanEqual(a, b));
`,ZI=`
  return vec4(greaterThan(a, b));
`,$I=`
  return vec4(greaterThanEqual(a, b));
`,JI=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,tN=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,eN=`
  vec4 result = vec4(max(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  `+Hc+`
  return result;
`,nN=`
  vec4 result = vec4(min(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  `+Hc+`
  return result;
`,rN=`
  vec4 result = mod(a, b);
  vec4 isNaN = vec4(equal(b, vec4(0.0)));
  `+Hc+`
  return result;
`,Hi=(function(){return function(r,t,e){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.usesPackedTextures=!0,this.outputShape=ve(t,e),this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        `+r+`
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}})(),aN=(function(){function r(t){this.variableNames=["A"],this.outputShape=t,this.userCode=`
      uniform float min;
      uniform float max;

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, min, max));
      }
    `}return r.prototype.getCustomSetupFunc=function(t,e){var n=this;return function(a,i){n.minLoc==null&&(n.minLoc=a.getUniformLocationNoThrow(i,"min"),n.maxLoc=a.getUniformLocationNoThrow(i,"max")),a.gl.uniform1f(n.minLoc,t),a.gl.uniform1f(n.maxLoc,e)}},r})(),iN=(function(){function r(t){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=t,this.userCode=`
      uniform float min;
      uniform float max;

      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(min), vec4(max)));
      }
    `}return r.prototype.getCustomSetupFunc=function(t,e){var n=this;return function(a,i){n.minLoc==null&&(n.minLoc=a.getUniformLocationNoThrow(i,"min"),n.maxLoc=a.getUniformLocationNoThrow(i,"max")),a.gl.uniform1f(n.minLoc,t),a.gl.uniform1f(n.maxLoc,e)}},r})(),oN=(function(){return function(r){this.variableNames=["real","imag"],this.outputShape=r,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}})(),uN=(function(){return function(r){this.outputShape=[],this.outputShape=al(r,1),this.variableNames=r.map(function(u,l){return"T"+l});var t=new Array(r.length-1);t[0]=r[0][1];for(var e=1;e<t.length;e++)t[e]=t[e-1]+r[e][1];var n=["if (yC < "+t[0]+") setOutput(getT0(yR, yC));"];for(e=1;e<t.length;e++){var a=t[e-1];n.push("else if (yC < "+t[e]+") setOutput(getT"+e+"(yR, yC-"+a+"));")}var i=t.length,o=t[t.length-1];n.push("else setOutput(getT"+i+"(yR, yC-"+o+"));"),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        `+n.join(`
        `)+`
      }
    `}})(),sN=(function(){return function(r,t){this.usesPackedTextures=!0,this.outputShape=[],this.outputShape=al(r,t);var e=this.outputShape,n=e.length,a=Ve(n),i=Xr("coords",n),o=["x","y","z","w","u","v"].slice(0,n);this.variableNames=r.map(function(b,E){return"T"+E});var u=new Array(r.length-1);u[0]=r[0][t];for(var l=1;l<u.length;l++)u[l]=u[l-1]+r[l][t];var h=o[t],f="vec2("+o.slice(-2).join()+")",p=o.join(),v="if ("+h+" < "+u[0]+`)
          return getChannel(getT0(`+p+"), "+f+");";for(l=1;l<u.length;l++){var m=u[l-1];v+=`
        else if (`+h+" < "+u[l]+`) {
          `+h+" -= "+m+`;
          return getChannel(getT`+l+"("+p+"), "+f+`);
        }`}var x=u.length;v+=`
        else {
          `+h+" -= "+u[u.length-1]+`;
          return getChannel(getT`+x+"("+p+"), "+f+`);
        }`,this.userCode=`
      float getValue(`+o.map(function(b){return"int "+b})+`) {
        `+v+`
      }

      void main() {
        `+a+` coords = getOutputCoords();
        vec4 result = vec4(getValue(`+i+`), 0., 0., 0.);
        if (++`+i[n-1]+" < "+e[n-1]+`) {
          result.g = getValue(`+i+`);
        }
        if (++`+i[n-2]+" < "+e[n-2]+`) {
          result.a = getValue(`+i+`);
        }
        if (`+i[n-2]+" < "+e[n-2]+` &&
            --`+i[n-1]+" < "+e[n-1]+`) {
          result.b = getValue(`+i+`);
        }
        setOutput(result);
      }
    `}})(),lN=(function(){return function(r){this.variableNames=["x","dy"],this.outputShape=r.filterShape;var t=r.strideHeight,e=r.strideWidth,n=r.padInfo.top,a=r.padInfo.left;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < `+r.batchSize+`; b++) {
          for (int yR = 0; yR < `+r.outHeight+`; yR++) {
            int xR = wR + yR * `+t+" - "+n+`;

            if (xR < 0 || xR >= `+r.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+r.outWidth+`; yC++) {
              int xC = wC + yC * `+e+" - "+a+`;

              if (xC < 0 || xC >= `+r.inWidth+`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}})(),cN=(function(){return function(r){this.variableNames=["dy","W"],this.outputShape=r.inShape;var t=r.filterHeight,e=r.filterWidth,n=r.strideHeight,a=r.strideWidth,i=t-1-r.padInfo.top,o=e-1-r.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(`+i+", "+o+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+t+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+n+`.0;

          if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+t+` - 1 - wR;

          for (int wC = 0; wC < `+e+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+a+`.0;

            if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+e+` - 1 - wC;

            for (int d2 = 0; d2 < `+r.outChannels+`; d2++) {
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, d2);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}})(),hN=(function(){return function(r){this.variableNames=["x","dy"],this.outputShape=r.filterShape;var t=r.strideDepth,e=r.strideHeight,n=r.strideWidth,a=r.padInfo.front,i=r.padInfo.top,o=r.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < `+r.batchSize+`; b++) {
          for (int yF = 0; yF < `+r.outDepth+`; yF++) {
            int xF = wF + yF * `+t+" - "+a+`;

            if (xF < 0 || xF >= `+r.inDepth+`) {
              continue;
            }

            for (int yR = 0; yR < `+r.outHeight+`; yR++) {
              int xR = wR + yR * `+e+" - "+i+`;

              if (xR < 0 || xR >= `+r.inHeight+`) {
                continue;
              }

              for (int yC = 0; yC < `+r.outWidth+`; yC++) {
                int xC = wC + yC * `+n+" - "+o+`;

                if (xC < 0 || xC >= `+r.inWidth+`) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}})(),fN=(function(){return function(r){this.variableNames=["dy","W"],this.outputShape=r.inShape;var t=r.filterDepth,e=r.filterHeight,n=r.filterWidth,a=r.strideDepth,i=r.strideHeight,o=r.strideWidth,u=t-1-r.padInfo.front,l=e-1-r.padInfo.top,h=n-1-r.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(`+u+", "+l+", "+h+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < `+t+`; wF++) {
          float dyF = float(dyFCorner + wF) / `+a+`.0;

          if (dyF < 0.0 || dyF >= `+r.outDepth+`.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = `+t+` - 1 - wF;

          for (int wR = 0; wR < `+e+`; wR++) {
            float dyR = float(dyRCorner + wR) / `+i+`.0;

            if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = `+e+` - 1 - wR;

            for (int wC = 0; wC < `+n+`; wC++) {
              float dyC = float(dyCCorner + wC) / `+o+`.0;

              if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = `+n+` - 1 - wC;

              for (int d2 = 0; d2 < `+r.outChannels+`; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}})(),dN=(function(){return function(r){this.variableNames=["x","dy"],this.outputShape=r.filterShape;var t=r.strideHeight,e=r.strideWidth,n=r.padInfo.top,a=r.padInfo.left,i=r.outChannels/r.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * `+i+` + dm;

        float dotProd = 0.0;

        // TODO: Vec4 over the batch size
        for (int b = 0; b < `+r.batchSize+`; b++) {
          for (int yR = 0; yR < `+r.outHeight+`; yR++) {
            int xR = wR + yR * `+t+" - "+n+`;

            if (xR < 0 || xR >= `+r.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+r.outWidth+`; yC++) {
              int xC = wC + yC * `+e+" - "+a+`;

              if (xC < 0 || xC >= `+r.inWidth+`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}})(),pN=(function(){return function(r){this.variableNames=["dy","W"],this.outputShape=r.inShape;var t=r.filterHeight,e=r.filterWidth,n=r.strideHeight,a=r.strideWidth,i=t-1-r.padInfo.top,o=e-1-r.padInfo.left,u=r.outChannels/r.inChannels;this.userCode=`
      const ivec2 pads = ivec2(`+i+", "+o+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < `+t+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+n+`.0;

          if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+t+` - 1 - wR;

          for (int wC = 0; wC < `+e+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+a+`.0;

            if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+e+` - 1 - wC;

            // TODO: Vec4 over the channelMul
            for (int dm = 0; dm < `+u+`; dm++) {
              int d2 = d1 * `+u+` + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}})(),vN=(function(){return function(r){this.variableNames=["x","W"],this.outputShape=r.outShape;var t=r.padInfo.top,e=r.padInfo.left,n=r.strideHeight,a=r.strideWidth,i=r.dilationHeight,o=r.dilationWidth,u=r.filterHeight,l=r.filterWidth,h=4*Math.floor(r.inChannels/4),f=r.inChannels%4;this.userCode=`
      const ivec2 strides = ivec2(`+n+", "+a+`);
      const ivec2 pads = ivec2(`+t+", "+e+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+u+`; wR++) {
          int xR = xRCorner + wR * `+i+`;

          if (xR < 0 || xR >= `+r.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+l+`; wC++) {
            int xC = xCCorner + wC * `+o+`;

            if (xC < 0 || xC >= `+r.inWidth+`) {
              continue;
            }

            for (int d1 = 0; d1 < `+h+`; d1 += 4) {
              vec4 xValues = vec4(
                getX(batch, xR, xC, d1),
                getX(batch, xR, xC, d1 + 1),
                getX(batch, xR, xC, d1 + 2),
                getX(batch, xR, xC, d1 + 3)
              );
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              dotProd += dot(xValues, wValues);
            }

            if (`+(f===1)+`) {
              dotProd +=
                getX(batch, xR, xC, `+h+`) *
                getW(wR, wC, `+h+`, d2);
            } else if (`+(f===2)+`) {
              vec2 xValues = vec2(
                getX(batch, xR, xC, `+h+`),
                getX(batch, xR, xC, `+h+` + 1)
              );
              vec2 wValues = vec2(
                getW(wR, wC, `+h+`, d2),
                getW(wR, wC, `+h+` + 1, d2)
              );
              dotProd += dot(xValues, wValues);
            } else if (`+(f===3)+`) {
              vec3 xValues = vec3(
                getX(batch, xR, xC, `+h+`),
                getX(batch, xR, xC, `+h+` + 1),
                getX(batch, xR, xC, `+h+` + 2)
              );
              vec3 wValues = vec3(
                getW(wR, wC, `+h+`, d2),
                getW(wR, wC, `+h+` + 1, d2),
                getW(wR, wC, `+h+` + 2, d2)
              );
              dotProd += dot(xValues, wValues);
            }
          }
        }
        setOutput(dotProd);
      }
    `}})(),mN=(function(){return function(r){this.variableNames=["x","W"],this.outputShape=r.outShape;var t=r.padInfo.front,e=r.padInfo.top,n=r.padInfo.left,a=r.strideDepth,i=r.strideHeight,o=r.strideWidth,u=r.dilationDepth,l=r.dilationHeight,h=r.dilationWidth,f=r.filterDepth,p=r.filterHeight,v=r.filterWidth,m=4*Math.floor(r.inChannels/4),x=r.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(`+a+", "+i+", "+o+`);
      const ivec3 pads = ivec3(`+t+", "+e+", "+n+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < `+f+`; wF++) {
          int xF = xFCorner + wF * `+u+`;

          if (xF < 0 || xF >= `+r.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+p+`; wR++) {
            int xR = xRCorner + wR * `+l+`;

            if (xR < 0 || xR >= `+r.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+v+`; wC++) {
              int xC = xCCorner + wC * `+h+`;

              if (xC < 0 || xC >= `+r.inWidth+`) {
                continue;
              }

              for (int d1 = 0; d1 < `+m+`; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (`+(x===1)+`) {
                dotProd +=
                  getX(batch, xF, xR, xC, `+m+`) *
                  getW(wF, wR, wC, `+m+`, d2);
              } else if (`+(x===2)+`) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, `+m+`),
                  getX(batch, xF, xR, xC, `+m+` + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, `+m+`, d2),
                  getW(wF, wR, wC, `+m+` + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (`+(x===3)+`) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, `+m+`),
                  getX(batch, xF, xR, xC, `+m+` + 1),
                  getX(batch, xF, xR, xC, `+m+` + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, `+m+`, d2),
                  getW(wF, wR, wC, `+m+` + 1, d2),
                  getW(wF, wR, wC, `+m+` + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}})(),gN=(function(){return function(r){this.variableNames=["x","W"],this.outputShape=r.outShape;var t=r.inHeight,e=r.inWidth,n=r.padInfo.top,a=r.padInfo.left,i=r.strideHeight,o=r.strideWidth,u=r.dilationHeight,l=r.dilationWidth,h=r.filterHeight,f=r.filterWidth,p=r.outChannels/r.inChannels;this.userCode=`
      const ivec2 strides = ivec2(`+i+", "+o+`);
      const ivec2 pads = ivec2(`+n+", "+a+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `+p+`;
        int q = d2 - d1 * `+p+`;

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TODO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < `+h+`; wR++) {
          int xR = xRCorner + wR * `+u+`;

          if (xR < 0 || xR >= `+t+`) {
            continue;
          }

          for (int wC = 0; wC < `+f+`; wC++) {
            int xC = xCCorner + wC * `+l+`;

            if (xC < 0 || xC >= `+e+`) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }
        setOutput(dotProd);
      }
    `}})(),yN=(function(){return function(r){this.variableNames=["x","W"],this.usesPackedTextures=!0,this.outputShape=r.outShape;for(var t=r.inHeight,e=r.inWidth,n=r.padInfo.top,a=r.padInfo.left,i=r.strideHeight,o=r.strideWidth,u=r.dilationHeight,l=r.dilationWidth,h=r.filterHeight,f=r.filterWidth,p=f,v="int xR; int xC; int xCOffset;",m=0;m<h;m++)for(var x=0;x<f;x++)v+=`
          vec4 xTexelR`+m+"C"+2*x+` = vec4(0.);
          vec4 wR`+m+"C"+x+` = vec4(0.);
          vec4 xR`+m+"C"+x+" = vec4(0.);";for(m=0;m<h;m++)for(var b=0;b<p;b++){if(v+=`
          xR = xRCorner + `+m*u+`;
          xC = xCCorner + `+(x=2*b)*l+`;
        `,o===1){if(x<f&&(v+=a%2==1?`
                xCOffset = xC + 1;
                if(xR >= 0 && xR < `+t+" && xCOffset >= 0 && xCOffset < "+e+`) {
                  xTexelR`+m+"C"+x+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+m+"C"+x+` = vec4(0.);
                }

                xCOffset = xC + 1 - 2;
                if(xR >= 0 && xR < `+t+" && xCOffset >= 0 && xCOffset < "+e+`) {
                  vec4 previous = getX(batch, xR, xCOffset, d1);
                  xR`+m+"C"+x+" = vec4(previous.zw, xTexelR"+m+"C"+x+`.xy);
                } else {
                  xR`+m+"C"+x+" = vec4(0, 0, xTexelR"+m+"C"+x+`.xy);
                }
              `:`
                if(xR >= 0 && xR < `+t+" && xC >= 0 && xC < "+e+`) {
                  xTexelR`+m+"C"+x+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+m+"C"+x+` = vec4(0.);
                }

                xR`+m+"C"+x+" = xTexelR"+m+"C"+x+`;
              `,x+1<f)){var E=a%2==0?nl(l):l;l%2==0&&a%2==1||l%2!=0&&a%2!=1?(v+=`
                  xCOffset = xC + `+a%2+" + "+E+`;

                  if(xR >= 0 && xR < `+t+` &&
                    xCOffset >= 0 && xCOffset < `+e+`) {
                    xTexelR`+m+"C"+(x+2)+` = getX(batch, xR, xCOffset, d1);
                  }
                `,l>1&&(v+=`
                    xCOffset -= 2;
                    if(xR >= 0 && xR < `+t+` &&
                      xCOffset >= 0 && xCOffset < `+e+`) {
                      xTexelR`+m+"C"+x+` = getX(batch, xR, xCOffset, d1);
                    } else {
                      xTexelR`+m+"C"+x+` = vec4(0.);
                    }
                  `),v+=`
                  xR`+m+"C"+(x+1)+` = vec4(
                    xTexelR`+m+"C"+x+".zw, xTexelR"+m+"C"+(x+2)+`.xy);
                `):v+=`
                  xCOffset = xC + `+E+`;

                  if(xR >= 0 && xR < `+t+` &&
                    xCOffset >= 0 && xCOffset < `+e+`) {
                    xTexelR`+m+"C"+(x+2)+` = getX(batch, xR, xCOffset, d1);
                  }

                  xR`+m+"C"+(x+1)+" = xTexelR"+m+"C"+(x+2)+`;
                `}}else x<f&&(v+=`
              if(xR >= 0 && xR < `+t+`) {
            `,a%2==1?(v+=`
                xCOffset = xC + 1 - `+o+`;
                if(xCOffset >= 0 && xCOffset < `+e+`) {
                  xTexelR`+m+"C"+x+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+m+"C"+x+` = vec4(0.);
                }

                if(xC + 1 >= 0 && xC + 1 < `+e+`) {
                  xTexelR`+m+"C"+(x+2)+` = getX(batch, xR, xC + 1, d1);
                } else {
                  xTexelR`+m+"C"+(x+2)+` = vec4(0.);
                }

                xR`+m+"C"+x+` = vec4(
                  xTexelR`+m+"C"+x+".zw, xTexelR"+m+"C"+(x+2)+`.zw);
              `,x+1<f&&(v+=`
                  vec4 final = vec4(0.);
                  xCOffset = xC + 1 + `+o+`;
                  if(xCOffset >= 0 && xCOffset < `+e+`) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xR`+m+"C"+(x+1)+" = vec4(xTexelR"+m+"C"+(x+2)+`.xy, final.xy);
                `)):(v+=`
                if(xC >= 0 && xC < `+e+`) {
                  xTexelR`+m+"C"+x+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+m+"C"+x+` = vec4(0.);
                }

                xCOffset = xC + `+o+`;
                if(xCOffset >= 0 && xCOffset < `+e+`) {
                  xTexelR`+m+"C"+(x+2)+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+m+"C"+(x+2)+` = vec4(0.);
                }

                xR`+m+"C"+x+` = vec4(
                  xTexelR`+m+"C"+x+".xy, xTexelR"+m+"C"+(x+2)+`.xy);
              `,x+1<f&&(v+=`
                  xR`+m+"C"+(x+1)+` = vec4(
                    xTexelR`+m+"C"+x+".zw, xTexelR"+m+"C"+(x+2)+`.zw);
                `)),v+="}");x<f&&(v+=`
            vec4 wTexelR`+m+"C"+x+" = getW("+m+", "+x+`, d1, q);
            wR`+m+"C"+x+" = vec4(wTexelR"+m+"C"+x+".xz, wTexelR"+m+"C"+x+`.xz);
          `,x+1<f&&(v+=`
              vec4 wTexelR`+m+"C"+(x+1)+" = getW("+m+", "+(x+1)+`, d1, q);
              wR`+m+"C"+(x+1)+` =
                vec4(wTexelR`+m+"C"+(x+1)+".xz, wTexelR"+m+"C"+(x+1)+".xz);"))}for(m=0;m<h;m++)for(x=0;x<f;x++)v+="result += xR"+m+"C"+x+" * wR"+m+"C"+x+";";this.userCode=`
      const ivec2 strides = ivec2(`+i+", "+o+`);
      const ivec2 pads = ivec2(`+n+", "+a+`);

      void main() {

        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2;
        int q = 0;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        vec4 result = vec4(0.);

        `+v+`

        setOutput(result);
      }
    `}})(),xN=(function(){return function(r,t,e,n,a){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var i=r[0],o=r[1],u=r[2],l=r[3],h=t[0],f=e[0],p=e[1];this.outputShape=[h,f,p,l];var v=n==="bilinear"?1:0,m=[o-1+".0",u-1+".0"],x=m[0],b=m[1],E=f>1?[""+(o-1)/(f-1),"(y2-y1) * height_ratio","y1*"+x+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+x],C=E[0],R=E[1],_=E[2],A=p>1?[""+(u-1)/(p-1),"(x2-x1) * width_ratio","x1*"+b+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+b],k=A[0],D=A[1],P=A[2];this.userCode=`
      const float height_ratio = float(`+C+`);
      const float width_ratio = float(`+k+`);
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= `+i+`) {
          return;
        }

        float height_scale = `+R+`;
        float width_scale = `+D+`;

        float in_y = `+_+`;
        if( in_y < 0.0 || in_y > `+x+` ) {
          setOutput(float(`+a+`));
          return;
        }
        float in_x = `+P+`;
        if( in_x < 0.0 || in_x > `+b+` ) {
          setOutput(float(`+a+`));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(`+v+` == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}})(),bN=(function(){return function(r,t,e){this.variableNames=["x"],this.outputShape=r;var n=r.length,a=r[r.length-1],i=e?"<":">";this.userCode=`
      int getIndex(int i) {
        `+(e?"return "+a+" -i - 1;":"return i;")+`
      }

      void main() {
        `+Ve(n)+` coords = getOutputCoords();
        int end = `+Q1(n,"coords")+`;
        float val = 0.0;
        for (int i = `+a+` - 1; i >= 0; i -= 1) {
          int idx = getIndex(i);
          if (idx `+i+` end) {
            continue;
          }
          if (idx == end && `+t+`) {
            continue;
          }
          `+Q1(n,"coords")+` = idx;
          val += getX(`+wN(n,"coords")+`);
        }
        setOutput(val);
      }
    `}})();function wN(r,t){if(r===1)return""+t;if(r===2)return t+".x, "+t+".y";if(r===3)return t+".x, "+t+".y, "+t+".z";if(r===4)return t+".x, "+t+".y, "+t+".z, "+t+".w";throw Error("Cumulative sum for rank "+r+" is not yet supported")}function Q1(r,t){if(r===1)return""+t;if(r===2)return t+".y";if(r===3)return t+".z";if(r===4)return t+".w";throw Error("Cumulative sum for rank "+r+" is not yet supported")}var EN=(function(){function r(t,e,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=e,this.dataFormat=n,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = `+this.getHeightCoordString()+`;
      int w = `+this.getWidthCoordString()+`;
      int d = `+this.getDepthCoordString()+`;

      int in_h = h / `+e+`;
      int offset_h = imod(h, `+e+`);
      int in_w = w / `+e+`;
      int offset_w = imod(w, `+e+`);
      int offset_d = (offset_h * `+e+` + offset_w) *
        `+this.getOutputDepthSize()+`;
      int in_d = d + offset_d;

      float result = `+this.getInputSamplingString()+`;
      setOutput(result);
    }
  `}return r.prototype.getHeightCoordString=function(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"},r.prototype.getWidthCoordString=function(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"},r.prototype.getDepthCoordString=function(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"},r.prototype.getOutputDepthSize=function(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]},r.prototype.getInputSamplingString=function(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},r})(),CN=(function(){return function(r){this.variableNames=["A"];var t=Ei();this.outputShape=r,this.userCode=`
      const float FLOAT_MAX = 1.70141184e38;
      const float FLOAT_MIN = 1.17549435e-38;

      lowp vec4 encode_float(highp float v) {
        if (isnan(v)) {
          return vec4(255, 255, 255, 255);
        }

        highp float av = abs(v);

        if(av < FLOAT_MIN) {
          return vec4(0.0, 0.0, 0.0, 0.0);
        } else if(v > FLOAT_MAX) {
          return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
        } else if(v < -FLOAT_MAX) {
          return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
        }

        highp vec4 c = vec4(0,0,0,0);

        highp float e = floor(log2(av));
        highp float m = exp2(fract(log2(av))) - 1.0;

        c[2] = floor(128.0 * m);
        m -= c[2] / 128.0;
        c[1] = floor(32768.0 * m);
        m -= c[1] / 32768.0;
        c[0] = floor(8388608.0 * m);

        highp float ebias = e + 127.0;
        c[3] = floor(ebias / 2.0);
        ebias -= c[3] * 2.0;
        c[2] += floor(ebias) * 128.0;

        c[3] += 128.0 * step(0.0, -v);

        return c / 255.0;
      }

      void main() {
        float x = getAAtOutCoords();
        `+t.output+` = encode_float(x);
      }
    `}})(),Z1={REAL:"return real * expR - imag * expI;",IMAG:"return real * expI + imag * expR;"},$1=(function(){return function(r,t,e){this.variableNames=["real","imag"];var n=t[1];this.outputShape=t;var a=e?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,i=e?n+".0":"1.0";this.userCode=`
      const float exponentMultiplier = `+a+`;

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        `+r+`
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(`+n+`);
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < `+n+`; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / `+i+`;
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}})(),SN=(function(){function r(t,e){this.outputShape=[],this.variableNames=["x"],this.outputShape=t,this.userCode=`
      uniform float value;
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}return r.prototype.getCustomSetupFunc=function(t){var e=this;return function(n,a){e.valueLoc==null&&(e.valueLoc=n.getUniformLocationNoThrow(a,"value")),n.gl.uniform1f(e.valueLoc,t)}},r})(),RN=(function(){return function(r){this.variableNames=["A"];var t=Ei(),e=r[0],n=r[1];this.outputShape=r,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+n+".0, "+e+`.0);

        vec4 values = `+t.texture2D+`(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}})(),_N=(function(){return function(r,t,e){this.variableNames=["A","indices"];var n=r.slice();n[e]=t,this.outputShape=n,this.rank=n.length;var a=Ve(this.rank),i=AN(r,e);this.userCode=`
      void main() {
        `+a+` resRC = getOutputCoords();
        setOutput(getA(`+i+`));
      }
    `}})();function AN(r,t){var e=r.length;if(e>4)throw Error("Gather for rank "+e+" is not yet supported");if(e===1)return"int(getIndices(resRC))";for(var n=["resRC.x","resRC.y","resRC.z","resRC.w"],a=[],i=0;i<r.length;i++)i===t?a.push("int(getIndices("+n[i]+"))"):a.push(""+n[i]);return a.join()}var fi,Cr,TN=(function(){return function(r,t,e){this.sliceDim=r,this.strides=t,this.variableNames=["x","indices"],this.outputShape=e;var n=Ve(t.length),a=Ve(e.length),i=this.sliceDim>1?"strides[j]":"strides";this.userCode=`
        `+n+" strides = "+n+"("+this.strides+`);
         void main() {
          `+a+` coords = getOutputCoords();
          int flattenIndex = 0;
          for (int j = 0; j < `+this.sliceDim+`; j++) {
            int index = round(getIndices(coords[0], j));
            flattenIndex += index * `+i+`;
          }
          setOutput(getX(flattenIndex, coords[1]));
        }
      `}})();function xl(r,t){return[t,r]}function qc(r,t){return r*t}function kN(r,t){if(r%t!=0)throw new Error("unpackedSize ("+r+") must be a multiple of "+t);return r/t}function DN(r,t,e){var n=qc(r.length,e);if(t.length<n)throw new Error("unpackedArray length ("+t.length+") must be >= "+n);for(var a=0,i=0;i<r.length;++i)t[a]=r[i],a+=e}function pC(r,t,e){var n=kN(r.length,e);if(t.length<n)throw new Error("matrix length ("+t.length+") must be >= "+n);for(var a=0,i=0;i<r.length;i+=e)t[a++]=r[i]}function qu(r,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(r/2))]}function Wg(r,t){var e=qu(r,t);return e[0]*e[1]*4}function IN(r,t,e,n,a){for(var i=n%2==1,o=e%2==1,u=Math.floor(n/2),l=Math.floor(e/2),h=Math.ceil(n/2),f=h*Math.ceil(e/2),p=nl(e)*nl(n),v=0;v<t;v++){for(var m=v*e*n,x=v*p,b=i?4:0,E=n,C=x,R=0;R<l;++R){for(var _=2*R*n,A=0;A<u;++A){var k=m+_+2*A;a[C]=r[k],a[C+1]=r[k+1],a[C+2]=r[k+E],a[C+3]=r[k+E+1],C+=4}C+=b}if(i){k=m+n-1,C=x+4*(h-1);var D=2*n;for(b=4*h,R=0;R<l;++R)a[C]=r[k],a[C+2]=r[k+n],k+=D,C+=b}if(o){for(k=m+(e-1)*n,C=x+4*(f-h),A=0;A<u;++A)a[C++]=r[k++],a[C++]=r[k++],C+=2;i&&o&&(a[x+p-4]=r[k])}}return a}function vC(r,t,e,n,a){var i=e*n;if(a.length<i)throw new Error("matrix length ("+a.length+") must be >= "+i);for(var o=n%2==1,u=e%2==1,l=Math.floor(n/2),h=Math.floor(e/2),f=Math.ceil(n/2),p=f*Math.ceil(e/2),v=nl(e)*nl(n),m=0;m<t;m++){for(var x=m*e*n,b=m*v,E=o?4:0,C=n+(o?1:0),R=b,_=x,A=x+n,k=0;k<h;++k){for(var D=0;D<l;++D)a[_++]=r[R++],a[_++]=r[R++],a[A++]=r[R++],a[A++]=r[R++];R+=E,_+=C,A+=C}if(o){R=b+4*(f-1);var P=x+n-1;for(E=4*f,C=2*n,k=0;k<h;++k)a[P]=r[R],a[P+n]=r[R+2],R+=E,P+=C}if(u){for(R=b+4*(p-f),P=x+(e-1)*n,D=0;D<l;++D)a[P++]=r[R++],a[P++]=r[R++],R+=2;o&&(a[x+e*n-1]=r[R])}}return a}function Lt(r,t,e){var n=e();return t&&NN(r),n}function NN(r){var t=r.getError();if(t!==r.NO_ERROR)throw new Error("WebGL Error: "+PN(r,t))}(function(r){r[r.RENDER=0]="RENDER",r[r.UPLOAD=1]="UPLOAD",r[r.PIXELS=2]="PIXELS",r[r.DOWNLOAD=3]="DOWNLOAD"})(fi||(fi={})),(function(r){r[r.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",r[r.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",r[r.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",r[r.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",r[r.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(Cr||(Cr={}));var ON=596e-10,MN=65504;function BN(r){return!!(q.get("WEBGL_RENDER_FLOAT32_ENABLED")||r===0||ON<Math.abs(r)&&Math.abs(r)<MN)}function PN(r,t){switch(t){case r.NO_ERROR:return"NO_ERROR";case r.INVALID_ENUM:return"INVALID_ENUM";case r.INVALID_VALUE:return"INVALID_VALUE";case r.INVALID_OPERATION:return"INVALID_OPERATION";case r.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case r.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case r.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+t}}function Ef(r,t,e){return no(r,t,function(){return r.getExtension(e)},'Extension "'+e+'" not supported on this browser.')}function FN(r,t,e){var n=no(r,t,function(){return r.createShader(r.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(Lt(r,t,function(){return r.shaderSource(n,e)}),Lt(r,t,function(){return r.compileShader(n)}),r.getShaderParameter(n,r.COMPILE_STATUS)===!1)throw console.log(r.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}function LN(r,t,e){var n=no(r,t,function(){return r.createShader(r.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(Lt(r,t,function(){return r.shaderSource(n,e)}),Lt(r,t,function(){return r.compileShader(n)}),r.getShaderParameter(n,r.COMPILE_STATUS)===!1)throw UN(e,r.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}var zN=/ERROR: [0-9]+:([0-9]+):/g;function UN(r,t){var e=zN.exec(t);if(e==null)return console.log("Couldn't parse line number in error: "+t),void console.log(r);for(var n=+e[1],a=r.split(`
`),i=a.length.toString().length+2,o=a.map(function(v,m){return js((m+1).toString(),i)+v}),u=0,l=0;l<o.length;l++)u=Math.max(o[l].length,u);var h=o.slice(0,n-1),f=o.slice(n-1,n),p=o.slice(n);console.log(h.join(`
`)),console.log(t.split(`
`)[0]),console.log("%c "+js(f[0],u),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(p.join(`
`))}function WN(r,t){return no(r,t,function(){return r.createProgram()},"Unable to create WebGLProgram.")}function VN(r,t,e){if(Lt(r,t,function(){return r.linkProgram(e)}),r.getProgramParameter(e,r.LINK_STATUS)===!1)throw console.log(r.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function dm(r,t,e){if(Lt(r,t,function(){return r.validateProgram(e)}),r.getProgramParameter(e,r.VALIDATE_STATUS)===!1)throw console.log(r.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function GN(r,t,e){var n=no(r,t,function(){return r.createBuffer()},"Unable to create WebGLBuffer");return Lt(r,t,function(){return r.bindBuffer(r.ARRAY_BUFFER,n)}),Lt(r,t,function(){return r.bufferData(r.ARRAY_BUFFER,e,r.STATIC_DRAW)}),n}function HN(r,t,e){var n=no(r,t,function(){return r.createBuffer()},"Unable to create WebGLBuffer");return Lt(r,t,function(){return r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,n)}),Lt(r,t,function(){return r.bufferData(r.ELEMENT_ARRAY_BUFFER,e,r.STATIC_DRAW)}),n}function qN(){return q.get("WEBGL_VERSION")===2?1:4}function jN(r,t){return no(r,t,function(){return r.createTexture()},"Unable to create WebGLTexture.")}function mC(r,t){var e=q.get("WEBGL_MAX_TEXTURE_SIZE");if(r<=0||t<=0){var n="["+r+"x"+t+"]";throw new Error("Requested texture size "+n+" is invalid.")}if(r>e||t>e)throw n="["+r+"x"+t+"]",new Error("Requested texture size "+n+" greater than WebGL maximum on this browser / GPU "+("["+e+"x"+e+"]")+".")}function XN(r,t){return no(r,t,function(){return r.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function J1(r,t,e,n,a,i,o,u){var l=r.getAttribLocation(e,n);return l!==-1&&(Lt(r,t,function(){return r.bindBuffer(r.ARRAY_BUFFER,a)}),Lt(r,t,function(){return r.vertexAttribPointer(l,i,r.FLOAT,!1,o,u)}),Lt(r,t,function(){return r.enableVertexAttribArray(l)}),!0)}function KN(r,t,e,n){JN(r,n),Lt(r,t,function(){return r.activeTexture(r.TEXTURE0+n)}),Lt(r,t,function(){return r.bindTexture(r.TEXTURE_2D,e)})}function YN(r,t,e,n){return no(r,t,function(){return r.getUniformLocation(e,n)},'uniform "'+n+'" not present in program.')}function QN(r,t,e){return r.getUniformLocation(t,e)}function ZN(r,t,e,n,a,i){Lt(r,t,function(){return KN(r,t,n,i)}),Lt(r,t,function(){return r.uniform1i(a,i)})}function pm(r,t,e,n){Lt(r,t,function(){return r.bindFramebuffer(r.FRAMEBUFFER,n)}),Lt(r,t,function(){return r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e,0)})}function tw(r,t,e){Lt(r,t,function(){return r.bindFramebuffer(r.FRAMEBUFFER,e)}),Lt(r,t,function(){return r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,null,0)})}function Cf(r){var t=r.checkFramebufferStatus(r.FRAMEBUFFER);if(t!==r.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+$N(r,t))}function $N(r,t){switch(t){case r.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case r.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case r.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case r.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+t}}function no(r,t,e,n){var a=Lt(r,t,function(){return e()});if(a==null)throw new Error(n);return a}function JN(r,t){var e=r.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,n=t+r.TEXTURE0;if(n<r.TEXTURE0||n>e)throw new Error("textureUnit must be in "+("[gl.TEXTURE0, gl.TEXTURE"+e+"]")+".")}function Ls(r,t){return t===void 0&&(t=2),qt(r.slice(0,r.length-t))}function zs(r){if(r.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[r.length>1?r[r.length-2]:1,r[r.length-1]]}function tO(r,t){var e;t===void 0&&(t=!1);var n=q.get("WEBGL_MAX_TEXTURE_SIZE");if(t&&(n*=2,(r=r.map(function(h,f){return f>=r.length-2?nl(r[f]):r[f]})).length===1&&(r=[2,r[0]])),r.length!==2){var a=Vu(r);r=a.newShape}var i=qt(r);if(r.length<=1&&i<=n)return[1,i];if(r.length===2&&r[0]<=n&&r[1]<=n)return r;if(r.length===3&&r[0]*r[1]<=n&&r[2]<=n)return[r[0]*r[1],r[2]];if(r.length===3&&r[0]<=n&&r[1]*r[2]<=n)return[r[0],r[1]*r[2]];if(r.length===4&&r[0]*r[1]*r[2]<=n&&r[3]<=n)return[r[0]*r[1]*r[2],r[3]];if(r.length===4&&r[0]<=n&&r[1]*r[2]*r[3]<=n)return[r[0],r[1]*r[2]*r[3]];if(t){var o=Ls(r),u=2,l=2;return r.length&&(u=(e=zs(r))[0],l=e[1]),F1(i=o*(u/2)*(l/2)).map(function(h){return 2*h})}return F1(i)}function Sf(r){return r%2==0}function Rf(r,t){if(pr(r=r.slice(-2),t=t.slice(-2))||!r.length||!t.length||r[0]===0||r[1]===0||t[0]===0||t[1]===0)return!0;if(r.length!==t.length){var e=r.slice(-1)[0],n=t.slice(-1)[0];if(e===n||Sf(e)&&Sf(n)&&(r[0]===1||t[0]===1))return!0}return r[1]===t[1]&&Sf(r[0])&&Sf(t[0])}function eO(r,t){var e=Ei();return FN(r,t,e.version+`
    precision highp float;
    `+e.attribute+` vec3 clipSpacePos;
    `+e.attribute+` vec2 uv;
    `+e.varyingVs+` vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`)}function nO(r,t){return GN(r,t,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function rO(r,t){return HN(r,t,new Uint16Array([0,1,2,2,1,3]))}function aO(r,t){var e,n,a,i,o,u,l,h,f=r;return q.get("WEBGL_VERSION")===2?(e=f.R32F,n=f.R16F,a=f.RGBA16F,i=f.RGBA32F,o=f.RED,u=4,l=1,h=f.HALF_FLOAT):(e=r.RGBA,n=r.RGBA,a=r.RGBA,i=f.RGBA,o=r.RGBA,u=4,l=4,h=t!=null?t.HALF_FLOAT_OES:null),{internalFormatFloat:e,internalFormatHalfFloat:n,internalFormatPackedHalfFloat:a,internalFormatPackedFloat:i,textureFormatFloat:o,downloadTextureFormat:r.RGBA,downloadUnpackNumChannels:u,defaultNumChannels:l,textureTypeHalfFloat:h}}function jc(r,t,e,n,a,i,o){mC(e,n);var u=jN(r,t),l=r.TEXTURE_2D;return Lt(r,t,function(){return r.bindTexture(l,u)}),Lt(r,t,function(){return r.texParameteri(l,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE)}),Lt(r,t,function(){return r.texParameteri(l,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE)}),Lt(r,t,function(){return r.texParameteri(l,r.TEXTURE_MIN_FILTER,r.NEAREST)}),Lt(r,t,function(){return r.texParameteri(l,r.TEXTURE_MAG_FILTER,r.NEAREST)}),Lt(r,t,function(){return r.texImage2D(l,0,a,e,n,0,i,o,null)}),Lt(r,t,function(){return r.bindTexture(r.TEXTURE_2D,null)}),u}function iO(r,t,e,n,a){var i=xl(e,n);return jc(r,t,i[0],i[1],a.internalFormatFloat,a.textureFormatFloat,r.FLOAT)}function oO(r,t,e,n,a){var i=xl(e,n);return jc(r,t,i[0],i[1],a.internalFormatHalfFloat,a.textureFormatFloat,a.textureTypeHalfFloat)}function uO(r,t,e,n,a){var i=xl(e,n);return jc(r,t,i[0],i[1],r.RGBA,r.RGBA,r.UNSIGNED_BYTE)}function sO(r,t,e,n,a){var i=qu(e,n);return jc(r,t,i[0],i[1],a.internalFormatPackedFloat,r.RGBA,r.FLOAT)}function lO(r,t,e,n,a){var i=qu(e,n);return jc(r,t,i[0],i[1],a.internalFormatPackedHalfFloat,r.RGBA,a.textureTypeHalfFloat)}function cO(r,t,e,n){return Lt(r,t,function(){return r.bindBuffer(r.ARRAY_BUFFER,n)}),J1(r,t,e,"clipSpacePos",n,3,20,0)&&J1(r,t,e,"uv",n,2,20,12)}function hO(r,t,e,n){Lt(r,t,function(){return r.bindTexture(r.TEXTURE_2D,e)}),Lt(r,t,function(){return r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,n)}),Lt(r,t,function(){return r.bindTexture(r.TEXTURE_2D,null)})}function gC(r,t,e,n,a,i,o){mC(n,a),Lt(r,t,function(){return r.bindTexture(r.TEXTURE_2D,e)}),Lt(r,t,function(){return r.texSubImage2D(r.TEXTURE_2D,0,0,0,n,a,o,r.FLOAT,i)}),Lt(r,t,function(){return r.bindTexture(r.TEXTURE_2D,null)})}function fO(r,t,e,n,a,i,o,u){var l,h=xl(n,a),f=h[0],p=h[1],v=n*a;u.defaultNumChannels===1&&v===i.length?l=i:DN(i,l=new Float32Array(v*o),o),gC(r,t,e,f,p,l,u.textureFormatFloat)}function dO(r,t,e,n,a,i,o,u,l,h){var f=qu(o,u),p=f[0],v=f[1],m=new Float32Array(Wg(o,u));IN(l,n,a,i,m),gC(r,t,e,p,v,m,r.RGBA)}function pO(r,t,e,n,a,i){var o=e;if(q.get("WEBGL_VERSION")===2){var u=r,l=u.createBuffer();Lt(r,t,function(){return r.bindBuffer(u.PIXEL_PACK_BUFFER,l)});var h=4*qc(n*a,i.downloadUnpackNumChannels);Lt(r,t,function(){return r.bufferData(u.PIXEL_PACK_BUFFER,h,u.STREAM_READ)}),Lt(r,t,function(){return u.readPixels(0,0,a,n,r.RGBA,r.FLOAT,0)}),Lt(r,t,function(){return r.bindBuffer(u.PIXEL_PACK_BUFFER,null)}),o=l}return o}function vO(r,t,e,n,a){var i=r,o=new Float32Array(qc(e*n,a.downloadUnpackNumChannels));i.bindBuffer(i.PIXEL_PACK_BUFFER,t),i.getBufferSubData(i.PIXEL_PACK_BUFFER,0,o),i.bindBuffer(i.PIXEL_PACK_BUFFER,null);var u=new Float32Array(e*n);return pC(o,u,a.downloadUnpackNumChannels),u}function mO(r,t,e,n,a){var i=xl(e,n),o=i[0],u=i[1],l=new Float32Array(qc(e*n,a.downloadUnpackNumChannels));Lt(r,t,function(){return r.readPixels(0,0,o,u,a.downloadTextureFormat,r.FLOAT,l)});var h=new Float32Array(e*n);return pC(l,h,a.downloadUnpackNumChannels),h}function gO(r,t,e,n,a){var i=xl(e,n),o=i[0],u=i[1],l=new Uint8Array(qc(e*n,4));return Lt(r,t,function(){return r.readPixels(0,0,o,u,a.downloadTextureFormat,r.UNSIGNED_BYTE,l)}),new Float32Array(l.buffer)}function yO(r,t,e,n,a,i,o,u){var l=r,h=new Float32Array(Wg(i,o));l.bindBuffer(l.PIXEL_PACK_BUFFER,t),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,h),l.bindBuffer(l.PIXEL_PACK_BUFFER,null);var f=new Float32Array(qt([e,n,a]));return vC(h,e,n,a,f),f}function xO(r,t,e,n,a,i,o,u){var l=qu(i,o),h=l[0],f=l[1],p=new Float32Array(Wg(i,o));Lt(r,t,function(){return r.readPixels(0,0,h,f,r.RGBA,r.FLOAT,p)});var v=new Float32Array(qt([e,n,a]));return vC(p,e,n,a,v)}var bO=(function(){function r(t){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var e=q.get("WEBGL_VERSION");t!=null?(this.gl=t,vk(e,t)):this.gl=yi(e),q.get("WEBGL_VERSION")===1?(this.textureFloatExtension=Ef(this.gl,this.debug,"OES_texture_float"),this.colorBufferFloatExtension=this.gl.getExtension("WEBGL_color_buffer_float"),q.get("WEBGL_RENDER_FLOAT32_ENABLED")||(this.textureHalfFloatExtension=Ef(this.gl,this.debug,"OES_texture_half_float"),this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float"))):this.colorBufferFloatExtension=Ef(this.gl,this.debug,"EXT_color_buffer_float"),this.vertexBuffer=nO(this.gl,this.debug),this.indexBuffer=rO(this.gl,this.debug),this.framebuffer=XN(this.gl,this.debug),this.textureConfig=aO(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(r.prototype,"debug",{get:function(){return q.get("DEBUG")},enumerable:!0,configurable:!0}),r.prototype.dispose=function(){var t=this;if(!this.disposed){this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var e=this.gl;Lt(e,this.debug,function(){return e.finish()}),Lt(e,this.debug,function(){return e.bindFramebuffer(e.FRAMEBUFFER,null)}),Lt(e,this.debug,function(){return e.deleteFramebuffer(t.framebuffer)}),Lt(e,this.debug,function(){return e.bindBuffer(e.ARRAY_BUFFER,null)}),Lt(e,this.debug,function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}),Lt(e,this.debug,function(){return e.deleteBuffer(t.indexBuffer)}),this.disposed=!0}},r.prototype.createFloat32MatrixTexture=function(t,e){return this.throwIfDisposed(),iO(this.gl,this.debug,t,e,this.textureConfig)},r.prototype.createFloat16MatrixTexture=function(t,e){return this.throwIfDisposed(),oO(this.gl,this.debug,t,e,this.textureConfig)},r.prototype.createUnsignedBytesMatrixTexture=function(t,e){return this.throwIfDisposed(),uO(this.gl,this.debug,t,e,this.textureConfig)},r.prototype.uploadPixelDataToTexture=function(t,e){this.throwIfDisposed(),hO(this.gl,this.debug,t,e)},r.prototype.createFloat16PackedMatrixTexture=function(t,e){return this.throwIfDisposed(),lO(this.gl,this.debug,t,e,this.textureConfig)},r.prototype.createPackedMatrixTexture=function(t,e){return this.throwIfDisposed(),sO(this.gl,this.debug,t,e,this.textureConfig)},r.prototype.deleteMatrixTexture=function(t){var e=this;this.throwIfDisposed(),this.outputTexture===t&&(tw(this.gl,this.debug,this.framebuffer),this.outputTexture=null),Lt(this.gl,this.debug,function(){return e.gl.deleteTexture(t)})},r.prototype.uploadMatrixToTexture=function(t,e,n,a){this.throwIfDisposed();var i=qN();return fO(this.gl,this.debug,t,e,n,a,i,this.textureConfig)},r.prototype.uploadMatrixToPackedTexture=function(t,e,n,a,i,o,u){return this.throwIfDisposed(),dO(this.gl,this.debug,t,e,n,a,i,o,u,this.textureConfig)},r.prototype.downloadFloat32MatrixFromOutputTexture=function(t,e,n){var a=this;return this.downloadMatrixDriver(t,function(){return mO(a.gl,a.debug,e,n,a.textureConfig)})},r.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(t,e,n){var a=this;return this.downloadMatrixDriver(t,function(){return gO(a.gl,a.debug,e,n,a.textureConfig)})},r.prototype.downloadPackedMatrixFromBuffer=function(t,e,n,a,i,o){return yO(this.gl,t,e,n,a,i,o,this.textureConfig)},r.prototype.downloadFloat32MatrixFromBuffer=function(t,e,n){return vO(this.gl,t,e,n,this.textureConfig)},r.prototype.maybeCreateBufferFromTexture=function(t,e,n){this.bindTextureToFrameBuffer(t);var a=pO(this.gl,this.debug,t,e,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),a},r.prototype.createAndWaitForFence=function(){var t=this.createFence(this.gl);return this.pollFence(t)},r.prototype.createFence=function(t){var e,n,a=this;if(q.get("WEBGL_FENCE_API_ENABLED")){var i=t,o=i.fenceSync(i.SYNC_GPU_COMMANDS_COMPLETE,0);t.flush(),n=function(){var u=i.clientWaitSync(o,0,0);return u===i.ALREADY_SIGNALED||u===i.CONDITION_SATISFIED},e=o}else q.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(e=this.beginQuery(),this.endQuery(),n=function(){return a.isQueryAvailable(e,q.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):n=function(){return!0};return{query:e,isFencePassed:n}},r.prototype.downloadMatrixFromPackedTexture=function(t,e,n,a,i,o){var u=this;return this.downloadMatrixDriver(t,function(){return xO(u.gl,u.debug,e,n,a,i,o,u.textureConfig)})},r.prototype.createProgram=function(t){this.throwIfDisposed();var e=this.gl,n=LN(e,this.debug,t),a=eO(e,this.debug),i=WN(e,this.debug);return Lt(e,this.debug,function(){return e.attachShader(i,a)}),Lt(e,this.debug,function(){return e.attachShader(i,n)}),VN(e,this.debug,i),this.debug&&dm(e,this.debug,i),this.vertexAttrsAreBound||(this.setProgram(i),this.vertexAttrsAreBound=cO(e,this.debug,this.program,this.vertexBuffer)),i},r.prototype.deleteProgram=function(t){var e=this;this.throwIfDisposed(),t===this.program&&(this.program=null),t!=null&&Lt(this.gl,this.debug,function(){return e.gl.deleteProgram(t)})},r.prototype.setProgram=function(t){var e=this;this.throwIfDisposed(),this.program=t,this.program!=null&&this.debug&&dm(this.gl,this.debug,this.program),Lt(this.gl,this.debug,function(){return e.gl.useProgram(t)})},r.prototype.getUniformLocation=function(t,e,n){return n===void 0&&(n=!0),this.throwIfDisposed(),n?YN(this.gl,this.debug,t,e):QN(this.gl,t,e)},r.prototype.getAttributeLocation=function(t,e){var n=this;return this.throwIfDisposed(),Lt(this.gl,this.debug,function(){return n.gl.getAttribLocation(t,e)})},r.prototype.getUniformLocationNoThrow=function(t,e){return this.throwIfDisposed(),this.gl.getUniformLocation(t,e)},r.prototype.setInputMatrixTexture=function(t,e,n){this.throwIfDisposed(),this.throwIfNoProgram(),ZN(this.gl,this.debug,this.program,t,e,n)},r.prototype.setOutputMatrixTexture=function(t,e,n){this.setOutputMatrixTextureDriver(t,n,e)},r.prototype.setOutputPackedMatrixTexture=function(t,e,n){this.throwIfDisposed();var a=qu(e,n),i=a[0],o=a[1];this.setOutputMatrixTextureDriver(t,i,o)},r.prototype.setOutputMatrixWriteRegion=function(t,e,n,a){this.setOutputMatrixWriteRegionDriver(n,t,a,e)},r.prototype.setOutputPackedMatrixWriteRegion=function(t,e,n,a){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},r.prototype.debugValidate=function(){this.program!=null&&dm(this.gl,this.debug,this.program),Cf(this.gl)},r.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var t=this.gl;this.debug&&this.debugValidate(),Lt(t,this.debug,function(){return t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0)})},r.prototype.blockUntilAllProgramsCompleted=function(){var t=this;this.throwIfDisposed(),Lt(this.gl,this.debug,function(){return t.gl.finish()})},r.prototype.getQueryTimerExtension=function(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=Ef(this.gl,this.debug,q.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},r.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},r.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},r.prototype.beginQuery=function(){if(q.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var t=this.gl,e=this.getQueryTimerExtensionWebGL2(),n=t.createQuery();return t.beginQuery(e.TIME_ELAPSED_EXT,n),n}var a=this.getQueryTimerExtensionWebGL1(),i=a.createQueryEXT();return a.beginQueryEXT(a.TIME_ELAPSED_EXT,i),i},r.prototype.endQuery=function(){if(q.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")!==2){var t=this.getQueryTimerExtensionWebGL1();t.endQueryEXT(t.TIME_ELAPSED_EXT)}else{var e=this.gl,n=this.getQueryTimerExtensionWebGL2();e.endQuery(n.TIME_ELAPSED_EXT)}},r.prototype.waitForQueryAndGetTime=function(t){return Ne(this,void 0,void 0,function(){var e=this;return Oe(this,function(n){switch(n.label){case 0:return[4,L1(function(){return e.disposed||e.isQueryAvailable(t,q.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return n.sent(),[2,this.getQueryTime(t,q.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},r.prototype.getQueryTime=function(t,e){if(e===0)return null;if(e===2){var n=this.gl;return n.getQueryParameter(t,n.QUERY_RESULT)/1e6}var a=this.getQueryTimerExtensionWebGL1();return a.getQueryObjectEXT(t,a.QUERY_RESULT_EXT)/1e6},r.prototype.isQueryAvailable=function(t,e){if(e===0)return!0;if(e===2){var n=this.gl,a=this.getQueryTimerExtensionWebGL2(),i=n.getQueryParameter(t,n.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(a.GPU_DISJOINT_EXT)),i&&!this.disjoint}return i=(a=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(t,a.QUERY_RESULT_AVAILABLE_EXT),this.disjoint==null&&(this.disjoint=this.gl.getParameter(a.GPU_DISJOINT_EXT)),i&&!this.disjoint},r.prototype.pollFence=function(t){var e=this;return new Promise(function(n){e.addItemToPoll(function(){return t.isFencePassed()},function(){return n()})})},r.prototype.pollItems=function(){for(var t=wO(this.itemsToPoll.map(function(n){return n.isDoneFn})),e=0;e<=t;++e)(0,this.itemsToPoll[e].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(t+1)},r.prototype.addItemToPoll=function(t,e){var n=this;this.itemsToPoll.push({isDoneFn:t,resolveFn:e}),this.itemsToPoll.length>1||L1(function(){return n.pollItems(),n.itemsToPoll.length===0})},r.prototype.bindTextureToFrameBuffer=function(t){this.throwIfDisposed(),pm(this.gl,this.debug,t,this.framebuffer),this.debug&&Cf(this.gl)},r.prototype.unbindTextureToFrameBuffer=function(){this.outputTexture!=null?(pm(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&Cf(this.gl)):tw(this.gl,this.debug,this.framebuffer)},r.prototype.downloadMatrixDriver=function(t,e){this.bindTextureToFrameBuffer(t);var n=e();return this.unbindTextureToFrameBuffer(),n},r.prototype.setOutputMatrixTextureDriver=function(t,e,n){this.throwIfDisposed();var a=this.gl;pm(a,this.debug,t,this.framebuffer),this.debug&&Cf(a),this.outputTexture=t,Lt(a,this.debug,function(){return a.viewport(0,0,e,n)}),Lt(a,this.debug,function(){return a.scissor(0,0,e,n)})},r.prototype.setOutputMatrixWriteRegionDriver=function(t,e,n,a){var i=this;this.throwIfDisposed(),Lt(this.gl,this.debug,function(){return i.gl.scissor(t,e,n,a)})},r.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},r.prototype.throwIfNoProgram=function(){if(this.program==null)throw new Error("No GPU program is currently set.")},r})();function wO(r){for(var t=0;t<r.length&&r[t]();++t);return t-1}function EO(r,t,e,n){var a=t.userCode,i=e.map(function(b,E){var C={logicalShape:b.shape,texShape:b.isUniform?null:b.texData.texShape,isUniform:b.isUniform,isPacked:!b.isUniform&&b.texData.isPacked,flatOffset:null};return b.texData!=null&&b.texData.slice!=null&&b.texData.slice.flatOffset>0&&(C.flatOffset=b.texData.slice.flatOffset),{name:t.variableNames[E],shapeInfo:C}}),o=i.map(function(b){return b.shapeInfo}),u={logicalShape:n.shape,texShape:n.texData.texShape,isUniform:!1,isPacked:n.texData.isPacked,flatOffset:null},l=zD(i,u,a,t.usesPackedTextures),h=r.createProgram(l),f=null,p=null;q.get("WEBGL_VERSION")===1&&(f=r.getUniformLocation(h,"INFINITY",!1),p=r.getUniformLocation(h,"NAN",!1));for(var v={},m=0;m<t.variableNames.length;m++){var x=t.variableNames[m];v[x]=r.getUniformLocation(h,x,!1),v["offset"+x]=r.getUniformLocation(h,"offset"+x,!1)}return{program:t,source:l,webGLProgram:h,uniformLocations:v,inShapeInfos:o,outShapeInfo:u,infLoc:f,nanLoc:p}}function ew(r,t){if(r.length!==t.length)throw Error("Binary was compiled with "+r.length+" inputs, but was executed with "+t.length+" inputs");r.forEach(function(e,n){var a=e.logicalShape,i=t[n],o=i.shape;if(!pr(a,o))throw Error("Binary was compiled with different shapes than the current args. Shapes "+a+" and "+o+" must match");if(!e.isUniform||!i.isUniform){var u=e.texShape,l=i.isUniform?null:i.texData.texShape;if(!pr(u,l))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+u+" and "+l+" must match")}})}function CO(r,t,e,n,a){ew(t.inShapeInfos,e),ew([t.outShapeInfo],[n]);var i=n.texData.texture,o=n.texData.texShape;n.texData.isPacked?r.setOutputPackedMatrixTexture(i,o[0],o[1]):r.setOutputMatrixTexture(i,o[0],o[1]),r.setProgram(t.webGLProgram),q.get("WEBGL_VERSION")===1&&(t.infLoc!==null&&r.gl.uniform1f(t.infLoc,1/0),t.nanLoc!==null&&r.gl.uniform1f(t.nanLoc,NaN)),e.forEach(function(u,l){var h=t.program.variableNames[l],f=t.uniformLocations[h],p=t.uniformLocations["offset"+h];if(f!=null)if(u.isUniform)if(qt(u.shape)<2)r.gl.uniform1f(f,u.uniformValues[0]);else{var v=u.uniformValues;v instanceof Float32Array||(v=new Float32Array(v)),r.gl.uniform1fv(f,v)}else u.texData.slice!=null&&p!=null&&r.gl.uniform1i(p,u.texData.slice.flatOffset),r.setInputMatrixTexture(u.texData.texture,f,l)}),a?.(r,t.webGLProgram),r.executeProgram()}function SO(r,t,e){var n="";t.concat(e).forEach(function(o){var u=o.texData!=null&&o.texData.slice!=null&&o.texData.slice.flatOffset>0,l=o.isUniform?"uniform":o.texData.texShape;n+=o.shape+"_"+l+"_"+u});var a=r.userCode,i=r.constructor.name;return i+="_"+n+"_"+a}var RO=(function(){return function(r,t,e){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=r;var n=e.filterWidth,a=e.inChannels,i=e.strideWidth,o=e.strideHeight,u=e.padInfo,l=e.outWidth,h=e.dilationWidth,f=e.dilationHeight,p=u.left,v=u.top,m=a*n,x=Ei();this.userCode=`
      void main() {
        ivec2 rc = getOutputCoords();

        vec4 result = vec4(0);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            int blockIndex = rc.y + col;
            int pos = rc.x + row;

            if(blockIndex >= `+r[1]+" || pos >= "+r[0]+`) continue;

            int offsetY = int(blockIndex / (`+l+")) * "+o+" - "+v+`;
            int d0 = offsetY + `+f+" * (pos / "+m+`);

            if(d0 >= `+t[0]+` || d0 < 0) continue;

            int offsetX = int(mod(float(blockIndex), `+l+".) * "+i+". - "+p+`.);
            int d1 = offsetX + `+h+" * (int(mod(float(pos), "+m+".) / "+a+`.));

            if(d1 >= `+t[1]+` || d1 < 0) continue;

            vec2 innerDims = vec2(d1, int(mod(float(pos), `+a+`.)));
            result[row * 2 + col] = getChannel(getA(d0, int(innerDims.x),
                                              int(innerDims.y)), innerDims);
          }
        }

        `+x.output+` = result;
      }
    `}})(),_O=(function(){return function(r,t,e,n,a){this.variableNames=["x"],this.outputShape=[];var i,o=t,u=r[3]-1;this.outputShape=r;var l="float("+e+") + float("+n+") * sum";i=a===.5?"inversesqrt("+l+")":a===1?"1.0/("+l+")":"exp(log("+l+") * float(-"+a+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -`+o+"; j <= "+o+`; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  `+u+`) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * `+i+`;
        setOutput(val);
      }
    `}})(),AO=(function(){return function(r,t,e,n,a){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=r,this.depth=r[3],this.depthRadius=t,this.bias=e,this.alpha=n,this.beta=a,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < `+this.depth+`; ++d) {
          int depthBegin = int(max(0.0, float(d - `+t+`)));
          int depthEnd = int(min(float(`+this.depth+`),
              float(d + `+t+` + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = `+this.depth+`;

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(`+n+") * norm + float("+e+`);

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(`+n+`)
                * float(`+a+`)
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * `+a+`);
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}})(),TO=(function(){return function(r){this.variableNames=["dy","maxPos"],this.outputShape=r.inShape;var t=r.strideHeight,e=r.strideWidth,n=r.dilationHeight,a=r.effectiveFilterHeight,i=r.effectiveFilterWidth,o=a-1-r.padInfo.top,u=i-1-r.padInfo.left,l=a*i-1;this.userCode=`
      const ivec2 pads = ivec2(`+o+", "+u+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+a+`;
          wR += `+n+`) {
          float dyR = float(dyRCorner + wR) / `+t+`.0;

          if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+i+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+e+`.0;

            if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = `+l+` - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * `+i+` + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}})(),vm=(function(){return function(r,t,e,n,a,i){e===void 0&&(e=!1),n===void 0&&(n=!1),a===void 0&&(a=!1),i===void 0&&(i=null),this.variableNames=["matrixA","matrixB"],this.usesPackedTextures=!0,this.outputShape=t;var o=e?r[1]:r[2],u=Math.ceil(o/2),l=e?"i * 2, rc.y":"rc.y, i * 2",h=n?"rc.z, i * 2":"i * 2, rc.z",f=e?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],p=n?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],v="",m="";i&&(v=`vec4 activation(vec4 x) {
        `+i+`
      }`,m="result = activation(result);");var x=a?"result += getBiasAtOutCoords();":"";a&&this.variableNames.push("bias"),this.userCode=`
      `+v+`

      const float sharedDimension = `+u+`.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < `+u+`; i++) {
          vec4 a = getMatrixA(rc.x, `+l+`);
          vec4 b = getMatrixB(rc.x, `+h+`);

          result += (`+f[0]+" * "+p[0]+") + ("+f[1]+" * "+p[1]+`);
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        `+x+`

        `+m+`

        setOutput(result);
      }
    `}})(),kO=(function(){function r(t,e,n){this.variableNames=["probs"],this.outputShape=[t,n],this.userCode=`
      uniform float seed;

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < `+(e-1)+`; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(`+(e-1)+`));
      }
    `}return r.prototype.getCustomSetupFunc=function(t){var e=this;return function(n,a){e.seedLoc==null&&(e.seedLoc=n.getUniformLocation(a,"seed")),n.gl.uniform1f(e.seedLoc,t)}},r})(),DO=(function(){return function(r,t,e,n){this.variableNames=["indices"],this.outputShape=[r,t],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(`+n+"), float("+e+`),
                      float(index == coords.y)));
      }
    `}})(),IO=(function(){return function(r){this.variableNames=["A"],this.isPackShader=!0,this.outputShape=r;var t=r.length;if(t===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{var e=Xr("rc",t),n=Ve(t),a=OO(t,r,e),i=MO(t,r[r.length-1],r[r.length-2],e),o=BO(r,e);this.userCode=`
        void main() {
          `+n+` rc = getOutputCoords();

          if(`+a+`) {
            setOutput(vec4(0));
          } else {
            `+i+`

            setOutput(vec4(`+o+`));
          }
        }
      `}}})();function NO(r,t){for(var e=[],n=0;n<=1;n++)for(var a=0;a<=1;a++){for(var i=(n===0?"r":"rp1")+", "+(a===0?"c":"cp1"),o=2;o<r;o++)i=t[t.length-1-o]+","+i;e.push(i)}return e}function OO(r,t,e){if(r===1)return"rc > "+t[0];for(var n="",a=r-2;a<r;a++)n+=e[a]+" >= "+t[a],a<r-1&&(n+="||");return n}function MO(r,t,e,n){if(r===1)return"";var a=n.slice(-2);return`
    int r = `+a[0]+`;
    int c = `+a[1]+`;
    int rp1 = r + 1;
    int cp1 = c + 1;

    bool cEdge = cp1 >= `+t+`;
    bool rEdge = rp1 >= `+e+`;
  `}function BO(r,t){var e=r.length,n=NO(e,t);return e===1?`getA(rc),
            rc + 1 >= `+r[0]+` ? 0. : getA(rc + 1),
            0, 0`:"getA("+n[0]+`),
          cEdge ? 0. : getA(`+n[1]+`),
          rEdge ? 0. : getA(`+n[2]+`),
          rEdge || cEdge ? 0. : getA(`+n[3]+")"}var PO=(function(){return function(r,t,e){this.variableNames=["x"],this.outputShape=t.map(function(l,h){return l[0]+r[h]+l[1]});var n=r.length,a=Ve(n),i=t.map(function(l){return l[0]}).join(","),o=t.map(function(l,h){return l[0]+r[h]}).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,n);this.userCode=n!==1?`
      `+a+" start = "+a+"("+i+`);
      `+a+" end = "+a+"("+o+`);

      void main() {
        `+a+` outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(float(`+e+`));
        } else {
          `+a+` coords = outC - start;
          setOutput(getX(`+u+`));
        }
      }
    `:`
        int start = `+i+`;
        int end = `+o+`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(float(`+e+`));
          } else {
            setOutput(getX(outC - start));
          }
        }
      `}})(),FO=(function(){return function(r,t,e){this.variableNames=["x"],this.usesPackedTextures=!0,this.outputShape=t.map(function(E,C){return E[0]+r[C]+E[1]});for(var n=r.length,a=Ve(n),i=t.map(function(E){return E[0]}).join(","),o=t.map(function(E,C){return E[0]+r[C]}).join(","),u=Xr("rc",n),l=Xr("source",n),h=u[n-1]+" < "+this.outputShape[n-1],f=n===1?"source":"vec2("+l.slice(-2).join()+")",p=[a+" rc = outputLoc;",u[n-1]+` += 1;
       if(`+h+`) {
      `,n===1?"":`}
       rc = outputLoc;
       `+u[n-2]+` += 1;
       if(`+u[n-2]+" < "+this.outputShape[n-2]+") {",n===1?"":"  "+u[n-1]+` += 1;
         if(`+h+") {"],v=n===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",m="",x=0,b=n===1?2:4;x<b;x++)m+=`
        `+p[x]+`
        if (`+v+`) {
          result[`+x+"] = float("+e+`);
        } else {
          `+a+` source = rc - start;
          result[`+x+"] = getChannel(getX("+l.join()+"), "+f+`);
        }
      `;m+=n===1?"} ":"}}",this.userCode=`
      const `+a+" start = "+a+"("+i+`);
      const `+a+" end = "+a+"("+o+`);

      void main() {
        `+a+` outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        `+m+`
        setOutput(result);
      }
    `}})(),mm=(function(){return function(r,t,e){if(this.variableNames=["x"],t==="avg"&&e)throw new Error("Cannot compute positions for average pool.");var n=r.filterWidth,a=r.strideHeight,i=r.strideWidth,o=r.dilationHeight,u=r.dilationWidth,l=r.effectiveFilterHeight,h=r.effectiveFilterWidth,f=r.padInfo.top,p=r.padInfo.left;this.outputShape=r.outShape;var v=t==="avg",m="0.0";if(v||(m="-1.0 / 1e-20"),e)this.userCode=`
        const ivec2 strides = ivec2(`+a+", "+i+`);
        const ivec2 pads = ivec2(`+f+", "+p+`);

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < `+l+`;
              wR += `+o+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+r.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+h+`;
                wC += `+u+`) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= `+r.inWidth+`) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value >= currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = wR * `+h+` + wC;
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var x=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";t==="avg"&&(x="avgValue / count");var b=4*Math.floor(n/4),E=n%4,C=`
      if (`+v+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(`+a+", "+i+`);
      const ivec2 pads = ivec2(`+f+", "+p+`);
      const float initializationValue = `+m+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= `+r.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+m+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < `+l+`;
            wR += `+o+`) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= `+r.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+b+`; wC += 4) {
            int xC = xCCorner + wC * `+u+`;

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+u+`, d),
              getValue(batch, xR, xC + 2 * `+u+`, d),
              getValue(batch, xR, xC + 3 * `+u+`, d)
            );

            `+C+`
          }

          int xC = xCCorner + `+b+`;
          if (`+(E===1)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            `+C+`
          } else if (`+(E===2)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+u+`, d),
              initializationValue,
              initializationValue
            );

            `+C+`
          } else if (`+(E===3)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+u+`, d),
              getValue(batch, xR, xC + 2 * `+u+`, d),
              initializationValue
            );

            `+C+`
          }
        }
        setOutput(`+x+`);
      }
    `}}})(),LO=(function(){return function(r,t){this.variableNames=["x"];var e=r.windowSize,n=r.batchSize,a=r.inSize,i=Math.ceil(a/e);this.outputShape=[n,i];var o="0.0",u="";t==="prod"?o="1.0":t==="min"?(o="1.0 / 1e-20",u="min"):t==="max"&&(o="-1.0 / 1e-20",u="max");var l=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";t==="sum"?l="sumValue":t==="prod"?l="prodValue":t==="all"?l="allValue":t==="any"&&(l="anyValue");var h=4*Math.floor(e/4),f=e%4,p=`
      if (`+(t==="sum")+`) {
        sumValue += dot(values, ones);
      } else if (`+(t==="prod")+`) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = `+u+`(values, minMaxValue);
      }
    `,v="vec4";t==="all"?(o="1.0",p=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,v="bvec4"):t==="any"&&(o="0.0",p=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,v="bvec4");var m="";a%e>0&&(m=`
        if (inIdx < 0 || inIdx >= `+a+`) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = `+o+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `+m+`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+e+`;

        vec4 minMaxValue = vec4(`+o+`);
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < `+h+`; i += 4) {
          int inIdx = inOffset + i;
          `+v+" values = "+v+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `+p+`
        }

        int inIdx = inOffset + `+h+`;
        if (`+(f===1)+`) {
          `+v+" values = "+v+`(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          `+p+`
        } else if (`+(f===2)+`) {
          `+v+" values = "+v+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          `+p+`
        } else if (`+(f===3)+`) {
          `+v+" values = "+v+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          `+p+`
        }
        setOutput(`+l+`);
      }
    `}})(),zO=(function(){return function(r,t){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=r;for(var e="",n=0;n<4;n++){var a="thisRC = rc;";n%2==1&&(a+="thisRC.z += 1;"),n>1&&(a+="thisRC.y += 1;"),e+=`
        `+a+`
        `+(n>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+`
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[`+n+`] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        `+(n>0?"}":"")+`
      `}this.userCode=`
      `+WO(t)+`
      `+UO(r)+`

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = `+r[1]+`;
        int cols = `+r[2]+`;

        `+e+`

        setOutput(result);
      }
    `}})();function UO(r){return`
    int getFlatIndex(ivec3 coords) {
      return round(`+LD(["coords.x","coords.y","coords.z"],Gu(r).map(function(t){return t.toString()}).concat(["1."]))+`);
    }
  `}function WO(r){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      `+Gc(["r","c","d"],r)+`
      return ivec3(r, c, d);
    }
  `}var VO=(function(){return function(r,t,e){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var n=t.shape,a=n[1],i=n[2],o=r.shape,u=o[1],l=o[2],h=[e&&u>1?a-1:a,e&&l>1?i-1:i],f=[e&&u>1?u-1:u,e&&l>1?l-1:l],p=h[0]/f[0],v=h[1]/f[1],m=1/p,x=1/v,b=2*Math.ceil(m)+2,E=2*Math.ceil(x)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+p+`);
        const float widthScale = float(`+v+`);

        const float invHeightScale = float(`+m+`);
        const float invWidthScale = float(`+x+`);

        const int winHeight = int(`+b+`);
        const int winWidth = int(`+E+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+u+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+l+`) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), `+(a-1)+`.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), `+(i-1)+`.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}})(),GO=(function(){return function(r,t,e,n){this.variableNames=["A"],this.outputShape=[];var a=r[0],i=r[1],o=r[2],u=r[3];this.outputShape=[a,t,e,u];var l=[n&&t>1?i-1:i,n&&e>1?o-1:o],h=[n&&t>1?t-1:t,n&&e>1?e-1:e];this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+l[0]/h[0]+`,
          `+l[1]/h[1]+`);
      const vec2 inputShapeRC = vec2(`+i+".0, "+o+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}})(),HO=(function(){return function(r,t,e,n){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=[];var a=r[0],i=r[1],o=r[2],u=r[3];this.outputShape=[a,t,e,u];var l=[n&&t>1?i-1:i,n&&e>1?o-1:o],h=[n&&t>1?t-1:t,n&&e>1?e-1:e];this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          `+l[0]/h[0]+`,
          `+l[1]/h[1]+`,
          `+l[1]/h[1]+`);
      const vec3 inputShapeRC = vec3(`+i+".0, "+o+`.0,
                                     `+o+`.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));
        
        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < `+(u-1)+`; 
        bool hasNextRow = coords.z < `+(e-1)+`;

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}})(),qO=(function(){return function(r,t,e){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var n=t.shape,a=n[1],i=n[2],o=r.shape,u=o[1],l=o[2],h=[e&&u>1?a-1:a,e&&l>1?i-1:i],f=[e&&u>1?u-1:u,e&&l>1?l-1:l],p=h[0]/f[0],v=h[1]/f[1],m=1/p,x=1/v,b=2*Math.ceil(m)+2,E=2*Math.ceil(x)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+p+`);
        const float widthScale = float(`+v+`);

        const float invHeightScale = float(`+m+`);
        const float invWidthScale = float(`+x+`);

        const int winHeight = int(`+b+`);
        const int winWidth = int(`+E+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+u+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+l+`) {
              continue;
            }

            float sourceFracRow =
              float(`+h[0]+`) *
                (float(dyR) / float(`+f[0]+`));

            float sourceFracCol =
                float(`+h[1]+`) *
                  (float(dyC) / float(`+f[1]+`));

            int sourceNearestRow = int(min(
                float(int(`+a+`) - 1),
                `+e+` ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(`+i+`) - 1),
                `+e+` ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}})(),jO=(function(){return function(r,t,e,n){this.variableNames=["A"],this.outputShape=[];var a=r[0],i=r[1],o=r[2],u=r[3];this.outputShape=[a,t,e,u];var l=[n&&t>1?i-1:i,n&&e>1?o-1:o],h=[n&&t>1?t-1:t,n&&e>1?e-1:e],f=n?"0.5":"0.0";this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+l[0]/h[0]+`,
          `+l[1]/h[1]+`);
      const vec2 inputShapeRC = vec2(`+i+".0, "+o+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `+f+`)));

        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}})(),XO=(function(){return function(r,t){this.variableNames=["x"];var e=r.length;if(e>4)throw new Error("WebGL backend: Reverse of rank-"+e+" tensor is not yet supported");if(this.outputShape=r,e!==1){var n=r.map(function(i,o){return(function(u){return t.indexOf(u)!==-1&&r[u]!==1?r[u]+" - coords["+u+"] - 1":"coords["+u+"]"})(o)}).join(","),a=Ve(e);this.userCode=`
      void main() {
        `+a+` coords = getOutputCoords();
        setOutput(getX(`+n+`));
      }
    `}else this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(`+r[0]+` - coord - 1));
        }
      `}})(),KO=(function(){return function(r,t){this.variableNames=["x"],this.usesPackedTextures=!0;var e=r.length;if(e>4)throw new Error("WebGL backend: Reverse of rank-"+e+" tensor is not yet supported");this.outputShape=r;var n=Xr("rc",e),a=n[e-1]+" + 1 < "+this.outputShape[e-1],i=n[e-2]+" + 1 < "+this.outputShape[e-2],o=Ve(e);function u(l){var h=r.map(function(f,p){return(function(v,m){return t.indexOf(v)!==-1&&r[v]!==1?r[v]+" - "+m[v]+" - 1":""+m[v]})(p,l)});return"getChannel(getX("+h.join(",")+"), vec2("+h.slice(-2).join(",")+"))"}this.userCode=e===1?`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(`+r[0]+` - rc - 1), rc);
          if(`+a+`){
              result.g = getChannel(getX(`+r[0]+` - (rc  + 1) - 1), rc + 1);
          }
          setOutput(result);
        }
      `:`
        void main() {
          `+o+` rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = `+(function(l){return u(l)})(n.slice())+`;
          if(`+a+`){
            result.g = `+(function(l){return l[e-1]="("+l[e-1]+" + 1)",u(l)})(n.slice())+`;
          }
          if(`+i+`) {
            result.b = `+(function(l){return l[e-2]="("+l[e-2]+" + 1)",u(l)})(n.slice())+`;
            if(`+a+`) {
              result.a = `+(function(l){return l[e-1]="("+l[e-1]+" + 1)",l[e-2]="("+l[e-2]+" + 1)",u(l)})(n.slice())+`;
            }
          }
          setOutput(result);
        }
    `}})(),nw=(function(){return function(r,t,e,n,a,i,o){this.variableNames=["updates","indices","defaultValue"],this.outputShape=i;var u=Ve(a.length),l=Ve(i.length),h="";e===1?h="i":e===2&&(h="i, j");var f="getIndices("+h+")",p="";n===1?p="i":n===2&&(p="i, coords[1]");var v="getUpdates("+p+")",m=t>1?"strides[j]":"strides";this.userCode=`
        `+u+" strides = "+u+"("+a+`);

        void main() {
          `+l+` coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < `+r+`; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < `+t+`; j++) {
              int index = round(`+f+`);
              flattenedIndex += index * `+m+`;
            }
            if (flattenedIndex == coords[0]) {
              sum += `+v+`;
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `}})(),YO=(function(){return function(r,t){this.variableNames=["x","segmentIds"];var e=r.windowSize,n=r.batchSize,a=r.inSize,i=r.numSegments,o=i*Math.ceil(a/e);this.outputShape=[n,o];var u=4*Math.floor(e/4),l=e%4,h=`
        sumValue += dot(values, segFilter);
    `,f="";a%e>0&&(f=`
        if (inIdx < 0 || inIdx >= `+a+`) {
          return initializationValue;
        }
      `);var p="";a%e>0&&(p=`
        if (inIdx < 0 || inIdx >= `+a+`) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = 0.0;

      float getValue(int batch, int inIdx) {
        `+f+`
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        `+p+`
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          `+i+")) * float("+e+`));
        int currentSeg = int(mod(float(outIdx), float(`+i+`)));

        float sumValue = 0.0;

        for (int i = 0; i < `+u+`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          `+h+`
        }

        int inIdx = inOffset + `+u+`;
        if (`+(l===1)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          `+h+`
        } else if (`+(l===2)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          `+h+`
        } else if (`+(l===3)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          `+h+`
        }
        setOutput(sumValue);
      }
    `}})(),QO=(function(){return function(r,t,e){var n,a;if(this.variableNames=["c","a","b"],this.outputShape=t,e>4)throw Error("Where for rank "+e+" is not yet supported");if(e===1)a="resRC",n="resRC";else{for(var i=["resRC.x","resRC.y","resRC.z","resRC.w"],o=[],u=[],l=0;l<t.length;l++)u.push(""+i[l]),l<r&&o.push(""+i[l]);n=o.join(),a=u.join()}var h=Ve(e);this.userCode=`
      void main() {
        `+h+` resRC = getOutputCoords();
        float cVal = getC(`+n+`);
        if (cVal >= 1.0) {
          setOutput(getA(`+a+`));
        } else {
          setOutput(getB(`+a+`));
        }
      }
    `}})(),ZO=(function(){function r(t){this.variableNames=["source"],this.outputShape=t,this.rank=t.length;var e,n=Ve(this.rank),a="uniform int start["+this.rank+"];",i=$O(this.rank);e=`
        `+n+` sourceLoc;
        `+n+` coords = getOutputCoords();
        `+t.map(function(o,u){return"sourceLoc."+ag[u]+" = start["+u+"] + coords."+ag[u]+";"}).join(`
`)+`
      `,this.userCode=`
      `+a+`
      void main() {
        `+e+`
        setOutput(getSource(`+i+`));
      }
    `}return r.prototype.getCustomSetupFunc=function(t){var e=this;if(t.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+t.length+")");return function(n,a){e.startLoc==null&&(e.startLoc=n.getUniformLocationNoThrow(a,"start"),e.startLoc==null)||n.gl.uniform1iv(e.startLoc,t)}},r})(),ag=["x","y","z","w","u","v"];function $O(r){if(r===1)return"sourceLoc";if(r<=6)return ag.slice(0,r).map(function(t){return"sourceLoc."+t}).join(",");throw Error("Slicing for rank "+r+" is not yet supported")}var JO=(function(){function r(t){this.variableNames=["source"],this.usesPackedTextures=!0,this.outputShape=t,this.rank=t.length;var e=Ve(this.rank),n=Xr("coords",this.rank),a=Xr("sourceLoc",this.rank),i=this.rank===1?"sourceLoc":"vec2("+a.slice(-2).join()+")",o="getChannel(getSource("+a.join()+"), "+i+")",u=`
      result.x = `+o+`;
      if (++`+n[this.rank-1]+" < "+t[this.rank-1]+`) {
        ++`+a[this.rank-1]+`;
        result.y = `+o+`;
        --`+a[this.rank-1]+`;
      }
    `,l=this.rank===1?"":`
      --`+n[this.rank-1]+`;
      if (++`+n[this.rank-2]+" < "+t[this.rank-2]+`) {
        ++`+a[this.rank-2]+`;
        result.z = `+o+`;
        if (++`+n[this.rank-1]+" < "+t[this.rank-1]+`) {
          ++`+a[this.rank-1]+`;
          result.w = `+o+`;
        }
      }
    `,h=this.rank<=4?`sourceLoc = coords +
            `+e+"("+t.map(function(f,p){return"start["+p+"]"}).join()+");":t.map(function(f,p){return a[p]+" = "+n[p]+" + start["+p+"];"}).join(`
`);this.userCode=`
      uniform int start[`+this.rank+`];
      void main() {
        `+e+` coords = getOutputCoords();
        `+e+` sourceLoc;
        `+h+` 
        vec4 result = vec4(0.);
        `+u+`
        `+l+`
        setOutput(result);
      }
    `}return r.prototype.getCustomSetupFunc=function(t){var e=this;if(t.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+t.length+")");return function(n,a){e.startLoc==null&&(e.startLoc=n.getUniformLocationNoThrow(a,"start"),e.startLoc==null)||n.gl.uniform1iv(e.startLoc,t)}},r})(),tM=(function(){return function(r,t,e,n){this.variableNames=["x"];var a=e.filter(function(f,p){return n.indexOf(p)===-1});this.outputShape=a;var i=e.length,o=Ve(e.length),u=Ve(a.length),l="";if(i===1)l="coords * strides + begin";else{var h=0;l=e.map(function(f,p){return n.indexOf(p)===-1?(h++,a.length===1?"coords * strides["+p+"] + begin["+p+"]":"coords["+(h-1)+"] * strides["+p+"] + begin["+p+"]"):"begin["+p+"]"}).join(",")}this.userCode=`
      `+o+" begin = "+o+"("+r+`);
      `+o+" strides = "+o+"("+t+`);

      void main() {
        `+u+` coords = getOutputCoords();
        setOutput(getX(`+l+`));
      }
    `}})(),eM=(function(){function r(t){this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return r.prototype.acquireTexture=function(t,e,n){var a,i=rw(e,n),o=aw(t,i,n);if(o in this.freeTextures||(this.freeTextures[o]=[]),o in this.usedTextures||(this.usedTextures[o]=[]),this.freeTextures[o].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var u=this.freeTextures[o].shift();return this.usedTextures[o].push(u),u}return this.numUsedTextures++,this.log(),i===Cr.PACKED_2X2_FLOAT32?a=this.gpgpu.createPackedMatrixTexture(t[0],t[1]):i===Cr.PACKED_2X2_FLOAT16?a=this.gpgpu.createFloat16PackedMatrixTexture(t[0],t[1]):i===Cr.UNPACKED_FLOAT32?a=this.gpgpu.createFloat32MatrixTexture(t[0],t[1]):i===Cr.UNPACKED_FLOAT16?a=this.gpgpu.createFloat16MatrixTexture(t[0],t[1]):i===Cr.PACKED_4X1_UNSIGNED_BYTE&&(a=this.gpgpu.createUnsignedBytesMatrixTexture(t[0],t[1])),this.usedTextures[o].push(a),a},r.prototype.releaseTexture=function(t,e,n,a){if(this.freeTextures!=null){var i=aw(e,rw(n,a),a);i in this.freeTextures||(this.freeTextures[i]=[]),this.freeTextures[i].push(t),this.numFreeTextures++,this.numUsedTextures--;var o=this.usedTextures[i],u=o.indexOf(t);if(u<0)throw new Error("Cannot release a texture that was never provided by this texture manager");o.splice(u,1),this.log()}},r.prototype.log=function(){if(this.logEnabled){var t=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+t+")")}},r.prototype.getNumUsedTextures=function(){return this.numUsedTextures},r.prototype.getNumFreeTextures=function(){return this.numFreeTextures},r.prototype.dispose=function(){var t=this;if(this.freeTextures!=null){for(var e in this.freeTextures)this.freeTextures[e].forEach(function(n){t.gpgpu.deleteMatrixTexture(n)});for(var e in this.usedTextures)this.usedTextures[e].forEach(function(a){t.gpgpu.deleteMatrixTexture(a)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},r})();function rw(r,t){if(r===fi.UPLOAD)return t?Cr.PACKED_2X2_FLOAT32:Cr.UNPACKED_FLOAT32;if(r===fi.RENDER||r==null)return t?q.get("WEBGL_RENDER_FLOAT32_ENABLED")?Cr.PACKED_2X2_FLOAT32:Cr.PACKED_2X2_FLOAT16:q.get("WEBGL_RENDER_FLOAT32_ENABLED")?Cr.UNPACKED_FLOAT32:Cr.UNPACKED_FLOAT16;if(r===fi.DOWNLOAD||r===fi.PIXELS)return Cr.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+r)}function aw(r,t,e){return r[0]+"_"+r[1]+"_"+t+"_"+e}var nM=(function(){return function(r,t){this.variableNames=["A"];for(var e=new Array(r.length),n=0;n<e.length;n++)e[n]=r[n]*t[n];this.outputShape=e,this.rank=e.length;var a=Ve(this.rank),i=rM(r);this.userCode=`
      void main() {
        `+a+` resRC = getOutputCoords();
        setOutput(getA(`+i+`));
      }
    `}})();function rM(r){var t=r.length;if(t>5)throw Error("Tile for rank "+t+" is not yet supported");if(t===1)return"imod(resRC, "+r[0]+")";for(var e=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],n=[],a=0;a<r.length;a++)n.push("imod("+e[a]+", "+r[a]+")");return n.join()}var aM=(function(){return function(r,t){this.variableNames=["A"];for(var e=new Array(r.length),n=0;n<e.length;n++)e[n]=r[t[n]];this.outputShape=e,this.rank=e.length;var a=Ve(this.rank),i=iM(t);this.userCode=`
    void main() {
      `+a+` resRC = getOutputCoords();
      setOutput(getA(`+i+`));
    }
    `}})();function iM(r){var t=r.length;if(t>6)throw Error("Transpose for rank "+t+" is not yet supported");for(var e=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],n=new Array(t),a=0;a<r.length;a++)n[r[a]]=e[a];return n.join()}var oM=(function(){return function(r,t){this.variableNames=["A"],this.usesPackedTextures=!0;for(var e=new Array(r.length),n=0;n<e.length;n++)e[n]=r[t[n]];if(this.outputShape=e,this.rank=e.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var a=Ve(this.rank),i=hC("rc",this.rank),o=new Array(this.rank);for(n=0;n<t.length;n++)o[t[n]]=i[n];var u="vec2("+o.slice(-2).join()+")",l="++"+i[this.rank-1]+" < "+e[this.rank-1],h="getChannel(getA("+o.join()+"), "+u+")";this.userCode=`
    void main() {
      `+a+` rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = `+h+`;
      if(`+l+`) {
        result[1] = `+h+`;
      }
      --`+i[this.rank-1]+`;
      if(++`+i[this.rank-2]+" < "+e[this.rank-2]+`) {
        result[2] = `+h+`;
        if(`+l+`) {
          result[3] = `+h+`;
        }
      }  
      setOutput(result);
    }
    `}})(),yC=.3275911,xC=.254829592,bC=-.284496736,wC=1.421413741,EC=-1.453152027,CC=1.061405429,Vg=1.7580993408473768,Gg=1.0507009873554805,ae=(function(){return function(r,t){this.variableNames=["A"],this.outputShape=r,this.userCode=`
      float unaryOperation(float x) {
        `+t+`
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}})(),ju="if (isnan(x)) return x;",uM="return x;",sM="return abs(x);",SC=ju+`
  return (x < 0.0) ? 0.0 : x;
`,lM="return (x >= 0.0) ? x : (exp(x) - 1.0);",cM=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = `+Vg+`;
  float scale = `+Gg+`;
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`;function hM(r){return r===void 0&&(r=0),ju+`
    return x > 0.0 ? 1.0 : float(`+r+`);
  `}var fM="return -x;",dM="return ceil(x);",pM="return floor(x);",vM=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,mM="return float(isnan(x));",gM="return float(isinf(x));",yM="return float(!isnan(x) && !isinf(x));",xM=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,iw="return exp(x);",bM="return exp(x) - 1.0;",wM=`if (x < 0.0) return NAN;
  return log(x);`,EM="return log(1.0 + x);",CM="return sqrt(x);",SM="return inversesqrt(x);",RM="return 1.0 / (1.0 + exp(-1.0 * x));",_M=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,AM=ju+`
  return sin(x);
`,TM=ju+`
  return cos(x);
`,kM="return tan(x);",DM="return asin(x);",IM="return acos(x);",NM=ju+`
  return atan(x);
`,OM=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,MM=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,BM=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,PM="return log(x + sqrt(x * x + 1.0));",FM=ju+`
  if (x < 1.0) return NAN;
  return log(x + sqrt(x * x - 1.0));`,LM=ju+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
  return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,zM=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = `+yC+`;
  float a1 = `+xC+`;
  float a2 = `+bC+`;
  float a3 = `+wC+`;
  float a4 = `+EC+`;
  float a5 = `+CC+`;

  float t = 1.0 / (1.0 + p * x);
  return 1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x);
`,UM="return x * x;",WM="return 1.0 / x;",VM="return float(!(x >= 1.0));",GM="return float(int(x));",ow="return x;",HM="return x;",qM=`
  vec4 result = log(x);
  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));
  result.r = isNaN.r == 1.0 ? NAN : result.r;
  result.g = isNaN.g == 1.0 ? NAN : result.g;
  result.b = isNaN.b == 1.0 ? NAN : result.b;
  result.a = isNaN.a == 1.0 ? NAN : result.a;

  return result;
`,RC=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,gm=(function(){return function(r,t){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=r,this.userCode=`
      vec4 unaryOperation(vec4 x) {
        `+t+`
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}})(),jM=(function(){return function(r){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=r;var t=r.length,e=Xr("rc",t),n=Ve(t),a=FD(t,e),i=e.slice(-2),o=t<=1?"rc":"vec2("+i.join(",")+")";this.userCode=`
      void main() {
        `+n+` rc = getOutputCoords();
        vec4 packedInput = getA(`+a+`);

        setOutput(getChannel(packedInput, `+o+`));
      }
    `}})();function XM(r){return Rr(r,0)}function KM(r,t){return Rr(r,t)}function YM(r,t){return Rr(r,t)}function QM(r,t){return Rr(r,t)}function ZM(r,t){t===void 0&&(t=0),Y(r.length>=1,function(){return"Pass at least one tensor to concat"});var e=Xf(r,"tensors","concat");t=$n(t,e[0].shape)[0];var n=al(e.map(function(o){return o.shape}),t);if(qt(n)===0)return bn([],n);if((e=e.filter(function(o){return o.size>0})).length===1)return e[0];var a=e.map(function(o){return o.shape});lD(a,t);var i=e;return q.engine.runKernel(function(o){return o.concat(e,t)},i,function(o){var u=a.map(function(l){return l[t]});return Hg(o,u,t).map(function(l){return function(){return l}})})}function $M(r,t,e){e===void 0&&(e=0);var n,a=H(r,"x","split");return e=$n(e,a.shape)[0],typeof t=="number"?(Y(a.shape[e]%t==0,function(){return"Number of splits must evenly divide the axis."}),n=new Array(t).fill(a.shape[e]/t)):(Y(a.shape[e]===t.reduce(function(i,o){return i+o}),function(){return"The sum of sizes must match the size of the axis dimension."}),n=t),q.engine.runKernel(function(i){return i.split(a,n,e)},{$x:a},function(i){return{$x:function(){return Rr(i,e)}}})}var Rr=it({concat_:ZM}),JM=it({concat1d_:XM}),tB=it({concat2d_:KM}),eB=it({concat3d_:YM}),nB=it({concat4d_:QM}),Hg=it({split_:$M});function Xu(r,t){return r(t={exports:{}},t.exports),t.exports}var rB=Xu(function(r){(function(t,e,n){function a(o,u){return u.c=o.c,u.s0=o.s0,u.s1=o.s1,u.s2=o.s2,u}function i(o,u){var l=new function(p){var v,m=this,x=(v=4022871197,function(b){b=b.toString();for(var E=0;E<b.length;E++){var C=.02519603282416938*(v+=b.charCodeAt(E));C-=v=C>>>0,v=(C*=v)>>>0,v+=4294967296*(C-=v)}return 23283064365386963e-26*(v>>>0)});m.next=function(){var b=2091639*m.s0+23283064365386963e-26*m.c;return m.s0=m.s1,m.s1=m.s2,m.s2=b-(m.c=0|b)},m.c=1,m.s0=x(" "),m.s1=x(" "),m.s2=x(" "),m.s0-=x(p),m.s0<0&&(m.s0+=1),m.s1-=x(p),m.s1<0&&(m.s1+=1),m.s2-=x(p),m.s2<0&&(m.s2+=1),x=null}(o),h=u&&u.state,f=l.next;return f.int32=function(){return 4294967296*l.next()|0},f.double=function(){return f()+11102230246251565e-32*(2097152*f()|0)},f.quick=f,h&&(typeof h=="object"&&a(h,l),f.state=function(){return a(l,{})}),f}e&&e.exports?e.exports=i:this.alea=i})(0,r)}),aB=Xu(function(r){(function(t,e,n){function a(o,u){return u.x=o.x,u.y=o.y,u.z=o.z,u.w=o.w,u}function i(o,u){var l=new function(p){var v=this,m="";v.x=0,v.y=0,v.z=0,v.w=0,v.next=function(){var b=v.x^v.x<<11;return v.x=v.y,v.y=v.z,v.z=v.w,v.w^=v.w>>>19^b^b>>>8},p===(0|p)?v.x=p:m+=p;for(var x=0;x<m.length+64;x++)v.x^=0|m.charCodeAt(x),v.next()}(o),h=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var p=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(p===0);return p},f.int32=l.next,f.quick=f,h&&(typeof h=="object"&&a(h,l),f.state=function(){return a(l,{})}),f}e&&e.exports?e.exports=i:this.xor128=i})(0,r)}),iB=Xu(function(r){(function(t,e,n){function a(o,u){return u.x=o.x,u.y=o.y,u.z=o.z,u.w=o.w,u.v=o.v,u.d=o.d,u}function i(o,u){var l=new function(p){var v=this,m="";v.next=function(){var b=v.x^v.x>>>2;return v.x=v.y,v.y=v.z,v.z=v.w,v.w=v.v,(v.d=v.d+362437|0)+(v.v=v.v^v.v<<4^b^b<<1)|0},v.x=0,v.y=0,v.z=0,v.w=0,v.v=0,p===(0|p)?v.x=p:m+=p;for(var x=0;x<m.length+64;x++)v.x^=0|m.charCodeAt(x),x==m.length&&(v.d=v.x<<10^v.x>>>4),v.next()}(o),h=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var p=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(p===0);return p},f.int32=l.next,f.quick=f,h&&(typeof h=="object"&&a(h,l),f.state=function(){return a(l,{})}),f}e&&e.exports?e.exports=i:this.xorwow=i})(0,r)}),oB=Xu(function(r){(function(t,e,n){function a(o,u){return u.x=o.x.slice(),u.i=o.i,u}function i(o,u){o==null&&(o=+new Date);var l=new function(p){var v=this;v.next=function(){var m,x,b=v.x,E=v.i;return m=b[E],x=(m^=m>>>7)^m<<24,x^=(m=b[E+1&7])^m>>>10,x^=(m=b[E+3&7])^m>>>3,x^=(m=b[E+4&7])^m<<7,m=b[E+7&7],x^=(m^=m<<13)^m<<9,b[E]=x,v.i=E+1&7,x},(function(m,x){var b,E=[];if(x===(0|x))E[0]=x;else for(x=""+x,b=0;b<x.length;++b)E[7&b]=E[7&b]<<15^x.charCodeAt(b)+E[b+1&7]<<13;for(;E.length<8;)E.push(0);for(b=0;b<8&&E[b]===0;++b);for(b==8?E[7]=-1:E[b],m.x=E,m.i=0,b=256;b>0;--b)m.next()})(v,p)}(o),h=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var p=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(p===0);return p},f.int32=l.next,f.quick=f,h&&(h.x&&a(h,l),f.state=function(){return a(l,{})}),f}e&&e.exports?e.exports=i:this.xorshift7=i})(0,r)}),uB=Xu(function(r){(function(t,e,n){function a(o,u){return u.i=o.i,u.w=o.w,u.X=o.X.slice(),u}function i(o,u){o==null&&(o=+new Date);var l=new function(p){var v=this;v.next=function(){var m,x,b=v.w,E=v.X,C=v.i;return v.w=b=b+1640531527|0,x=E[C+34&127],m=E[C=C+1&127],x^=x<<13,m^=m<<17,x^=x>>>15,m^=m>>>12,x=E[C]=x^m,v.i=C,x+(b^b>>>16)|0},(function(m,x){var b,E,C,R,_,A=[],k=128;for(x===(0|x)?(E=x,x=null):(x+="\0",E=0,k=Math.max(k,x.length)),C=0,R=-32;R<k;++R)x&&(E^=x.charCodeAt((R+32)%x.length)),R===0&&(_=E),E^=E<<10,E^=E>>>15,E^=E<<4,E^=E>>>13,R>=0&&(_=_+1640531527|0,C=(b=A[127&R]^=E+_)==0?C+1:0);for(C>=128&&(A[127&(x&&x.length||0)]=-1),C=127,R=512;R>0;--R)E=A[C+34&127],b=A[C=C+1&127],E^=E<<13,b^=b<<17,E^=E>>>15,b^=b>>>12,A[C]=E^b;m.w=_,m.X=A,m.i=C})(v,p)}(o),h=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var p=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(p===0);return p},f.int32=l.next,f.quick=f,h&&(h.X&&a(h,l),f.state=function(){return a(l,{})}),f}e&&e.exports?e.exports=i:this.xor4096=i})(0,r)}),sB=Xu(function(r){(function(t,e,n){function a(o,u){return u.a=o.a,u.b=o.b,u.c=o.c,u.d=o.d,u}function i(o,u){var l=new function(p){var v=this,m="";v.next=function(){var b=v.b,E=v.c,C=v.d,R=v.a;return b=b<<25^b>>>7^E,E=E-C|0,C=C<<24^C>>>8^R,R=R-b|0,v.b=b=b<<20^b>>>12^E,v.c=E=E-C|0,v.d=C<<16^E>>>16^R,v.a=R-b|0},v.a=0,v.b=0,v.c=-1640531527,v.d=1367130551,p===Math.floor(p)?(v.a=p/4294967296|0,v.b=0|p):m+=p;for(var x=0;x<m.length+20;x++)v.b^=0|m.charCodeAt(x),v.next()}(o),h=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var p=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(p===0);return p},f.int32=l.next,f.quick=f,h&&(typeof h=="object"&&a(h,l),f.state=function(){return a(l,{})}),f}e&&e.exports?e.exports=i:this.tychei=i})(0,r)}),Ru=Xu(function(r){(function(t,e){var n,a=this,i=256,o=6,u="random",l=e.pow(i,o),h=e.pow(2,52),f=2*h,p=i-1;function v(E,C,R){var _=[],A=x((function P(M,O){var F,W=[],j=typeof M;if(O&&j=="object")for(F in M)try{W.push(P(M[F],O-1))}catch{}return W.length?W:j=="string"?M:M+"\0"})((C=C==1?{entropy:!0}:C||{}).entropy?[E,b(t)]:E??(function(){try{var P;return n&&(P=n.randomBytes)?P=P(i):(P=new Uint8Array(i),(a.crypto||a.msCrypto).getRandomValues(P)),b(P)}catch{var M=a.navigator,O=M&&M.plugins;return[+new Date,a,O,a.screen,b(t)]}})(),3),_),k=new function(P){var M,O=P.length,F=this,W=0,j=F.i=F.j=0,ot=F.S=[];for(O||(P=[O++]);W<i;)ot[W]=W++;for(W=0;W<i;W++)ot[W]=ot[j=p&j+P[W%O]+(M=ot[W])],ot[j]=M;(F.g=function(nt){for(var at,V=0,X=F.i,Q=F.j,ut=F.S;nt--;)at=ut[X=p&X+1],V=V*i+ut[p&(ut[X]=ut[Q=p&Q+at])+(ut[Q]=at)];return F.i=X,F.j=Q,V})(i)}(_),D=function(){for(var P=k.g(o),M=l,O=0;P<h;)P=(P+O)*i,M*=i,O=k.g(1);for(;P>=f;)P/=2,M/=2,O>>>=1;return(P+O)/M};return D.int32=function(){return 0|k.g(4)},D.quick=function(){return k.g(4)/4294967296},D.double=D,x(b(k.S),t),(C.pass||R||function(P,M,O,F){return F&&(F.S&&m(F,k),P.state=function(){return m(k,{})}),O?(e[u]=P,M):P})(D,A,"global"in C?C.global:this==e,C.state)}function m(E,C){return C.i=E.i,C.j=E.j,C.S=E.S.slice(),C}function x(E,C){for(var R,_=E+"",A=0;A<_.length;)C[p&A]=p&(R^=19*C[p&A])+_.charCodeAt(A++);return b(C)}function b(E){return String.fromCharCode.apply(0,E)}if(e["seed"+u]=v,x(e.random(),t),r.exports){r.exports=v;try{n=require("crypto")}catch{}}})([],Math)});Ru.alea=rB,Ru.xor128=aB,Ru.xorwow=iB,Ru.xorshift7=oB,Ru.xor4096=uB,Ru.tychei=sB;var lB=Ru,_C=lB.alea,AC=(function(){function r(t,e,n,a,i){this.mean=t,this.stdDev=e,this.dtype=n,this.nextVal=NaN,this.truncated=a,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var o=i||Math.random();this.random=_C(o.toString())}return r.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var t=this.nextVal;return this.nextVal=NaN,t}for(var e,n,a=!1;!a;){var i=void 0,o=void 0,u=void 0;do u=(i=2*this.random()-1)*i+(o=2*this.random()-1)*o;while(u>=1||u===0);var l=Math.sqrt(-2*Math.log(u)/u);e=this.mean+this.stdDev*i*l,n=this.mean+this.stdDev*o*l,this.truncated&&!this.isValidTruncated(e)||(a=!0)}return this.truncated&&!this.isValidTruncated(n)||(this.nextVal=this.convertValue(n)),this.convertValue(e)},r.prototype.convertValue=function(t){return this.dtype==null||this.dtype==="float32"?t:Math.round(t)},r.prototype.isValidTruncated=function(t){return t<=this.upper&&t>=this.lower},r})();function cB(r){var t=H(r,"x","clone",null);return q.engine.runKernel(function(e){return kt.make(t.shape,{dataId:t.dataId},t.dtype)},{$x:t},function(e){return{$x:function(){return e.toFloat()}}})}function hB(r,t,e,n){n===void 0&&(n="float32"),t==null&&(t=r);for(var a=fe([r,t],n),i=r<=t?r:t,o=0;o<i;++o)a.set(1,o,o);var u=a.toTensor().as2D(r,t);if(e==null)return u;if(e.length===1)return Xs(pa(u,0),[e[0],1,1]);if(e.length===2)return Xs(pa(pa(u,0),0),[e[0],e[1],1,1]);if(e.length===3)return Xs(pa(pa(pa(u,0),0),0),[e[0],e[1],e[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+e.length+"D.")}function fB(r,t,e,n,a){if(t===void 0&&(t=0),e===void 0&&(e=1),n!=null&&n==="bool")throw new Error("Unsupported data type "+n);for(var i=new AC(t,e,n,!1,a),o=fe(r,n),u=0;u<o.values.length;u++)o.values[u]=i.nextValue();return o.toTensor()}function dB(r,t,e,n,a){if(t===void 0&&(t=0),e===void 0&&(e=1),n!=null&&n==="bool")throw new Error("Unsupported data type "+n);for(var i=new AC(t,e,n,!0,a),o=fe(r,n),u=0;u<o.values.length;u++)o.values[u]=i.nextValue();return o.toTensor()}function pB(r,t,e,n){t===void 0&&(t=0),e===void 0&&(e=1),n===void 0&&(n="float32");for(var a=fe(r,n),i=0;i<a.values.length;i++)a.values[i]=xk(t,e);return a.toTensor()}function vB(r,t,e){var n=qt(r),a=null;if(e==null||e==="float32")a=new Float32Array(n);else if(e==="int32")a=new Int32Array(n);else{if(e!=="bool")throw new Error("Unknown data type "+e);a=new Uint8Array(n)}for(var i=0;i<n;i++)a[i]=t();return kt.make(r,{values:a},e)}function mB(r,t,e,n){n===void 0&&(n=!1);var a=H(r,"logits","multinomial"),i=a.size,o=a.rank;if(i<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+i+".");if(o>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+o);e=e||Math.random();var u=o===1?a.as2D(1,-1):a,l=q.engine.runKernel(function(h){return h.multinomial(u,n,t,e)},{logits2D:u});return o===1?l.as1D():l}function gB(r,t,e,n){if(e===void 0&&(e=1),n===void 0&&(n=0),t<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+t);var a=H(r,"indices","oneHot","int32"),i=a.shape.concat([t]);return a=a.flatten(),q.engine.runKernel(function(o){return o.oneHot(a,t,e,n)},{$indices:a},function(o){return{$indices:function(){return dn(a.shape,"float32")}}}).reshape(i)}function yB(r,t){var e=H(r,"x","reshape",null);return t=wk(t,e.size),Y(e.size===qt(t),function(){return"new shape and old shape must have the same number of elements."}),q.engine.runKernel(function(n){return n.reshape(e,t)},{$x:e},function(n){return{$x:function(){return n.reshape(e.shape)}}})}function xB(r,t){var e=H(r,"x","squeeze");return Ba(e,Vu(e.shape,t).newShape)}function bB(r,t){var e=H(r,"x","cast");return q.engine.runKernel(function(n){return n.cast(e,t)},{$x:e},function(n){return{$x:function(){return n.clone()}}})}function wB(r,t){var e=H(r,"x","tile");return Y(e.rank===t.length,function(){return"Error in transpose: rank of input "+e.rank+" must match length of reps "+t+"."}),q.engine.runKernel(function(n,a){var i=n.tile(e,t);return a([e]),i},{$x:e},function(n,a){var i=a[0];return{$x:function(){var o=Ce(i);if(i.rank===1)for(var u=0;u<t[0];++u)o=o.add(n.slice([u*i.shape[0]],[i.shape[0]]));else if(i.rank===2)for(u=0;u<t[0];++u)for(var l=0;l<t[1];++l)o=o.add(n.slice([u*i.shape[0],l*i.shape[1]],[i.shape[0],i.shape[1]]));else if(i.rank===3)for(u=0;u<t[0];++u)for(l=0;l<t[1];++l)for(var h=0;h<t[2];++h)o=o.add(n.slice([u*i.shape[0],l*i.shape[1],h*i.shape[2]],[i.shape[0],i.shape[1],i.shape[2]]));else{if(i.rank!==4)throw new Error("Gradient for tile operation is not implemented for rank-"+i.rank+" tensors yet.");for(u=0;u<t[0];++u)for(l=0;l<t[1];++l)for(h=0;h<t[2];++h)for(var f=0;f<t[3];++f)o=o.add(n.slice([u*i.shape[0],l*i.shape[1],h*i.shape[2],f*i.shape[3]],[i.shape[0],i.shape[1],i.shape[2],i.shape[3]]))}return o}}})}function EB(r,t,e){return e===void 0&&(e=0),Y(t.length===2,function(){return"Invalid number of paddings. Must be length of 2."}),Xc(r,[t],e)}function CB(r,t,e){return e===void 0&&(e=0),Y(t.length===2&&t[0].length===2&&t[1].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Xc(r,t,e)}function SB(r,t,e){return e===void 0&&(e=0),Y(t.length===3&&t[0].length===2&&t[1].length===2&&t[2].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Xc(r,t,e)}function RB(r,t,e){return e===void 0&&(e=0),Y(t.length===4&&t[0].length===2&&t[1].length===2&&t[2].length===2&&t[3].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Xc(r,t,e)}function _B(r,t,e){e===void 0&&(e=0);var n=H(r,"x","pad");if(n.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var a=t.map(function(i){return i[0]});return q.engine.runKernel(function(i){return i.pad(n,t,e)},{$x:n},function(i){return{$x:function(){return i.slice(a,n.shape)}}})}function AB(r,t){t===void 0&&(t=0);var e=Xf(r,"tensors","stack");if(Y(e.length>=1,function(){return"Pass at least one tensor to tf.stack"}),e.length===1)return e[0].expandDims(t);var n=e[0].rank,a=e[0].shape,i=e[0].dtype;Y(t<=n,function(){return"Axis must be <= rank of the tensor"}),e.forEach(function(u){Me(a,u.shape,"All tensors passed to stack must have matching shapes")}),e.forEach(function(u){Y(i===u.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var o=e.map(function(u){return u.expandDims(t)});return Rr(o,t)}function TB(r,t,e){var n=H(r,"x","batchToSpaceND"),a=t.reduce(function(i,o){return i*o});return Y(n.rank>=1+t.length,function(){return"input rank is "+n.rank+" but should be > than blockShape.length "+t.length}),Y(e.length===t.length,function(){return"crops.length is "+e.length+" but should be equal to blockShape.length  "+t.length}),Y(n.shape[0]%a==0,function(){return"input tensor batch is "+n.shape[0]+" but is not divisible by the product of the elements of blockShape "+t.join(" * ")+" === "+a}),q.engine.runKernel(function(i){return i.batchToSpaceND(n,t,e)},{$x:n},function(i){return{$x:function(){return i.spaceToBatchND(t,e)}}})}function kB(r,t,e){var n=H(r,"x","spaceToBatchND");return Y(n.rank>=1+t.length,function(){return"input rank "+n.rank+" should be > than [blockShape] "+t.length}),Y(e.length===t.length,function(){return"paddings.shape[0] "+e.length+" must be equal to [blockShape] "+t.length}),Y(n.shape.reduce(function(a,i,o){return o>0&&o<=t.length?a&&(i+e[o-1][0]+e[o-1][1])%t[o-1]==0:a},!0),function(){return"input spatial dimensions "+n.shape.slice(1)+" with paddings "+e.toString()+" must be divisible by blockShapes "+t.toString()}),q.engine.runKernel(function(a){return a.spaceToBatchND(n,t,e)},{$x:n},function(a){return{$x:function(){return a.batchToSpaceND(t,e)}}})}function DB(r,t){t===void 0&&(t=0),t=t||0;var e=H(r,"x","unstack");return Y(t>=-e.shape.length&&t<e.shape.length,function(){return"Axis = "+t+" is not in [-"+e.shape.length+", "+e.shape.length+")"}),t<0&&(t+=e.shape.length),q.engine.runKernel(function(n){return n.unstack(e,t)},{$x:e},function(n){return{$x:function(){return Pa(n,t)}}})}function IB(r,t,e,n){t===void 0&&(t=0),e===void 0&&(e=!1),n===void 0&&(n=!1);var a=H(r,"x","cumsum"),i=bi([t|=0],a.rank),o=a;i!=null&&(o=a.transpose(i));var u=wi(1,a.rank)[0],l=q.engine.runKernel(function(h){return h.cumsum(o,u,e,n)},{permutedX:o},function(h){return{permutedX:function(){return h.cumsum(t,e,!n)}}});return i!=null&&(l=l.transpose(i)),l}function NB(r,t){t===void 0&&(t=0);var e=H(r,"x","expandDims");Y(t<=e.rank,function(){return"Axis must be <= rank of the tensor"});var n=e.shape.slice();return t<0&&(Y(-(e.rank+1)<=t,function(){return"Axis must be in the interval ["+-(e.rank+1)+", "+e.rank+"]"}),t=e.rank+t+1),n.splice(t,0,1),Ba(e,n)}function OB(r,t,e){e===void 0&&(e="NHWC");var n=H(r,"x","depthToSpace"),a=e==="NHWC"?n.shape[1]:n.shape[2],i=e==="NHWC"?n.shape[2]:n.shape[3],o=e==="NHWC"?n.shape[3]:n.shape[1];return Y(a*t>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+a+" and "+t+`  for depthToSpace with input shape
      `+n.shape}),Y(i*t>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+i+" and "+t+` for depthToSpace with input shape
          `+n.shape}),Y(o%(t*t)==0,function(){return"Dimension size must be evenly divisible by "+t*t+" but is "+o+" for depthToSpace with input shape "+n.shape}),q.engine.runKernel(function(u){return u.depthToSpace(n,t,e)},{$x:n})}function MB(r,t){return Ne(this,void 0,void 0,function(){var e,n,a,i,o,u,l,h,f,p;return Oe(this,function(v){switch(v.label){case 0:return e=H(r,"x","setdiff1d"),n=H(t,"y","setdiff1d"),Y(e.dtype===n.dtype,function(){return"x and y should have the same dtype, but got x ("+e.dtype+") and y ("+n.dtype+")."}),Y(e.rank===1,function(){return"x should be 1D tensor, but got x ("+e.shape+")."}),Y(n.rank===1,function(){return"y should be 1D tensor, but got y ("+n.shape+")."}),[4,e.data()];case 1:return a=v.sent(),[4,n.data()];case 2:for(i=v.sent(),o=new Set(i),u=0,f=0;f<a.length;f++)o.has(a[f])||u++;for(l=new Dc([u],e.dtype),h=new Dc([u],"int32"),f=0,p=0;f<a.length;f++)o.has(a[f])||(l.values[p]=a[f],h.values[p]=f,p++);return[2,[l.toTensor(),h.toTensor()]]}})})}function fe(r,t,e){return t===void 0&&(t="float32"),t=t||"float32",WE(r),new Dc(r,t,e)}function BB(r,t){t===void 0&&(t=!1),console.log(r.toString(t))}var TC=it({batchToSpaceND_:TB}),PB=it({cast_:bB}),FB=it({clone_:cB}),LB=it({cumsum_:IB}),zB=it({depthToSpace_:OB}),pa=it({expandDims_:NB}),kC=it({eye_:hB}),UB=it({multinomial_:mB}),ig=it({oneHot_:gB}),Xc=it({pad_:_B}),WB=it({pad1d_:EB}),VB=it({pad2d_:CB}),GB=it({pad3d_:SB}),HB=it({pad4d_:RB}),qB=it({rand_:vB}),jB=it({randomNormal_:fB}),XB=it({randomUniform_:pB}),Ba=it({reshape_:yB}),DC=it({spaceToBatchND_:kB}),IC=it({squeeze_:xB}),Pa=it({stack_:AB}),Xs=it({tile_:wB}),KB=it({truncatedNormal_:dB}),Zn=it({unstack_:DB}),YB=MB;function qg(r,t){for(var e=[],n=0;n<t.length;n++)t[n]&&e.push(n);var a=fe(r,"int32"),i=fe([e.length,r.length],"int32");for(n=0;n<e.length;n++){var o=a.indexToLoc(e[n]),u=n*r.length;i.values.set(o,u)}return i.toTensor()}var _f={};function QB(r){return r in _f||(_f[r]={}),_f[r]}function ZB(r,t){if(r==="linear")return t?HM:uM;if(r==="relu")return t?RC:SC;throw new Error("Activation "+r+" has not been implemented for the WebGL backend.")}var $B=128,uw=1e3,JB=(function(){function r(t){if(this.gpgpu=t,this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.lruDataGPU=[],this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.disposed=!1,q.get("WEBGL_VERSION")<1)throw new Error("WebGL is not supported on this device");if(t==null){var e=yi(q.get("WEBGL_VERSION"));this.binaryCache=QB(q.get("WEBGL_VERSION")),this.gpgpu=new bO(e),this.canvas=e.canvas,this.gpgpuCreatedLocally=!0}else this.binaryCache={},this.gpgpuCreatedLocally=!1,this.canvas=t.gl.canvas;this.textureManager=new eM(this.gpgpu)}return r.prototype.register=function(t,e,n){if(this.texData.has(t))throw new Error("Data buffer is already registered");this.texData.set(t,{shape:e,dtype:n})},r.prototype.setDataMover=function(t){this.texData=new oC(t)},r.prototype.fromPixels=function(t,e){if(t==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var n=[t.height,t.width],a=[t.height,t.width,e];if(q.get("IS_BROWSER")){if(!(t instanceof HTMLVideoElement||t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof ImageData))throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement or ImageData, but was "+t.constructor.name);if(t instanceof HTMLVideoElement){if(this.fromPixels2DContext==null){if(document.readyState!=="complete")throw new Error("The DOM is not ready yet. Please call tf.browser.fromPixels() once the DOM is ready. One way to do that is to add an event listener for `DOMContentLoaded` on the document object");this.fromPixels2DContext=document.createElement("canvas").getContext("2d")}this.fromPixels2DContext.canvas.width=t.width,this.fromPixels2DContext.canvas.height=t.height,this.fromPixels2DContext.drawImage(t,0,0,t.width,t.height),t=this.fromPixels2DContext.canvas}}var i=this.makeTensorHandle(n,"int32");this.texData.get(i.dataId).usage=fi.PIXELS,this.gpgpu.uploadPixelDataToTexture(this.getTexture(i.dataId),t);var o=new RN(a),u=this.compileAndRun(o,[i]);return this.disposeData(i.dataId),u},r.prototype.makeTensorHandle=function(t,e){var n={};return this.register(n,t,e),{dataId:n,shape:t,dtype:e}},r.prototype.write=function(t,e){if(e==null)throw new Error("MathBackendWebGL.write(): values can not be null");if(q.get("DEBUG"))for(var n=0;n<e.length;n++){var a=e[n];if(!BN(a))throw Error("The value "+a+" cannot be represented on this device.")}var i=this.texData.get(t),o=i.texture,u=i.texShape,l=i.usage,h=i.dtype,f=i.isPacked;if(h==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");o!=null&&(this.releaseTexture(t,o,u,l,h,f),i.texture=null,i.texShape=null),i.usage=fi.UPLOAD,i.values=e},r.prototype.readSync=function(t){var e=this.texData.get(t),n=e.values,a=e.dtype,i=e.complexTensors,o=e.slice,u=e.shape;if(o!=null){var l=new ae(u,ow),h=this.compileAndRun(l,[{dataId:t,shape:u,dtype:a}]),f=this.readSync(h.dataId);return h.dispose(),f}if(n!=null)return this.convertAndCacheOnCPU(t);if(a==="string")return n;var p,v,m=this.activeTimers!=null;return m&&(p=performance.now()),a==="complex64"?v=sC(i.real.dataSync(),i.imag.dataSync()):v=this.getValuesFromTexture(t),m&&(this.downloadWaitMs+=performance.now()-p),this.convertAndCacheOnCPU(t,v)},r.prototype.read=function(t){return Ne(this,void 0,void 0,function(){var e,n,a,i,o,u,l,h,f,p,v,m,x,b,E,C,R,_,A,k,D,P,M,O;return Oe(this,function(F){switch(F.label){case 0:if(this.pendingRead.has(t))return a=this.pendingRead.get(t),[2,new Promise(function(W){return a.push(W)})];if(i=this.texData.get(t),o=i.texture,u=i.values,l=i.texShape,h=i.isPacked,f=i.shape,p=i.slice,v=i.dtype,p!=null)return m=new ae(f,ow),x=this.compileAndRun(m,[{dataId:t,shape:f,dtype:v}]),b=this.read(x.dataId),x.dispose(),[2,b];if(u!=null)return[2,this.convertAndCacheOnCPU(t)];if(this.pendingRead.set(t,[]),!q.get("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&q.get("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return E=l[1],C=l[0],h&&(e=qu(l[0],l[1]),E=e[0],C=e[1]),R=this.gpgpu.maybeCreateBufferFromTexture(o,C,E),[4,this.gpgpu.createAndWaitForFence()];case 1:return F.sent(),R instanceof WebGLTexture?_=this.getValuesFromTexture(t):(A=qt(f),h?(k=Ls(f),D=1,P=1,f.length&&(n=zs(f),D=n[0],P=n[1]),_=this.gpgpu.downloadPackedMatrixFromBuffer(R,k,D,P,l[0],l[1]).subarray(0,A)):_=this.gpgpu.downloadFloat32MatrixFromBuffer(R,l[0],l[1]).subarray(0,A)),M=this.convertAndCacheOnCPU(t,_),O=this.pendingRead.get(t),this.pendingRead.delete(t),O.forEach(function(W){return W(M)}),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t)),[2,M]}})})},r.prototype.getValuesFromTexture=function(t){var e,n=this,a=this.texData.get(t),i=a.shape,o=a.dtype,u=a.texture,l=a.texShape,h=qt(i);if(q.get("WEBGL_DOWNLOAD_FLOAT_ENABLED")){if(this.texData.get(t).isPacked){var f=Ls(i),p=1,v=1;return i.length&&(p=(e=zs(i))[0],v=e[1]),this.gpgpu.downloadMatrixFromPackedTexture(u,f,p,v,l[0],l[1]).subarray(0,h)}return this.gpgpu.downloadFloat32MatrixFromOutputTexture(u,l[0],l[1]).subarray(0,h)}var m=this.makeTensorHandle(i,"float32");m.size=qt(i),this.texData.get(m.dataId).usage=fi.DOWNLOAD;var x=Ht(function(){var C=new CN(i);return n.compileAndRun(C,[{shape:i,dtype:o,dataId:t}],m,null,!1)}),b=this.texData.get(x.dataId),E=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(b.texture,b.texShape[0],b.texShape[1]).subarray(0,h);return this.disposeData(m.dataId),E},r.prototype.time=function(t){return Ne(this,void 0,void 0,function(){var e,n,a,i,o,u,l;return Oe(this,function(h){switch(h.label){case 0:return e=this.activeTimers,n=[],a=!1,this.programTimersStack==null?(this.programTimersStack=n,a=!0):this.activeTimers.push(n),this.activeTimers=n,t(),i=rl(this.activeTimers.map(function(f){return f.query})).filter(function(f){return f!=null}),o=rl(this.activeTimers.map(function(f){return f.name})).filter(function(f){return f!=null}),this.activeTimers=e,a&&(this.programTimersStack=null),[4,Promise.all(i)];case 1:return u=h.sent(),l={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:yk(u),getExtraProfileInfo:function(){return u.map(function(f,p){return{name:o[p],ms:f}}).map(function(f){return f.name+": "+f.ms}).join(", ")},wallMs:null},this.uploadWaitMs=0,this.downloadWaitMs=0,[2,l]}})})},r.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},r.prototype.startTimer=function(){return q.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?this.gpgpu.beginQuery():{startMs:performance.now(),endMs:null}},r.prototype.endTimer=function(t){return q.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(this.gpgpu.endQuery(),t):(t.endMs=performance.now(),t)},r.prototype.getQueryTime=function(t){return Ne(this,void 0,void 0,function(){var e;return Oe(this,function(n){return q.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?[2,this.gpgpu.waitForQueryAndGetTime(t)]:[2,(e=t).endMs-e.startMs]})})},r.prototype.disposeData=function(t){if(!this.pendingDisposal.has(t)){if(this.pendingRead.has(t))this.pendingDisposal.add(t);else if(this.texData.has(t)){var e=this.texData.get(t),n=e.texture,a=e.dtype,i=e.texShape,o=e.usage,u=e.complexTensors,l=e.isPacked,h=e.slice;if(n!=null){var f=h&&h.origDataId||t,p=this.dataRefCount.get(f);p>1?this.dataRefCount.set(f,p-1):(this.dataRefCount.delete(f),this.releaseTexture(t,n,i,o,a,l),this.texData.delete(t))}u!=null&&(u.real.dispose(),u.imag.dispose())}}},r.prototype.getTexture=function(t){return this.uploadToGPU(t),this.texData.get(t).texture},r.prototype.getCPUBackend=function(){return q.get("WEBGL_CPU_FORWARD")?(this.cpuBackend==null&&(this.cpuBackend=q.findBackend("cpu")),this.cpuBackend):null},r.prototype.shouldExecuteOnCPU=function(t,e){var n=this;return e===void 0&&(e=$B),this.getCPUBackend()!=null&&t.every(function(a){return n.texData.get(a.dataId).texture==null&&a.size<e})},r.prototype.getGPGPUContext=function(){return this.gpgpu},r.prototype.getCanvas=function(){return this.canvas},r.prototype.complex=function(t,e){var n=this.makeOutputArray(t.shape,"complex64");return this.texData.get(n.dataId).complexTensors={real:q.engine.keep(t.clone()),imag:q.engine.keep(e.clone())},n},r.prototype.real=function(t){return this.texData.get(t.dataId).complexTensors.real.clone()},r.prototype.imag=function(t){return this.texData.get(t.dataId).complexTensors.imag.clone()},r.prototype.slice=function(t,e,n){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.slice(t,e,n);var a=this.texData.get(t.dataId).isPacked,i=nC(t.shape,e,n);if(a||!i){var o=q.get("WEBGL_PACK_ARRAY_OPERATIONS")?new JO(n):new ZO(n),u=o.getCustomSetupFunc(e);return this.compileAndRun(o,[t],null,u)}return this.uploadToGPU(t.dataId),this.shallowSlice(t,e,n)},r.prototype.shallowSlice=function(t,e,n){var a=this.texData.get(t.dataId),i=kt.make(n,{},t.dtype,this),o=this.texData.get(i.dataId);Object.assign(o,a),o.shape=n,o.dtype=t.dtype;var u=rC(e,t.strides);a.slice&&(u+=a.slice.flatOffset),o.slice={flatOffset:u,origDataId:a.slice&&a.slice.origDataId||t.dataId};var l=this.dataRefCount.get(o.slice.origDataId)||1;return this.dataRefCount.set(o.slice.origDataId,l+1),i},r.prototype.stridedSlice=function(t,e,n,a,i,o,u,l,h){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.stridedSlice(t,e,n,a,i,o,u,l,h);var f=Fg(t.shape,e,n,a,i,o,u,l,h),p=f[0],v=f[1],m=f[2],x=v.filter(function(E,C){return m.indexOf(C)===-1});if(x.some(function(E){return E===0}))return bn([],x);var b=new tM(p,a,v,m);return this.compileAndRun(b,[t])},r.prototype.reverse=function(t,e){var n=q.get("WEBGL_PACK_ARRAY_OPERATIONS")?new KO(t.shape,e):new XO(t.shape,e);return this.compileAndRun(n,[t])},r.prototype.concat=function(t,e){if(this.shouldExecuteOnCPU(t))return this.cpuBackend.concat(t,e);if(t.length===1)return t[0];if(t.length>q.get("WEBGL_MAX_TEXTURES_IN_SHADER")){var n=Math.floor(t.length/2),a=this.concat(t.slice(0,n),e),i=this.concat(t.slice(n),e);return this.concat([a,i],e)}if(q.get("WEBGL_PACK_ARRAY_OPERATIONS")&&t[0].rank>1){var o=new sN(t.map(function(f){return f.shape}),e);return this.compileAndRun(o,t)}var u=al(t.map(function(f){return f.shape}),e),l=t.map(function(f){return f.as2D(-1,qt(f.shape.slice(e)))}),h=new uN(l.map(function(f){return f.shape}));return this.compileAndRun(h,l).reshape(u)},r.prototype.neg=function(t){var e=new ae(t.shape,fM);return this.compileAndRun(e,[t])},r.prototype.batchMatMul=function(t,e,n,a){var i=n?t.shape[2]:t.shape[1],o=a?e.shape[1]:e.shape[2],u=n?t.shape[1]:t.shape[2],l=t.shape[0];if((i===1||o===1)&&u>uw){n&&(t=t.transpose([0,2,1])),a&&(e=e.transpose([0,2,1]));var h=o===1?t:t.as3D(l,u,1),f=o===1?2:1,p=o===1?e.as3D(l,1,u):e;return this.multiply(h,p).sum(f,!0)}var v=Un(t.dtype,e.dtype),m=new vm(t.shape,[l,i,o],n,a),x=this.makePackedTensor(m.outputShape,v);return this.compileAndRun(m,[t,e],x)},r.prototype.fusedBatchMatMul=function(t,e,n,a,i,o){var u=n?t.shape[2]:t.shape[1],l=a?e.shape[1]:e.shape[2],h=t.shape[0],f=Un(t.dtype,e.dtype),p=new vm(t.shape,[h,u,l],n,a,!!i,o?ZB(o,!0):null),v=this.makePackedTensor(p.outputShape,f),m=[t,e];return i&&m.push(i),this.compileAndRun(p,m,v)},r.prototype.multiply=function(t,e){if(t.dtype==="complex64"){var n=this.texData.get(t.dataId),a=this.texData.get(e.dataId),i=new X1(j1.REAL,t.shape,e.shape),o=new X1(j1.IMAG,t.shape,e.shape),u=[this.makeComplexComponentTensorHandle(t,n.complexTensors.real),this.makeComplexComponentTensorHandle(t,n.complexTensors.imag),this.makeComplexComponentTensorHandle(e,a.complexTensors.real),this.makeComplexComponentTensorHandle(e,a.complexTensors.imag)],l=this.compileAndRun(i,u),h=this.compileAndRun(o,u),f=this.complex(l,h);return l.dispose(),h.dispose(),f}if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.multiply(t,e);if(q.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,K1,t.dtype);var p=new an(K1,t.shape,e.shape),v=this.makeOutputArray(p.outputShape,t.dtype);return this.compileAndRun(p,[t,e],v)},r.prototype.batchNormalization=function(t,e,n,a,i,o){var u=[t,e,n],l=null;o!=null&&(l=o.shape,u.push(o));var h=null;if(i!=null&&(h=i.shape,u.push(i)),q.get("WEBGL_PACK_BATCHNORMALIZATION")){var f=new SI(t.shape,e.shape,n.shape,l,h,a);return this.compileAndRun(f,u)}var p=new CI(t.shape,e.shape,n.shape,l,h,a);return this.compileAndRun(p,u)},r.prototype.localResponseNormalization4D=function(t,e,n,a,i){var o=new _O(t.shape,e,n,a,i);return this.compileAndRun(o,[t])},r.prototype.LRNGrad=function(t,e,n,a,i,o,u){var l=new AO(e.shape,a,i,o,u);return this.compileAndRun(l,[e,n,t])},r.prototype.tile=function(t,e){var n=new nM(t.shape,e);return this.compileAndRun(n,[t])},r.prototype.pad=function(t,e,n){var a=q.get("WEBGL_PACK_ARRAY_OPERATIONS")?new FO(t.shape,e,n):new PO(t.shape,e,n);return this.compileAndRun(a,[t])},r.prototype.transpose=function(t,e){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.transpose(t,e);var n=q.get("WEBGL_PACK_ARRAY_OPERATIONS")?new oM(t.shape,e):new aM(t.shape,e);return this.compileAndRun(n,[t])},r.prototype.gather=function(t,e,n){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.gather(t,e,n);var a=new _N(t.shape,e.size,n);return this.compileAndRun(a,[t,e])},r.prototype.batchToSpaceND=function(t,e,n){Y(t.rank<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var a=e.reduce(function(f,p){return f*p}),i=Kf(t.shape,e,a),o=Yf(i.length,e.length),u=Qf(t.shape,e,a),l=ZE(n,e.length),h=$E(u,n,e.length);return t.reshape(i).transpose(o).reshape(u).slice(l,h)},r.prototype.spaceToBatchND=function(t,e,n){Y(t.rank<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var a=e.reduce(function(p,v){return p*v}),i=[[0,0]];i.push.apply(i,n);for(var o=1+e.length;o<t.shape.length;++o)i.push([0,0]);var u=t.pad(i),l=Kf(u.shape,e,a,!1),h=Yf(l.length,e.length,!1),f=Qf(u.shape,e,a,!1);return u.reshape(l).transpose(h).reshape(f)},r.prototype.reduce=function(t,e,n){var a=t.shape[0],i=t.shape[1],o=cm(i),u=new LO({windowSize:o,inSize:i,batchSize:a},e),l=u.outputShape,h=l[0],f=l[1],p=this.makeOutputArray([h,f],n);return this.compileAndRun(u,[t],p),p.shape[1]===1?p:this.reduce(p,e,n)},r.prototype.argReduce=function(t,e,n){n===void 0&&(n=null);var a=t.shape[0],i=t.shape[1];n!=null&&(a=n.shape[0],i=n.shape[1]);var o=cm(i),u=new PD({windowSize:o,inSize:i,batchSize:a},e,n==null),l=u.outputShape,h=l[0],f=l[1],p=this.makeOutputArray([h,f],"int32"),v=[t];return n!=null&&v.push(n),this.compileAndRun(u,v,p),p.shape[1]===1?p:this.argReduce(t,e,p)},r.prototype.argReducePacked=function(t,e,n){n===void 0&&(n=null);var a=n!=null?n.shape:t.shape,i=cm(a[a.length-1]),o=new wI(a,i,e,n==null),u=this.makePackedTensor(o.outputShape,"int32"),l=n==null?[t]:[t,n];return this.compileAndRun(o,l,u),u.rank===t.rank?this.argReducePacked(t,e,u):u},r.prototype.sum=function(t,e){Gr("sum",e,t.rank);var n=er(t.shape,e),a=n[0],i=qt(n[1]),o=t.as2D(-1,i),u=om(t.dtype);return this.reduce(o,"sum",u).reshape(a)},r.prototype.prod=function(t,e){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.prod(t,e);var n=er(t.shape,e),a=n[0],i=qt(n[1]),o=t.as2D(-1,i),u=om(t.dtype);return this.reduce(o,"prod",u).reshape(a)},r.prototype.unsortedSegmentSum=function(t,e,n){var a=0,i=bi([a],t.rank),o=t;i!=null&&(o=t.transpose(i),a=wi(1,t.rank)[0]);var u=dD(o.shape,a,n),l=qt([o.shape[a]]),h=o.as2D(-1,l),f=om(t.dtype),p=this.segOpCompute(h,"unsortedSegmentSum",e,f,n).reshape(u);return i!=null&&(p=p.transpose(Pg(i))),p},r.prototype.segOpCompute=function(t,e,n,a,i){var o=t.shape[0],u=t.shape[1],l=fD(u,i),h=new YO({windowSize:l,inSize:u,batchSize:o,numSegments:i},e),f=h.outputShape,p=f[0],v=f[1],m=this.makeOutputArray([p,v],a);return this.compileAndRun(h,[t,n],m),m.shape[1]===i?m:(n=aC(0,i).tile([u/l]),this.segOpCompute(m,e,n,a,i))},r.prototype.argMinMaxReduce=function(t,e,n){var a=[e];if(Gr("arg"+n.charAt(0).toUpperCase()+n.slice(1),a,t.rank),!q.get("WEBGL_PACK_REDUCE")||t.rank<=2){var i=er(t.shape,a),o=i[0],u=qt(i[1]),l=t.as2D(-1,u);return this.argReduce(l,n).reshape(o)}return this.argReducePacked(t,n)},r.prototype.argMin=function(t,e){return this.argMinMaxReduce(t,e,"min")},r.prototype.argMax=function(t,e){return this.argMinMaxReduce(t,e,"max")},r.prototype.cumsum=function(t,e,n,a){if(e!==t.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(t.rank-1)+" but got axis="+e);var i=new bN(t.shape,n,a);return this.compileAndRun(i,[t])},r.prototype.equal=function(t,e){if(q.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,XI,"bool");var n=new an(TI,t.shape,e.shape),a=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[t,e],a)},r.prototype.notEqual=function(t,e){if(q.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,KI,"bool");var n=new an(kI,t.shape,e.shape),a=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[t,e],a)},r.prototype.less=function(t,e){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.less(t,e);if(q.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,YI,"bool");var n=new an(DI,t.shape,e.shape),a=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[t,e],a)},r.prototype.lessEqual=function(t,e){if(q.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,QI,"bool");var n=new an(II,t.shape,e.shape),a=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[t,e],a)},r.prototype.greater=function(t,e){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.greater(t,e);if(q.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,ZI,"bool");var n=new an(NI,t.shape,e.shape),a=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[t,e],a)},r.prototype.greaterEqual=function(t,e){if(q.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,$I,"bool");var n=new an(OI,t.shape,e.shape),a=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[t,e],a)},r.prototype.logicalNot=function(t){var e=new ae(t.shape,VM);return this.compileAndRun(e,[t])},r.prototype.logicalAnd=function(t,e){if(q.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,JI,"bool");var n=new an(MI,t.shape,e.shape),a=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[t,e],a)},r.prototype.logicalOr=function(t,e){if(q.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,tN,"bool");var n=new an(BI,t.shape,e.shape),a=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[t,e],a)},r.prototype.select=function(t,e,n){var a=new QO(t.rank,e.shape,e.rank),i=this.makeOutputArray(a.outputShape,Un(e.dtype,n.dtype));return this.compileAndRun(a,[t,e,n],i)},r.prototype.where=function(t){ng("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var e=t.dataSync();return qg(t.shape,e)},r.prototype.topk=function(t,e,n){return cC(t.dataSync(),t.shape,t.dtype,e)},r.prototype.min=function(t,e){Gr("min",e,t.rank);var n=er(t.shape,e),a=n[0],i=qt(n[1]),o=t.as2D(-1,i);return this.reduce(o,"min",o.dtype).reshape(a)},r.prototype.minimum=function(t,e){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.minimum(t,e);var n=q.get("WEBGL_PACK_BINARY_OPERATIONS")?new Hi(nN,t.shape,e.shape):new an(FI,t.shape,e.shape);return this.compileAndRun(n,[t,e])},r.prototype.mod=function(t,e){var n=q.get("WEBGL_PACK_BINARY_OPERATIONS")?new Hi(rN,t.shape,e.shape):new an(LI,t.shape,e.shape);return this.compileAndRun(n,[t,e])},r.prototype.max=function(t,e){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.max(t,e);Gr("max",e,t.rank);var n=er(t.shape,e),a=n[0],i=qt(n[1]),o=t.as2D(-1,i);return this.reduce(o,"max",o.dtype).reshape(a)},r.prototype.maximum=function(t,e){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.maximum(t,e);var n=q.get("WEBGL_PACK_BINARY_OPERATIONS")?new Hi(eN,t.shape,e.shape):new an(PI,t.shape,e.shape);return this.compileAndRun(n,[t,e])},r.prototype.all=function(t,e){Gr("all",e,t.rank);var n=er(t.shape,e),a=n[0],i=qt(n[1]),o=t.as2D(-1,i);return this.reduce(o,"all",o.dtype).reshape(a)},r.prototype.any=function(t,e){Gr("any",e,t.rank);var n=er(t.shape,e),a=n[0],i=qt(n[1]),o=t.as2D(-1,i);return this.reduce(o,"any",o.dtype).reshape(a)},r.prototype.squaredDifference=function(t,e){var n=q.get("WEBGL_PACK_BINARY_OPERATIONS")?new Hi(Y1,t.shape,e.shape):new an(Y1,t.shape,e.shape);return this.compileAndRun(n,[t,e])},r.prototype.realDivide=function(t,e){var n=new an(RI,t.shape,e.shape),a=this.makeOutputArray(n.outputShape,"float32");return this.compileAndRun(n,[t,e],a)},r.prototype.floorDiv=function(t,e){var n=_I;if(q.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,VI,"int32");var a=new an(n,t.shape,e.shape),i=this.makeOutputArray(a.outputShape,"int32");return this.compileAndRun(a,[t,e],i)},r.prototype.add=function(t,e){if(t.dtype==="complex64"&&e.dtype==="complex64")return this.complexSeparableBinaryOp(t,e,hm);if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.add(t,e);var n=Un(t.dtype,e.dtype);if(q.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,hm,n);var a=new an(hm,t.shape,e.shape),i=this.makeOutputArray(a.outputShape,n);return this.compileAndRun(a,[t,e],i)},r.prototype.packedBinaryOp=function(t,e,n,a){var i=new Hi(n,t.shape,e.shape),o=this.makePackedTensor(i.outputShape,a);return this.compileAndRun(i,[t,e],o)},r.prototype.complexSeparableBinaryOp=function(t,e,n){var a=this,i=this.texData.get(t.dataId),o=this.texData.get(e.dataId),u=[[i.complexTensors.real,o.complexTensors.real],[i.complexTensors.imag,o.complexTensors.imag]].map(function(p){var v=p[0],m=p[1],x=a.makeComplexComponentTensorHandle(t,v),b=a.makeComplexComponentTensorHandle(e,m),E=new an(n,t.shape,e.shape),C=a.makeOutputArray(E.outputShape,Un(v.dtype,m.dtype));return a.compileAndRun(E,[x,b],C)}),l=u[0],h=u[1],f=this.complex(l,h);return l.dispose(),h.dispose(),f},r.prototype.makeComplexComponentTensorHandle=function(t,e){return{dataId:e.dataId,dtype:e.dtype,shape:t.shape}},r.prototype.addN=function(t){for(var e=t[0],n=1;n<t.length;n++)e=this.add(e,t[n]);return e},r.prototype.subtract=function(t,e){if(t.dtype==="complex64"&&e.dtype==="complex64")return this.complexSeparableBinaryOp(t,e,fm);if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.subtract(t,e);var n=Un(t.dtype,e.dtype);if(q.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,fm,t.dtype);var a=new an(fm,t.shape,e.shape),i=this.makeOutputArray(a.outputShape,n);return this.compileAndRun(a,[t,e],i)},r.prototype.pow=function(t,e){var n=q.get("WEBGL_PACK_BINARY_OPERATIONS"),a=n?new Hi(GI,t.shape,e.shape):new an(AI,t.shape,e.shape),i=Un(t.dtype,e.dtype),o=n?this.makePackedTensor(a.outputShape,i):this.makeOutputArray(a.outputShape,i);return this.compileAndRun(a,[t,e],o)},r.prototype.ceil=function(t){var e=new ae(t.shape,dM);return this.compileAndRun(e,[t])},r.prototype.floor=function(t){var e=new ae(t.shape,pM);return this.compileAndRun(e,[t])},r.prototype.sign=function(t){var e=new ae(t.shape,vM);return this.compileAndRun(e,[t])},r.prototype.isNaN=function(t){var e=new ae(t.shape,mM),n=this.makeOutputArray(e.outputShape,"bool");return this.compileAndRun(e,[t],n)},r.prototype.isInf=function(t){var e=new ae(t.shape,gM),n=this.makeOutputArray(e.outputShape,"bool");return this.compileAndRun(e,[t],n)},r.prototype.isFinite=function(t){var e=new ae(t.shape,yM),n=this.makeOutputArray(e.outputShape,"bool");return this.compileAndRun(e,[t],n)},r.prototype.round=function(t){var e=new ae(t.shape,xM);return this.compileAndRun(e,[t])},r.prototype.exp=function(t){var e;return e=q.get("WEBGL_PACK")?new gm(t.shape,iw):new ae(t.shape,iw),this.compileAndRun(e,[t])},r.prototype.expm1=function(t){var e=new ae(t.shape,bM);return this.compileAndRun(e,[t])},r.prototype.log=function(t){var e;return e=q.get("WEBGL_PACK")?new gm(t.shape,qM):new ae(t.shape,wM),this.compileAndRun(e,[t])},r.prototype.log1p=function(t){var e=new ae(t.shape,EM);return this.compileAndRun(e,[t])},r.prototype.sqrt=function(t){var e=new ae(t.shape,CM);return this.compileAndRun(e,[t])},r.prototype.rsqrt=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.rsqrt(t);var e=new ae(t.shape,SM);return this.compileAndRun(e,[t])},r.prototype.square=function(t){var e=new ae(t.shape,UM);return this.compileAndRun(e,[t])},r.prototype.reciprocal=function(t){var e=new ae(t.shape,WM);return this.compileAndRun(e,[t])},r.prototype.relu=function(t){var e;return e=q.get("WEBGL_PACK")?new gm(t.shape,RC):new ae(t.shape,SC),this.compileAndRun(e,[t])},r.prototype.prelu=function(t,e){var n=q.get("WEBGL_PACK_BINARY_OPERATIONS")?new Hi(HI,t.shape,e.shape):new an(WI,t.shape,e.shape);return this.compileAndRun(n,[t,e])},r.prototype.elu=function(t){var e=new ae(t.shape,lM);return this.compileAndRun(e,[t])},r.prototype.eluDer=function(t,e){var n=q.get("WEBGL_PACK_BINARY_OPERATIONS")?new Hi(qI,t.shape,e.shape):new an(UI,t.shape,e.shape);return this.compileAndRun(n,[t,e])},r.prototype.selu=function(t){var e=new ae(t.shape,cM);return this.compileAndRun(e,[t])},r.prototype.int=function(t){var e=new ae(t.shape,GM),n=this.makeOutputArray(e.outputShape,"int32");return this.compileAndRun(e,[t],n)},r.prototype.clip=function(t,e,n){var a,i=(a=q.get("WEBGL_PACK_CLIP")?new iN(t.shape):new aN(t.shape)).getCustomSetupFunc(e,n);return this.compileAndRun(a,[t],null,i)},r.prototype.abs=function(t){var e=new ae(t.shape,sM);return this.compileAndRun(e,[t])},r.prototype.complexAbs=function(t){var e=this.texData.get(t.dataId),n=new oN(t.shape),a=[this.makeComplexComponentTensorHandle(t,e.complexTensors.real),this.makeComplexComponentTensorHandle(t,e.complexTensors.imag)];return this.compileAndRun(n,a)},r.prototype.sigmoid=function(t){var e=new ae(t.shape,RM);return this.compileAndRun(e,[t])},r.prototype.softplus=function(t){var e=new ae(t.shape,_M);return this.compileAndRun(e,[t])},r.prototype.sin=function(t){var e=new ae(t.shape,AM);return this.compileAndRun(e,[t])},r.prototype.cos=function(t){var e=new ae(t.shape,TM);return this.compileAndRun(e,[t])},r.prototype.tan=function(t){var e=new ae(t.shape,kM);return this.compileAndRun(e,[t])},r.prototype.asin=function(t){var e=new ae(t.shape,DM);return this.compileAndRun(e,[t])},r.prototype.acos=function(t){var e=new ae(t.shape,IM);return this.compileAndRun(e,[t])},r.prototype.atan=function(t){var e=new ae(t.shape,NM);return this.compileAndRun(e,[t])},r.prototype.atan2=function(t,e){var n=q.get("WEBGL_PACK_BINARY_OPERATIONS")?new Hi(jI,t.shape,e.shape):new an(zI,t.shape,e.shape);return this.compileAndRun(n,[t,e])},r.prototype.sinh=function(t){var e=new ae(t.shape,OM);return this.compileAndRun(e,[t])},r.prototype.cosh=function(t){var e=new ae(t.shape,MM);return this.compileAndRun(e,[t])},r.prototype.tanh=function(t){var e=new ae(t.shape,BM);return this.compileAndRun(e,[t])},r.prototype.asinh=function(t){var e=new ae(t.shape,PM);return this.compileAndRun(e,[t])},r.prototype.acosh=function(t){var e=new ae(t.shape,FM);return this.compileAndRun(e,[t])},r.prototype.atanh=function(t){var e=new ae(t.shape,LM);return this.compileAndRun(e,[t])},r.prototype.erf=function(t){var e=new ae(t.shape,zM);return this.compileAndRun(e,[t])},r.prototype.step=function(t,e){var n=new ae(t.shape,hM(e));return this.compileAndRun(n,[t])},r.prototype.conv2dByMatMul=function(t,e,n){var a=t.shape,i=this.texData.get(t.dataId),o=n.inChannels,u=a[0]*a[1]*a[2],l=n.outChannels,h=(u===1||l===1)&&o>uw,f=a[2]%2!=0&&!!i.isPacked;if(h||!q.get("WEBGL_LAZILY_UNPACK")||!q.get("WEBGL_PACK_BINARY_OPERATIONS")||!f){var p=this.reshape(t,[1,a[0]*a[1]*a[2],n.inChannels]),v=this.reshape(e,[1,n.inChannels,n.outChannels]);return this.reshape(this.batchMatMul(p,v,!1,!1),n.outShape)}var m=kt.make([1,a[0]*a[1]*(a[2]+1),n.inChannels],{dataId:t.dataId},t.dtype,this),x=i.shape;i.shape=i.shape.slice(),i.shape[i.shape.length-2]++,Y(Rf(i.shape,m.shape),function(){return"packed reshape "+i.shape+" to "+m.shape+" isn't free"});var b=this.reshape(e,[1,n.inChannels,n.outChannels]),E=this.batchMatMul(m,b,!1,!1),C=this.texData.get(E.dataId);return Y(C.isPacked,function(){return"batchMatMul result is expected to be packed"}),i.shape=x,C.shape=n.outShape,kt.make(n.outShape,{dataId:E.dataId},E.dtype,this)},r.prototype.conv2dWithIm2Row=function(t,e,n){var a=n.filterWidth,i=n.filterHeight,o=n.inChannels,u=n.outWidth,l=n.outHeight,h=a*i*o,f=l*u,p=[h,f],v=t.squeeze([0]),m=e.reshape([1,h,-1]),x=new RO(p,v.shape,n),b=this.compileAndRun(x,[v]).reshape([1,p[0],p[1]]),E=new vm(b.shape,[1,f,n.outChannels],!0,!1);return this.compileAndRun(E,[b,m]).reshape([1,l,u,n.outChannels])},r.prototype.conv2d=function(t,e,n){if(n.filterHeight===1&&n.filterWidth===1&&n.dilationHeight===1&&n.dilationWidth===1&&n.strideHeight===1&&n.strideWidth===1&&(n.padInfo.type==="SAME"||n.padInfo.type==="VALID"))return this.conv2dByMatMul(t,e,n);if(q.get("WEBGL_CONV_IM2COL")&&t.shape[0]===1)return this.conv2dWithIm2Row(t,e,n);var a=new vN(n);return this.compileAndRun(a,[t,e])},r.prototype.conv2dDerInput=function(t,e,n){var a=new cN(n);return this.compileAndRun(a,[t,e])},r.prototype.conv2dDerFilter=function(t,e,n){var a=new lN(n);return this.compileAndRun(a,[t,e])},r.prototype.depthwiseConv2D=function(t,e,n){var a;return q.get("WEBGL_PACK_DEPTHWISECONV")&&n.strideWidth<=2&&n.outChannels/n.inChannels==1?(a=new yN(n),this.compileAndRun(a,[t,e],this.makePackedTensor(n.outShape,t.dtype))):(a=new gN(n),this.compileAndRun(a,[t,e]))},r.prototype.depthwiseConv2DDerInput=function(t,e,n){var a=new pN(n);return this.compileAndRun(a,[t,e])},r.prototype.depthwiseConv2DDerFilter=function(t,e,n){var a=new dN(n);return this.compileAndRun(a,[t,e])},r.prototype.conv3d=function(t,e,n){var a=new mN(n);return this.compileAndRun(a,[t,e])},r.prototype.conv3dDerInput=function(t,e,n){var a=new fN(n);return this.compileAndRun(a,[t,e])},r.prototype.conv3dDerFilter=function(t,e,n){var a=new hN(n);return this.compileAndRun(a,[t,e])},r.prototype.maxPool=function(t,e){var n=new mm(e,"max",!1),a=this.makeOutputArray(n.outputShape,t.dtype);return this.compileAndRun(n,[t],a)},r.prototype.avgPool=function(t,e){var n=new mm(e,"avg",!1),a=this.makeOutputArray(n.outputShape,"float32");return this.compileAndRun(n,[t],a)},r.prototype.maxPoolBackprop=function(t,e,n,a){var i=new mm(a,"max",!0),o=this.compileAndRun(i,[e]),u=new TO(a),l=this.makeOutputArray(u.outputShape,e.dtype),h=this.compileAndRun(u,[t,o],l);return o.dispose(),h},r.prototype.avgPoolBackprop=function(t,e,n){var a=new EI(n),i=this.makeOutputArray(a.outputShape,e.dtype);return this.compileAndRun(a,[t],i)},r.prototype.cast=function(t,e){return uC(t,e,this)},r.prototype.unstack=function(t,e){for(var n=t.shape[e],a=new Array(t.rank-1),i=0,o=0;o<t.rank;o++)o!==e&&(a[i++]=t.shape[o]);var u=new Array(t.rank).fill(0),l=t.shape.slice();l[e]=1;var h=new Array(n);for(o=0;o<h.length;o++)u[e]=o,h[o]=this.slice(t,u,l).reshape(a);return h},r.prototype.reshape=function(t,e){var n=this.texData.get(t.dataId);return!n.isPacked||Rf(t.shape,e)||n.texture!==null&&Rf(n.shape,e)?rg(t,e):this.packedReshape(t,e)},r.prototype.resizeBilinear=function(t,e,n,a){var i=q.get("WEBGL_PACK_IMAGE_OPERATIONS")?new HO(t.shape,e,n,a):new GO(t.shape,e,n,a);return this.compileAndRun(i,[t])},r.prototype.resizeBilinearBackprop=function(t,e,n){var a=new VO(t,e,n);return this.compileAndRun(a,[t])},r.prototype.resizeNearestNeighbor=function(t,e,n,a){var i=new jO(t.shape,e,n,a);return this.compileAndRun(i,[t])},r.prototype.resizeNearestNeighborBackprop=function(t,e,n){var a=new qO(t,e,n);return this.compileAndRun(a,[t])},r.prototype.multinomial=function(t,e,n,a){var i=e?t:Jo(t),o=i.shape[0],u=i.shape[1],l=new kO(o,u,n),h=this.makeOutputArray(l.outputShape,"int32"),f=l.getCustomSetupFunc(a);return this.compileAndRun(l,[i],h,f)},r.prototype.oneHot=function(t,e,n,a){var i=new DO(t.size,e,n,a);return this.compileAndRun(i,[t])},r.prototype.nonMaxSuppression=function(t,e,n,a,i){return ng("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),zg(t.dataSync(),e.dataSync(),n,a,i)},r.prototype.cropAndResize=function(t,e,n,a,i,o){var u=new xN(t.shape,e.shape,a,i,o);return this.compileAndRun(u,[t,e,n])},r.prototype.depthToSpace=function(t,e,n){Y(e>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+e});var a=t.shape[0],i=n==="NHWC"?t.shape[1]:t.shape[2],o=n==="NHWC"?t.shape[2]:t.shape[3],u=n==="NHWC"?t.shape[3]:t.shape[1],l=i*e,h=o*e,f=u/(e*e),p=new EN(n==="NHWC"?[a,l,h,f]:[a,f,l,h],e,n);return this.compileAndRun(p,[t])},r.prototype.split=function(t,e,n){return lC(t,e,n)},r.prototype.scatterND=function(t,e,n){var a=Zf(e,t,n),i=a.sliceRank,o=a.numUpdates,u=a.sliceSize,l=a.strides,h=a.outputSize,f=[h/u,u],p=t.reshape([o,i]),v=e.reshape([o,u]);if(h===0)return rg(bn([]),n);var m=Tt(0),x=new nw(o,i,p.rank,v.rank,l,f);return this.compileAndRun(x,[v,p,m]).reshape(n)},r.prototype.sparseToDense=function(t,e,n,a){var i=Zf(e,t,n),o=i.sliceRank,u=i.numUpdates,l=i.strides,h=i.outputSize,f=new nw(u,o,t.rank,e.rank,l,[h,1],!1);return this.compileAndRun(f,[e,t,a]).reshape(n)},r.prototype.fft=function(t){return this.fftImpl(t,!1)},r.prototype.ifft=function(t){return this.fftImpl(t,!0)},r.prototype.fftImpl=function(t,e){var n=this.texData.get(t.dataId),a=new $1(Z1.REAL,t.shape,e),i=new $1(Z1.IMAG,t.shape,e),o=[this.makeComplexComponentTensorHandle(t,n.complexTensors.real),this.makeComplexComponentTensorHandle(t,n.complexTensors.imag)],u=this.compileAndRun(a,o),l=this.compileAndRun(i,o),h=this.complex(u,l).as2D(t.shape[0],t.shape[1]);return u.dispose(),l.dispose(),h},r.prototype.gatherND=function(t,e){var n=e.shape,a=n[n.length-1],i=tC(t,e),o=i[0],u=i[1],l=i[2],h=i[3],f=e.reshape([u,a]),p=t.reshape([t.size/l,l]),v=new TN(a,h,[u,l]);return this.compileAndRun(v,[p,f]).reshape(o)},r.prototype.fill=function(t,e,n){if((n=n||zc(e))==="string"){var a=qf(n,qt(t));return a.fill(e),kt.make(t,{values:a},n)}var i=new SN(t,e),o=i.getCustomSetupFunc(e),u=this.makeOutputArray(t,n);return this.compileAndRun(i,[],u,o)},r.prototype.onesLike=function(t){if(t.dtype==="string")throw new Error("onesLike is not supported under string dtype");return this.fill(t.shape,1,t.dtype)},r.prototype.zerosLike=function(t){return this.fill(t.shape,t.dtype==="string"?"":0,t.dtype)},r.prototype.makeOutputArray=function(t,e){return kt.make(t,{},e,this)},r.prototype.makePackedTensor=function(t,e){var n=kt.make(t,{},e,this);return this.texData.get(n.dataId).isPacked=!0,n},r.prototype.unpackTensor=function(t){var e=new jM(t.shape);return this.compileAndRun(e,[t],kt.make(e.outputShape,{},t.dtype,this))},r.prototype.packTensor=function(t){var e=new IO(t.shape);return this.compileAndRun(e,[t],this.makePackedTensor(t.shape,t.dtype))},r.prototype.packedReshape=function(t,e){var n=t.reshape([Ls(t.shape)].concat(zs(t.shape))),a=[Ls(e)].concat(zs(e)),i=new zO(a,n.shape);return this.compileAndRun(i,[n]).reshape(e)},r.prototype.compileAndRun=function(t,e,n,a,i){var o=this;if(i===void 0&&(i=!0),n==null&&(n=t.usesPackedTextures?this.makePackedTensor(t.outputShape,e[0].dtype):this.makeOutputArray(t.outputShape,e[0].dtype)),n.size===0)return this.texData.get(n.dataId).values=Ym(n.dtype,0),n;var u=e.map(function(_){if(_.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var A=o.texData.get(_.dataId);if(A.texture==null){if(!t.usesPackedTextures&&qt(_.shape)<=q.get("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:_.shape,texData:null,isUniform:!0,uniformValues:o.readSync(_.dataId)};t.usesPackedTextures&&(A.isPacked=!0,A.shape=_.shape)}else if(!!A.isPacked!=!!t.usesPackedTextures)_=A.isPacked?o.unpackTensor(_):o.packTensor(_),A=o.texData.get(_.dataId);else if(A.isPacked&&!Rf(A.shape,_.shape)){var k=_,D=_.shape;_.shape=A.shape,_=o.packedReshape(_,D),A=o.texData.get(_.dataId),k.shape=D}return o.uploadToGPU(_.dataId),{shape:_.shape,texData:A,isUniform:!1}});this.uploadToGPU(n.dataId);var l,h={shape:n.shape,texData:this.texData.get(n.dataId),isUniform:!1},f=SO(t,u,h),p=this.getAndSaveBinary(f,function(){return EO(o.gpgpu,t,u,h)}),v=this.activeTimers!=null;v&&(l=this.startTimer()),CO(this.gpgpu,p,u,h,a);var m=1024*q.get("WEBGL_NUM_MB_BEFORE_PAGING");if(i&&this.numBytesInGPU>m)for(var x=this.numBytesInGPU-m;x>0&&this.lruDataGPU.length>0;){var b=this.lruDataGPU.shift(),E=this.texData.get(b),C=E.texShape,R=E.dtype;x-=this.computeBytes(C,R),this.read(b)}return v&&(l=this.endTimer(l),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(l)})),q.get("WEBGL_LAZILY_UNPACK")||!this.texData.get(n.dataId).isPacked||t.isPackShader?n:this.unpackTensor(n)},r.prototype.getAndSaveBinary=function(t,e){return t in this.binaryCache||(this.binaryCache[t]=e()),this.binaryCache[t]},r.prototype.getTextureManager=function(){return this.textureManager},r.prototype.dispose=function(){this.disposed||(this.textureManager.dispose(),this.canvas.remove(),this.fromPixels2DContext!=null&&this.fromPixels2DContext.canvas.remove(),this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},r.prototype.floatPrecision=function(){var t=this;return Ht(function(){var e=q.get("DEBUG");q.set("DEBUG",!1);var n=t.abs(Tt(1e-8)).dataSync()[0];return q.set("DEBUG",e),n>0?32:16})},r.prototype.uploadToGPU=function(t){var e,n=this.texData.get(t),a=n.shape,i=n.dtype,o=n.values,u=n.texture,l=n.usage,h=n.isPacked;if(u==null){var f,p=this.activeTimers!=null;p&&(f=performance.now());var v=tO(a,h);n.texShape=v;var m=this.acquireTexture(t,v,l,i,h);if(n.texture=m,o!=null){if(h){var x=Ls(a),b=1,E=1;a.length&&(b=(e=zs(a))[0],E=e[1]),this.gpgpu.uploadMatrixToPackedTexture(m,x,b,E,v[0],v[1],sw(o))}else this.gpgpu.uploadMatrixToTexture(m,v[0],v[1],sw(o));n.values=null,p&&(this.uploadWaitMs+=performance.now()-f)}}else q.get("WEBGL_NUM_MB_BEFORE_PAGING")<Number.POSITIVE_INFINITY&&this.lruDataGPU.indexOf(t)>=0&&(this.lruDataGPU.splice(this.lruDataGPU.indexOf(t),1),this.lruDataGPU.push(t))},r.prototype.convertAndCacheOnCPU=function(t,e){var n=this.texData.get(t),a=n.texture,i=n.texShape,o=n.dtype,u=n.usage,l=n.isPacked;return a!=null&&(this.releaseTexture(t,a,i,u,o,l),n.texture=null,n.texShape=null,n.isPacked=!1),n.usage=fi.UPLOAD,e!=null&&(n.values=tP(e,o)),n.values},r.prototype.releaseTexture=function(t,e,n,a,i,o){if(q.get("WEBGL_NUM_MB_BEFORE_PAGING")<Number.POSITIVE_INFINITY){var u=this.lruDataGPU.indexOf(t);u>=0&&this.lruDataGPU.splice(u,1)}this.numBytesInGPU-=this.computeBytes(n,i),this.textureManager.releaseTexture(e,n,a,o)},r.prototype.acquireTexture=function(t,e,n,a,i){return q.get("WEBGL_NUM_MB_BEFORE_PAGING")<Number.POSITIVE_INFINITY&&this.lruDataGPU.push(t),this.numBytesInGPU+=this.computeBytes(e,a),this.textureManager.acquireTexture(e,n,i)},r.prototype.computeBytes=function(t,e){return t[0]*t[1]*PE(e)},r})();function tP(r,t){if(t==="float32"||t==="complex64")return r;if(t==="int32"||t==="bool"){for(var e=t==="int32"?new Int32Array(r.length):new Uint8Array(r.length),n=0;n<e.length;++n)e[n]=Math.round(r[n]);return e}throw new Error("Unknown dtype "+t)}function sw(r){return r instanceof Float32Array?r:new Float32Array(r)}function eP(r){var t=H(r,"x","neg");return q.engine.runKernel(function(e){return e.neg(t)},{$x:t},function(e){return{$x:function(){return e.neg()}}})}function nP(r){var t=H(r,"x","ceil");return q.engine.runKernel(function(e){return e.ceil(t)},{$x:t},function(e){return{$x:function(){return Ce(e)}}})}function rP(r){var t=H(r,"x","floor");return q.engine.runKernel(function(e){return e.floor(t)},{$x:t},function(e){return{$x:function(){return Ce(e)}}})}function aP(r){var t=H(r,"x","sign");return q.engine.runKernel(function(e){return e.sign(t)},{$x:t},function(e){return{$x:function(){return Ce(e)}}})}function iP(r){var t=H(r,"x","isNaN");return q.engine.runKernel(function(e){return e.isNaN(t)},{$x:t},function(e){return{$x:function(){return Ce(e)}}})}function oP(r){var t=H(r,"x","isInf");return q.engine.runKernel(function(e){return e.isInf(t)},{$x:t},function(e){return{$x:function(){return Ce(e)}}})}function uP(r){var t=H(r,"x","isFinite");return q.engine.runKernel(function(e){return e.isFinite(t)},{$x:t},function(e){return{$x:function(){return Ce(e)}}})}function sP(r){var t=H(r,"x","round");return q.engine.runKernel(function(e){return e.round(t)},{$x:t},function(e){return{$x:function(){return Ce(e)}}})}function lP(r){var t=H(r,"x","exp");return q.engine.runKernel(function(e,n){var a=e.exp(t);return n([a]),a},{$x:t},function(e,n){return{$x:function(){return e.mulStrict(n[0])}}})}function cP(r){var t=H(r,"x","expm1");return q.engine.runKernel(function(e,n){var a=e.expm1(t);return n([t]),a},{$x:t},function(e,n){var a=n[0];return{$x:function(){return e.mul(a.exp())}}})}function hP(r){var t=H(r,"x","log");return q.engine.runKernel(function(e,n){var a=e.log(t);return n([t]),a},{$x:t},function(e,n){var a=n[0];return{$x:function(){return e.div(a.toFloat())}}})}function fP(r){var t=H(r,"x","log1p");return q.engine.runKernel(function(e,n){var a=e.log1p(t);return n([t]),a},{$x:t},function(e,n){var a=n[0];return{$x:function(){return e.div(a.add(1))}}})}function dP(r){var t=H(r,"x","sqrt");return q.engine.runKernel(function(e,n){var a=e.sqrt(t);return n([t]),a},{$x:t},function(e,n){var a=n[0];return{$x:function(){return e.div(a.toFloat().sqrt().mul(2))}}})}function pP(r){var t=H(r,"x","rsqrt");return q.engine.runKernel(function(e,n){var a=e.rsqrt(t);return n([t]),a},{$x:t},function(e,n){var a=n[0];return{$x:function(){return e.div(a.pow(1.5).mul(2)).neg()}}})}function vP(r){var t=H(r,"x","square");return q.engine.runKernel(function(e,n){return n([t]),e.square(t)},{$x:t},function(e,n){var a=n[0];return{$x:function(){return e.mul(a.toFloat().mul(2))}}})}function mP(r){var t=H(r,"x","reciprocal");return q.engine.runKernel(function(e,n){var a=e.reciprocal(t);return n([t]),a},{$x:t},function(e,n){var a=n[0];return{$x:function(){return e.div(a.square().neg())}}})}function gP(r){var t=H(r,"x","abs");return t.dtype==="complex64"?q.engine.runKernel(function(e){return e.complexAbs(t)},{$x:t}):q.engine.runKernel(function(e,n){var a=e.abs(t);return n([t]),a},{$x:t},function(e,n){var a=n[0];return{$x:function(){return e.mul(a.toFloat().step(-1))}}})}function yP(r,t,e){var n=H(r,"x","clipByValue");return Y(t<=e,function(){return"Error in clip: min ("+t+") must be less than or equal to max ("+e+")."}),q.engine.runKernel(function(a,i){var o=a.clip(n,t,e);return i([n]),o},{$x:n},function(a,i){var o=i[0];return{$x:function(){return a.where(o.greaterEqual(t).logicalAnd(o.lessEqual(e)),Ce(a))}}})}function xP(r){var t=H(r,"x","sigmoid");return q.engine.runKernel(function(e,n){var a=e.sigmoid(t);return n([a]),a},{$x:t},function(e,n){var a=n[0];return{$x:function(){return e.mul(a.mul(Tt(1).sub(a)))}}})}function bP(r){var t=H(r,"x","logSigmoid");return q.engine.runKernel(function(e,n){var a=e.softplus(t.neg()).neg();return n([t]),a},{$x:t},function(e,n){var a=n[0];return{$x:function(){return e.mul(a.neg().sigmoid())}}})}function wP(r){var t=H(r,"x","softplus");return q.engine.runKernel(function(e,n){var a=e.softplus(t);return n([t]),a},{$x:t},function(e,n){var a=n[0];return{$x:function(){return e.mul(a.sigmoid())}}})}function EP(r){var t=H(r,"x","sin");return q.engine.runKernel(function(e,n){var a=e.sin(t);return n([t]),a},{$x:t},function(e,n){var a=n[0];return{$x:function(){return a.toFloat().cos().mul(e)}}})}function CP(r){var t=H(r,"x","cos");return q.engine.runKernel(function(e,n){var a=e.cos(t);return n([t]),a},{$x:t},function(e,n){var a=n[0];return{$x:function(){return a.toFloat().sin().neg().mul(e)}}})}function SP(r){var t=H(r,"x","tan");return q.engine.runKernel(function(e,n){var a=e.tan(t);return n([t]),a},{$x:t},function(e,n){var a=n[0];return{$x:function(){return e.div(a.cos().square())}}})}function RP(r){var t=H(r,"x","asin");return q.engine.runKernel(function(e,n){var a=e.asin(t);return n([t]),a},{$x:t},function(e,n){var a=n[0];return{$x:function(){return e.divStrict(Tt(1).sub(a.toFloat().square()).sqrt())}}})}function _P(r){var t=H(r,"x","acos");return q.engine.runKernel(function(e,n){var a=e.acos(t);return n([t]),a},{$x:t},function(e,n){var a=n[0];return{$x:function(){return e.divStrict(Tt(1).sub(a.toFloat().square()).sqrt()).neg()}}})}function AP(r){var t=H(r,"x","atan");return q.engine.runKernel(function(e,n){var a=e.atan(t);return n([t]),a},{$x:t},function(e,n){var a=n[0];return{$x:function(){return e.div(a.toFloat().square().add(1))}}})}function TP(r){var t=H(r,"x","sinh");return q.engine.runKernel(function(e,n){var a=e.sinh(t);return n([t]),a},{$x:t},function(e,n){var a=n[0];return{$x:function(){return a.toFloat().cosh().mulStrict(e)}}})}function kP(r){var t=H(r,"x","cosh");return q.engine.runKernel(function(e,n){var a=e.cosh(t);return n([t]),a},{$x:t},function(e,n){var a=n[0];return{$x:function(){return a.toFloat().sinh().mulStrict(e)}}})}function DP(r){var t=H(r,"x","tanh");return q.engine.runKernel(function(e,n){var a=e.tanh(t);return n([a]),a},{$x:t},function(e,n){var a=n[0];return{$x:function(){return Tt(1).sub(a.square()).mulStrict(e)}}})}function IP(r){var t=H(r,"x","asinh");return q.engine.runKernel(function(e,n){var a=e.asinh(t);return n([t]),a},{$x:t},function(e,n){var a=n[0];return{$x:function(){return e.divStrict(Tt(1).add(a.toFloat().square()).sqrt())}}})}function NP(r){var t=H(r,"x","acosh");return q.engine.runKernel(function(e,n){var a=e.acosh(t);return n([t]),a},{$x:t},function(e,n){var a=n[0];return{$x:function(){return e.divStrict(a.toFloat().square().sub(1).sqrt())}}})}function OP(r){var t=H(r,"x","atanh");return q.engine.runKernel(function(e,n){var a=e.atanh(t);return n([t]),a},{$x:t},function(e,n){var a=n[0];return{$x:function(){return e.div(Tt(1).sub(a.toFloat().square()))}}})}function MP(r){var t=H(r,"x","erf");return Y(t.dtype==="int32"||t.dtype==="float32",function(){return"Input dtype must be `int32` or `float32`."}),t.dtype==="int32"&&(t=t.toFloat()),q.engine.runKernel(function(e,n){var a=e.erf(t);return n([t]),a},{$x:t},function(e,n){var a=n[0];return{$x:function(){return e.mul(a.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}function BP(r,t){t===void 0&&(t=0);var e=H(r,"x","step");return q.engine.runKernel(function(n){return n.step(e,t)},{$x:e},function(n){return{$x:function(){return Ce(n)}}})}q.get("IS_BROWSER")&&q.registerBackend("webgl",function(){return new JB},2);var PP=it({abs_:gP}),FP=it({acos_:_P}),LP=it({acosh_:NP}),zP=it({asin_:RP}),UP=it({asinh_:IP}),WP=it({atan_:AP}),VP=it({atanh_:OP}),GP=it({ceil_:nP}),jg=it({clipByValue_:yP}),HP=it({cos_:CP}),qP=it({cosh_:kP}),jP=it({erf_:MP}),og=it({exp_:lP}),XP=it({expm1_:cP}),KP=it({floor_:rP}),YP=it({log_:hP}),QP=it({log1p_:fP}),ZP=it({logSigmoid_:bP}),$f=it({neg_:eP}),$P=it({reciprocal_:mP}),JP=it({round_:sP}),NC=it({rsqrt_:pP}),OC=it({sigmoid_:xP}),t4=it({sign_:aP}),e4=it({isNaN_:iP}),n4=it({isInf_:oP}),r4=it({isFinite_:uP}),a4=it({sin_:EP}),i4=it({sinh_:TP}),o4=it({softplus_:wP}),u4=it({sqrt_:dP}),s4=it({square_:vP}),l4=it({step_:BP}),c4=it({tan_:SP}),h4=it({tanh_:DP});function MC(r,t,e,n,a,i){var o,u,l=H(r,"x","batchNorm"),h=H(t,"mean","batchNorm"),f=H(e,"variance","batchNorm");return a!=null&&(o=H(a,"scale","batchNorm")),n!=null&&(u=H(n,"offset","batchNorm")),Y(l.rank===2,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+l.rank+"."}),Y(h.rank===2||h.rank===1,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+h.rank+"."}),Y(f.rank===2||f.rank===1,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+f.rank+"."}),o!=null&&Y(o.rank===2||o.rank===1,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+o.rank+"."}),u!=null&&Y(u.rank===2||u.rank===1,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+u.rank+"."}),Kc(l,h,f,u,o,i)}function BC(r,t,e,n,a,i){var o,u,l=H(r,"x","batchNorm"),h=H(t,"mean","batchNorm"),f=H(e,"variance","batchNorm");return a!=null&&(o=H(a,"scale","batchNorm")),n!=null&&(u=H(n,"offset","batchNorm")),Y(l.rank===3,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+l.rank+"."}),Y(h.rank===3||h.rank===1,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+h.rank+"."}),Y(f.rank===3||f.rank===1,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+f.rank+"."}),o!=null&&Y(o.rank===3||o.rank===1,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+o.rank+"."}),u!=null&&Y(u.rank===3||u.rank===1,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+u.rank+"."}),Kc(l,h,f,u,o,i)}function PC(r,t,e,n,a,i){var o,u,l=H(r,"x","batchNorm"),h=H(t,"mean","batchNorm"),f=H(e,"variance","batchNorm");return a!=null&&(o=H(a,"scale","batchNorm")),n!=null&&(u=H(n,"offset","batchNorm")),Y(l.rank===4,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+l.rank+"."}),Y(h.rank===4||h.rank===1,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+h.rank+"."}),Y(f.rank===4||f.rank===1,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+f.rank+"."}),o!=null&&Y(o.rank===4||o.rank===1,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+o.rank+"."}),u!=null&&Y(u.rank===4||u.rank===1,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+u.rank+"."}),Kc(l,h,f,u,o,i)}function f4(r,t,e,n,a,i){return n===void 0&&(n=.001),Ad(),Kc(r,t,e,i,a,n)}function Kc(r,t,e,n,a,i){i==null&&(i=.001);var o,u,l,h=H(r,"x","batchNorm"),f=H(t,"mean","batchNorm"),p=H(e,"variance","batchNorm");return a!=null&&(o=H(a,"scale","batchNorm")),n!=null&&(u=H(n,"offset","batchNorm")),Y(f.rank===p.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),Y(u==null||f.rank===u.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),Y(o==null||f.rank===o.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),l=h.rank===0||h.rank===1?h.as4D(1,1,1,h.size):h.rank===2?h.as4D(1,1,h.shape[0],h.shape[1]):h.rank===3?h.as4D(1,h.shape[0],h.shape[1],h.shape[2]):h,q.engine.runKernel(function(v,m){var x=v.batchNormalization(l,Af(f),Af(p),i,Af(o),Af(u));return m([h,f,p,o]),x},{$x:h,$mean:f,$variance:p,$scale:o,$offset:u},function(v,m){var x=m[0],b=m[1],E=m[2],C=m[3],R=C??Tt(1),_=Dn(b.shape,l.shape),A=[];if(b.rank===1){for(var k=0;k<l.shape.length-1;++k)A.push(l.shape[k]);A.push(1)}var D=x.sub(b),P=v.mul(R),M=NC(E.add(Tt(i))),O=M.mul(M).mul(M).mul(Tt(-.5));return{$x:function(){return b.rank===1?v.mul(Xs(M.as4D(1,1,1,b.shape[0]),A)).mul(R).reshape(x.shape):v.mul(M).mul(R).reshape(x.shape)},$mean:function(){var F=M.mul(Tt(-1)).mul(P);return b.rank===1&&(F=F.sum(_)),F.reshape(b.shape)},$variance:function(){var F=O.mul(D).mul(P);return b.rank===1&&(F=F.sum(_)),F.reshape(b.shape)},$scale:function(){var F=D.mul(M),W=v.mul(F);return b.rank===1&&(W=W.sum(_)),W.reshape(b.shape)},$offset:function(){var F=v;return b.rank===1&&(F=F.sum(_)),F.reshape(b.shape)}}}).reshape(h.shape)}function Af(r){return r==null?null:r.rank===0?r.as1D():r.rank===1?r:r.rank===2?r.as4D(1,1,r.shape[0],r.shape[1]):r.rank===3?r.as4D(1,r.shape[0],r.shape[1],r.shape[2]):r}function d4(r,t,e,n,a,i){return n===void 0&&(n=.001),Ad(),MC(r,t,e,i,a,n)}function p4(r,t,e,n,a,i){return n===void 0&&(n=.001),Ad(),BC(r,t,e,i,a,n)}function v4(r,t,e,n,a,i){return n===void 0&&(n=.001),Ad(),PC(r,t,e,i,a,n)}function Ad(){YE("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var m4=it({batchNormalization2d_:d4}),g4=it({batchNormalization3d_:p4}),y4=it({batchNormalization4d_:v4}),x4=it({batchNormalization_:f4}),FC=it({batchNorm_:Kc}),b4=it({batchNorm2d_:MC}),w4=it({batchNorm3d_:BC}),E4=it({batchNorm4d_:PC});function Yc(r,t,e,n,a,i,o){o===void 0&&(o="channelsLast");var u,l=Jf(t),h=l[0],f=l[1];if(o==="channelsLast")u=[h,f,r[3],r[3]];else{if(o!=="channelsFirst")throw new Error("Unknown dataFormat "+o);u=[h,f,r[1],r[1]]}return Qc(r,u,e,n,a,i,!1,o)}function Qc(r,t,e,n,a,i,o,u){o===void 0&&(o=!1),u===void 0&&(u="channelsLast");var l=[-1,-1,-1,-1],h=l[0],f=l[1],p=l[2],v=l[3];if(u==="channelsLast")h=r[0],f=r[1],p=r[2],v=r[3];else{if(u!=="channelsFirst")throw new Error("Unknown dataFormat "+u);h=r[0],v=r[1],f=r[2],p=r[3]}var m,x=t[0],b=t[1],E=t[3],C=Jf(e),R=C[0],_=C[1],A=Jf(n),k=A[0],D=A[1],P=Ks(x,k),M=Ks(b,D),O=R4(a,f,p,R,_,P,M,i),F=O.padInfo,W=O.outHeight,j=O.outWidth,ot=o?E*v:E;return u==="channelsFirst"?m=[h,ot,W,j]:u==="channelsLast"&&(m=[h,W,j,ot]),{batchSize:h,dataFormat:u,inHeight:f,inWidth:p,inChannels:v,outHeight:W,outWidth:j,outChannels:ot,padInfo:F,strideHeight:R,strideWidth:_,filterHeight:x,filterWidth:b,effectiveFilterHeight:P,effectiveFilterWidth:M,dilationHeight:k,dilationWidth:D,inShape:r,outShape:m,filterShape:t}}function Xg(r,t,e,n,a,i,o){i===void 0&&(i=!1),o===void 0&&(o="channelsLast");var u=[-1,-1,-1,-1,-1],l=u[0],h=u[1],f=u[2],p=u[3],v=u[4];if(o==="channelsLast")l=r[0],h=r[1],f=r[2],p=r[3],v=r[4];else{if(o!=="channelsFirst")throw new Error("Unknown dataFormat "+o);l=r[0],v=r[1],h=r[2],f=r[3],p=r[4]}var m,x=t[0],b=t[1],E=t[2],C=t[4],R=lw(e),_=R[0],A=R[1],k=R[2],D=lw(n),P=D[0],M=D[1],O=D[2],F=_4(a,h,f,p,_,A,k,Ks(x,P),Ks(b,M),Ks(E,O)),W=F.padInfo,j=F.outDepth,ot=F.outHeight,nt=F.outWidth,at=i?C*v:C;return o==="channelsFirst"?m=[l,at,j,ot,nt]:o==="channelsLast"&&(m=[l,j,ot,nt,at]),{batchSize:l,dataFormat:o,inDepth:h,inHeight:f,inWidth:p,inChannels:v,outDepth:j,outHeight:ot,outWidth:nt,outChannels:at,padInfo:W,strideDepth:_,strideHeight:A,strideWidth:k,filterDepth:x,filterHeight:b,filterWidth:E,dilationDepth:P,dilationHeight:M,dilationWidth:O,inShape:r,outShape:m,filterShape:t}}function C4(r,t,e,n,a,i){a==null&&(a=S4(r,t,n));var o=r[0],u=r[1],l=cw((o-t+2*a)/n+1,i);Y(xa(l),function(){return"The output # of rows ("+l+") must be an integer. Change the stride and/or zero pad parameters"});var h=cw((u-t+2*a)/n+1,i);return Y(xa(h),function(){return"The output # of columns ("+h+") must be an integer. Change the stride and/or zero pad parameters"}),[l,h,e]}function S4(r,t,e,n){n===void 0&&(n=1);var a=Ks(t,n);return Math.floor((r[0]*(e-1)-e+a)/2)}function Jf(r){return typeof r=="number"?[r,r]:r}function lw(r){return typeof r=="number"?[r,r,r]:r}function Ks(r,t){return t<=1?r:r+(r-1)*(t-1)}function R4(r,t,e,n,a,i,o,u){var l,h,f;if(typeof r=="number"){l={top:r,bottom:r,left:r,right:r,type:r===0?"VALID":"NUMBER"};var p=C4([t,e,1],i,1,n,r,u);h=p[0],f=p[1]}else if(r==="same"){h=Math.ceil(t/n),f=Math.ceil(e/a);var v=Math.max(0,(h-1)*n+i-t),m=Math.max(0,(f-1)*a+o-e),x=Math.floor(v/2),b=v-x,E=Math.floor(m/2);l={top:x,bottom:b,left:E,right:m-E,type:"SAME"}}else{if(r!=="valid")throw Error("Unknown padding parameter: "+r);l={top:0,bottom:0,left:0,right:0,type:"VALID"},h=Math.ceil((t-i+1)/n),f=Math.ceil((e-o+1)/a)}return{padInfo:l,outHeight:h,outWidth:f}}function _4(r,t,e,n,a,i,o,u,l,h){var f,p,v,m;if(r==="same"){var x=((p=Math.ceil(t/a))-1)*a+u-t,b=((v=Math.ceil(e/i))-1)*i+l-e,E=((m=Math.ceil(n/o))-1)*o+h-n,C=Math.floor(x/2),R=x-C,_=Math.floor(b/2),A=b-_,k=Math.floor(E/2);f={top:_,bottom:A,left:k,right:E-k,front:C,back:R,type:"SAME"}}else{if(r!=="valid")throw Error("Unknown padding parameter: "+r);f={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},p=Math.ceil((t-u+1)/a),v=Math.ceil((e-l+1)/i),m=Math.ceil((n-h+1)/o)}return{padInfo:f,outDepth:p,outHeight:v,outWidth:m}}function cw(r,t){if(!t)return r;switch(t){case"round":return Math.round(r);case"ceil":return Math.ceil(r);case"floor":return Math.floor(r);default:throw new Error("Unknown roundingMode "+t)}}function td(r){var t=Jf(r),e=t[0],n=t[1];return e===1&&n===1}function tu(r,t){return td(r)||td(t)}function A4(r,t,e,n,a,i,o){a===void 0&&(a="NWC"),i===void 0&&(i=1);var u=H(r,"x","conv1d"),l=H(t,"filter","conv1d"),h=u,f=!1;u.rank===2&&(f=!0,h=u.as3D(1,u.shape[0],u.shape[1])),Y(h.rank===3,function(){return"Error in conv1d: input must be rank 3, but got rank "+h.rank+"."}),Y(l.rank===3,function(){return"Error in conv1d: filter must be rank 3, but got rank "+l.rank+"."}),o!=null&&Y(xa(n),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+n+"."}),Y(h.shape[2]===l.shape[1],function(){return"Error in conv1d: depth of input ("+h.shape[2]+") must match input depth for filter "+l.shape[1]+"."}),Y(tu(e,i),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+e+" and dilation '"+i+"'"}),Y(a==="NWC",function(){return"Error in conv1d: got dataFormat of "+a+" but only NWC is currently supported."});var p=l.as4D(1,l.shape[0],l.shape[1],l.shape[2]),v=h.as4D(h.shape[0],1,h.shape[1],h.shape[2]),m=ro(v,p,[1,e],n,"NHWC",[1,i],o);return f?m.as2D(m.shape[2],m.shape[3]):m.as3D(m.shape[0],m.shape[2],m.shape[3])}function T4(r,t,e,n,a,i,o){a===void 0&&(a="NHWC"),i===void 0&&(i=[1,1]);var u=H(r,"x","conv2d"),l=H(t,"filter","conv2d"),h=u,f=!1;u.rank===3&&(f=!0,h=u.as4D(1,u.shape[0],u.shape[1],u.shape[2])),Y(h.rank===4,function(){return"Error in conv2d: input must be rank 4, but got rank "+h.rank+"."}),Y(l.rank===4,function(){return"Error in conv2d: filter must be rank 4, but got rank "+l.rank+"."}),o!=null&&Y(xa(n),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+n+"."}),Y(h.shape[3]===l.shape[2],function(){return"Error in conv2d: depth of input ("+h.shape[3]+") must match input depth for filter "+l.shape[2]+"."}),Y(tu(e,i),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+i+"'"}),Y(a==="NHWC",function(){return"Error in conv2d: got dataFormat of "+a+" but only NHWC is currently supported."});var p=Qc(h.shape,l.shape,e,i,n,o),v=q.engine.runKernel(function(m,x){var b=m.conv2d(h,l,p);return x([l,h]),b},{x:h,$filter:l},function(m,x){var b=x,E=b[0],C=b[1];return Y(td(i),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+i+"'"}),{x:function(){return LC(C.shape,m,E,e,n)},$filter:function(){return zC(C,m,E.shape,e,n)}}});return f?v.as3D(v.shape[1],v.shape[2],v.shape[3]):v}function LC(r,t,e,n,a,i){Y(r.length===t.rank,function(){return"Length of inShape ("+r.length+") and rank of dy ("+t.rank+") must match"});var o=r,u=t,l=!1;t.rank===3&&(l=!0,u=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]),o=[1,r[0],r[1],r[2]]);var h=o[3],f=u.shape[3];Y(o.length===4,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+o.length+"."}),Y(u.rank===4,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+u.rank}),Y(e.rank===4,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+e.rank}),Y(h===e.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+h+") must match input depth for filter "+e.shape[2]+"."}),Y(f===e.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+f+") must match output depth for filter "+e.shape[3]+"."}),i!=null&&Y(xa(a),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+a+"."});var p=Qc(o,e.shape,n,1,a,i),v=q.engine.runKernel(function(m,x){var b=m.conv2dDerInput(u,e,p);return x([e,u]),b},{dy4D:u,filter:e},function(m,x){var b=x[0],E=x[1];return{dy4D:function(){return ro(m,b,n,a,"NHWC",1,i)},filter:function(){return UC(m,E,b.shape,n,a,i)}}});return l?v.as3D(v.shape[1],v.shape[2],v.shape[3]):v}function zC(r,t,e,n,a,i){var o=r;r.rank===3&&(o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var u=t;u.rank===3&&(u=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),Y(o.rank===4,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+o.shape+"."}),Y(u.rank===4,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+u.shape+"."}),Y(e.length===4,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+e+"."}),Y(o.shape[3]===e[2],function(){return"Error in conv2dDerFilter: depth of input "+o.shape[3]+") must match input depth in filter ("+e[2]+"."}),Y(u.shape[3]===e[3],function(){return"Error in conv2dDerFilter: depth of dy ("+u.shape[3]+") must match output depth for filter ("+e[3]+")."}),i!=null&&Y(xa(a),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+a+"."});var l=Qc(o.shape,e,n,1,a,i);return q.engine.runKernel(function(h){return h.conv2dDerFilter(o,u,l)},{x4D:o,dy4D:u})}function k4(r,t,e,n,a,i){return LC(e,H(r,"x","conv2dTranspose"),H(t,"filter","conv2dTranspose"),n,a,i)}function D4(r,t,e,n,a,i,o){i===void 0&&(i=[1,1]);var u=H(r,"x","depthwiseConv2d"),l=H(t,"filter","depthwiseConv2d"),h=u,f=!1;u.rank===3&&(f=!0,h=u.as4D(1,u.shape[0],u.shape[1],u.shape[2])),Y(h.rank===4,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+h.rank+"."}),Y(l.rank===4,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+l.rank+"."}),Y(h.shape[3]===l.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+h.shape[3]+") must match the inChannels dimension in filter "+l.shape[2]+"."}),i==null&&(i=[1,1]),Y(tu(e,i),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+i+"'"}),o!=null&&Y(xa(n),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+n+"."});var p=Qc(h.shape,l.shape,e,i,n,o,!0),v=q.engine.runKernel(function(m,x){var b=m.depthwiseConv2D(h,l,p);return x([h,l]),b},{x:h,$filter:l},function(m,x){Y(td(i),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+i+"'"});var b=x[0],E=x[1];return{x:function(){return M4(b.shape,m,E,p)},$filter:function(){return B4(b,m,E.shape,p)}}});return f?v.as3D(v.shape[1],v.shape[2],v.shape[3]):v}function I4(r,t,e,n,a,i,o){i===void 0&&(i=[1,1]),o===void 0&&(o="NHWC");var u=H(r,"x","separableConv2d"),l=H(t,"depthwiseFilter","separableConv2d"),h=H(e,"pointwiseFilter","separableConv2d"),f=u,p=!1;if(u.rank===3&&(p=!0,f=u.as4D(1,u.shape[0],u.shape[1],u.shape[2])),o==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");Y(f.rank===4,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+f.rank+"."}),Y(l.rank===4,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+l.rank+"."}),Y(h.rank===4,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+l.rank+"."}),Y(h.shape[0]===1,function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+h.shape[0]+"."}),Y(h.shape[1]===1,function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+h.shape[1]+"."});var v=l.shape[2],m=l.shape[3];Y(h.shape[2]===v*m,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+v*m+", but got "+h.shape[2]+"."});var x=Kg(f,l,n,a,o,i),b=ro(x,h,1,"valid",o);return p?b.as3D(b.shape[1],b.shape[2],b.shape[3]):b}function N4(r){return typeof r=="number"?[r,r,r]:r.length===2?[r[0],r[1],1]:r}function ug(r){var t=N4(r),e=t[0],n=t[1],a=t[2];return e===1&&n===1&&a===1}function O4(r,t){return ug(r)||ug(t)}function M4(r,t,e,n){var a=t,i=!1;t.rank===3&&(i=!0,a=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var o=q.engine.runKernel(function(u){return u.depthwiseConv2DDerInput(a,e,n)},{dy4D:a});return i?o.as3D(o.shape[1],o.shape[2],o.shape[3]):o}function B4(r,t,e,n){var a=r;r.rank===3&&(a=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var i=t;return i.rank===3&&(i=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),q.engine.runKernel(function(o){return o.depthwiseConv2DDerFilter(a,i,n)},{x4D:a,dy4D:i})}function P4(r,t,e,n,a,i){a===void 0&&(a="NHWC"),i===void 0&&(i=[1,1,1]);var o=H(r,"x","conv3d"),u=H(t,"filter","conv3d"),l=o,h=!1;o.rank===4&&(h=!0,l=o.as5D(1,o.shape[0],o.shape[1],o.shape[2],o.shape[3])),Y(l.rank===5,function(){return"Error in conv3d: input must be rank 5, but got rank "+l.rank+"."}),Y(u.rank===5,function(){return"Error in conv3d: filter must be rank 5, but got rank "+u.rank+"."}),Y(l.shape[4]===u.shape[3],function(){return"Error in conv3d: depth of input ("+l.shape[4]+") must match input depth for filter "+u.shape[3]+"."}),Y(O4(e,i),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+i+"'"}),Y(a==="NHWC",function(){return"Error in conv3d: got dataFormat of "+a+" but only NHWC is currently supported."});var f=Xg(l.shape,u.shape,e,i,n),p=q.engine.runKernel(function(v,m){var x=v.conv3d(l,u,f);return m([l,u]),x},{x:l,$filter:u},function(v,m){Y(ug(i),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+i+"'"});var x=m[0],b=m[1];return{x:function(){return F4(x.shape,v,b,e,n)},$filter:function(){return L4(x,v,b.shape,e,n)}}});return h?p.as4D(p.shape[1],p.shape[2],p.shape[3],p.shape[4]):p}function F4(r,t,e,n,a){Y(r.length===t.rank,function(){return"Length of inShape ("+r.length+") and rank of dy ("+t.rank+") must match"});var i=r,o=t,u=!1;t.rank===4&&(u=!0,o=t.as5D(1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]),i=[1,r[0],r[1],r[2],r[3]]);var l=i[4],h=o.shape[4];Y(i.length===5,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+i.length+"."}),Y(o.rank===5,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+o.rank}),Y(e.rank===5,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+e.rank}),Y(l===e.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+l+") must match input depth for filter "+e.shape[3]+"."}),Y(h===e.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+h+") must match output depth for filter "+e.shape[4]+"."});var f=Xg(i,e.shape,n,1,a),p=q.engine.runKernel(function(v){return v.conv3dDerInput(o,e,f)},{dy5D:o});return u?p.as4D(p.shape[1],p.shape[2],p.shape[3],p.shape[4]):p}function L4(r,t,e,n,a){var i=r;r.rank===4&&(i=r.as5D(1,r.shape[0],r.shape[1],r.shape[2],r.shape[3]));var o=t;o.rank===4&&(o=t.as5D(1,t.shape[0],t.shape[1],t.shape[2],t.shape[3])),Y(i.rank===5,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+i.shape+"."}),Y(o.rank===5,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+o.shape+"."}),Y(e.length===5,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+e+"."}),Y(i.shape[4]===e[3],function(){return"Error in conv3dDerFilter: depth of input "+i.shape[4]+") must match input depth in filter ("+e[3]+"."}),Y(o.shape[4]===e[4],function(){return"Error in conv3dDerFilter: depth of dy ("+o.shape[4]+") must match output depth for filter ("+e[4]+")."});var u=Xg(i.shape,e,n,1,a);return q.engine.runKernel(function(l){return l.conv3dDerFilter(i,o,u)},{x5D:i,dy5D:o})}var z4=it({conv1d_:A4}),ro=it({conv2d_:T4}),U4=it({conv3d_:P4}),UC=it({conv2dDerFilter_:zC}),Kg=it({depthwiseConv2d_:D4}),WC=it({separableConv2d_:I4}),W4=it({conv2dTranspose_:k4});function V4(r,t,e,n){var a;e===void 0&&(e=!1),n===void 0&&(n=!1);var i=H(r,"a","matMul"),o=H(t,"b","matMul");a=kn(i,o),i=a[0],o=a[1];var u=e?i.shape[i.rank-2]:i.shape[i.rank-1],l=n?o.shape[o.rank-1]:o.shape[o.rank-2],h=e?i.shape[i.rank-1]:i.shape[i.rank-2],f=n?o.shape[o.rank-2]:o.shape[o.rank-1],p=i.shape.slice(0,-2),v=o.shape.slice(0,-2),m=qt(p),x=qt(v);Y(i.rank>=2&&o.rank>=2&&i.rank===o.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+i.rank+" and "+o.rank+"."}),Y(pr(p,v),function(){return"Error in matMul: outer dimensions ("+p+") and ("+v+") of Tensors with shapes "+i.shape+" and "+o.shape+" must match."}),Y(u===l,function(){return"Error in matMul: inner shapes ("+u+") and ("+l+") of Tensors with shapes "+i.shape+" and "+o.shape+" and transposeA="+e+" and transposeB="+n+" must match."});var b=i.shape.slice(0,-2).concat([h,f]),E=e?i.as3D(m,u,h):i.as3D(m,h,u),C=n?o.as3D(x,f,l):o.as3D(x,l,f);return q.engine.runKernel(function(R,_){var A=R.batchMatMul(E,C,e,n);return _([E,C]),A},{$a:E,$b:C},function(R,_){var A=_,k=A[0],D=A[1];return e||n?!e&&n?{$a:function(){return R.matMul(D,!1,!1)},$b:function(){return R.matMul(k,!0,!1)}}:e&&!n?{$a:function(){return D.matMul(R,!1,!0)},$b:function(){return k.matMul(R,!1,!1)}}:{$a:function(){return D.matMul(R,!0,!0)},$b:function(){return R.matMul(k,!0,!0)}}:{$a:function(){return R.matMul(D,!1,!0)},$b:function(){return k.matMul(R,!0,!1)}}}).reshape(b)}function G4(r,t){var e=H(r,"v1","outerProduct"),n=H(t,"v2","outerProduct");return Y(e.rank===1&&n.rank===1,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+e.rank+" and "+n.rank+"."}),e.as2D(-1,1).matMul(n.as2D(1,-1))}function H4(r,t){var e=H(r,"t1","dot"),n=H(t,"t2","dot");Y(!(e.rank!==1&&e.rank!==2||n.rank!==1&&n.rank!==2),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+e.rank+" and "+n.rank+"."});var a=e.rank===1?e.size:e.shape[1],i=n.rank===1?n.size:n.shape[0];return Y(a===i,function(){return"Error in dot: inner dimensions of inputs must match, but got "+a+" and "+i+"."}),e.rank===1&&n.rank===1?e.as2D(1,-1).matMul(n.as2D(-1,1)).asScalar():e.rank===1&&n.rank===2?e.as2D(1,-1).matMul(n.as2D(n.shape[0],n.shape[1])).as1D():e.rank===2&&n.rank===1?e.matMul(n.as2D(-1,1)).as1D():e.matMul(n.as2D(n.shape[0],n.shape[1]))}var Yg=it({matMul_:V4}),q4=it({dot_:H4}),j4=it({outerProduct_:G4});function X4(r){var t=H(r,"x","reverse");return Y(t.rank===1,function(){return"Error in reverse1D: x must be rank 1 but got rank "+t.rank+"."}),Zc(t,0)}function K4(r,t){var e=H(r,"x","reverse");return Y(e.rank===2,function(){return"Error in reverse2D: x must be rank 2 but got rank "+e.rank+"."}),Zc(e,t)}function Y4(r,t){var e=H(r,"x","reverse");return Y(e.rank===3,function(){return"Error in reverse3D: x must be rank 3 but got rank "+e.rank+"."}),Zc(e,t)}function Q4(r,t){var e=H(r,"x","reverse");return Y(e.rank===4,function(){return"Error in reverse4D: x must be rank 4 but got rank "+e.rank+"."}),Zc(e,t)}function Z4(r,t){var e=H(r,"x","reverse");if(e.rank===0)return e.clone();var n=$n(t,e.shape);return q.engine.runKernel(function(a){return a.reverse(e,n)},{$x:e},function(a){return{$x:function(){return a.reverse(n)}}}).reshapeAs(e)}var Zc=it({reverse_:Z4}),$4=it({reverse1d_:X4}),J4=it({reverse2d_:K4}),tF=it({reverse3d_:Y4}),eF=it({reverse4d_:Q4});function VC(r,t,e,n,a,i){var o=H(r,"x","maxPool"),u=o,l=!1;o.rank===3&&(l=!0,u=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),Y(u.rank===4,function(){return"Error in maxPool: input must be rank 4 but got rank "+u.rank+"."}),Y(tu(e,n),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+n+"'"}),i!=null&&Y(xa(a),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+a+"."});var h=Yc(u.shape,t,e,n,a,i),f=q.engine.runKernel(function(p,v){var m=p.maxPool(u,h);return v([u,m]),m},{x:u},function(p,v){var m=v[0],x=v[1];return{x:function(){return iF(p,m,x,t,e,n,a)}}});return l?f.as3D(f.shape[1],f.shape[2],f.shape[3]):f}function nF(r,t,e,n,a){return VC(r,t,e,1,n,a)}function GC(r,t,e,n,a,i){var o=H(r,"x","avgPool","float32");Y(tu(e,n),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+n+"'"});var u=o,l=!1;o.rank===3&&(l=!0,u=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),Y(u.rank===4,function(){return"Error in avgPool: x must be rank 4 but got rank "+u.rank+"."}),i!=null&&Y(xa(a),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+a+"."});var h=Yc(u.shape,t,e,n,a,i),f=q.engine.runKernel(function(p){return p.avgPool(u,h)},{x:u},function(p){return{x:function(){return oF(p,u,t,e,n,a)}}});return f=f.cast(o.dtype),l?f.as3D(f.shape[1],f.shape[2],f.shape[3]):f}function rF(r,t,e,n,a){return GC(r,t,e,1,n,a)}function aF(r,t,e,n,a,i){a==null&&(a=[1,1]),i==null&&(i=1),n===0&&(n="valid");var o=H(r,"x","maxPool"),u=o,l=!1;o.rank===3&&(l=!0,u=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),Y(tu(i,a),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+i+" and dilations '"+a+"'"});var h,f=Yc(u.shape,t,i,a,n),p=[f.dilationHeight,f.dilationWidth];h=n==="same"?sF([f.filterHeight,f.filterWidth],p):[[0,0],[0,0]];var v=p[0]===1&&p[1]===1,m=uF([f.inHeight,f.inWidth],p,h),x=m[0],b=m[1],E=v?n:"valid",C=v?u:DC(u,p,x),R=(e==="avg"?function(){return GC(C,t,i,1,E)}:function(){return VC(C,t,i,1,E)})(),_=v?R:TC(R,p,b);return l?_.as3D(_.shape[1],_.shape[2],_.shape[3]):_}function iF(r,t,e,n,a,i,o,u){var l=H(r,"dy","maxPoolBackprop"),h=H(t,"input","maxPoolBackprop"),f=H(e,"output","maxPoolBackprop");Y(h.rank===l.rank,function(){return"Rank of input ("+h.rank+") does not match rank of dy ("+l.rank+")"}),Y(tu(a,i),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+a+" and dilations '"+i+"'"}),Y(l.rank===4,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+l.rank+"."}),Y(h.rank===4,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+h.rank+"."});var p=Yc(h.shape,n,a,i,o,u);return q.engine.runKernel(function(v){return v.maxPoolBackprop(l,h,f,p)},{$dy:l,$input:h})}function oF(r,t,e,n,a,i){var o=H(r,"dy","avgPoolBackprop"),u=H(t,"input","avgPoolBackprop");Y(u.rank===o.rank,function(){return"Rank of input ("+u.rank+") does not match rank of dy ("+o.rank+")"}),Y(tu(n,a),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"});var l=u,h=o,f=!1;u.rank===3&&(f=!0,l=u.as4D(1,u.shape[0],u.shape[1],u.shape[2]),h=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),Y(h.rank===4,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+h.rank+"."}),Y(l.rank===4,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+l.rank+"."});var p=Yc(l.shape,e,n,a,i),v=q.engine.runKernel(function(m){return m.avgPoolBackprop(h,l,p)},{dy4D:h,input4D:l});return f?v.as3D(v.shape[1],v.shape[2],v.shape[3]):v}function uF(r,t,e){var n=e.map(function(l){return l[0]}),a=e.map(function(l){return l[1]}),i=r.concat(n,a),o=t.map(function(l,h){return(l-i[h]%l)%l}),u=a.map(function(l,h){return l+o[h]});return[t.map(function(l,h){return[n[h],u[h]]}),t.map(function(l,h){return[0,o[h]]})]}function sF(r,t){var e=r.map(function(i,o){return i+(i-1)*(t[o]-1)}).map(function(i){return i-1}),n=e.map(function(i){return Math.floor(i/2)}),a=e.map(function(i,o){return i-n[o]});return e.map(function(i,o){return[n[o],a[o]]})}var il=it({maxPool_:nF}),$c=it({avgPool_:rF}),lF=it({pool_:aF});function cF(r,t,e){var n=H(r,"x","slice1d");return Y(n.rank===1,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+n.rank+" tensor"}),Xo(n,[t],[e])}function hF(r,t,e){var n=H(r,"x","slice2d");return Y(n.rank===2,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+n.rank+" tensor"}),Xo(n,t,e)}function fF(r,t,e){var n=H(r,"x","slice3d");return Y(n.rank===3,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+n.rank+" tensor"}),Xo(n,t,e)}function dF(r,t,e){var n=H(r,"x","slice4d");return Y(n.rank===4,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+n.rank+" tensor"}),Xo(n,t,e)}function pF(r,t,e){var n,a,i=H(r,"x","slice");if(i.rank===0)throw new Error("Slicing scalar is not possible");n=typeof t=="number"?[t].concat(new Array(i.rank-1).fill(0)):t.length<i.rank?t.concat(new Array(i.rank-t.length).fill(0)):t.slice(),a=(a=e==null?new Array(i.rank).fill(-1):typeof e=="number"?[e].concat(new Array(i.rank-1).fill(-1)):e.length<i.rank?e.concat(new Array(i.rank-e.length).fill(-1)):e).map(function(u,l){return u>=0?u:(Y(u===-1,function(){return"Bad value in size"}),i.shape[l]-n[l])}),vD(i,n,a);var o=i.shape;return q.engine.runKernel(function(u){return u.slice(i,n,a)},{$x:i},function(u){for(var l=[],h=0;h<u.rank;h++)l.push([n[h],o[h]-n[h]-a[h]]);return{$x:function(){return u.pad(l)}}})}var Xo=it({slice_:pF}),vF=it({slice1d_:cF}),mF=it({slice2d_:hF}),HC=it({slice3d_:fF}),gF=it({slice4d_:dF});function yF(r,t,e){t===void 0&&(t=null),e===void 0&&(e=!1);var n=H(r,"x","logSumExp"),a=$n(t,n.shape),i=n.max(a,!0),o=n.sub(i).exp().sum(a).log(),u=i.reshape(o.shape).add(o);if(e){var l=ba(u.shape,a);return u.reshape(l)}return u}function xF(r,t,e){t===void 0&&(t=null),e===void 0&&(e=!1);var n=H(r,"x","sum");n.dtype==="bool"&&(n=n.toInt());var a=$n(t,n.shape);return Vc(function(i){var o=bi(a,i.rank),u=a,l=i;o!=null&&(l=i.transpose(o),u=wi(u.length,i.rank));var h=q.engine.runKernel(function(p){return p.sum(l,u)},{permutedX:l});if(e){var f=ba(h.shape,a);h=h.reshape(f)}return{value:h,gradFunc:function(p){var v=i.shape.slice();return a.forEach(function(m){v[m]=1}),p.reshape(v).mul(Lu(i.shape,"float32"))}}})(n)}function bF(r,t,e){t===void 0&&(t=null),e===void 0&&(e=!1);var n=H(r,"x","prod");n.dtype==="bool"&&(n=n.toInt());var a=$n(t,n.shape),i=bi(a,n.rank),o=a,u=n;i!=null&&(u=n.transpose(i),o=wi(o.length,n.rank));var l=q.engine.runKernel(function(f){return f.prod(u,o)},{permutedX:u});if(e){var h=ba(l.shape,a);l=l.reshape(h)}return l}function wF(r,t,e){t===void 0&&(t=null),e===void 0&&(e=!1);var n=H(r,"x","mean"),a=$n(t,n.shape),i=qt(er(n.shape,a)[1]);return Vc(function(o){var u=Tt(i);return{value:(u.dtype===o.dtype?o:o.cast(u.dtype)).div(u).sum(t,e),gradFunc:function(l){var h=o.shape.slice();return a.forEach(function(f){h[f]=1}),l.reshape(h).mul(Lu(o.shape,"float32")).div(i)}}})(n)}function qC(r,t,e,n,a){return t.rank<e.rank&&(t=t.reshape(ba(t.shape,n))),r.rank<e.rank&&(r=r.reshape(ba(r.shape,n))),{$x:function(){var i=r.mul(e.equal(t).cast(r.dtype));return a==null?i:i.transpose(a)}}}function EF(r,t,e){t===void 0&&(t=null),e===void 0&&(e=!1);var n=H(r,"x","min"),a=n,i=$n(t,n.shape),o=i,u=bi(o,n.rank);u!=null&&(n=n.transpose(u),o=wi(o.length,n.rank));var l=q.engine.runKernel(function(f,p){var v=f.min(n,o);return p([a,v]),v},{$x:n},function(f,p){return qC(f,p[1],p[0],i,u)});if(e){var h=ba(l.shape,i);l=l.reshape(h)}return l}function CF(r,t,e){t===void 0&&(t=null),e===void 0&&(e=!1);var n=H(r,"x","max"),a=n,i=$n(t,n.shape),o=i,u=bi(o,n.rank);u!=null&&(n=n.transpose(u),o=wi(o.length,n.rank));var l=q.engine.runKernel(function(f,p){var v=f.max(n,o);return p([a,v]),v},{$x:n},function(f,p){return qC(f,p[1],p[0],i,u)});if(e){var h=ba(l.shape,i);l=l.reshape(h)}return l}function SF(r,t){t===void 0&&(t=0);var e=H(r,"x","argMin");t==null&&(t=0);var n=$n(t,e.shape),a=bi(n,e.rank);return a!=null&&(e=e.transpose(a),n=wi(n.length,e.rank)),q.engine.runKernel(function(i,o){var u=i.argMin(e,n[0]);return o([e]),u},{$x:e},function(i,o){var u=o[0];return{$x:function(){return Ce(u)}}})}function RF(r,t){t===void 0&&(t=0);var e=H(r,"x","argMax");t==null&&(t=0);var n=$n(t,e.shape),a=bi(n,e.rank);return a!=null&&(e=e.transpose(a),n=wi(n.length,e.rank)),q.engine.runKernel(function(i,o){var u=i.argMax(e,n[0]);return o([e]),u},{$x:e},function(i,o){var u=o[0];return{$x:function(){return Ce(u)}}})}function _F(r,t,e){t===void 0&&(t=null),e===void 0&&(e=!1);var n=H(r,"x","all","bool"),a=$n(t,n.shape),i=a,o=bi(i,n.rank);o!=null&&(n=n.transpose(o),i=wi(i.length,n.rank));var u=q.engine.runKernel(function(h){return h.all(n,i)},{$x:n});if(e){var l=ba(u.shape,a);return u.reshape(l)}return u}function AF(r,t,e){t===void 0&&(t=null),e===void 0&&(e=!1);var n=H(r,"x","any","bool"),a=$n(t,n.shape),i=a,o=bi(i,n.rank);o!=null&&(n=n.transpose(o),i=wi(i.length,n.rank));var u=q.engine.runKernel(function(h){return h.any(n,i)},{$x:n});if(e){var l=ba(u.shape,a);return u.reshape(l)}return u}function TF(r,t,e){t===void 0&&(t=null),e===void 0&&(e=!1);var n=$n(t,(r=H(r,"x","moments")).shape),a=r.mean(n,e),i=a.shape;return e||(i=ba(a.shape,n)),{mean:a,variance:r.toFloat().sub(a.reshape(i)).square().mean(n,e)}}var kF=it({all_:_F}),DF=it({any_:AF}),IF=it({argMax_:RF}),NF=it({argMin_:SF}),OF=it({logSumExp_:yF}),Td=it({max_:CF}),MF=it({mean_:wF}),BF=it({min_:EF}),PF=it({moments_:TF}),jC=it({sum_:xF}),FF=it({prod_:bF});function LF(r,t){var e,n=H(r,"a","notEqual"),a=H(t,"b","notEqual");return e=kn(n,a),n=e[0],a=e[1],ve(n.shape,a.shape),q.engine.runKernel(function(i){return i.notEqual(n,a)},{$a:n,$b:a})}function zF(r,t){var e=H(r,"a","notEqualStrict"),n=H(t,"b","notEqualStrict");return Me(e.shape,n.shape,"Error in notEqualStrict: "),e.notEqual(n)}function UF(r,t){var e,n=H(r,"a","less"),a=H(t,"b","less");return e=kn(n,a),n=e[0],a=e[1],ve(n.shape,a.shape),q.engine.runKernel(function(i){return i.less(n,a)},{$a:n,$b:a})}function WF(r,t){var e=H(r,"a","lessStrict"),n=H(t,"b","lessStrict");return Me(e.shape,n.shape,"Error in lessStrict: "),e.less(n)}function VF(r,t){var e,n=H(r,"a","equal"),a=H(t,"b","equal");return e=kn(n,a),n=e[0],a=e[1],ve(n.shape,a.shape),q.engine.runKernel(function(i){return i.equal(n,a)},{$a:n,$b:a})}function GF(r,t){var e=H(r,"a","equalStrict"),n=H(t,"b","equalStrict");return Me(e.shape,n.shape,"Error in equalStrict: "),e.equal(n)}function HF(r,t){var e,n=H(r,"a","lessEqual"),a=H(t,"b","lessEqual");return e=kn(n,a),n=e[0],a=e[1],ve(n.shape,a.shape),q.engine.runKernel(function(i){return i.lessEqual(n,a)},{$a:n,$b:a})}function qF(r,t){var e=H(r,"a","lessEqualStrict"),n=H(t,"b","lessEqualStrict");return Me(e.shape,n.shape,"Error in lessEqualStrict: "),e.lessEqual(n)}function jF(r,t){var e,n=H(r,"a","greater"),a=H(t,"b","greater");return e=kn(n,a),n=e[0],a=e[1],ve(n.shape,a.shape),q.engine.runKernel(function(i){return i.greater(n,a)},{$a:n,$b:a})}function XF(r,t){var e=H(r,"a","greaterStrict"),n=H(t,"b","greaterStrict");return Me(e.shape,n.shape,"Error in greaterStrict: "),e.greater(n)}function KF(r,t){var e,n=H(r,"a","greaterEqual"),a=H(t,"b","greaterEqual");return e=kn(n,a),n=e[0],a=e[1],ve(n.shape,a.shape),q.engine.runKernel(function(i,o){var u=i.greaterEqual(n,a);return o([n,a]),u},{$a:n,$b:a},function(i,o){var u=o[0],l=o[1];return{$a:function(){return Ce(u)},$b:function(){return Ce(l)}}})}function YF(r,t){var e=H(r,"a","greaterEqualStrict"),n=H(t,"b","greaterEqualStrict");return Me(e.shape,n.shape,"Error in greaterEqualStrict: "),e.greaterEqual(n)}var XC=it({equal_:VF}),QF=it({equalStrict_:GF}),ZF=it({greater_:jF}),KC=it({greaterEqual_:KF}),$F=it({greaterEqualStrict_:YF}),JF=it({greaterStrict_:XF}),tL=it({less_:UF}),eL=it({lessEqual_:HF}),nL=it({lessEqualStrict_:qF}),rL=it({lessStrict_:WF}),aL=it({notEqual_:LF}),iL=it({notEqualStrict_:zF});function oL(r,t){var e,n=H(r,"a","add"),a=H(t,"b","add");e=kn(n,a),n=e[0],a=e[1];var i=ve(n.shape,a.shape);return q.engine.runKernel(function(o){return o.add(n,a)},{$a:n,$b:a},function(o){return{$a:function(){var u=o,l=Dn(n.shape,i);return l.length>0&&(u=u.sum(l)),u.reshape(n.shape)},$b:function(){var u=o,l=Dn(a.shape,i);return l.length>0&&(u=u.sum(l)),u.reshape(a.shape)}}})}function uL(r){Y(Array.isArray(r),function(){return"The argument passed to tf.addN() must be a list of tensors"}),Y(r.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+r.length});var t=r.map(function(a,i){return H(a,"tensors"+i,"addN")}),e=t[0];t.forEach(function(a){if(a.dtype!==e.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),t.forEach(function(a){if(!pr(a.shape,e.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var n=t;return q.engine.runKernel(function(a){return a.addN(t)},n,function(a){var i={};return t.forEach(function(o,u){i[u]=function(){return a.clone()}}),i})}function sL(r,t){var e=H(r,"a","addStrict"),n=H(t,"b","addStrict");return Me(e.shape,n.shape,"Error in addStrict: "),e.add(n)}function lL(r,t){var e,n=H(r,"a","sub"),a=H(t,"b","sub");e=kn(n,a),n=e[0],a=e[1];var i=ve(n.shape,a.shape);return q.engine.runKernel(function(o){return o.subtract(n,a)},{$a:n,$b:a},function(o){return{$a:function(){var u=o,l=Dn(n.shape,i);return l.length>0&&(u=u.sum(l)),u.reshape(n.shape)},$b:function(){var u=o,l=Dn(a.shape,i);return l.length>0&&(u=u.sum(l)),u.neg().reshape(a.shape)}}})}function cL(r,t){var e=H(r,"a","subStrict"),n=H(t,"b","subStrict");return Me(e.shape,n.shape,"Error in subStrict: "),e.sub(n)}function hL(r,t){var e=H(r,"base","pow"),n=H(t,"exp","pow"),a=ve(e.shape,n.shape);return r=e.cast(Un(e.dtype,n.dtype)),t=n.cast(Un(e.dtype,n.dtype)),q.engine.runKernel(function(i,o){var u=i.pow(e,n);return o([e,n,u]),u},{$base:e,$exp:n},function(i,o){var u=o[0],l=o[1],h=o[2];return{$base:function(){var f=l.toFloat(),p=i.mul(f.mul(u.pow(f.sub(Tt(1))))),v=Dn(u.shape,a);return v.length>0&&(p=p.sum(v)),p.reshape(u.shape)},$exp:function(){var f=u.greater(0),p=u.log().where(f,Ce(u)),v=i.mul(h.mul(p)),m=Dn(l.shape,a);return m.length>0&&(v=v.sum(m)),v.reshape(l.shape)}}})}function fL(r,t){return Me(r.shape,t.shape,"Error in powStrict: "),r.pow(t)}function dL(r,t){var e,n=H(r,"a","mul"),a=H(t,"b","mul");e=kn(n,a),n=e[0],a=e[1];var i=ve(n.shape,a.shape);return q.engine.runKernel(function(o,u){var l=o.multiply(n,a);return u([n,a]),l},{$a:n,$b:a},function(o,u){var l=u[0],h=u[1];return{$a:function(){var f=o.mul(h.toFloat()),p=Dn(l.shape,i);return p.length>0?f.sum(p).reshape(l.shape):f},$b:function(){var f=o.mul(l.toFloat()),p=Dn(h.shape,i);return p.length>0?f.sum(p).reshape(h.shape):f}}})}function pL(r,t){var e=H(r,"a","mul"),n=H(t,"b","mul");return Me(e.shape,n.shape,"Error in multiplyStrict: "),e.mul(n)}function vL(r,t){var e,n=H(r,"a","div"),a=H(t,"b","div");if(e=kn(n,a),n=e[0],a=e[1],n.dtype==="int32"&&a.dtype==="int32")return YC(n,a);var i=ve(n.shape,a.shape);return q.engine.runKernel(function(o,u){var l=o.realDivide(n,a);return u([n,a]),l},{$a:n,$b:a},function(o,u){var l=u[0],h=u[1];return{$a:function(){var f=o.div(h.toFloat()),p=Dn(l.shape,i);return p.length>0?f.sum(p).reshape(l.shape):f},$b:function(){var f=o.mul(l.toFloat()),p=Dn(h.shape,i);p.length>0&&(f=f.sum(p).reshape(h.shape));var v=h.square();return f.div(v.toFloat()).neg()}}})}function mL(r,t){var e,n=H(r,"a","floorDiv"),a=H(t,"b","floorDiv");e=kn(n,a),n=e[0],a=e[1];var i=ve(n.shape,a.shape);return q.engine.runKernel(function(o,u){var l=o.floorDiv(n,a);return u([n,a]),l},{$a:n,$b:a},function(o,u){var l=u[0],h=u[1];return{$a:function(){var f=o.div(h.toFloat()),p=Dn(l.shape,i);return p.length>0?f.sum(p).reshape(l.shape):f},$b:function(){var f=o.mul(l.toFloat()),p=Dn(h.shape,i);p.length>0&&(f=f.sum(p).reshape(h.shape));var v=h.square();return f.div(v.toFloat()).neg()}}})}function gL(r,t){var e=H(r,"a","div"),n=H(t,"b","div");return Me(e.shape,n.shape,"Error in divideStrict: "),e.div(n)}function yL(r,t){var e,n=H(r,"a","mod"),a=H(t,"b","mod");e=kn(n,a),n=e[0],a=e[1];var i=ve(n.shape,a.shape);return q.engine.runKernel(function(o,u){var l=o.mod(n,a);return u([n,a]),l},{$a:n,$b:a},function(o,u){var l=u[0],h=u[1];return{$a:function(){var f=Dn(l.shape,i);return f.length>0?o.sum(f).reshape(l.shape):o},$b:function(){var f=o.mul(l.div(h).floor().neg()),p=Dn(h.shape,i);return p.length>0?f.sum(p).reshape(h.shape):f}}})}function xL(r,t){var e=H(r,"a","modStrict"),n=H(t,"b","modStrict");return Me(e.shape,n.shape,"Error in modStrict: "),e.mod(n)}function bL(r,t){var e,n=H(r,"a","minimum"),a=H(t,"b","minimum");return e=kn(n,a),n=e[0],a=e[1],n.dtype==="bool"&&(n=n.toInt(),a=a.toInt()),ve(n.shape,a.shape),q.engine.runKernel(function(i,o){var u=i.minimum(n,a);return o([n,a]),u},{$a:n,$b:a},function(i,o){var u=o[0],l=o[1];return{$a:function(){return i.mul(u.lessEqual(l).toFloat())},$b:function(){return i.mul(u.greater(l).toFloat())}}})}function wL(r,t){var e=H(r,"a","minimumStrict"),n=H(t,"b","minimumStrict");return Me(e.shape,n.shape,"Error in minimumStrict: "),e.minimum(n)}function EL(r,t){var e,n=H(r,"a","maximum"),a=H(t,"b","maximum");return e=kn(n,a),n=e[0],a=e[1],n.dtype==="bool"&&(n=n.toInt(),a=a.toInt()),ve(n.shape,a.shape),q.engine.runKernel(function(i,o){var u=i.maximum(n,a);return o([n,a]),u},{$a:n,$b:a},function(i,o){var u=o[0],l=o[1];return{$a:function(){return i.mul(u.greaterEqual(l).toFloat())},$b:function(){return i.mul(u.less(l).toFloat())}}})}function CL(r,t){var e=H(r,"a","maximumStrict"),n=H(t,"b","maximumStrict");return Me(e.shape,n.shape,"Error in maximumStrict: "),e.maximum(n)}function SL(r,t){var e,n=H(r,"a","squaredDifference"),a=H(t,"b","squaredDifference");return e=kn(n,a),n=e[0],a=e[1],ve(n.shape,a.shape),q.engine.runKernel(function(i,o){var u=i.squaredDifference(n,a);return o([n,a]),u},{$a:n,$b:a},function(i,o){var u=o[0],l=o[1],h=Tt(2);return{$a:function(){return i.mul(u.sub(l).mul(h))},$b:function(){return i.mul(l.sub(u).mul(h))}}})}function RL(r,t){var e=H(r,"a","squaredDifferenceStrict"),n=H(t,"b","squaredDifferenceStrict");return Me(e.shape,n.shape,"Error in squaredDifferenceStrict: "),e.squaredDifference(n)}function _L(r,t){var e,n=H(r,"a","atan2"),a=H(t,"b","atan2");e=kn(n,a),n=e[0],a=e[1];var i=ve(n.shape,a.shape);return q.engine.runKernel(function(o,u){var l=o.atan2(n,a);return u([n,a]),l},{$a:n,$b:a},function(o,u){var l=u[0],h=u[1];return{$a:function(){var f=we(l.square(),h.square()),p=o.mul(h.div(f)),v=Dn(l.shape,i);return v.length>0&&(p=p.sum(v)),p.reshape(l.shape)},$b:function(){var f=we(l.square(),h.square()),p=$f(o.mul(l.div(f))),v=Dn(h.shape,i);return v.length>0&&(p=p.sum(v)),p.reshape(h.shape)}}})}var we=it({add_:oL}),AL=it({addN_:uL}),TL=it({addStrict_:sL}),kL=it({atan2_:_L}),ji=it({div_:vL}),DL=it({divStrict_:gL}),YC=it({floorDiv_:mL}),Qg=it({maximum_:EL}),IL=it({maximumStrict_:CL}),QC=it({minimum_:bL}),NL=it({minimumStrict_:wL}),OL=it({mod_:yL}),ML=it({modStrict_:xL}),Zi=it({mul_:dL}),BL=it({mulStrict_:pL}),ZC=it({pow_:hL}),PL=it({powStrict_:fL}),FL=it({squaredDifference_:SL}),LL=it({squaredDifferenceStrict_:RL}),vi=it({sub_:lL}),zL=it({subStrict_:cL});function UL(r){var t=H(r,"x","logicalNot","bool");return q.engine.runKernel(function(e){return e.logicalNot(t)},{$x:t})}function WL(r,t){var e=H(r,"a","logicalAnd","bool"),n=H(t,"b","logicalAnd","bool");return ve(e.shape,n.shape),q.engine.runKernel(function(a){return a.logicalAnd(e,n)},{$a:e,$b:n})}function VL(r,t){var e=H(r,"a","logicalOr","bool"),n=H(t,"b","logicalOr","bool");return ve(e.shape,n.shape),q.engine.runKernel(function(a){return a.logicalOr(e,n)},{$a:e,$b:n})}function GL(r,t){var e=H(r,"a","logicalXor","bool"),n=H(t,"b","logicalXor","bool");return ve(e.shape,n.shape),$C(r,t).logicalAnd(Zg(r,t).logicalNot())}function HL(r,t,e){var n=H(t,"a","where"),a=H(e,"b","where"),i=H(r,"condition","where","bool");return Me(n.shape,a.shape,"Error in where: "),i.rank===1?Y(i.shape[0]===n.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):Me(i.shape,a.shape,"Error in where: "),q.engine.runKernel(function(o,u){var l=o.select(i,n,a);return u([i]),l},{$condition:i,$a:n,$b:a},function(o,u){var l=u[0];return{$condition:function(){return Ce(l).toFloat()},$a:function(){return o.mul(l.cast(o.dtype))},$b:function(){return o.mul(l.logicalNot().cast(o.dtype))}}})}function qL(r){return Ne(this,void 0,void 0,function(){var t,e,n;return Oe(this,function(a){switch(a.label){case 0:return[4,(t=H(r,"condition","whereAsync","bool")).data()];case 1:return e=a.sent(),n=qg(t.shape,e),r!==t&&t.dispose(),[2,n]}})})}var Zg=it({logicalAnd_:WL}),jL=it({logicalNot_:UL}),$C=it({logicalOr_:VL}),XL=it({logicalXor_:GL}),Ic=it({where_:HL}),KL=qL;function YL(r){var t=H(r,"x","relu");return t.dtype==="bool"?t.toInt():q.engine.runKernel(function(e,n){var a=e.relu(t);return n([t]),a},{$x:t},function(e,n){var a=n[0];return{$x:function(){return e.mulStrict(a.step().toFloat())}}})}function QL(r){var t=H(r,"x","elu");return q.engine.runKernel(function(e,n){var a=e.elu(t);return n([a]),a},{$x:t},function(e,n){var a=n[0];return{$x:function(){return q.engine.runKernel(function(i){return i.eluDer(e,a)},{dy:e,y:a})}}})}function ZL(r){var t=H(r,"x","selu");return q.engine.runKernel(function(e,n){var a=e.selu(t);return n([t]),a},{$x:t},function(e,n){var a=n[0];return{$x:function(){var i=a.greater(Tt(0)),o=Tt(Vg),u=Tt(Gg),l=e.mul(u),h=e.mul(o).mul(a.toFloat().exp());return Ic(i,l,h)}}})}function $L(r,t){t===void 0&&(t=.2);var e=H(r,"x","leakyRelu");return Qg(Tt(t).mul(e),e)}function JL(r,t){var e=H(r,"x","prelu"),n=H(t,"alpha","prelu");return q.engine.runKernel(function(a,i){var o=a.prelu(e,n);return i([e,n]),o},{$x:e,$alpha:n},function(a,i){var o=i[0],u=i[1],l=o.greater(0);return{$x:function(){return Ic(l,a,a.mul(u))},$alpha:function(){var h=Ic(l,Ce(a),a.mul(o)),f=Dn(u.shape,a.shape);return f.length>0&&(h=h.sum(f)),h.reshape(u.shape)}}})}var tz=it({elu_:QL}),ez=it({leakyRelu_:$L}),nz=it({prelu_:JL}),wn=it({relu_:YL}),rz=it({selu_:ZL});function az(r,t){var e=H(r,"x","transpose");return t==null&&(t=e.shape.map(function(n,a){return a}).reverse()),Y(e.rank===t.length,function(){return"Error in transpose: rank of input "+e.rank+" must match length of perm "+t+"."}),t.forEach(function(n){Y(n>=0&&n<e.rank,function(){return"All entries in 'perm' must be between 0 and "+(e.rank-1)+" but got "+t})}),e.rank<=1?e.clone():q.engine.runKernel(function(n){return n.transpose(e,t)},{$x:e},function(n){var a=Pg(t);return{$x:function(){return n.transpose(a)}}})}var Ko=it({transpose_:az});function iz(r,t,e,n,a){t===void 0&&(t=5),e===void 0&&(e=1),n===void 0&&(n=1),a===void 0&&(a=.5);var i=H(r,"x","localResponseNormalization");Y(i.rank===4||i.rank===3,function(){return`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `+i.rank+"."}),Y(xa(t),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+t+"."});var o=i,u=!1;i.rank===3&&(u=!0,o=i.as4D(1,i.shape[0],i.shape[1],i.shape[2]));var l=q.engine.runKernel(function(h,f){var p=h.localResponseNormalization4D(o,t,e,n,a);return f([o,p]),p},{x4D:o},function(h,f){var p=f[0],v=f[1];return{x4D:function(){return q.engine.runKernel(function(m){return m.LRNGrad(h,p,v,t,e,n,a)},{})}}});return u?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l}var oz=it({localResponseNormalization_:iz});function uz(r,t,e,n){t===void 0&&(t="euclidean"),e===void 0&&(e=null),n===void 0&&(n=!1);var a=JC(r=H(r,"x","norm"),t,e),i=a.shape;if(n){var o=$n(e,r.shape);i=ba(a.shape,o)}return a.reshape(i)}function JC(r,t,e){if(e===void 0&&(e=null),r.rank===0)return r.abs();if(r.rank!==1&&e===null)return JC(r.reshape([-1]),t,e);if(r.rank===1||typeof e=="number"||Array.isArray(e)&&e.length===1){if(t===1)return r.abs().sum(e);if(t===1/0)return r.abs().max(e);if(t===-1/0)return r.abs().min(e);if(t==="euclidean"||t===2)return r.abs().pow(Tt(2,"int32")).sum(e).sqrt();throw new Error("Error in norm: invalid ord value: "+t)}if(Array.isArray(e)&&e.length===2){if(t===1)return r.abs().sum(e[0]).max(e[1]-1);if(t===1/0)return r.abs().sum(e[1]).max(e[0]);if(t===-1/0)return r.abs().sum(e[1]).min(e[0]);if(t==="fro"||t==="euclidean")return r.square().sum(e).sqrt();throw new Error("Error in norm: invalid ord value: "+t)}throw new Error("Error in norm: invalid axis: "+e)}var tS=it({norm_:uz});function sz(r,t,e){var n=H(r,"x","unsortedSegmentSum"),a=H(t,"segmentIds","unsortedSegmentSum","int32");return Y(xa(e),function(){return"numSegments must be of dtype int"}),q.engine.runKernel(function(i,o){var u=i.unsortedSegmentSum(n,a,e);return o([a]),u},{$x:n},function(i,o){var u=o[0];return{$x:function(){return cz(i,u)}}})}function lz(r,t,e){e===void 0&&(e=0);var n=H(r,"x","gather"),a=H(t,"indices","gather","int32");e=$n(e,n.shape)[0];var i=pD(n,a,e);return q.engine.runKernel(function(o,u){var l=o.gather(n,a.flatten(),e);return u([a]),l},{$x:n},function(o,u){var l=u[0];return{$x:function(){var h=n.shape,f=l.size,p=h.slice(0,e),v=p.length,m=h.slice(e,h.length).slice(1),x=m.length,b=hw(0,v),E=hw(v+1,v+1+x),C=fw([p,[f],m]),R=o.reshape(C),_=l.reshape([f]),A=fw([[v],b,E]),k=R.transpose(A),D=nS(k,_,n.shape[e]),P=Pg(A);return D=D.transpose(P)}}}).reshape(i.outputShape)}function hw(r,t){for(var e=[],n=r;n<t;++n)e.push(n);return e}function fw(r){for(var t=[],e=0;e<r.length;++e)for(var n=0;n<r[e].length;++n)t.push(r[e][n]);return t}function cz(r,t){for(var e=Qg(t,Ce(t)),n=eS(r,e),a=KC(t,Tt(0,"int32")),i=n.rank-a.rank,o=0;o<i;++o)a=pa(a,o+1);a=Zg(a,Lu(n.shape,"bool"));var u=Ce(n);return Ic(a,n,u)}var eS=it({gather_:lz}),nS=it({unsortedSegmentSum_:sz});function hz(r,t,e,n){for(var a=H(t,"data","multiRNNCell"),i=Xf(e,"c","multiRNNCell"),o=Xf(n,"h","multiRNNCell"),u=a,l=[],h=0;h<r.length;h++){var f=r[h](u,i[h],o[h]);l.push(f[0]),l.push(f[1]),u=f[1]}var p=[],v=[];for(h=0;h<l.length;h+=2)p.push(l[h]),v.push(l[h+1]);return[p,v]}function fz(r,t,e,n,a,i){var o=H(r,"forgetBias","basicLSTMCell"),u=H(t,"lstmKernel","basicLSTMCell"),l=H(e,"lstmBias","basicLSTMCell"),h=H(n,"data","basicLSTMCell"),f=H(a,"c","basicLSTMCell"),p=H(i,"h","basicLSTMCell"),v=h.concat(p,1).matMul(u).add(l),m=v.shape[0],x=v.shape[1]/4,b=[m,x],E=v.slice([0,0],b),C=v.slice([0,x],b),R=v.slice([0,2*x],b),_=v.slice([0,3*x],b),A=E.sigmoid().mulStrict(C.tanh()).addStrict(f.mulStrict(o.add(R).sigmoid()));return[A,A.tanh().mulStrict(_.sigmoid())]}var dz=it({basicLSTMCell_:fz}),pz=it({multiRNNCell_:hz});function vz(r,t,e,n,a){a===void 0&&(a=!0);var i=H(r,"v","movingAverage"),o=H(t,"x","movingAverage"),u=H(e,"decay","movingAverage");zk(i,o),Y(pr(i.shape,o.shape),function(){return"Shape mismatch in v and x"});var l=Tt(1),h=l.sub(u),f=o.sub(i).mul(h);if(a){Y(n!=null,function(){return"When using zeroDebias: true, step is required."});var p=H(n,"step","movingAverage");f=f.div(l.sub(ZC(u,p)))}return i.add(f)}var mz=it({movingAverage_:vz});function gz(r,t,e,n,a,i,o,u,l){if(a===void 0&&(a=0),i===void 0&&(i=0),o===void 0&&(o=0),u===void 0&&(u=0),l===void 0&&(l=0),o!==0)throw new Error("ellipsis mask is not yet supported");if(u!==0)throw new Error("new axis mask is not yet supported");var h=H(r,"x","stridedSlice");if(n.every(function(b){return b===1})){var f=Fg(h.shape,t,e,n,a,i,o,u,l),p=f[0],v=f[1],m=f[2],x=v.filter(function(b,E){return m.indexOf(E)===-1});return Xo(h,p,v).reshape(x)}return q.engine.runKernel(function(b){return b.stridedSlice(h,t,e,n,a,i,o,u,l)},{$x:h})}var yz=it({stridedSlice_:gz});function xz(r,t,e){t===void 0&&(t=1),e===void 0&&(e=!0);var n=H(r,"x","topk");if(n.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var a=n.shape[n.shape.length-1];if(t>a)throw new Error("'k' passed to topk() must be <= the last dimension ("+a+") but got "+t);var i=q.engine.runKernel(function(o){return o.topk(n,t,e)},{$x:n});return{values:i[0],indices:i[1]}}var bz=it({topk_:xz});function wz(r,t,e){var n=H(r,"indices","scatterND","int32"),a=H(t,"updates","scatterND");return hD(a,n,e),q.engine.runKernel(function(i){return i.scatterND(n,a,e)},{$indices:n,$updates:a})}var Ez=it({scatterND_:wz});function Cz(r){Y(r.dtype==="complex64",function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+r.dtype+"."});var t=r.shape[r.shape.length-1],e=r.size/t,n=r.as2D(e,t);return q.engine.runKernel(function(a){return a.fft(n)},{input:r}).reshape(r.shape)}function Sz(r){Y(r.dtype==="complex64",function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+r.dtype+"."});var t=r.shape[r.shape.length-1],e=r.size/t,n=r.as2D(e,t);return q.engine.runKernel(function(a){return a.ifft(n)},{input:r}).reshape(r.shape)}function Rz(r){Y(r.dtype==="float32",function(){return"The dtype for rfft() must be real value but got "+r.dtype});var t=r.shape[r.shape.length-1],e=r.size/t,n=r.zerosLike(),a=dr(r,n).as2D(e,t),i=$g(a),o=Math.floor(t/2)+1,u=hi(i),l=Wo(i),h=u.split([o,t-o],u.shape.length-1),f=l.split([o,t-o],l.shape.length-1),p=r.shape.slice();return p[r.shape.length-1]=o,dr(h[0],f[0]).reshape(p)}function _z(r){var t=r.shape[r.shape.length-1],e=r.size/t;if(t<=2){var n=r.as2D(e,t),a=ed(n);return hi(a)}var i=[e,2*(t-1)],o=hi(r).as2D(e,t),u=Wo(r).as2D(e,t),l=o.slice([0,1],[e,t-2]).reverse(1),h=u.slice([0,1],[e,t-2]).reverse(1).mul(Tt(-1)),f=o.concat(l,1),p=u.concat(h,1);return n=dr(f,p).as2D(i[0],i[1]),a=ed(n),hi(a)}var $g=it({fft_:Cz}),ed=it({ifft_:Sz}),rS=it({rfft_:Rz}),aS=it({irfft_:_z}),Az=Object.freeze({fft:$g,ifft:ed,rfft:rS,irfft:aS});function Tz(r,t,e,n){if(r.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+r.dtype+".");if(r.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+r.shape+".");var a=r.rank>0?r.shape[0]:1,i=r.rank>1?r.shape[1]:1;if(e.length!==i)throw new Error("outputShape has incorrect number of elements:, "+e.length+", should be: "+i+".");var o=t.size;if(t.rank!==0&&(t.rank!==1||o!==a))throw new Error("sparseValues has incorrect shape "+t.shape+", should be [] or ["+a+"]");if(t.dtype!==n.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}function kz(r,t,e,n){n===void 0&&(n=0);var a=H(r,"sparseIndices","sparseToDense","int32"),i=H(t,"sparseValues","sparseToDense"),o=H(n,"defaultValue","sparseToDense",i.dtype);return Tz(a,i,e,o),q.engine.runKernel(function(u){return u.sparseToDense(a,i,e,o)},{$sparseIndices:a,$sparseValues:i,$defaultValue:o})}var Dz=it({sparseToDense_:kz});function Iz(r,t){var e=H(t,"indices","gatherND","int32"),n=H(r,"x","gatherND");return q.engine.runKernel(function(a){return a.gatherND(n,e)},{$x:n,$indices:e})}var rr,Nz=it({gatherND_:Iz});function Oz(r,t,e){e===void 0&&(e=rr.SUM_BY_NONZERO_WEIGHTS);var n=H(r,"losses","computeWeightedLoss"),a=null;t!=null&&(a=H(t,"weights","computeWeightedLoss"));var i=a==null?n:n.mul(a);if(e===rr.NONE)return i;if(e===rr.SUM)return i.sum();if(e===rr.MEAN){if(a==null)return i.mean();var o=n.size/a.size,u=i.sum().div(a.sum());return o>1?u.div(Tt(o)):u}if(e===rr.SUM_BY_NONZERO_WEIGHTS){if(a==null)return i.sum().div(Tt(n.size));var l=a.mul(Lu(n.shape)).notEqual(Tt(0)).sum().toFloat();return i.sum().div(l)}throw Error("Unknown reduction: "+e)}function Mz(r,t,e,n){n===void 0&&(n=rr.SUM_BY_NONZERO_WEIGHTS);var a=H(r,"labels","absoluteDifference"),i=H(t,"predictions","absoluteDifference"),o=null;e!=null&&(o=H(e,"weights","absoluteDifference")),Me(a.shape,i.shape,"Error in absoluteDifference: ");var u=a.sub(i).abs();return ao(u,o,n)}function Bz(r,t,e,n){n===void 0&&(n=rr.SUM_BY_NONZERO_WEIGHTS);var a=H(r,"labels","meanSquaredError"),i=H(t,"predictions","meanSquaredError"),o=null;e!=null&&(o=H(e,"weights","meanSquaredError")),Me(a.shape,i.shape,"Error in meanSquaredError: ");var u=a.squaredDifference(i);return ao(u,o,n)}function Pz(r,t,e,n,a){a===void 0&&(a=rr.SUM_BY_NONZERO_WEIGHTS);var i=H(r,"labels","cosineDistance"),o=H(t,"predictions","cosineDistance"),u=null;n!=null&&(u=H(n,"weights","cosineDistance")),Me(i.shape,o.shape,"Error in cosineDistance: ");var l=Tt(1).sub(i.mul(o).sum(e,!0));return ao(l,u,a)}function Fz(r,t,e,n){n===void 0&&(n=rr.SUM_BY_NONZERO_WEIGHTS);var a=H(r,"labels","hingeLoss"),i=H(t,"predictions","hingeLoss"),o=null;e!=null&&(o=H(e,"weights","hingeLoss")),Me(a.shape,i.shape,"Error in hingeLoss: ");var u=Tt(1);a=Tt(2).mul(a).sub(u);var l=u.sub(a.mul(i)).relu();return ao(l,o,n)}function Lz(r,t,e,n,a){n===void 0&&(n=1e-7),a===void 0&&(a=rr.SUM_BY_NONZERO_WEIGHTS);var i=H(r,"labels","logLoss"),o=H(t,"predictions","logLoss"),u=null;e!=null&&(u=H(e,"weights","logLoss")),Me(i.shape,o.shape,"Error in logLoss: ");var l=Tt(1),h=Tt(n),f=i.mul(o.add(h).log()).neg().sub(l.sub(i).mul(l.sub(o).add(h).log()));return ao(f,u,a)}function zz(r,t){var e=H(r,"labels","sigmoidCrossEntropyWithLogits"),n=H(t,"logits","sigmoidCrossEntropyWithLogits");Me(e.shape,n.shape,"Error in sigmoidCrossEntropyWithLogits: ");var a=n.relu(),i=n.mul(e),o=n.abs().neg().exp().log1p();return a.sub(i).add(o)}function Uz(r,t,e,n,a){n===void 0&&(n=0),a===void 0&&(a=rr.SUM_BY_NONZERO_WEIGHTS);var i=H(r,"multiClassLabels","sigmoidCrossEntropy"),o=H(t,"logits","sigmoidCrossEntropy"),u=null;if(e!=null&&(u=H(e,"weights","sigmoidCrossEntropy")),Me(i.shape,o.shape,"Error in sigmoidCrossEntropy: "),n>0){var l=Tt(n),h=Tt(1),f=Tt(.5);i=i.mul(h.sub(l)).add(f.mul(l))}var p=zz(i,o);return ao(p,u,a)}function Wz(r,t,e,n,a){n===void 0&&(n=1),a===void 0&&(a=rr.SUM_BY_NONZERO_WEIGHTS);var i=H(r,"labels","huberLoss"),o=H(t,"predictions","huberLoss"),u=null;e!=null&&(u=H(e,"weights","huberLoss")),Me(i.shape,o.shape,"Error in huberLoss: ");var l=Tt(n),h=o.sub(i).abs(),f=QC(h,l),p=h.sub(f),v=Tt(.5).mul(f.square()).add(l.mul(p));return ao(v,u,a)}function Vz(r,t,e){if(e===void 0&&(e=-1),e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+t.rank+" and dim was "+e);return Vc(function(n,a,i){var o=a.logSumExp([e],!0),u=a.toFloat().sub(o);return i([n,u]),{value:u.mul(n).neg().sum([e]),gradFunc:function(l,h){var f=h[0],p=h[1],v=ba(l.shape,[e]);return[l.reshape(v).mul(f.toFloat().sub(p.exp())),l.reshape(v).mul(p.exp().sub(f.toFloat()))]}}})(r,t)}function Gz(r,t,e,n,a){n===void 0&&(n=0),a===void 0&&(a=rr.SUM_BY_NONZERO_WEIGHTS);var i=H(r,"onehotLabels","softmaxCrossEntropy"),o=H(t,"logits","softmaxCrossEntropy"),u=null;if(e!=null&&(u=H(e,"weights","softmaxCrossEntropy")),Me(i.shape,o.shape,"Error in softmaxCrossEntropy: "),n>0){var l=Tt(n),h=Tt(1),f=Tt(i.shape[1]);i=i.mul(h.sub(l)).add(l.div(f))}var p=Vz(i,o);return ao(p,u,a)}(function(r){r[r.NONE=0]="NONE",r[r.MEAN=1]="MEAN",r[r.SUM=2]="SUM",r[r.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(rr||(rr={}));var Hz=it({absoluteDifference_:Mz}),ao=it({computeWeightedLoss_:Oz}),qz=it({cosineDistance_:Pz}),jz=it({hingeLoss_:Fz}),Xz=it({huberLoss_:Wz}),Kz=it({logLoss_:Lz}),Yz=it({meanSquaredError_:Bz}),Qz=it({sigmoidCrossEntropy_:Uz}),Zz=it({softmaxCrossEntropy_:Gz}),$z=Object.freeze({get Reduction(){return rr},absoluteDifference:Hz,computeWeightedLoss:ao,cosineDistance:qz,hingeLoss:jz,huberLoss:Xz,logLoss:Kz,meanSquaredError:Yz,sigmoidCrossEntropy:Qz,softmaxCrossEntropy:Zz});function Jz(r){var t;if(Array.isArray(r)){t=!1,Y(r!=null&&r.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var e=r[0].shape[0],n=function(l){Y(r[l].shape[0]===e,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+r[l].shape[0]+" vs. "+e+")"})},a=1;a<r.length;++a)n(a)}else t=!0,r=Hg(r,r.shape[0],0).map(function(l){return IC(l,[0])});Y(r.length<=r[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+r.length+") exceeds number of dimensions ("+r[0].shape[0]+")."});var i=[],o=r,u=function(l){i.push(q.engine.tidy(function(){var h=o[l];if(l>0)for(var f=0;f<l;++f){var p=jC(i[f].mulStrict(h)).mul(i[f]);h=h.sub(p)}return h.div(tS(h,"euclidean"))}))};for(a=0;a<r.length;++a)u(a);return t?Pa(i,0):i}function tU(r,t){if(t===void 0&&(t=!1),r.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+r.rank);if(r.rank===2)return dw(r,t);var e=r.shape.slice(0,r.shape.length-2).reduce(function(i,o){return i*o}),n=[],a=[];return Zn(r.reshape([e,r.shape[r.shape.length-2],r.shape[r.shape.length-1]]),0).forEach(function(i){var o=dw(i,t),u=o[0],l=o[1];n.push(u),a.push(l)}),[Pa(n,0).reshape(r.shape),Pa(a,0).reshape(r.shape)]}function dw(r,t){return t===void 0&&(t=!1),q.engine.tidy(function(){if(r.shape.length!==2)throw new Error("qr2d() requires a 2D Tensor, but got a "+r.shape.length+"D Tensor.");for(var e=r.shape[0],n=r.shape[1],a=kC(e),i=r.clone(),o=_d([[1]],[1,1]),u=o.clone(),l=e>=n?n:e,h=function(p){var v,m=i,x=u,b=a;v=q.engine.tidy(function(){var E=i.slice([p,p],[e-p,1]),C=E.norm(),R=i.slice([p,p],[1,1]),_=R.sign().neg(),A=R.sub(_.mul(C)),k=E.div(A);u=k.shape[0]===1?o.clone():o.concat(k.slice([1,0],[k.shape[0]-1,k.shape[1]]),0);var D=_.matMul(A).div(C).neg(),P=i.slice([p,0],[e-p,n]),M=D.mul(u);i=p===0?P.sub(M.matMul(u.transpose().matMul(P))):i.slice([0,0],[p,n]).concat(P.sub(M.matMul(u.transpose().matMul(P))),0);var O=a.slice([0,p],[e,a.shape[1]-p]);return a=p===0?O.sub(O.matMul(u).matMul(M.transpose())):a.slice([0,0],[e,p]).concat(O.sub(O.matMul(u).matMul(M.transpose())),1),[u,i,a]}),u=v[0],i=v[1],a=v[2],uD([m,x,b])},f=0;f<l;++f)h(f);return!t&&e>n&&(a=a.slice([0,0],[e,n]),i=i.slice([0,0],[n,n])),[a,i]})}var eU=it({gramSchmidt_:Jz}),nU=it({qr_:tU}),rU=Object.freeze({gramSchmidt:eU,qr:nU});function aU(r,t,e){e===void 0&&(e=!1);var n=H(r,"images","resizeBilinear");Y(n.rank===3||n.rank===4,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+n.rank+"."}),Y(t.length===2,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+t+"."});var a=n,i=!1;n.rank===3&&(i=!0,a=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var o=t[0],u=t[1],l=q.engine.runKernel(function(h,f){return f([a]),h.resizeBilinear(a,o,u,e)},{batchImages:a},function(h,f){return{batchImages:function(){return q.engine.runKernel(function(p){return p.resizeBilinearBackprop(h,f[0],e)},{})}}});return i?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l}function iU(r,t,e){e===void 0&&(e=!1);var n=H(r,"images","resizeNearestNeighbor");Y(n.rank===3||n.rank===4,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+n.rank+"."}),Y(t.length===2,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+t+"."}),Y(n.dtype==="float32"||n.dtype==="int32",function(){return"`images` must have `int32` or `float32` as dtype"});var a=n,i=!1;n.rank===3&&(i=!0,a=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var o=t[0],u=t[1],l=q.engine.runKernel(function(h,f){return f([a]),h.resizeNearestNeighbor(a,o,u,e)},{batchImages:a},function(h,f){return{batchImages:function(){return q.engine.runKernel(function(p){return p.resizeNearestNeighborBackprop(h,f[0],e)},{})}}});return i?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l}function oU(r,t,e,n,a){n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY);var i=H(r,"boxes","nonMaxSuppression"),o=H(t,"scores","nonMaxSuppression"),u=iS(i,o,e,n,a);return e=u.maxOutputSize,n=u.iouThreshold,a=u.scoreThreshold,q.engine.runKernel(function(l){return l.nonMaxSuppression(i,o,e,n,a)},{$boxes:i})}function uU(r,t,e,n,a){return n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),Ne(this,void 0,void 0,function(){var i,o,u,l,h,f;return Oe(this,function(p){switch(p.label){case 0:return i=H(r,"boxes","nonMaxSuppressionAsync"),o=H(t,"scores","nonMaxSuppressionAsync"),u=iS(i,o,e,n,a),e=u.maxOutputSize,n=u.iouThreshold,a=u.scoreThreshold,[4,i.data()];case 1:return l=p.sent(),[4,o.data()];case 2:return h=p.sent(),f=zg(l,h,e,n,a),i!==r&&i.dispose(),o!==t&&o.dispose(),[2,f]}})})}function iS(r,t,e,n,a){n==null&&(n=.5),a==null&&(a=Number.NEGATIVE_INFINITY);var i=r.shape[0];return e=Math.min(e,i),Y(0<=n&&n<=1,function(){return"iouThreshold must be in [0, 1], but was '"+n+"'"}),Y(r.rank===2,function(){return"boxes must be a 2D tensor, but was of rank '"+r.rank+"'"}),Y(r.shape[1]===4,function(){return"boxes must have 4 columns, but 2nd dimension was "+r.shape[1]}),Y(t.rank===1,function(){return"scores must be a 1D tensor"}),Y(t.shape[0]===i,function(){return"scores has incompatible shape with boxes. Expected "+i+", but was "+t.shape[0]}),{maxOutputSize:e,iouThreshold:n,scoreThreshold:a}}function sU(r,t,e,n,a,i){var o=H(r,"image","cropAndResize","float32"),u=H(t,"boxes","cropAndResize","float32"),l=H(e,"boxInd","cropAndResize","int32");a=a||"bilinear",i=i||0;var h=u.shape[0];return Y(o.rank===4,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+o.rank+"."}),Y(u.rank===2&&u.shape[1]===4,function(){return"Error in cropAndResize: boxes must be have size ["+h+",4] but had shape "+u.shape+"."}),Y(l.rank===1&&l.shape[0]===h,function(){return"Error in cropAndResize: boxInd must be have size ["+h+"] but had shape "+u.shape+"."}),Y(n.length===2,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+n.length+"."}),Y(n[0]>=1&&n[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+n}),Y(a==="bilinear"||a==="nearest",function(){return"method must be bilinear or nearest, but was "+a}),q.engine.runKernel(function(f,p){return f.cropAndResize(o,u,l,n,a,i)},{$image:o,$boxes:u})}var lU=it({resizeBilinear_:aU}),cU=it({resizeNearestNeighbor_:iU}),hU=it({nonMaxSuppression_:oU}),fU=uU,dU=it({cropAndResize_:sU}),oS=Object.freeze({resizeBilinear:lU,resizeNearestNeighbor:cU,nonMaxSuppression:hU,nonMaxSuppressionAsync:fU,cropAndResize:dU});function pU(r,t,e,n,a,i){var o;e===void 0&&(e=!1),n===void 0&&(n=!1),i===void 0&&(i="linear");var u=H(r,"a","fused matMul"),l=H(t,"b","fused matMul");o=kn(u,l),u=o[0],l=o[1];var h=e?u.shape[u.rank-2]:u.shape[u.rank-1],f=n?l.shape[l.rank-1]:l.shape[l.rank-2],p=e?u.shape[u.rank-1]:u.shape[u.rank-2],v=n?l.shape[l.rank-2]:l.shape[l.rank-1],m=u.shape.slice(0,-2),x=l.shape.slice(0,-2),b=qt(m),E=qt(x);Y(u.rank>=2&&l.rank>=2&&u.rank===l.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+u.rank+" and "+l.rank+"."}),Y(pr(m,x),function(){return"Error in fused matMul: outer dimensions ("+m+") and ("+x+") of Tensors with shapes "+u.shape+" and "+l.shape+" must match."}),Y(h===f,function(){return"Error in fused matMul: inner shapes ("+h+") and ("+f+") of Tensors with shapes "+u.shape+" and "+l.shape+" and transposeA="+e+" and transposeB="+n+" must match."});var C,R=u.shape.slice(0,-2).concat([p,v]),_=e?u.as3D(b,h,p):u.as3D(b,p,h),A=n?l.as3D(E,v,f):l.as3D(E,f,v);a!=null&&ve(R,(C=kn(C=H(a,"bias","fused matMul"),u)[0]).shape);var k={$a:_,$b:A};return a!=null&&(k.$bias=C),q.engine.runKernel(function(D,P){var M=D.fusedBatchMatMul(_,A,e,n,C,i);return P([_,A,M]),M},k,function(D,P){var M,O=P[0],F=P[1],W=P[2];if(i==null||i==="linear")M=D;else{if(i!=="relu")throw new Error("Gradient for activation "+i+" has not been implemented yet.");M=D.mul(W.step())}var j={};return a!=null&&(j={$bias:function(){var ot=M,nt=Dn(C.shape,M.shape);return nt.length>0&&(ot=ot.sum(nt)),ot.reshape(C.shape)}}),Object.assign(e||n?!e&&n?{$a:function(){return M.matMul(F,!1,!1)},$b:function(){return M.matMul(O,!0,!1)}}:e&&!n?{$a:function(){return F.matMul(M,!1,!0)},$b:function(){return O.matMul(M,!1,!1)}}:{$a:function(){return F.matMul(M,!0,!0)},$b:function(){return M.matMul(O,!0,!0)}}:{$a:function(){return M.matMul(F,!1,!0)},$b:function(){return O.matMul(M,!0,!1)}},j)}).reshape(R)}var vU=it({matMul_:pU}),mU=Object.freeze({matMul:vU}),gU=Object.freeze({image:oS,linalg:rU,losses:$z,spectral:Az,fused:mU,op:it,batchNormalization2d:m4,batchNormalization3d:g4,batchNormalization4d:y4,batchNormalization:x4,batchNorm:FC,batchNorm2d:b4,batchNorm3d:w4,batchNorm4d:E4,complex:dr,real:hi,imag:Wo,concat:Rr,concat1d:JM,concat2d:tB,concat3d:eB,concat4d:nB,split:Hg,conv1d:z4,conv2d:ro,conv3d:U4,conv2dDerFilter:UC,depthwiseConv2d:Kg,separableConv2d:WC,conv2dTranspose:W4,matMul:Yg,dot:q4,outerProduct:j4,reverse:Zc,reverse1d:$4,reverse2d:J4,reverse3d:tF,reverse4d:eF,maxPool:il,avgPool:$c,pool:lF,slice:Xo,slice1d:vF,slice2d:mF,slice3d:HC,slice4d:gF,abs:PP,acos:FP,acosh:LP,asin:zP,asinh:UP,atan:WP,atanh:VP,ceil:GP,clipByValue:jg,cos:HP,cosh:qP,erf:jP,exp:og,expm1:XP,floor:KP,log:YP,log1p:QP,logSigmoid:ZP,neg:$f,reciprocal:$P,round:JP,rsqrt:NC,sigmoid:OC,sign:t4,isNaN:e4,isInf:n4,isFinite:r4,sin:a4,sinh:i4,softplus:o4,sqrt:u4,square:s4,step:l4,tan:c4,tanh:h4,all:kF,any:DF,argMax:IF,argMin:NF,logSumExp:OF,max:Td,mean:MF,min:BF,moments:PF,sum:jC,prod:FF,equal:XC,equalStrict:QF,greater:ZF,greaterEqual:KC,greaterEqualStrict:$F,greaterStrict:JF,less:tL,lessEqual:eL,lessEqualStrict:nL,lessStrict:rL,notEqual:aL,notEqualStrict:iL,add:we,addN:AL,addStrict:TL,atan2:kL,div:ji,divStrict:DL,floorDiv:YC,maximum:Qg,maximumStrict:IL,minimum:QC,minimumStrict:NL,mod:OL,modStrict:ML,mul:Zi,mulStrict:BL,pow:ZC,powStrict:PL,squaredDifference:FL,squaredDifferenceStrict:LL,sub:vi,subStrict:zL,elu:tz,leakyRelu:ez,prelu:nz,relu:wn,selu:rz,logicalAnd:Zg,logicalNot:jL,logicalOr:$C,logicalXor:XL,where:Ic,whereAsync:KL,buffer:fe,print:BB,batchToSpaceND:TC,cast:PB,clone:FB,cumsum:LB,depthToSpace:zB,expandDims:pa,eye:kC,multinomial:UB,oneHot:ig,pad:Xc,pad1d:WB,pad2d:VB,pad3d:GB,pad4d:HB,rand:qB,randomNormal:jB,randomUniform:XB,reshape:Ba,spaceToBatchND:DC,squeeze:IC,stack:Pa,tile:Xs,truncatedNormal:KB,unstack:Zn,setdiff1dAsync:YB,fill:_c,linspace:TD,ones:Lu,range:aC,scalar:Tt,tensor:bn,tensor1d:jr,tensor2d:_d,tensor3d:Lg,tensor4d:Oa,tensor5d:SD,tensor6d:RD,zeros:dn,onesLike:iC,zerosLike:Ce,transpose:Ko,softmax:Jo,logSoftmax:bD,localResponseNormalization:oz,norm:tS,gather:eS,unsortedSegmentSum:nS,basicLSTMCell:dz,multiRNNCell:pz,movingAverage:mz,stridedSlice:yz,topk:bz,scatterND:Ez,fft:$g,ifft:ed,rfft:rS,irfft:aS,sparseToDense:Dz,gatherND:Nz});function yU(r,t,e){if(t==="linear")return r.linear(e);if(t==="relu")return r.relu(e);throw new Error("Activation "+t+" has not been implemented for the CPU backend.")}var xU=(function(){function r(){this.blockSize=48,this.firstUse=!0,q.get("IS_BROWSER")&&(this.fromPixels2DContext=document.createElement("canvas").getContext("2d"))}return r.prototype.setDataMover=function(t){this.data=new oC(t)},r.prototype.register=function(t,e,n){if(this.firstUse&&(this.firstUse=!1,q.get("IS_NODE")&&ng(`
============================
Hi there . Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.
============================
`)),this.data.has(t))throw new Error("Data buffer is already registered");this.data.set(t,{dtype:n})},r.prototype.write=function(t,e){if(e==null)throw new Error("MathBackendCPU.write(): values can not be null");this.data.get(t).values=e},r.prototype.fromPixels=function(t,e){if(t==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var n,a;if(q.get("IS_NODE")&&t.getContext==null)throw new Error("When running in node, pixels must be an HTMLCanvasElement like the one returned by the `canvas` npm package");if(t.getContext!=null)n=t.getContext("2d").getImageData(0,0,t.width,t.height).data;else if(t instanceof ImageData)n=t.data;else{if(!(t instanceof HTMLImageElement||t instanceof HTMLVideoElement))throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement or ImageData, but was "+t.constructor.name);if(this.fromPixels2DContext==null)throw new Error("Can't read pixels from HTMLImageElement outside the browser.");this.fromPixels2DContext.canvas.width=t.width,this.fromPixels2DContext.canvas.height=t.height,this.fromPixels2DContext.drawImage(t,0,0,t.width,t.height),n=this.fromPixels2DContext.getImageData(0,0,t.width,t.height).data}if(e===4)a=new Int32Array(n);else{var i=t.width*t.height;a=new Int32Array(i*e);for(var o=0;o<i;o++)for(var u=0;u<e;++u)a[o*e+u]=n[4*o+u]}return Lg(a,[t.height,t.width,e],"int32")},r.prototype.read=function(t){return Ne(this,void 0,void 0,function(){return Oe(this,function(e){return[2,this.readSync(t)]})})},r.prototype.readSync=function(t){var e=this.data.get(t),n=e.dtype,a=e.complexTensors;return n==="complex64"?sC(a.real.dataSync(),a.imag.dataSync()):this.data.get(t).values},r.prototype.disposeData=function(t){if(this.data.has(t)){var e=this.data.get(t).complexTensors;e!=null&&(e.real.dispose(),e.imag.dispose()),this.data.delete(t)}},r.prototype.time=function(t){return Ne(this,void 0,void 0,function(){var e;return Oe(this,function(n){return e=jf(),t(),[2,{kernelMs:jf()-e}]})})},r.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},r.prototype.complex=function(t,e){var n=kt.make(t.shape,{},"complex64");return this.data.get(n.dataId).complexTensors={real:q.engine.keep(t.clone()),imag:q.engine.keep(e.clone())},n},r.prototype.real=function(t){return this.data.get(t.dataId).complexTensors.real.clone()},r.prototype.imag=function(t){return this.data.get(t.dataId).complexTensors.imag.clone()},r.prototype.assertNotComplex=function(t,e){Array.isArray(t)||(t=[t]),t.forEach(function(n){n!=null&&Y(n.dtype!=="complex64",function(){return e+" does not support complex64 tensors."})})},r.prototype.slice=function(t,e,n){if(this.assertNotComplex(t,"slice"),nC(t.shape,e,n)){var a=rC(e,t.strides),i=qt(n);return bn(t.dataSync().subarray(a,a+i),n,t.dtype)}for(var o=fe(n,t.dtype),u=t.bufferSync(),l=0;l<o.size;++l){var h=o.indexToLoc(l).map(function(f,p){return f+e[p]});o.values[l]=u.get.apply(u,h)}return o.toTensor()},r.prototype.stridedSlice=function(t,e,n,a,i,o,u,l,h){this.assertNotComplex(t,"stridedSlice");var f=Fg(t.shape,e,n,a,i,o,u,l,h),p=f[0],v=f[1],m=f[2],x=v.filter(function(k,D){return m.indexOf(D)===-1});if(x.some(function(k){return k===0}))return bn([],x);for(var b=fe(v,t.dtype),E=t.bufferSync(),C=0;C<b.size;C++){for(var R=b.indexToLoc(C),_=new Array(R.length),A=0;A<_.length;A++)_[A]=R[A]*a[A]+p[A];b.set.apply(b,[E.get.apply(E,_)].concat(R))}return b.toTensor().reshape(x)},r.prototype.unstack=function(t,e){for(var n=t.shape[e],a=new Array(t.rank-1),i=0,o=0;o<t.rank;o++)o!==e&&(a[i++]=t.shape[o]);var u=new Array(t.rank).fill(0),l=t.shape.slice();l[e]=1;var h=new Array(n);for(o=0;o<h.length;o++)u[e]=o,h[o]=this.slice(t,u,l).reshape(a);return h},r.prototype.reverse=function(t,e){this.assertNotComplex(t,"reverse");for(var n=fe(t.shape,t.dtype),a=t.bufferSync(),i=function(u){var l=n.indexToLoc(u),h=l.slice();e.forEach(function(f){return h[f]=t.shape[f]-1-h[f]}),n.set.apply(n,[a.get.apply(a,h)].concat(l))},o=0;o<n.size;o++)i(o);return n.toTensor()},r.prototype.concat=function(t,e){this.assertNotComplex(t,"concat");var n=t.map(function(h){var f=qt(h.shape.slice(e));return h.as2D(-1,f)}),a=al(n.map(function(h){return h.shape}),1),i=fe(a,t[0].dtype).values;if(n[0].shape[0]===1){var o=0;n.forEach(function(h){i.set(h.dataSync(),o),o+=h.size})}else{var u=0;n.forEach(function(h){for(var f=h.dataSync(),p=0,v=0;v<h.shape[0];++v)for(var m=v*a[1]+u,x=0;x<h.shape[1];++x)i[m+x]=f[p++];u+=h.shape[1]})}var l=al(t.map(function(h){return h.shape}),e);return bn(i,l,t[0].dtype)},r.prototype.neg=function(t){return this.assertNotComplex(t,"neg"),this.multiply(Tt(-1),t)},r.prototype.add=function(t,e){return t.dtype==="complex64"||e.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),e.cast("complex64"),function(n,a,i,o){return{real:n+i,imag:a+o}}):this.broadcastedBinaryOp(t,e,Un(t.dtype,e.dtype),function(n,a){return n+a})},r.prototype.addN=function(t){this.assertNotComplex(t,"addN");for(var e=t.map(function(l){return l.dataSync()}),n=fe(t[0].shape,t[0].dtype),a=n.values,i=0;i<t.length;i++)for(var o=e[i],u=0;u<a.length;u++)a[u]+=o[u];return n.toTensor()},r.prototype.subtract=function(t,e){return t.dtype==="complex64"||e.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),e.cast("complex64"),function(n,a,i,o){return{real:n-i,imag:a-o}}):this.broadcastedBinaryOp(t,e,Un(t.dtype,e.dtype),function(n,a){return n-a})},r.prototype.pow=function(t,e){return this.assertNotComplex([t,e],"pow"),this.broadcastedBinaryOp(t,e,t.dtype,function(n,a){return Math.pow(n,a)})},r.prototype.batchMatMul=function(t,e,n,a){this.assertNotComplex([t,e],"matMul");for(var i=n?t.shape[1]:t.shape[2],o=n?t.shape[2]:t.shape[1],u=a?e.shape[1]:e.shape[2],l=t.shape[0],h=t.dataSync(),f=e.dataSync(),p=n?[t.strides[0],1,t.strides[1]]:[t.strides[0],t.strides[1],1],v=p[0],m=p[1],x=p[2],b=a?[1,e.strides[1],e.strides[0]]:[e.strides[1],1,e.strides[0]],E=b[0],C=b[1],R=b[2],_=o*u,A=fe([l,o,u],t.dtype),k=A.values,D=this.blockSize,P=0;P<l;P++)for(var M=0;M<o;M+=D)for(var O=0;O<u;O+=D)for(var F=0;F<i;F+=D)for(var W=Math.min(M+D,o),j=Math.min(O+D,u),ot=Math.min(F+D,i),nt=M;nt<W;nt++)for(var at=O;at<j;at++){for(var V=0,X=F;X<ot;X++)V+=h[P*v+nt*m+X*x]*f[X*E+at*C+P*R];k[P*_+(nt*u+at)]+=V}return A.toTensor()},r.prototype.fusedBatchMatMul=function(t,e,n,a,i,o){var u=this.batchMatMul(t,e,n,a);return i&&(u=this.add(u,i)),o&&(u=yU(this,o,u)),u},r.prototype.multiply=function(t,e){return t.dtype==="complex64"||e.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),e.cast("complex64"),function(n,a,i,o){return{real:n*i-a*o,imag:n*o+a*i}}):this.broadcastedBinaryOp(t,e,Un(t.dtype,e.dtype),function(n,a){return n*a})},r.prototype.realDivide=function(t,e){return this.assertNotComplex([t,e],"realDivide"),this.broadcastedBinaryOp(t,e,"float32",function(n,a){return n/a})},r.prototype.floorDiv=function(t,e){return this.assertNotComplex([t,e],"floorDiv"),this.broadcastedBinaryOp(t,e,"int32",function(n,a){return Math.floor(n/a)})},r.prototype.sum=function(t,e){this.assertNotComplex(t,"sum"),Gr("sum",e,t.rank);for(var n=er(t.shape,e),a=n[0],i=n[1],o=dn(a,Un(t.dtype,"int32")),u=qt(i),l=o.dataSync(),h=t.dataSync(),f=0;f<l.length;++f){for(var p=f*u,v=0,m=0;m<u;++m)v+=h[p+m];l[f]=v}return o},r.prototype.prod=function(t,e){this.assertNotComplex(t,"sum");for(var n=er(t.shape,e),a=n[0],i=n[1],o=dn(a,Un(t.dtype,"int32")),u=qt(i),l=o.dataSync(),h=t.dataSync(),f=0;f<l.length;++f){for(var p=f*u,v=1,m=0;m<u;++m)v*=h[p+m];l[f]=v}return o},r.prototype.unsortedSegmentSum=function(t,e,n){this.assertNotComplex(t,"unsortedSegmentSum");for(var a=[],i=t.rank-e.rank,o=0;o<i;++o)e=e.expandDims(o+1);for(o=0;o<n;++o){var u=Tt(o,"int32"),l=XC(u,e).asType("float32").mul(t).sum(0);a.push(l)}return Pa(a)},r.prototype.argMin=function(t,e){this.assertNotComplex(t,"argMin");var n=[e];Gr("argMin",n,t.rank);for(var a=er(t.shape,n),i=a[0],o=a[1],u=dn(i,"int32"),l=qt(o),h=u.dataSync(),f=t.dataSync(),p=0;p<h.length;++p){for(var v=p*l,m=f[v],x=0,b=0;b<l;++b){var E=f[v+b];E<m&&(m=E,x=b)}h[p]=x}return u},r.prototype.argMax=function(t,e){this.assertNotComplex(t,"argMax");var n=[e];Gr("argMax",n,t.rank);for(var a=er(t.shape,n),i=a[0],o=a[1],u=dn(i,"int32"),l=qt(o),h=u.dataSync(),f=t.dataSync(),p=0;p<h.length;++p){for(var v=p*l,m=f[v],x=0,b=0;b<l;++b){var E=f[v+b];E>m&&(m=E,x=b)}h[p]=x}return u},r.prototype.cumsum=function(t,e,n,a){if(this.assertNotComplex(t,"cumsum"),e!==t.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(t.rank-1)+" but got axis="+e);for(var i=Un(t.dtype,"int32"),o=dn(t.shape,i),u=o.dataSync(),l=t.dataSync(),h=t.shape[t.rank-1],f=a?function(b,E){return b+h-E-1}:function(b,E){return b+E},p=0;p<l.length;p+=h)for(var v=0;v<h;v++){var m=f(p,v);if(v===0)u[m]=n?0:l[m];else{var x=f(p,v-1);u[m]=n?l[x]+u[x]:l[m]+u[x]}}return o},r.prototype.equal=function(t,e){return this.assertNotComplex([t,e],"equal"),this.broadcastedBinaryOp(t,e,"bool",function(n,a){return n===a?1:0})},r.prototype.notEqual=function(t,e){return this.assertNotComplex([t,e],"notEqual"),this.broadcastedBinaryOp(t,e,"bool",function(n,a){return n!==a?1:0})},r.prototype.less=function(t,e){return this.assertNotComplex([t,e],"less"),this.broadcastedBinaryOp(t,e,"bool",function(n,a){return n<a?1:0})},r.prototype.lessEqual=function(t,e){return this.assertNotComplex([t,e],"lessEqual"),this.broadcastedBinaryOp(t,e,"bool",function(n,a){return n<=a?1:0})},r.prototype.greater=function(t,e){return this.assertNotComplex([t,e],"greater"),this.broadcastedBinaryOp(t,e,"bool",function(n,a){return n>a?1:0})},r.prototype.greaterEqual=function(t,e){return this.assertNotComplex([t,e],"greaterEqual"),this.broadcastedBinaryOp(t,e,"bool",function(n,a){return n>=a?1:0})},r.prototype.logicalNot=function(t){this.assertNotComplex(t,"logicalNot");for(var e=t.dataSync(),n=new Uint8Array(e.length),a=0;a<e.length;++a)n[a]=e[a]?0:1;return kt.make(t.shape,{values:n},"bool")},r.prototype.logicalAnd=function(t,e){return this.assertNotComplex([t,e],"logicalAnd"),this.broadcastedBinaryOp(t,e,"bool",function(n,a){return n&&a})},r.prototype.logicalOr=function(t,e){return this.assertNotComplex([t,e],"logicalOr"),this.broadcastedBinaryOp(t,e,"bool",function(n,a){return n||a})},r.prototype.select=function(t,e,n){this.assertNotComplex([t,e,n],"select");for(var a=t.dataSync(),i=e.dataSync(),o=n.dataSync(),u=dn(e.shape,Un(e.dtype,n.dtype)),l=u.dataSync(),h=0,f=t.rank===0||t.rank>1||e.rank===1?1:e.shape[1],p=0;p<a.length;p++)for(var v=0;v<f;v++)a[p]===1?l[h++]=i[p]:l[h++]=o[p];return u},r.prototype.where=function(t){this.assertNotComplex([t],"where");var e=t.dataSync();return qg(t.shape,e)},r.prototype.topk=function(t,e,n){return this.assertNotComplex(t,"topk"),cC(t.dataSync(),t.shape,t.dtype,e)},r.prototype.min=function(t,e){this.assertNotComplex(t,"min"),Gr("min",e,t.rank);for(var n=er(t.shape,e),a=n[0],i=n[1],o=dn(a,t.dtype),u=qt(i),l=o.dataSync(),h=t.dataSync(),f=0;f<l.length;++f){for(var p=f*u,v=h[p],m=0;m<u;++m){var x=h[p+m];x<v&&(v=x)}l[f]=v}return o},r.prototype.minimum=function(t,e){return this.assertNotComplex([t,e],"minimum"),this.broadcastedBinaryOp(t,e,t.dtype,function(n,a){return Math.min(n,a)})},r.prototype.mod=function(t,e){return this.assertNotComplex([t,e],"mod"),this.broadcastedBinaryOp(t,e,t.dtype,function(n,a){var i=n%a;return n<0&&a<0||n>=0&&a>=0?i:(i+a)%a})},r.prototype.max=function(t,e){this.assertNotComplex(t,"max"),Gr("max",e,t.rank);for(var n=er(t.shape,e),a=n[0],i=n[1],o=dn(a,t.dtype),u=qt(i),l=o.dataSync(),h=t.dataSync(),f=0;f<l.length;++f){for(var p=f*u,v=h[p],m=0;m<u;++m){var x=h[p+m];x>v&&(v=x)}l[f]=v}return o},r.prototype.maximum=function(t,e){return this.assertNotComplex([t,e],"maximum"),this.broadcastedBinaryOp(t,e,t.dtype,function(n,a){return Math.max(n,a)})},r.prototype.all=function(t,e){this.assertNotComplex(t,"all"),Gr("all",e,t.rank);for(var n=er(t.shape,e),a=n[0],i=n[1],o=dn(a,t.dtype),u=qt(i),l=o.dataSync(),h=t.dataSync(),f=0;f<l.length;++f){for(var p=f*u,v=h[p],m=0;m<u;++m){var x=h[p+m];v=v&&x}l[f]=v}return o},r.prototype.any=function(t,e){this.assertNotComplex(t,"any"),Gr("any",e,t.rank);for(var n=er(t.shape,e),a=n[0],i=n[1],o=dn(a,t.dtype),u=qt(i),l=o.dataSync(),h=t.dataSync(),f=0;f<l.length;++f){for(var p=f*u,v=h[p],m=0;m<u;++m){var x=h[p+m];v=v||x}l[f]=v}return o},r.prototype.squaredDifference=function(t,e){return this.assertNotComplex([t,e],"squaredDifference"),this.broadcastedBinaryOp(t,e,t.dtype,function(n,a){var i=n-a;return i*i})},r.prototype.ceil=function(t){this.assertNotComplex(t,"ceil");for(var e=t.dataSync(),n=new Float32Array(e.length),a=0;a<e.length;++a)n[a]=Math.ceil(e[a]);return kt.make(t.shape,{values:n})},r.prototype.floor=function(t){this.assertNotComplex(t,"floor");for(var e=t.dataSync(),n=new Float32Array(e.length),a=0;a<e.length;++a)n[a]=Math.floor(e[a]);return kt.make(t.shape,{values:n})},r.prototype.sign=function(t){this.assertNotComplex(t,"x");for(var e=t.dataSync(),n=new Float32Array(e.length),a=0;a<e.length;++a)e[a]<0?n[a]=-1:e[a]>0?n[a]=1:n[a]=0;return kt.make(t.shape,{values:n})},r.prototype.isNaN=function(t){this.assertNotComplex(t,"x");for(var e=t.dataSync(),n=new Uint8Array(e.length),a=0;a<e.length;++a)Number.isNaN(e[a])&&(n[a]=1);return kt.make(t.shape,{values:n},"bool")},r.prototype.isInf=function(t){this.assertNotComplex(t,"x");for(var e=t.dataSync(),n=new Uint8Array(e.length),a=0;a<e.length;++a)Math.abs(e[a])===1/0&&(n[a]=1);return kt.make(t.shape,{values:n},"bool")},r.prototype.isFinite=function(t){this.assertNotComplex(t,"x");for(var e=t.dataSync(),n=new Uint8Array(e.length),a=0;a<e.length;++a)Number.isFinite(e[a])&&(n[a]=1);return kt.make(t.shape,{values:n},"bool")},r.prototype.round=function(t){this.assertNotComplex(t,"round");for(var e=t.dataSync(),n=new Float32Array(e.length),a=0;a<e.length;++a){var i=Math.floor(e[a]);e[a]-i<.5?n[a]=Math.floor(e[a]):e[a]-i>.5?n[a]=Math.ceil(e[a]):n[a]=i%2==0?i:i+1}return kt.make(t.shape,{values:n})},r.prototype.exp=function(t){this.assertNotComplex(t,"exp");for(var e=t.dataSync(),n=new Float32Array(e.length),a=0;a<e.length;++a)n[a]=Math.exp(e[a]);return kt.make(t.shape,{values:n})},r.prototype.expm1=function(t){this.assertNotComplex(t,"expm1");for(var e=t.dataSync(),n=new Float32Array(e.length),a=0;a<e.length;++a)n[a]=Math.expm1(e[a]);return kt.make(t.shape,{values:n})},r.prototype.log=function(t){this.assertNotComplex(t,"log");for(var e=t.dataSync(),n=new Float32Array(e.length),a=0;a<e.length;++a){var i=e[a];n[a]=Math.log(i)}return kt.make(t.shape,{values:n})},r.prototype.log1p=function(t){this.assertNotComplex(t,"log1p");for(var e=t.dataSync(),n=new Float32Array(e.length),a=0;a<e.length;++a){var i=e[a];n[a]=Math.log1p(i)}return kt.make(t.shape,{values:n})},r.prototype.sqrt=function(t){this.assertNotComplex(t,"sqrt");for(var e=t.dataSync(),n=new Float32Array(e.length),a=0;a<e.length;++a){var i=e[a];n[a]=Math.sqrt(i)}return kt.make(t.shape,{values:n})},r.prototype.rsqrt=function(t){this.assertNotComplex(t,"rsqrt");for(var e=t.dataSync(),n=new Float32Array(e.length),a=0;a<e.length;++a){var i=e[a];n[a]=1/Math.sqrt(i)}return kt.make(t.shape,{values:n})},r.prototype.square=function(t){this.assertNotComplex(t,"square");for(var e=t.dataSync(),n=new Float32Array(e.length),a=0;a<e.length;++a){var i=e[a];n[a]=i*i}return kt.make(t.shape,{values:n})},r.prototype.reciprocal=function(t){this.assertNotComplex(t,"reciprocal");for(var e=t.dataSync(),n=new Float32Array(e.length),a=0;a<e.length;++a)n[a]=1/e[a];return kt.make(t.shape,{values:n})},r.prototype.linear=function(t){return t},r.prototype.relu=function(t){this.assertNotComplex(t,"relu");for(var e=dn(t.shape,t.dtype),n=e.dataSync(),a=t.dataSync(),i=0;i<a.length;++i)n[i]=Math.max(0,a[i]);return e},r.prototype.prelu=function(t,e){return this.assertNotComplex([t,e],"prelu"),this.broadcastedBinaryOp(t,e,t.dtype,function(n,a){return n<0?a*n:n})},r.prototype.elu=function(t){this.assertNotComplex(t,"elu");for(var e=new Float32Array(t.size),n=t.dataSync(),a=0;a<n.length;++a){var i=n[a];e[a]=i>=0?i:Math.exp(i)-1}return kt.make(t.shape,{values:e})},r.prototype.eluDer=function(t,e){this.assertNotComplex([t,e],"eluDer");for(var n=new Float32Array(e.size),a=e.dataSync(),i=t.dataSync(),o=0;o<a.length;++o){var u=a[o];n[o]=u>=1?i[o]:i[o]*(u+1)}return kt.make(e.shape,{values:n})},r.prototype.selu=function(t){this.assertNotComplex(t,"selu");for(var e=Vg,n=Gg,a=new Float32Array(t.size),i=t.dataSync(),o=0;o<i.length;++o){var u=i[o];a[o]=u>=0?n*u:e*(Math.exp(u)-1)}return kt.make(t.shape,{values:a})},r.prototype.clip=function(t,e,n){this.assertNotComplex(t,"clip");for(var a=new Float32Array(t.size),i=t.dataSync(),o=0;o<i.length;++o){var u=i[o];a[o]=u>n?n:u<e?e:u}return kt.make(t.shape,{values:a})},r.prototype.abs=function(t){for(var e=new Float32Array(t.size),n=t.dataSync(),a=0;a<n.length;++a)e[a]=Math.abs(n[a]);return kt.make(t.shape,{values:e})},r.prototype.complexAbs=function(t){for(var e=new Float32Array(t.size),n=t.dataSync(),a=0;a<t.size;++a){var i=n[2*a],o=n[2*a+1];e[a]=Math.hypot(i,o)}return kt.make(t.shape,{values:e})},r.prototype.int=function(t){this.assertNotComplex(t,"int");for(var e=new Int32Array(t.size),n=t.dataSync(),a=0;a<n.length;++a)e[a]=n[a];return kt.make(t.shape,{values:e},"int32")},r.prototype.sigmoid=function(t){this.assertNotComplex(t,"sigmoid");for(var e=new Float32Array(t.size),n=t.dataSync(),a=0;a<n.length;++a)e[a]=1/(1+Math.exp(-n[a]));return kt.make(t.shape,{values:e})},r.prototype.softplus=function(t){this.assertNotComplex(t,"softplus");for(var e=Math.log(11920928955078125e-23)+2,n=new Float32Array(t.size),a=t.dataSync(),i=0;i<a.length;++i){var o=a[i]>-e,u=a[i]<e,l=Math.exp(a[i]),h=void 0;h=u?l:o?a[i]:Math.log(1+l),n[i]=h}return kt.make(t.shape,{values:n})},r.prototype.sin=function(t){this.assertNotComplex(t,"sin");for(var e=new Float32Array(t.size),n=t.dataSync(),a=0;a<n.length;++a)e[a]=Math.sin(n[a]);return kt.make(t.shape,{values:e})},r.prototype.cos=function(t){this.assertNotComplex(t,"cos");for(var e=new Float32Array(t.size),n=t.dataSync(),a=0;a<n.length;++a)e[a]=Math.cos(n[a]);return kt.make(t.shape,{values:e})},r.prototype.tan=function(t){this.assertNotComplex(t,"tan");for(var e=new Float32Array(t.size),n=t.dataSync(),a=0;a<n.length;++a)e[a]=Math.tan(n[a]);return kt.make(t.shape,{values:e})},r.prototype.asin=function(t){this.assertNotComplex(t,"asin");for(var e=new Float32Array(t.size),n=t.dataSync(),a=0;a<n.length;++a)e[a]=Math.asin(n[a]);return kt.make(t.shape,{values:e})},r.prototype.acos=function(t){this.assertNotComplex(t,"acos");for(var e=new Float32Array(t.size),n=t.dataSync(),a=0;a<n.length;++a)e[a]=Math.acos(n[a]);return kt.make(t.shape,{values:e})},r.prototype.atan=function(t){this.assertNotComplex(t,"atan");for(var e=new Float32Array(t.size),n=t.dataSync(),a=0;a<n.length;++a)e[a]=Math.atan(n[a]);return kt.make(t.shape,{values:e})},r.prototype.atan2=function(t,e){return this.assertNotComplex([t,e],"atan2"),this.broadcastedBinaryOp(t,e,t.dtype,function(n,a){return Math.atan2(n,a)})},r.prototype.sinh=function(t){this.assertNotComplex(t,"sinh");for(var e=new Float32Array(t.size),n=t.dataSync(),a=0;a<n.length;++a)e[a]=Math.sinh(n[a]);return kt.make(t.shape,{values:e})},r.prototype.cosh=function(t){this.assertNotComplex(t,"cosh");for(var e=new Float32Array(t.size),n=t.dataSync(),a=0;a<n.length;++a)e[a]=Math.cosh(n[a]);return kt.make(t.shape,{values:e})},r.prototype.tanh=function(t){this.assertNotComplex(t,"tanh");for(var e=new Float32Array(t.size),n=t.dataSync(),a=0;a<n.length;++a)e[a]=bk(n[a]);return kt.make(t.shape,{values:e})},r.prototype.asinh=function(t){this.assertNotComplex(t,"asinh");for(var e=new Float32Array(t.size),n=t.dataSync(),a=0;a<n.length;++a)e[a]=Math.asinh(n[a]);return kt.make(t.shape,{values:e})},r.prototype.acosh=function(t){this.assertNotComplex(t,"acosh");for(var e=new Float32Array(t.size),n=t.dataSync(),a=0;a<n.length;++a)e[a]=Math.acosh(n[a]);return kt.make(t.shape,{values:e})},r.prototype.atanh=function(t){this.assertNotComplex(t,"atanh");for(var e=new Float32Array(t.size),n=t.dataSync(),a=0;a<n.length;++a)e[a]=Math.atanh(n[a]);return kt.make(t.shape,{values:e})},r.prototype.erf=function(t){this.assertNotComplex(t,"erf");for(var e=new Float32Array(t.size),n=t.dataSync(),a=yC,i=xC,o=bC,u=wC,l=EC,h=CC,f=0;f<n.length;++f){var p=n[f],v=1/(1+a*p);e[f]=1-((((h*v+l)*v+u)*v+o)*v+i)*v*Math.exp(-p*p)}return kt.make(t.shape,{values:e})},r.prototype.step=function(t,e){e===void 0&&(e=0),this.assertNotComplex(t,"step");for(var n=new Float32Array(t.size),a=t.dataSync(),i=0;i<a.length;++i){var o=a[i];isNaN(o)?n[i]=NaN:n[i]=o>0?1:e}return kt.make(t.shape,{values:n})},r.prototype.conv2d=function(t,e,n){this.assertNotComplex([t,e],"conv2d");for(var a=n.filterHeight,i=n.filterWidth,o=n.dilationHeight,u=n.dilationWidth,l=n.padInfo.left,h=n.padInfo.top,f=fe(n.outShape,t.dtype),p=t.dataSync(),v=e.dataSync(),m=f.values,x=0;x<n.batchSize;++x)for(var b=x*t.strides[0],E=x*f.strides[0],C=0;C<n.outHeight;++C)for(var R=E+C*f.strides[1],_=C*n.strideHeight-l,A=0;A<a;A++){var k=_+A*o;if(!(k<0||k>=n.inHeight))for(var D=A*e.strides[0],P=b+k*t.strides[1],M=0;M<n.outWidth;++M)for(var O=R+M*n.outChannels,F=M*n.strideWidth-h,W=0;W<i;W++){var j=F+W*u;if(!(j<0||j>=n.inWidth))for(var ot=D+W*e.strides[1],nt=P+j*n.inChannels,at=ot,V=0;V<n.inChannels;++V){for(var X=p[nt+V],Q=0;Q<n.outChannels;++Q)m[O+Q]+=X*v[at+Q];at+=n.outChannels}}}return f.toTensor()},r.prototype.conv3d=function(t,e,n){for(var a=n.filterDepth,i=n.filterHeight,o=n.filterWidth,u=n.dilationDepth,l=n.dilationHeight,h=n.dilationWidth,f=n.padInfo.front,p=n.padInfo.left,v=n.padInfo.top,m=fe(n.outShape,t.dtype),x=t.dataSync(),b=e.dataSync(),E=m.values,C=0;C<n.batchSize;++C)for(var R=C*t.strides[0],_=C*m.strides[0],A=0;A<n.outDepth;++A)for(var k=_+A*m.strides[1],D=A*n.strideDepth-f,P=0;P<a;P++){var M=D+P*u;if(!(M<0||M>=n.inDepth))for(var O=P*e.strides[0],F=R+M*t.strides[1],W=0;W<n.outHeight;++W)for(var j=k+W*m.strides[2],ot=W*n.strideHeight-v,nt=0;nt<i;nt++){var at=ot+nt*l;if(!(at<0||at>=n.inHeight))for(var V=O+nt*e.strides[1],X=F+at*t.strides[2],Q=0;Q<n.outWidth;++Q)for(var ut=j+Q*n.outChannels,B=Q*n.strideWidth-p,$=0;$<o;$++){var ht=B+$*h;if(!(ht<0||ht>=n.inWidth))for(var ft=V+$*e.strides[2],xt=X+ht*n.inChannels,wt=ft,Rt=0;Rt<n.inChannels;++Rt){for(var Dt=x[xt+Rt],_t=0;_t<n.outChannels;++_t)E[ut+_t]+=Dt*b[wt+_t];wt+=n.outChannels}}}}return m.toTensor()},r.prototype.conv2dDerInput=function(t,e,n){this.assertNotComplex([t,e],"conv2dDerInput");for(var a=fe(n.inShape,"float32"),i=a.values,o=a.strides,u=o[0],l=o[1],h=o[2],f=t.dataSync(),p=t.strides,v=p[0],m=p[1],x=p[2],b=e.dataSync(),E=e.strides,C=E[0],R=E[1],_=E[2],A=n.batchSize,k=n.filterHeight,D=n.filterWidth,P=n.inChannels,M=n.inHeight,O=n.inWidth,F=n.outChannels,W=n.outHeight,j=n.outWidth,ot=n.strideHeight,nt=n.strideWidth,at=k-1-n.padInfo.top,V=D-1-n.padInfo.left,X=0;X<A;++X)for(var Q=0;Q<P;++Q)for(var ut=0;ut<M;++ut)for(var B=ut-at,$=Math.max(0,Math.ceil(B/ot)),ht=Math.min(W,(k+B)/ot),ft=0;ft<O;++ft){for(var xt=ft-V,wt=Math.max(0,Math.ceil(xt/nt)),Rt=Math.min(j,(D+xt)/nt),Dt=0,_t=$;_t<ht;++_t)for(var Pt=_t*ot-B,jt=wt;jt<Rt;++jt)for(var Ft=v*X+m*_t+x*jt,Wt=C*(k-1-Pt)+R*(D-1-(jt*nt-xt))+_*Q,Gt=0;Gt<F;++Gt)Dt+=f[Ft+Gt]*b[Wt+Gt];i[u*X+l*ut+h*ft+Q]=Dt}return a.toTensor()},r.prototype.conv3dDerInput=function(t,e,n){for(var a=fe(n.inShape,"float32"),i=a.values,o=a.strides,u=o[0],l=o[1],h=o[2],f=o[3],p=t.dataSync(),v=t.strides,m=v[0],x=v[1],b=v[2],E=v[3],C=e.dataSync(),R=e.strides,_=R[0],A=R[1],k=R[2],D=R[3],P=n.batchSize,M=n.filterDepth,O=n.filterHeight,F=n.filterWidth,W=n.inChannels,j=n.inDepth,ot=n.inHeight,nt=n.inWidth,at=n.outChannels,V=n.outDepth,X=n.outHeight,Q=n.outWidth,ut=n.strideDepth,B=n.strideHeight,$=n.strideWidth,ht=M-1-n.padInfo.front,ft=O-1-n.padInfo.top,xt=F-1-n.padInfo.left,wt=0;wt<P;++wt)for(var Rt=0;Rt<W;++Rt)for(var Dt=0;Dt<j;++Dt)for(var _t=Dt-ht,Pt=Math.max(0,Math.ceil(_t/ut)),jt=Math.min(V,(M+_t)/ut),Ft=0;Ft<ot;++Ft)for(var Wt=Ft-ft,Gt=Math.max(0,Math.ceil(Wt/B)),$t=Math.min(X,(O+Wt)/B),ue=0;ue<nt;++ue){for(var de=ue-xt,Te=Math.max(0,Math.ceil(de/$)),je=Math.min(Q,(F+de)/$),Se=0,vn=Pt;vn<jt;++vn)for(var Xe=vn*ut-_t,Ge=Gt;Ge<$t;++Ge)for(var ln=Ge*B-Wt,Gn=Te;Gn<je;++Gn)for(var Nn=m*wt+x*vn+b*Ge+E*Gn,On=_*(M-1-Xe)+A*(O-1-ln)+k*(F-1-(Gn*$-de))+D*Rt,Be=0;Be<at;++Be)Se+=p[Nn+Be]*C[On+Be];i[u*wt+l*Dt+h*Ft+f*ue+Rt]=Se}return a.toTensor()},r.prototype.conv2dDerFilter=function(t,e,n){this.assertNotComplex([t,e],"conv2dDerFilter");for(var a=n.strideHeight,i=n.strideWidth,o=n.filterHeight,u=n.filterWidth,l=fe(n.filterShape,"float32"),h=n.padInfo.left,f=n.padInfo.top,p=t.bufferSync(),v=e.bufferSync(),m=0;m<o;++m)for(var x=Math.max(0,Math.ceil((f-m)/a)),b=Math.min(n.outHeight,(n.inHeight+f-m)/a),E=0;E<u;++E)for(var C=Math.max(0,Math.ceil((h-E)/i)),R=Math.min(n.outWidth,(n.inWidth+h-E)/i),_=0;_<n.inChannels;++_)for(var A=0;A<n.outChannels;++A){for(var k=0,D=0;D<n.batchSize;++D)for(var P=x;P<b;++P)for(var M=m+P*a-f,O=C;O<R;++O){var F=E+O*i-h;k+=p.get(D,M,F,_)*v.get(D,P,O,A)}l.set(k,m,E,_,A)}return l.toTensor()},r.prototype.conv3dDerFilter=function(t,e,n){for(var a=n.strideDepth,i=n.strideHeight,o=n.strideWidth,u=n.filterDepth,l=n.filterHeight,h=n.filterWidth,f=fe(n.filterShape,"float32"),p=f.values,v=f.strides,m=v[0],x=v[1],b=v[2],E=v[3],C=e.dataSync(),R=e.strides,_=R[0],A=R[1],k=R[2],D=R[3],P=t.dataSync(),M=t.strides,O=M[0],F=M[1],W=M[2],j=M[3],ot=n.padInfo.front,nt=n.padInfo.left,at=n.padInfo.top,V=0;V<u;++V)for(var X=Math.max(0,Math.ceil((ot-V)/a)),Q=Math.min(n.outDepth,(n.inDepth+ot-V)/a),ut=V*m,B=0;B<l;++B)for(var $=Math.max(0,Math.ceil((at-B)/i)),ht=Math.min(n.outHeight,(n.inHeight+at-B)/i),ft=B*x+ut,xt=0;xt<h;++xt)for(var wt=Math.max(0,Math.ceil((nt-xt)/o)),Rt=Math.min(n.outWidth,(n.inWidth+nt-xt)/o),Dt=xt*b+ft,_t=0;_t<n.inChannels;++_t)for(var Pt=_t*E+Dt,jt=0;jt<n.outChannels;++jt){for(var Ft=0,Wt=0;Wt<n.batchSize;++Wt)for(var Gt=Wt*O,$t=Wt*_,ue=X;ue<Q;++ue)for(var de=(V+ue*a-ot)*F+Gt,Te=ue*A+$t,je=$;je<ht;++je)for(var Se=(B+je*i-at)*W+de,vn=je*k+Te,Xe=wt;Xe<Rt;++Xe){var Ge=Xe*D+vn;Ft+=P[(xt+Xe*o-nt)*j+Se+_t]*C[Ge+jt]}p[Pt+jt]=Ft}return f.toTensor()},r.prototype.depthwiseConv2D=function(t,e,n){this.assertNotComplex([t,e],"depthwiseConv2D");for(var a=n.filterHeight,i=n.filterWidth,o=n.dilationHeight,u=n.dilationWidth,l=n.padInfo.left,h=n.padInfo.top,f=n.outChannels/n.inChannels,p=fe(n.outShape,t.dtype),v=t.dataSync(),m=e.dataSync(),x=p.values,b=0;b<n.batchSize;++b)for(var E=b*t.strides[0],C=b*p.strides[0],R=0;R<n.outHeight;++R)for(var _=C+R*p.strides[1],A=R*n.strideHeight-l,k=0;k<a;++k){var D=A+k*o;if(!(D<0||D>=n.inHeight))for(var P=k*e.strides[0],M=E+D*t.strides[1],O=0;O<n.outWidth;++O)for(var F=_+O*p.strides[2],W=O*n.strideWidth-h,j=0;j<i;++j){var ot=W+j*u;if(!(ot<0||ot>=n.inWidth))for(var nt=P+j*e.strides[1],at=M+ot*n.inChannels,V=F,X=nt,Q=0;Q<n.inChannels;++Q){for(var ut=v[at+Q],B=0;B<f;++B)x[V+B]+=ut*m[X+B];V+=f,X+=f}}}return p.toTensor()},r.prototype.depthwiseConv2DDerInput=function(t,e,n){this.assertNotComplex([t,e],"depthwiseConv2DDerInput");for(var a=fe(n.inShape,"float32"),i=a.values,o=a.strides,u=o[0],l=o[1],h=o[2],f=t.dataSync(),p=t.strides,v=p[0],m=p[1],x=p[2],b=e.dataSync(),E=e.strides,C=E[0],R=E[1],_=E[2],A=n.batchSize,k=n.filterHeight,D=n.filterWidth,P=n.inChannels,M=n.inHeight,O=n.inWidth,F=n.outChannels,W=n.outHeight,j=n.outWidth,ot=n.strideHeight,nt=n.strideWidth,at=k-1-n.padInfo.top,V=D-1-n.padInfo.left,X=F/P,Q=0;Q<A;++Q)for(var ut=0;ut<P;++ut)for(var B=0;B<M;++B)for(var $=B-at,ht=Math.max(0,Math.ceil($/ot)),ft=Math.min(W,(k+$)/ot),xt=0;xt<O;++xt){for(var wt=xt-V,Rt=Math.max(0,Math.ceil(wt/nt)),Dt=Math.min(j,(D+wt)/nt),_t=0,Pt=ht;Pt<ft;++Pt)for(var jt=Pt*ot-$,Ft=Rt;Ft<Dt;++Ft)for(var Wt=v*Q+m*Pt+x*Ft,Gt=C*(k-1-jt)+R*(D-1-(Ft*nt-wt))+_*ut,$t=0;$t<X;++$t)_t+=f[Wt+(ut*X+$t)]*b[Gt+$t];i[u*Q+l*B+h*xt+ut]=_t}return a.toTensor()},r.prototype.depthwiseConv2DDerFilter=function(t,e,n){this.assertNotComplex([t,e],"depthwiseConv2DDerFilter");for(var a=n.strideHeight,i=n.strideWidth,o=n.filterHeight,u=n.filterWidth,l=fe(n.filterShape,"float32"),h=n.padInfo.left,f=n.padInfo.top,p=n.outChannels/n.inChannels,v=t.bufferSync(),m=e.bufferSync(),x=0;x<o;++x)for(var b=Math.max(0,Math.ceil((f-x)/a)),E=Math.min(n.outHeight,(n.inHeight+f-x)/a),C=0;C<u;++C)for(var R=Math.max(0,Math.ceil((h-C)/i)),_=Math.min(n.outWidth,(n.inWidth+h-C)/i),A=0;A<n.outChannels;++A){for(var k=Math.trunc(A/p),D=A%p,P=0,M=0;M<n.batchSize;++M)for(var O=b;O<E;++O)for(var F=x+O*a-f,W=R;W<_;++W){var j=C+W*i-h;P+=v.get(M,F,j,k)*m.get(M,O,W,A)}l.set(P,x,C,k,D)}return l.toTensor()},r.prototype.tile=function(t,e){this.assertNotComplex(t,"tile");for(var n=new Array(t.rank),a=0;a<n.length;a++)n[a]=t.shape[a]*e[a];var i=fe(n,t.dtype),o=t.bufferSync();for(a=0;a<i.values.length;++a){for(var u=i.indexToLoc(a),l=new Array(t.rank),h=0;h<l.length;h++)l[h]=u[h]%t.shape[h];var f=o.locToIndex(l);i.values[a]=o.values[f]}return i.toTensor()},r.prototype.pad=function(t,e,n){this.assertNotComplex(t,"pad");var a=e.map(function(p,v){return p[0]+t.shape[v]+p[1]}),i=e.map(function(p){return p[0]}),o=t.bufferSync(),u=fe(a,t.dtype);n!==0&&u.values.fill(n);for(var l=0;l<t.size;l++){var h=o.indexToLoc(l),f=h.map(function(p,v){return p+i[v]});u.set.apply(u,[o.get.apply(o,h)].concat(f))}return u.toTensor()},r.prototype.transpose=function(t,e){this.assertNotComplex(t,"transpose");for(var n=new Array(t.rank),a=0;a<n.length;a++)n[a]=t.shape[e[a]];var i=t.dataSync(),o=fe(n,t.dtype),u=t.bufferSync();for(a=0;a<t.size;++a){for(var l=u.indexToLoc(a),h=new Array(l.length),f=0;f<h.length;f++)h[f]=l[e[f]];var p=o.locToIndex(h);o.values[p]=i[a]}return o.toTensor()},r.prototype.gather=function(t,e,n){this.assertNotComplex([t,e],"gather");var a=t.shape.slice(),i=e.dataSync();a[n]=i.length;for(var o=fe(a,t.dtype),u=t.bufferSync(),l=0;l<o.size;++l){var h=o.indexToLoc(l),f=h.slice();f[n]=i[h[n]];var p=u.locToIndex(f);o.values[l]=u.values[p]}return o.toTensor()},r.prototype.batchToSpaceND=function(t,e,n){this.assertNotComplex([t],"batchToSpaceND");var a=e.reduce(function(f,p){return f*p}),i=Kf(t.shape,e,a),o=Yf(i.length,e.length),u=Qf(t.shape,e,a),l=ZE(n,e.length),h=$E(u,n,e.length);return t.reshape(i).transpose(o).reshape(u).slice(l,h)},r.prototype.spaceToBatchND=function(t,e,n){this.assertNotComplex([t],"spaceToBatchND");var a=e.reduce(function(p,v){return p*v}),i=[[0,0]];i.push.apply(i,n);for(var o=1+e.length;o<t.shape.length;++o)i.push([0,0]);var u=t.pad(i),l=Kf(u.shape,e,a,!1),h=Yf(l.length,e.length,!1),f=Qf(u.shape,e,a,!1);return u.reshape(l).transpose(h).reshape(f)},r.prototype.pool=function(t,e,n){this.assertNotComplex(t,"pool");for(var a=e.strideHeight,i=e.strideWidth,o=e.dilationHeight,u=e.dilationWidth,l=e.effectiveFilterHeight,h=e.effectiveFilterWidth,f=e.padInfo.top,p=e.padInfo.left,v=n==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,m=t.dataSync(),x=fe(e.outShape,t.dtype),b=x.values,E=e.outShape[1]*e.outShape[2]*e.outShape[3],C=e.outShape[2]*e.outShape[3],R=e.outShape[3],_=0;_<e.batchSize;++_)for(var A=_*E,k=_*t.strides[0],D=0;D<e.inChannels;++D)for(var P=0;P<e.outHeight;++P)for(var M=P*a-f,O=Math.max(0,M),F=Math.min(e.inHeight,l+M),W=A+P*C,j=0;j<e.outWidth;++j){for(var ot=j*i-p,nt=Math.max(0,ot),at=Math.min(e.inWidth,h+ot),V=v,X=0,Q=0,ut=O;ut<F;ut+=o){for(var B=k+ut*t.strides[1],$=nt;$<at;$+=u){var ht=m[B+$*t.strides[2]+D];n==="max"&&ht>V?V=ht:n==="avg"&&(X+=ht,Q++)}if(isNaN(V))break}b[W+j*R+D]=n==="avg"?X/Q:V}return x.toTensor()},r.prototype.maxPool=function(t,e){return this.pool(t,e,"max")},r.prototype.maxPoolPositions=function(t,e){for(var n=fe(e.outShape,"int32"),a=e.strideHeight,i=e.strideWidth,o=e.dilationHeight,u=e.dilationWidth,l=e.effectiveFilterHeight,h=e.effectiveFilterWidth,f=e.padInfo.top,p=e.padInfo.left,v=t.bufferSync(),m=0;m<e.batchSize;++m)for(var x=0;x<e.inChannels;++x)for(var b=0;b<e.outHeight;++b){for(var E=b*a-f,C=E;C<0;)C+=o;for(var R=Math.min(e.inHeight,l+E),_=0;_<e.outWidth;++_){for(var A=_*i-p,k=A;k<0;)k+=u;for(var D=Math.min(e.inWidth,h+A),P=Number.NEGATIVE_INFINITY,M=-1,O=C;O<R;O+=o)for(var F=O-E,W=k;W<D;W+=u){var j=W-A,ot=v.get(m,O,W,x);ot>P&&(P=ot,M=F*h+j)}n.set(M,m,b,_,x)}}return n.toTensor()},r.prototype.maxPoolBackprop=function(t,e,n,a){this.assertNotComplex([e,n],"maxPoolBackprop");for(var i=this.maxPoolPositions(e,a),o=a.strideHeight,u=a.strideWidth,l=a.dilationHeight,h=a.dilationWidth,f=a.effectiveFilterHeight,p=a.effectiveFilterWidth,v=p-1-a.padInfo.left,m=f-1-a.padInfo.top,x=fe(e.shape,"float32"),b=i.bufferSync(),E=t.bufferSync(),C=0;C<a.batchSize;++C)for(var R=0;R<a.inChannels;++R)for(var _=0;_<a.inHeight;++_)for(var A=0;A<a.inWidth;++A){for(var k=_-m,D=A-v,P=0,M=0;M<f;M+=l){var O=(k+M)/o;if(!(O<0||O>=a.outHeight||Math.floor(O)!==O))for(var F=0;F<p;F+=h){var W=(D+F)/u;if(!(W<0||W>=a.outWidth||Math.floor(W)!==W)){var j=f*p-1-b.get(C,O,W,R)===M*p+F?1:0;j!==0&&(P+=E.get(C,O,W,R)*j)}}}x.set(P,C,_,A,R)}return x.toTensor()},r.prototype.avgPoolBackprop=function(t,e,n){this.assertNotComplex([t,e],"avgPoolBackprop");for(var a=n.strideHeight,i=n.strideWidth,o=n.filterHeight,u=n.filterWidth,l=n.dilationHeight,h=n.dilationWidth,f=n.effectiveFilterHeight,p=n.effectiveFilterWidth,v=p-1-n.padInfo.left,m=f-1-n.padInfo.top,x=fe(e.shape,"float32"),b=1/(o*u),E=t.bufferSync(),C=0;C<n.batchSize;++C)for(var R=0;R<n.inChannels;++R)for(var _=0;_<n.inHeight;++_)for(var A=0;A<n.inWidth;++A){for(var k=_-m,D=A-v,P=0,M=0;M<f;M+=l){var O=(k+M)/a;if(!(O<0||O>=n.outHeight||Math.floor(O)!==O))for(var F=0;F<p;F+=h){var W=(D+F)/i;W<0||W>=n.outWidth||Math.floor(W)!==W||(P+=E.get(C,O,W,R))}}x.set(P*b,C,_,A,R)}return x.toTensor()},r.prototype.cast=function(t,e){return uC(t,e,this)},r.prototype.reshape=function(t,e){return rg(t,e)},r.prototype.avgPool=function(t,e){return this.assertNotComplex(t,"avgPool"),this.pool(t,e,"avg").toFloat()},r.prototype.resizeBilinear=function(t,e,n,a){this.assertNotComplex(t,"resizeBilinear");for(var i=t.shape,o=i[0],u=i[1],l=i[2],h=i[3],f=t.dataSync(),p=new Float32Array(qt([o,e,n,h])),v=[a&&e>1?u-1:u,a&&n>1?l-1:l],m=[a&&e>1?e-1:e,a&&n>1?n-1:n],x=0,b=v[0]/m[0],E=v[1]/m[1],C=0;C<o;C++)for(var R=0;R<e;R++)for(var _=b*R,A=Math.floor(_),k=_-A,D=Math.min(u-1,Math.ceil(_)),P=C*t.strides[0]+A*t.strides[1],M=C*t.strides[0]+D*t.strides[1],O=0;O<n;O++)for(var F=E*O,W=Math.floor(F),j=F-W,ot=Math.min(l-1,Math.ceil(F)),nt=P+W*t.strides[2],at=M+W*t.strides[2],V=P+ +ot*t.strides[2],X=M+ot*t.strides[2],Q=0;Q<h;Q++){var ut=f[nt+Q],B=f[at+Q],$=ut+(f[V+Q]-ut)*j,ht=$+(B+(f[X+Q]-B)*j-$)*k;p[x++]=ht}return bn(p,[o,e,n,h])},r.prototype.resizeBilinearBackprop=function(t,e,n){this.assertNotComplex([t,e],"resizeBilinearBackprop");for(var a=e.shape,i=a[0],o=a[1],u=a[2],l=a[3],h=t.shape,f=h[1],p=h[2],v=new Float32Array(i*o*u*l),m=[n&&f>1?o-1:o,n&&p>1?u-1:u],x=[n&&f>1?f-1:f,n&&p>1?p-1:p],b=m[0]/x[0],E=m[1]/x[1],C=t.dataSync(),R=0,_=0;_<i;_++)for(var A=_*e.strides[0],k=0;k<f;k++)for(var D=k*b,P=Math.floor(D),M=Math.min(Math.ceil(D),o-1),O=A+P*e.strides[1],F=A+M*e.strides[1],W=D-P,j=1-W,ot=0;ot<p;ot++)for(var nt=ot*E,at=Math.floor(nt),V=Math.min(Math.ceil(nt),u-1),X=nt-at,Q=1-X,ut=O+at*e.strides[2],B=O+V*e.strides[2],$=F+at*e.strides[2],ht=F+V*e.strides[2],ft=j*Q,xt=j*X,wt=W*Q,Rt=W*X,Dt=0;Dt<l;Dt++){var _t=C[R++];v[ut+Dt]+=_t*ft,v[B+Dt]+=_t*xt,v[$+Dt]+=_t*wt,v[ht+Dt]+=_t*Rt}return Oa(v,[i,u,o,l],e.dtype)},r.prototype.resizeNearestNeighbor=function(t,e,n,a){this.assertNotComplex(t,"resizeNearestNeighbor");for(var i=t.shape,o=i[0],u=i[1],l=i[2],h=i[3],f=t.dataSync(),p=new Float32Array(o*e*n*h),v=[a&&e>1?u-1:u,a&&n>1?l-1:l],m=[a&&e>1?e-1:e,a&&n>1?n-1:n],x=v[0]/m[0],b=v[1]/m[1],E=0,C=0;C<o;C++)for(var R=C*t.strides[0],_=0;_<e;_++)for(var A=x*_,k=R+Math.min(u-1,a?Math.round(A):Math.floor(A))*t.strides[1],D=0;D<n;D++)for(var P=b*D,M=k+Math.min(l-1,a?Math.round(P):Math.floor(P))*t.strides[2],O=0;O<h;O++){var F=f[M+O];p[E++]=F}return bn(p,[o,e,n,h],t.dtype)},r.prototype.resizeNearestNeighborBackprop=function(t,e,n){this.assertNotComplex([t,e],"resizeNearestNeighborBackprop");for(var a=e.shape,i=a[0],o=a[1],u=a[2],l=a[3],h=t.shape,f=h[1],p=h[2],v=new Float32Array(i*o*u*l),m=t.dataSync(),x=[n&&f>1?o-1:o,n&&p>1?u-1:u],b=[n&&f>1?f-1:f,n&&p>1?p-1:p],E=x[0]/b[0],C=x[1]/b[1],R=1/E,_=1/C,A=2*Math.ceil(R)+2,k=2*Math.ceil(_)+2,D=0;D<i;D++)for(var P=D*e.strides[0],M=0;M<o;M++)for(var O=P+M*e.strides[1],F=Math.floor(M*R),W=Math.floor(F-A/2),j=0;j<u;j++)for(var ot=O+j*e.strides[2],nt=Math.floor(j*_),at=Math.floor(nt-k/2),V=0;V<l;V++){for(var X=0,Q=0;Q<A;Q++){var ut=Q+W;if(!(ut<0||ut>=f)){var B=P+ut*t.strides[1],$=ut*E;if(M===Math.min(o-1,n?Math.round($):Math.floor($)))for(var ht=0;ht<k;ht++){var ft=ht+at;if(!(ft<0||ft>=p)){var xt=B+ft*t.strides[2],wt=ft*C;j===Math.min(u-1,n?Math.round(wt):Math.floor(wt))&&(X+=m[xt+V])}}}}v[ot+V]=X}return Oa(v,e.shape,e.dtype)},r.prototype.batchNormalization=function(t,e,n,a,i,o){this.assertNotComplex([t,e,n,i,o],"batchNorm");for(var u=t.dataSync(),l=e.dataSync(),h=n.dataSync(),f=i?i.dataSync():new Float32Array([1]),p=o?o.dataSync():new Float32Array([0]),v=new Float32Array(u.length),m=p.length,x=f.length,b=h.length,E=l.length,C=0,R=0,_=0,A=0,k=0;k<u.length;++k)v[k]=p[C++]+(u[k]-l[R++])*f[_++]/Math.sqrt(h[A++]+a),C>=m&&(C=0),R>=E&&(R=0),_>=x&&(_=0),A>=b&&(A=0);return Oa(v,t.shape)},r.prototype.localResponseNormalization4D=function(t,e,n,a,i){this.assertNotComplex(t,"localResponseNormalization4D");var o=t.shape[3],u=o-1,l=t.dataSync(),h=t.size,f=new Float32Array(h);function p(b){for(var E=b%o,C=b-E+Math.max(0,E-e),R=b-E+Math.min(E+e,u),_=0;C<=R;C++){var A=l[C];_+=A*A}return _}for(var v=0;v<h;v++){var m=p(v),x=l[v]*Math.pow(n+a*m,-i);f[v]=x}return Oa(f,t.shape)},r.prototype.LRNGrad=function(t,e,n,a,i,o,u){this.assertNotComplex(t,"LRNGrad");for(var l=t.shape[3],h=t.dataSync(),f=e.dataSync(),p=n.dataSync(),v=new Float32Array(t.size),m=t.size,x=0;x<m;x++){for(var b=x%l,E=x-b+Math.max(0,b-a),C=x-b+Math.min(l,b+a+1),R=0,_=E;_<C;_++)R+=Math.pow(f[_],2);for(R=o*R+i,_=E;_<C;_++){var A=-2*o*u*f[_]*p[x]/R;x===_&&(A+=Math.pow(R,-u)),A*=h[x],v[_]+=A}}return Oa(v,t.shape)},r.prototype.multinomial=function(t,e,n,a){this.assertNotComplex(t,"multinomial");for(var i=e?t:Jo(t),o=i.shape[0],u=i.shape[1],l=dn([o,n],"int32"),h=l.dataSync(),f=i.dataSync(),p=0;p<o;++p){var v=p*u,m=new Float32Array(u-1);m[0]=f[v];for(var x=1;x<m.length;++x)m[x]=m[x-1]+f[v+x];for(var b=_C(a.toString()),E=p*n,C=0;C<n;++C){var R=b();h[E+C]=m.length;for(var _=0;_<m.length;_++)if(R<m[_]){h[E+C]=_;break}}}return l},r.prototype.oneHot=function(t,e,n,a){this.assertNotComplex(t,"oneHot");var i=new Float32Array(t.size*e);i.fill(a);for(var o=t.dataSync(),u=0;u<t.size;++u)o[u]>=0&&o[u]<e&&(i[u*e+o[u]]=n);return _d(i,[t.size,e],"int32")},r.prototype.nonMaxSuppression=function(t,e,n,a,i){return this.assertNotComplex(t,"nonMaxSuppression"),zg(t.dataSync(),e.dataSync(),n,a,i)},r.prototype.fft=function(t){return this.fftBatch(t,!1)},r.prototype.ifft=function(t){return this.fftBatch(t,!0)},r.prototype.fftBatch=function(t,e){for(var n=t.shape[0],a=t.shape[1],i=fe(t.shape,"float32"),o=fe(t.shape,"float32"),u=hi(t).as2D(n,a),l=Wo(t).as2D(n,a),h=0;h<n;h++)for(var f=u.slice([h,0],[1,a]),p=l.slice([h,0],[1,a]),v=dr(f,p),m=this.fftImpl(v,e).dataSync(),x=0;x<a;x++){var b=q1(m,x);i.values[h*a+x]=b.real,o.values[h*a+x]=b.imag}return dr(i.toTensor(),o.toTensor()).as2D(n,a)},r.prototype.fftImpl=function(t,e){var n=t.as1D(),a=n.size;if(this.isExponentOf2(a)){var i=this.fftRadix2(n,a,e).as2D(t.shape[0],t.shape[1]);return e&&(i=dr(hi(i).div(Tt(a)),Wo(i).div(Tt(a)))),i}var o=t.dataSync(),u=kD(this.fourierTransformByMatmul(o,a,e));return dr(u.real,u.imag).as2D(t.shape[0],t.shape[1])},r.prototype.isExponentOf2=function(t){return(t&t-1)==0},r.prototype.fftRadix2=function(t,e,n){if(e===1)return t;var a=t.dataSync(),i=e/2,o=DD(a),u=dr(o.real,o.imag).as1D(),l=ID(a),h=dr(l.real,l.imag).as1D();u=this.fftRadix2(u,i,n),h=this.fftRadix2(h,i,n);var f=OD(e,n),p=dr(f.real,f.imag).mul(h),v=u.add(p),m=u.sub(p),x=hi(v).concat(hi(m)),b=Wo(v).concat(Wo(m));return dr(x,b).as1D()},r.prototype.fourierTransformByMatmul=function(t,e,n){for(var a=new Float32Array(2*e),i=0;i<e;i++){for(var o=0,u=0,l=0;l<e;l++){var h=MD(i*l,e,n),f=q1(t,l);o+=f.real*h.real-f.imag*h.imag,u+=f.real*h.imag+f.imag*h.real}n&&(o/=e,u/=e),ND(a,o,u,i)}return a},r.prototype.depthToSpace=function(t,e,n){Y(n==="NHWC",function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+n}),Y(e>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+e});for(var a=t.shape[0],i=t.shape[1],o=t.shape[2],u=t.shape[3],l=i*e,h=o*e,f=u/(e*e),p=t.dataSync(),v=new Float32Array(a*l*h*f),m=0,x=0;x<a;++x)for(var b=0;b<l;++b)for(var E=Math.floor(b/e),C=b%e,R=0;R<h;++R)for(var _=Math.floor(R/e),A=(C*e+R%e)*f,k=0;k<f;++k){var D=k+A+u*(_+o*(E+i*x));v[m++]=p[D]}return Oa(v,[a,l,h,f])},r.prototype.broadcastedBinaryOp=function(t,e,n,a){var i=ve(t.shape,e.shape),o=fe(i,n),u=t.dataSync(),l=e.dataSync(),h=qs(t.shape,i),f=qs(e.shape,i),p=o.values;if(h.length+f.length===0)for(var v=0;v<p.length;++v)p[v]=a(u[v%u.length],l[v%l.length]);else{var m=t.bufferSync(),x=e.bufferSync(),b=function(E){var C=o.indexToLoc(E),R=C.slice(-t.rank);h.forEach(function(D){return R[D]=0});var _=m.locToIndex(R),A=C.slice(-e.rank);f.forEach(function(D){return A[D]=0});var k=x.locToIndex(A);p[E]=a(u[_],l[k])};for(v=0;v<p.length;++v)b(v)}return o.toTensor()},r.prototype.broadcastedBinaryComplexOp=function(t,e,n){var a=ve(t.shape,e.shape),i=fe(a,"float32"),o=fe(a,"float32"),u=t.dataSync(),l=e.dataSync(),h=qs(t.shape,a),f=qs(e.shape,a),p=i.values,v=o.values;if(h.length+f.length===0)for(var m=0;m<p.length;m++){var x=m%u.length,b=m%l.length,E=n(u[2*x],u[2*x+1],l[2*b],l[2*b+1]);p[m]=E.real,v[m]=E.imag}else{var C=this.data.get(t.dataId).complexTensors.real.bufferSync(),R=this.data.get(e.dataId).complexTensors.real.bufferSync(),_=function(A){var k=i.indexToLoc(A),D=k.slice(-t.rank);h.forEach(function(W){return D[W]=0});var P=C.locToIndex(D),M=k.slice(-e.rank);f.forEach(function(W){return M[W]=0});var O=R.locToIndex(M),F=n(u[2*P],u[2*P+1],l[2*O],l[2*O+1]);p[A]=F.real,v[A]=F.imag};for(m=0;m<p.length;m++)_(m)}return this.complex(i.toTensor(),o.toTensor())},r.prototype.split=function(t,e,n){return lC(t,e,n)},r.prototype.dispose=function(){},r.prototype.floatPrecision=function(){return 32},r.prototype.cropAndResize=function(t,e,n,a,i,o){for(var u=t.shape,l=u[0],h=u[1],f=u[2],p=u[3],v=e.shape[0],m=a[0],x=a[1],b=fe([v,m,x,p],t.dtype),E=e.dataSync(),C=n.dataSync(),R=t.dataSync(),_=t.strides,A=b.strides,k=0;k<v;k++){var D=4*k,P=E[D],M=E[D+1],O=E[D+2],F=E[D+3],W=C[k];if(!(W>=l))for(var j=m>1?(O-P)*(h-1)/(m-1):0,ot=x>1?(F-M)*(f-1)/(x-1):0,nt=0;nt<m;nt++){var at=m>1?P*(h-1)+nt*j:.5*(P+O)*(h-1);if(at<0||at>h-1)for(var V=0;V<x;V++)for(var X=0;X<p;X++){var Q=X+V*A[2]+nt*A[1]+k*A[0];b.values[Q]=o}else if(i==="bilinear"){var ut=Math.floor(at),B=Math.ceil(at),$=at-ut;for(V=0;V<x;V++)if((jt=x>1?M*(f-1)+V*ot:.5*(M+F)*(f-1))<0||jt>f-1)for(X=0;X<p;X++)Q=X+V*A[2]+nt*A[1]+k*A[0],b.values[Q]=o;else{var ht=Math.floor(jt),ft=Math.ceil(jt),xt=jt-ht;for(X=0;X<p;X++){var wt=R[Q=X+ht*_[2]+ut*_[1]+W*_[0]],Rt=R[Q=X+ft*_[2]+ut*_[1]+W*_[0]],Dt=R[Q=X+ht*_[2]+B*_[1]+W*_[0]],_t=wt+(Rt-wt)*xt,Pt=Dt+(R[Q=X+ft*_[2]+B*_[1]+W*_[0]]-Dt)*xt;Q=X+V*A[2]+nt*A[1]+k*A[0],b.values[Q]=_t+(Pt-_t)*$}}}else for(V=0;V<x;++V){var jt;if((jt=x>1?M*(f-1)+V*ot:.5*(M+F)*(f-1))<0||jt>f-1)for(X=0;X<p;X++)Q=X+V*A[2]+nt*A[1]+k*A[0],b.values[Q]=o;else{var Ft=Math.round(jt),Wt=Math.round(at);for(X=0;X<p;X++){var Gt=X+Ft*_[2]+Wt*_[1]+W*_[0],$t=X+V*A[2]+nt*A[1]+k*A[0];b.values[$t]=R[Gt]}}}}}return b.toTensor()},r.prototype.sparseToDense=function(t,e,n,a){var i=Zf(e,t,n),o=i.sliceRank,u=i.numUpdates,l=i.sliceSize,h=i.strides,f=i.outputSize;return this.scatter(t,e,n,f,l,u,o,h,a,!1)},r.prototype.gatherND=function(t,e){var n=e.shape,a=n[n.length-1],i=tC(t,e),o=i[0],u=i[1],l=i[2],h=i[3];if(u===0)return bn([],o,t.dtype);for(var f=new Dc([u,l],t.dtype),p=e.dataSync(),v=t.dataSync(),m=0;m<u;m++){for(var x=[],b=0,E=0;E<a;E++){var C=p[m*a+E];b+=C*h[E],x.push(C)}if(b<0||b>=t.size/l)throw new Error("Invalid indices: "+x+" does not index into "+t.shape);for(var R=0;R<l;R++)f.values[m*l+R]=v[b*l+R]}return f.toTensor().reshape(o)},r.prototype.scatterND=function(t,e,n){var a=Zf(e,t,n),i=a.sliceRank,o=a.numUpdates,u=a.sliceSize,l=a.strides,h=a.outputSize,f=Tt(0);return this.scatter(t,e,n,h,u,o,i,l,f,!0)},r.prototype.fill=function(t,e,n){var a=qf(n=n||zc(e),qt(t));return a.fill(e),kt.make(t,{values:a},n)},r.prototype.onesLike=function(t){if(t.dtype==="string")throw new Error("onesLike is not supported for string tensors");return this.fill(t.shape,1,t.dtype)},r.prototype.zerosLike=function(t){var e=qf(t.dtype,qt(t.shape));return kt.make(t.shape,{values:e},t.dtype)},r.prototype.scatter=function(t,e,n,a,i,o,u,l,h,f){var p=[a/i,i],v=t.dataSync(),m=e.dataSync();if(a===0)return bn([],n,e.dtype);var x=new Dc(p,e.dtype);x.values.fill(h.dataSync()[0]);for(var b=0;b<o;b++){for(var E=[],C=0,R=0;R<u;R++){var _=v[b*u+R];E.push(_),C+=_*l[R]}if(C<0||C>=a/i)throw new Error("Invalid indices: "+E+" does not index into "+n);for(var A=0;A<i;A++)f?x.values[C*i+A]+=m[b*i+A]:x.values[C*i+A]=e.rank===0?m[0]:m[b*i+A]}return x.toTensor().reshape(n)},r})();q.registerBackend("cpu",function(){return new xU},1);var Jg=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function pw(r){return Jg?Buffer.byteLength(r):new Blob([r]).size}function bU(r){return Jg?Buffer.from(r).toString("base64"):btoa(String.fromCharCode.apply(null,new Uint8Array(r)))}function wU(r){if(Jg){var t=Buffer.from(r,"base64");return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}for(var e=atob(r),n=new Uint8Array(e.length),a=0;a<e.length;++a)n.set([e.charCodeAt(a)],a);return n.buffer}function EU(r){var t=0;r.forEach(function(a){t+=a.byteLength});var e=new Uint8Array(t),n=0;return r.forEach(function(a){e.set(new Uint8Array(a),n),n+=a.byteLength}),e.buffer}function kd(r){if(r.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:r.modelTopology==null?0:pw(JSON.stringify(r.modelTopology)),weightSpecsBytes:r.weightSpecs==null?0:pw(JSON.stringify(r.weightSpecs)),weightDataBytes:r.weightData==null?0:r.weightData.byteLength}}var zu=(function(){function r(){this.saveRouters=[],this.loadRouters=[]}return r.getInstance=function(){return r.instance==null&&(r.instance=new r),r.instance},r.registerSaveRouter=function(t){r.getInstance().saveRouters.push(t)},r.registerLoadRouter=function(t){r.getInstance().loadRouters.push(t)},r.getSaveHandlers=function(t){return r.getHandlers(t,"save")},r.getLoadHandlers=function(t,e){return r.getHandlers(t,"load",e)},r.getHandlers=function(t,e,n){var a=[];return(e==="load"?r.getInstance().loadRouters:r.getInstance().saveRouters).forEach(function(i){var o=i(t,n);o!==null&&a.push(o)}),a},r})(),vw="://",uS=(function(){function r(){this.managers={}}return r.getInstance=function(){return r.instance==null&&(r.instance=new r),r.instance},r.registerManager=function(t,e){Y(t!=null,function(){return"scheme must not be undefined or null."}),t.endsWith(vw)&&(t=t.slice(0,t.indexOf(vw))),Y(t.length>0,function(){return"scheme must not be an empty string."});var n=r.getInstance();Y(n.managers[t]==null,function(){return"A model store manager is already registered for scheme '"+t+"'."}),n.managers[t]=e},r.getManager=function(t){var e=this.getInstance().managers[t];if(e==null)throw new Error("Cannot find model manager for scheme '"+t+"'");return e},r.getSchemes=function(){return Object.keys(this.getInstance().managers)},r})(),sg="tensorflowjs",lg=1,Du="models_store",Vo="model_info_store";function sS(){if(!q.get("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var r=window,t=r.indexedDB||r.mozIndexedDB||r.webkitIndexedDB||r.msIndexedDB||r.shimIndexedDB;if(t==null)throw new Error("The current browser does not appear to support IndexedDB.");return t}function cg(r){var t=r.result;t.createObjectStore(Du,{keyPath:"modelPath"}),t.createObjectStore(Vo,{keyPath:"modelPath"})}var ol=(function(){function r(t){if(this.indexedDB=sS(),t==null||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}return r.prototype.save=function(t){return Ne(this,void 0,void 0,function(){return Oe(this,function(e){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,t)]})})},r.prototype.load=function(){return Ne(this,void 0,void 0,function(){return Oe(this,function(t){return[2,this.databaseAction(this.modelPath)]})})},r.prototype.databaseAction=function(t,e){var n=this;return new Promise(function(a,i){var o=n.indexedDB.open(sg,lg);o.onupgradeneeded=function(){return cg(o)},o.onsuccess=function(){var u=o.result;if(e==null){var l=u.transaction(Du,"readonly"),h=l.objectStore(Du).get(n.modelPath);h.onsuccess=function(){if(h.result==null)return u.close(),i(new Error("Cannot find model with path '"+n.modelPath+"' in IndexedDB."));a(h.result.modelArtifacts)},h.onerror=function(b){return u.close(),i(h.error)},l.oncomplete=function(){return u.close()}}else{var f,p=kd(e),v=u.transaction(Vo,"readwrite"),m=v.objectStore(Vo),x=m.put({modelPath:n.modelPath,modelArtifactsInfo:p});x.onsuccess=function(){var b=(f=u.transaction(Du,"readwrite")).objectStore(Du).put({modelPath:n.modelPath,modelArtifacts:e,modelArtifactsInfo:p});b.onsuccess=function(){return a({modelArtifactsInfo:p})},b.onerror=function(E){var C=(m=v.objectStore(Vo)).delete(n.modelPath);C.onsuccess=function(){return u.close(),i(b.error)},C.onerror=function(R){return u.close(),i(b.error)}}},x.onerror=function(b){return u.close(),i(x.error)},v.oncomplete=function(){f==null?u.close():f.oncomplete=function(){return u.close()}}}},o.onerror=function(u){return i(o.error)}})},r.URL_SCHEME="indexeddb://",r})(),mw=function(r){return q.get("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(ol.URL_SCHEME)?CU(r.slice(ol.URL_SCHEME.length)):null};function CU(r){return new ol(r)}function SU(r){return r.startsWith(ol.URL_SCHEME)?r.slice(ol.URL_SCHEME.length):r}zu.registerSaveRouter(mw),zu.registerLoadRouter(mw);var RU=(function(){function r(){this.indexedDB=sS()}return r.prototype.listModels=function(){return Ne(this,void 0,void 0,function(){var t=this;return Oe(this,function(e){return[2,new Promise(function(n,a){var i=t.indexedDB.open(sg,lg);i.onupgradeneeded=function(){return cg(i)},i.onsuccess=function(){var o=i.result,u=o.transaction(Vo,"readonly"),l=u.objectStore(Vo).getAll();l.onsuccess=function(){for(var h={},f=0,p=l.result;f<p.length;f++){var v=p[f];h[v.modelPath]=v.modelArtifactsInfo}n(h)},l.onerror=function(h){return o.close(),a(l.error)},u.oncomplete=function(){return o.close()}},i.onerror=function(o){return a(i.error)}})]})})},r.prototype.removeModel=function(t){return Ne(this,void 0,void 0,function(){var e=this;return Oe(this,function(n){return t=SU(t),[2,new Promise(function(a,i){var o=e.indexedDB.open(sg,lg);o.onupgradeneeded=function(){return cg(o)},o.onsuccess=function(){var u,l=o.result,h=l.transaction(Vo,"readwrite"),f=h.objectStore(Vo),p=f.get(t);p.onsuccess=function(){if(p.result==null)return l.close(),i(new Error("Cannot find model with path '"+t+"' in IndexedDB."));var v=f.delete(t),m=function(){var x=(u=l.transaction(Du,"readwrite")).objectStore(Du).delete(t);x.onsuccess=function(){return a(p.result.modelArtifactsInfo)},x.onerror=function(b){return i(p.error)}};v.onsuccess=m,v.onerror=function(x){return m(),l.close(),i(p.error)}},p.onerror=function(v){return l.close(),i(p.error)},h.oncomplete=function(){u==null?l.close():u.oncomplete=function(){return l.close()}}},o.onerror=function(u){return i(o.error)}})]})})},r})();if(q.get("IS_BROWSER"))try{uS.registerManager(ol.URL_SCHEME,new RU)}catch{}var Yi="/",Us="tensorflowjs_models",lS="info",_U="model_topology",AU="weight_specs",TU="weight_data",kU="model_metadata";function cS(r){return{info:[Us,r,lS].join(Yi),topology:[Us,r,_U].join(Yi),weightSpecs:[Us,r,AU].join(Yi),weightData:[Us,r,TU].join(Yi),modelMetadata:[Us,r,kU].join(Yi)}}function DU(r){var t=r.split(Yi);if(t.length<3)throw new Error("Invalid key format: "+r);return t.slice(1,t.length-1).join(Yi)}function IU(r){return r.startsWith(ul.URL_SCHEME)?r.slice(ul.URL_SCHEME.length):r}var ul=(function(){function r(t){if(!q.get("IS_BROWSER")||window.localStorage===void 0)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,t==null||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=cS(this.modelPath)}return r.prototype.save=function(t){return Ne(this,void 0,void 0,function(){var e,n,a;return Oe(this,function(i){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");e=JSON.stringify(t.modelTopology),n=JSON.stringify(t.weightSpecs),a=kd(t);try{return this.LS.setItem(this.keys.info,JSON.stringify(a)),this.LS.setItem(this.keys.topology,e),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,bU(t.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy})),[2,{modelArtifactsInfo:a}]}catch{throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+a.modelTopologyBytes+", weightSpecsBytes="+a.weightSpecsBytes+", weightDataBytes="+a.weightDataBytes+".")}return[2]})})},r.prototype.load=function(){return Ne(this,void 0,void 0,function(){var t,e,n,a,i,o,u;return Oe(this,function(l){if((t=JSON.parse(this.LS.getItem(this.keys.info)))==null)throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if(t.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(e={},(n=JSON.parse(this.LS.getItem(this.keys.topology)))==null)throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(e.modelTopology=n,(a=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))==null)throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(e.weightSpecs=a,(i=this.LS.getItem(this.keys.modelMetadata))!=null&&(o=JSON.parse(i),e.format=o.format,e.generatedBy=o.generatedBy,e.convertedBy=o.convertedBy),(u=this.LS.getItem(this.keys.weightData))==null)throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return e.weightData=wU(u),[2,e]})})},r.URL_SCHEME="localstorage://",r})(),gw=function(r){return q.get("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(ul.URL_SCHEME)?NU(r.slice(ul.URL_SCHEME.length)):null};function NU(r){return new ul(r)}zu.registerSaveRouter(gw),zu.registerLoadRouter(gw);var OU=(function(){function r(){Y(q.get("IS_BROWSER"),function(){return"Current environment is not a web browser"}),Y(window.localStorage!==void 0,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return r.prototype.listModels=function(){return Ne(this,void 0,void 0,function(){var t,e,n,a,i,o;return Oe(this,function(u){for(t={},e=Us+Yi,n=Yi+lS,a=0;a<this.LS.length;++a)(i=this.LS.key(a)).startsWith(e)&&i.endsWith(n)&&(o=DU(i),t[o]=JSON.parse(this.LS.getItem(i)));return[2,t]})})},r.prototype.removeModel=function(t){return Ne(this,void 0,void 0,function(){var e,n;return Oe(this,function(a){if(t=IU(t),e=cS(t),this.LS.getItem(e.info)==null)throw new Error("Cannot find model at path '"+t+"'");return n=JSON.parse(this.LS.getItem(e.info)),this.LS.removeItem(e.info),this.LS.removeItem(e.topology),this.LS.removeItem(e.weightSpecs),this.LS.removeItem(e.weightData),[2,n]})})},r})();if(q.get("IS_BROWSER"))try{uS.registerManager(ul.URL_SCHEME,new OU)}catch{}var MU="model",BU=".json",PU=".weights.bin",hg=(function(){function r(t){if(!q.get("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(r.URL_SCHEME)&&(t=t.slice(r.URL_SCHEME.length)),t!=null&&t.length!==0||(t=MU),this.modelTopologyFileName=t+BU,this.weightDataFileName=t+PU}return r.prototype.save=function(t){return Ne(this,void 0,void 0,function(){var e,n,a,i,o,u;return Oe(this,function(l){if(e=window.URL.createObjectURL(new Blob([t.weightData],{type:"application/octet-stream"})),t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");return n=[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}],a={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:n},i=window.URL.createObjectURL(new Blob([JSON.stringify(a)],{type:"application/json"})),(o=this.jsonAnchor==null?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,o.href=i,o.click(),t.weightData!=null&&((u=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,u.href=e,u.click()),[2,{modelArtifactsInfo:kd(t)}]})})},r.URL_SCHEME="downloads://",r})(),FU=function(r){return q.get("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(hg.URL_SCHEME)?LU(r.slice(hg.URL_SCHEME.length)):null};function LU(r){return r===void 0&&(r="model"),new hg(r)}function yw(r,t,e,n){(function(i){Y(i!=null&&Array.isArray(i)&&i.length>0,function(){return"promises must be a none empty array"})})(r),(function(i,o){Y(i>=0&&i<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+i}),Y(o>=0&&o<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+o}),Y(o>=i,function(){return"startFraction must be no more than endFraction, but got startFraction "+i+" and endFraction "+o})})(e=e??0,n=n??1);var a=0;return Promise.all(r.map(function(i){return i.then(function(o){var u=e+ ++a/r.length*(n-e);return t(u),o}),i}))}function zU(r,t){return Ne(this,void 0,void 0,function(){var e,n,a,i,o,u,l,h,f;return Oe(this,function(p){switch(p.label){case 0:return t==null&&(t={}),e=t.fetchFunc==null?fetch:t.fetchFunc,n=r.map(function(v){return e(v,t.requestInit)}),a=0,i=.5,t.onProgress!=null?[3,2]:[4,Promise.all(n)];case 1:return o=p.sent(),[3,4];case 2:return[4,yw(n,t.onProgress,a,i)];case 3:o=p.sent(),p.label=4;case 4:return u=o.map(function(v){return v.arrayBuffer()}),l=.5,h=1,t.onProgress!=null?[3,6]:[4,Promise.all(u)];case 5:return f=p.sent(),[3,8];case 6:return[4,yw(u,t.onProgress,l,h)];case 7:f=p.sent(),p.label=8;case 8:return[2,f]}})})}zu.registerSaveRouter(FU);var UU="application/octet-stream",WU="application/json",hS=(function(){function r(t,e){if(this.DEFAULT_METHOD="POST",e==null&&(e={}),this.weightPathPrefix=e.weightPathPrefix,this.onProgress=e.onProgress,e.fetchFunc==null){var n=q.global.fetch;if(n===void 0)throw new Error("browserHTTPRequest is not supported outside the web browser without a fetch polyfill.");e.fetchFunc=n.bind(q.global)}else Y(typeof e.fetchFunc=="function",function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"});if(this.fetchFunc=function(a,i){return e.fetchFunc(a,i).catch(function(o){throw new Error("Request for "+a+" failed due to error: "+o)})},Y(t!=null&&t.length>0,function(){return"URL path for browserHTTPRequest must not be null, undefined or empty."}),Array.isArray(t)&&Y(t.length===2,function(){return"URL paths for browserHTTPRequest must have a length of 2, (actual length is "+t.length+")."}),this.path=t,e.requestInit!=null&&e.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=e.requestInit||{}}return r.prototype.save=function(t){return Ne(this,void 0,void 0,function(){var e,n,a,i;return Oe(this,function(o){switch(o.label){case 0:if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(e=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,n=[{paths:["./model.weights.bin"],weights:t.weightSpecs}],a={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:n},e.body.append("model.json",new Blob([JSON.stringify(a)],{type:WU}),"model.json"),t.weightData!=null&&e.body.append("model.weights.bin",new Blob([t.weightData],{type:UU}),"model.weights.bin"),[4,this.getFetchFunc()(this.path,e)];case 1:if((i=o.sent()).ok)return[2,{modelArtifactsInfo:kd(t),responses:[i]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+i.status+".")}})})},r.prototype.load=function(){return Ne(this,void 0,void 0,function(){var t,e,n,a,i,o,u,l;return Oe(this,function(h){switch(h.label){case 0:return[4,this.getFetchFunc()(this.path,this.requestInit)];case 1:if(!(t=h.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+t.status+". Please verify this URL points to the model JSON of the model to load.");h.label=2;case 2:return h.trys.push([2,4,,5]),[4,t.json()];case 3:return e=h.sent(),[3,5];case 4:throw h.sent(),n="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?n+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":n+=" Please make sure the server is serving valid JSON for this request.",new Error(n);case 5:if(a=e.modelTopology,i=e.weightsManifest,a==null&&i==null)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return i==null?[3,7]:[4,this.loadWeights(i)];case 6:l=h.sent(),o=l[0],u=l[1],h.label=7;case 7:return[2,{modelTopology:a,weightSpecs:o,weightData:u}]}})})},r.prototype.loadWeights=function(t){return Ne(this,void 0,void 0,function(){var e,n,a,i,o,u,l,h,f,p,v;return Oe(this,function(m){switch(m.label){case 0:for(e=Array.isArray(this.path)?this.path[1]:this.path,n=VU(e),a=n[0],i=n[1],o=this.weightPathPrefix||a,u=[],l=0,h=t;l<h.length;l++)f=h[l],u.push.apply(u,f.weights);return p=[],t.forEach(function(x){x.paths.forEach(function(b){p.push(o+b+i)})}),[4,zU(p,{requestInit:this.requestInit,fetchFunc:this.getFetchFunc(),onProgress:this.onProgress})];case 1:return v=m.sent(),[2,[u,EU(v)]]}})})},r.prototype.getFetchFunc=function(){return this.fetchFunc},r.URL_SCHEME_REGEX=/^https?:\/\//,r})();function VU(r){var t=r.lastIndexOf("/"),e=r.lastIndexOf("?");return[r.substring(0,t)+"/",e>t?r.substring(e):""]}function xw(r){return r.match(hS.URL_SCHEME_REGEX)!=null}var bw=function(r,t){return typeof fetch>"u"?null:(Array.isArray(r)?r.every(function(e){return xw(e)}):xw(r))?GU(r,{onProgress:t}):null};function GU(r,t){return new hS(r,t)}zu.registerSaveRouter(bw),zu.registerLoadRouter(bw);function HU(r,t,e){var n=H(r,"labels","confusionMatrix"),a=H(t,"predictions","confusionMatrix");Y(e==null||e>0&&Number.isInteger(e),function(){return"If provided, numClasses must be a positive integer, but got "+e}),Y(n.rank===1,function(){return"Expected the rank of labels to be 1, but got "+n.rank}),Y(a.rank===1,function(){return"Expected the rank of predictions to be 1, but got "+a.rank}),Y(n.shape[0]===a.shape[0],function(){return"Mismatch in the number of examples: "+n.shape[0]+" vs. "+a.shape[0]+". Labels and predictions should have the same number of elements."}),Y(e>0&&Number.isInteger(e),function(){return"numClasses is required to be a positive integer, but got "+e});var i=ig(n.asType("int32"),e),o=ig(a.asType("int32"),e);return i.transpose().matMul(o).asType("int32")}it({confusionMatrix_:HU});function qU(r,t){if(t===void 0&&(t=3),t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");return q.engine.fromPixels(r,t)}function jU(r,t){return Ne(this,void 0,void 0,function(){var e,n,a,i,o,u,l,h,f,p,v,m,x,b,E,C,R,_,A,k;return Oe(this,function(D){switch(D.label){case 0:if(e=H(r,"img","toPixels"),r instanceof kt||(e=e.toInt()),e.rank!==2&&e.rank!==3)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+e.rank+".");if(n=e.shape.slice(0,2),a=n[0],i=n[1],(o=e.rank===2?1:e.shape[2])>4||o===2)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+o);return u=e.min(),l=e.max(),[4,u.data()];case 1:return h=D.sent()[0],[4,l.data()];case 2:if(f=D.sent()[0],u.dispose(),l.dispose(),e.dtype==="float32"){if(h<0||f>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+h+" - "+f+"].")}else{if(e.dtype!=="int32")throw new Error("Unsupported type for toPixels: "+e.dtype+". Please use float32 or int32 tensors.");if(h<0||f>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+h+" - "+f+"].")}return[4,e.data()];case 3:for(p=D.sent(),v=e.dtype==="float32"?255:1,m=new Uint8ClampedArray(i*a*4),x=0;x<a*i;++x)b=void 0,E=void 0,C=void 0,R=void 0,o===1?(b=p[x]*v,E=p[x]*v,C=p[x]*v,R=255):o===3?(b=p[3*x]*v,E=p[3*x+1]*v,C=p[3*x+2]*v,R=255):o===4&&(b=p[4*x]*v,E=p[4*x+1]*v,C=p[4*x+2]*v,R=p[4*x+3]*v),m[(_=4*x)+0]=Math.round(b),m[_+1]=Math.round(E),m[_+2]=Math.round(C),m[_+3]=Math.round(R);return t!=null&&(t.width=i,t.height=a,A=t.getContext("2d"),k=new ImageData(m,i,a),A.putImageData(k,0,0)),e!==r&&e.dispose(),[2,m]}})})}var XU=it({fromPixels_:qU}),KU=Object.freeze({toPixels:jU,fromPixels:XU}),YU=(function(){function r(){}return r.prototype.getClassName=function(){return this.constructor.className},r.fromConfig=function(t,e){return new t(e)},r})(),QU=(function(){function r(){this.classNameMap={}}return r.getMap=function(){return r.instance==null&&(r.instance=new r),r.instance},r.register=function(t){r.getMap().classNameMap[t.className]=[t,t.fromConfig]},r})();function Ku(r){Y(r.className!=null,function(){return"Class being registered does not have the static className property defined."}),Y(typeof r.className=="string",function(){return"className is required to be a string, but got type "+typeof r.className}),Y(r.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),QU.register(r)}var Yu=(function(r){function t(){return r!==null&&r.apply(this,arguments)||this}return eo(t,r),t.prototype.minimize=function(e,n,a){n===void 0&&(n=!1);var i=this.computeGradients(e,a),o=i.value,u=i.grads;return this.applyGradients(u),Object.keys(u).forEach(function(l){return u[l].dispose()}),n?o:(o.dispose(),null)},t.prototype.computeGradients=function(e,n){return oD(e,n)},t.prototype.dispose=function(){},t})(YU);Object.defineProperty(Yu,Symbol.hasInstance,{value:function(r){return r.minimize!=null&&r.computeGradients!=null&&r.applyGradients!=null}});var ZU=(function(r){function t(e,n,a){a===void 0&&(a=null);var i=r.call(this)||this;return i.learningRate=e,i.rho=n,i.epsilon=a,i.accumulatedGrads={},i.accumulatedUpdates={},i.c=Ue(Tt(-e)),i.rhoScalar=Ue(Tt(n)),i.oneMinusRho=Ue(Tt(1-n)),a===null&&(a=q.get("EPSILON")),i.epsilonScalar=Ue(Tt(a)),i}return eo(t,r),t.prototype.applyGradients=function(e){var n=this,a=function(u){var l=q.engine.registeredVariables[u];i.accumulatedGrads[u]==null&&Ht(function(){n.accumulatedGrads[u]=Ce(l).variable(!1)}),i.accumulatedUpdates[u]==null&&Ht(function(){n.accumulatedUpdates[u]=Ce(l).variable(!1)});var h=e[u],f=i.accumulatedGrads[u],p=i.accumulatedUpdates[u];Ht(function(){var v=n.rhoScalar.mul(f).add(n.oneMinusRho.mul(h.square())),m=p.add(n.epsilonScalar).sqrt().div(f.add(n.epsilonScalar).sqrt()).mul(h),x=n.rhoScalar.mul(p).add(n.oneMinusRho.mul(m.square()));n.accumulatedGrads[u].assign(v),n.accumulatedUpdates[u].assign(x);var b=n.c.mul(m).add(l);l.assign(b)})},i=this;for(var o in e)a(o)},t.prototype.dispose=function(){var e=this;this.c.dispose(),this.epsilonScalar.dispose(),this.rhoScalar.dispose(),this.oneMinusRho.dispose(),this.accumulatedUpdates!=null&&(Object.keys(this.accumulatedUpdates).forEach(function(n){return e.accumulatedUpdates[n].dispose()}),Object.keys(this.accumulatedGrads).forEach(function(n){return e.accumulatedGrads[n].dispose()}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},t.fromConfig=function(e,n){return new e(n.learningRate,n.rho,n.epsilon)},t.className="AdadeltaOptimizer",t})(Yu);Ku(ZU);var $U=(function(r){function t(e,n){n===void 0&&(n=.1);var a=r.call(this)||this;return a.learningRate=e,a.initialAccumulatorValue=n,a.accumulatedGrads={},a.c=Ue(Tt(-e)),a.epsilon=Ue(Tt(q.get("EPSILON"))),a}return eo(t,r),t.prototype.applyGradients=function(e){var n=this,a=function(u){var l=q.engine.registeredVariables[u];i.accumulatedGrads[u]==null&&Ht(function(){n.accumulatedGrads[u]=_c(l.shape,n.initialAccumulatorValue).variable(!1)});var h=e[u],f=i.accumulatedGrads[u];Ht(function(){var p=f.add(h.square());n.accumulatedGrads[u].assign(p);var v=n.c.mul(h.div(p.add(n.epsilon).sqrt())).add(l);l.assign(v)})},i=this;for(var o in e)a(o)},t.prototype.dispose=function(){var e=this;this.epsilon.dispose(),this.c.dispose(),this.accumulatedGrads!=null&&Object.keys(this.accumulatedGrads).forEach(function(n){return e.accumulatedGrads[n].dispose()})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},t.fromConfig=function(e,n){return new e(n.learningRate,n.initialAccumulatorValue)},t.className="AdagradOptimizer",t})(Yu);Ku($U);var JU=(function(r){function t(e,n,a,i){i===void 0&&(i=null);var o=r.call(this)||this;return o.learningRate=e,o.beta1=n,o.beta2=a,o.epsilon=i,o.accumulatedFirstMoment={},o.accumulatedSecondMoment={},o.c=Ue(Tt(-e)),o.beta1Scalar=Ue(Tt(n)),o.beta2Scalar=Ue(Tt(a)),Ht(function(){o.accBeta1=Tt(n).variable(),o.accBeta2=Tt(a).variable()}),o.oneMinusBeta1=Ue(Tt(1-n)),o.oneMinusBeta2=Ue(Tt(1-a)),o.one=Ue(Tt(1)),i===null&&(i=q.get("EPSILON")),o.epsScalar=Ue(Tt(i)),o}return eo(t,r),t.prototype.applyGradients=function(e){var n=this;Ht(function(){var a=n.one.sub(n.accBeta1),i=n.one.sub(n.accBeta2);for(var o in e){var u=q.engine.registeredVariables[o];if(n.accumulatedFirstMoment[o]==null){var l=!1;n.accumulatedFirstMoment[o]=Ce(u).variable(l)}n.accumulatedSecondMoment[o]==null&&(l=!1,n.accumulatedSecondMoment[o]=Ce(u).variable(l));var h=e[o],f=n.accumulatedFirstMoment[o],p=n.accumulatedSecondMoment[o],v=n.beta1Scalar.mul(f).add(n.oneMinusBeta1.mul(h)),m=n.beta2Scalar.mul(p).add(n.oneMinusBeta2.mul(h.square())),x=v.div(a),b=m.div(i);n.accumulatedFirstMoment[o].assign(v),n.accumulatedSecondMoment[o].assign(m);var E=n.c.mul(x.div(n.epsScalar.add(b.sqrt()))).add(u);u.assign(E)}n.accBeta1.assign(n.accBeta1.mul(n.beta1Scalar)),n.accBeta2.assign(n.accBeta2.mul(n.beta2Scalar))})},t.prototype.dispose=function(){var e=this;this.c.dispose(),this.epsScalar.dispose(),this.beta1Scalar.dispose(),this.beta2Scalar.dispose(),this.accBeta1.dispose(),this.accBeta2.dispose(),this.oneMinusBeta1.dispose(),this.oneMinusBeta2.dispose(),this.one.dispose(),this.accumulatedFirstMoment!=null&&Object.keys(this.accumulatedFirstMoment).forEach(function(n){return e.accumulatedFirstMoment[n].dispose()}),this.accumulatedSecondMoment!=null&&Object.keys(this.accumulatedSecondMoment).forEach(function(n){return e.accumulatedSecondMoment[n].dispose()})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},t.fromConfig=function(e,n){return new e(n.learningRate,n.beta1,n.beta2,n.epsilon)},t.className="AdamOptimizer",t})(Yu);Ku(JU);var t3=(function(r){function t(e,n,a,i,o){i===void 0&&(i=null),o===void 0&&(o=0);var u=r.call(this)||this;return u.learningRate=e,u.beta1=n,u.beta2=a,u.epsilon=i,u.decay=o,u.accumulatedFirstMoment={},u.accumulatedWeightedInfNorm={},u.c=Ue(Tt(-e)),u.beta1Scalar=Ue(Tt(n)),u.beta2Scalar=Ue(Tt(a)),u.decayScalar=Ue(Tt(o)),Ht(function(){u.iteration=Tt(0).variable(),u.accBeta1=Tt(n).variable()}),u.oneMinusBeta1=Ue(Tt(1-n)),u.one=Ue(Tt(1)),i===null&&(i=q.get("EPSILON")),u.epsScalar=Ue(Tt(i)),u}return eo(t,r),t.prototype.applyGradients=function(e){var n=this;Ht(function(){var a=n.one.sub(n.accBeta1),i=n.c.div(n.one.add(n.decayScalar.mul(n.iteration)));for(var o in e){var u=q.engine.registeredVariables[o];if(n.accumulatedFirstMoment[o]==null){var l=!1;n.accumulatedFirstMoment[o]=Ce(u).variable(l)}n.accumulatedWeightedInfNorm[o]==null&&(l=!1,n.accumulatedWeightedInfNorm[o]=Ce(u).variable(l));var h=e[o],f=n.accumulatedFirstMoment[o],p=n.accumulatedWeightedInfNorm[o],v=n.beta1Scalar.mul(f).add(n.oneMinusBeta1.mul(h)),m=n.beta2Scalar.mul(p),x=h.abs(),b=m.maximum(x);n.accumulatedFirstMoment[o].assign(v),n.accumulatedWeightedInfNorm[o].assign(b);var E=i.div(a).mul(v.div(n.epsScalar.add(b))).add(u);u.assign(E)}n.iteration.assign(n.iteration.add(n.one)),n.accBeta1.assign(n.accBeta1.mul(n.beta1Scalar))})},t.prototype.dispose=function(){var e=this;this.c.dispose(),this.epsScalar.dispose(),this.accBeta1.dispose(),this.beta1Scalar.dispose(),this.beta2Scalar.dispose(),this.oneMinusBeta1.dispose(),this.decayScalar.dispose(),this.iteration.dispose(),this.one.dispose(),this.accumulatedFirstMoment!=null&&Object.keys(this.accumulatedFirstMoment).forEach(function(n){return e.accumulatedFirstMoment[n].dispose()}),this.accumulatedWeightedInfNorm!=null&&Object.keys(this.accumulatedWeightedInfNorm).forEach(function(n){return e.accumulatedWeightedInfNorm[n].dispose()})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},t.fromConfig=function(e,n){return new e(n.learningRate,n.beta1,n.beta2,n.epsilon,n.decay)},t.className="AdamaxOptimizer",t})(Yu);Ku(t3);var fS=(function(r){function t(e){var n=r.call(this)||this;return n.learningRate=e,n.setLearningRate(e),n}return eo(t,r),t.prototype.applyGradients=function(e){var n=this;Object.keys(e).forEach(function(a){var i=e[a],o=q.engine.registeredVariables[a];Ht(function(){var u=n.c.mul(i).add(o);o.assign(u)})})},t.prototype.setLearningRate=function(e){this.learningRate=e,this.c!=null&&this.c.dispose(),this.c=Ue(Tt(-e))},t.prototype.dispose=function(){this.c.dispose()},t.prototype.getConfig=function(){return{learningRate:this.learningRate}},t.fromConfig=function(e,n){return new e(n.learningRate)},t.className="SGDOptimizer",t})(Yu);Ku(fS);var e3=(function(r){function t(e,n,a){a===void 0&&(a=!1);var i=r.call(this,e)||this;return i.learningRate=e,i.momentum=n,i.useNesterov=a,i.m=Tt(i.momentum),i.accumulations={},i}return eo(t,r),t.prototype.applyGradients=function(e){var n=this,a=function(u){var l=q.engine.registeredVariables[u];i.accumulations[u]==null&&Ht(function(){n.accumulations[u]=Ce(l).variable(!1)});var h=i.accumulations[u],f=e[u];Ht(function(){var p,v=n.m.mul(h).add(f);p=n.useNesterov?n.c.mul(f.add(v.mul(n.m))).add(l):n.c.mul(v).add(l),n.accumulations[u].assign(v),l.assign(p)})},i=this;for(var o in e)a(o)},t.prototype.dispose=function(){if(r.prototype.dispose.call(this),this.m.dispose(),this.accumulations!=null)for(var e in this.accumulations)this.accumulations[e].dispose()},t.prototype.setMomentum=function(e){this.momentum=e},t.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},t.fromConfig=function(e,n){return new e(n.learningRate,n.momentum,n.useNesterov)},t.className="MomentumOptimizer",t})(fS);Ku(e3);var n3=(function(r){function t(e,n,a,i,o){n===void 0&&(n=.9),a===void 0&&(a=0),i===void 0&&(i=null),o===void 0&&(o=!1);var u=r.call(this)||this;return u.learningRate=e,u.decay=n,u.momentum=a,u.epsilon=i,u.accumulatedMeanSquares={},u.accumulatedMeanGrads={},u.accumulatedMoments={},u.c=Ue(Tt(e)),u.decayScalar=Ue(Tt(n)),u.momentumScalar=Ue(Tt(a)),u.oneMinusDecay=Ue(Tt(1-n)),u.centered=o,i===null&&(i=q.get("EPSILON")),u.epsilonScalar=Ue(Tt(i)),u}return eo(t,r),t.prototype.applyGradients=function(e){var n=this,a=function(u){var l=q.engine.registeredVariables[u];i.accumulatedMeanSquares[u]==null&&Ht(function(){n.accumulatedMeanSquares[u]=Ce(l).variable(!1)}),i.accumulatedMeanGrads[u]==null&&i.centered&&Ht(function(){n.accumulatedMeanGrads[u]=Ce(l).variable(!1)}),i.accumulatedMoments[u]==null&&Ht(function(){n.accumulatedMoments[u]=Ce(l).variable(!1)});var h=i.accumulatedMeanSquares[u],f=i.accumulatedMeanGrads[u],p=i.accumulatedMoments[u],v=e[u];Ht(function(){var m=n.decayScalar.mul(h).add(n.oneMinusDecay.mul(v.square()));if(n.centered){var x=n.decayScalar.mul(f).add(n.oneMinusDecay.mul(v)),b=n.momentumScalar.mul(p).add(n.c.mul(v).div(m.sub(x.square().add(n.epsilonScalar)).sqrt()));n.accumulatedMeanSquares[u].assign(m),n.accumulatedMeanGrads[u].assign(x),n.accumulatedMoments[u].assign(b);var E=l.sub(b);l.assign(E)}else{var C=n.decayScalar.mul(h).add(n.oneMinusDecay.mul(v.square()));b=n.momentumScalar.mul(p).add(n.c.mul(v).div(C.add(n.epsilonScalar).sqrt())),n.accumulatedMeanSquares[u].assign(C),n.accumulatedMoments[u].assign(b),E=l.sub(b),l.assign(E)}})},i=this;for(var o in e)a(o)},t.prototype.dispose=function(){var e=this;this.c.dispose(),this.epsilonScalar.dispose(),this.decayScalar.dispose(),this.momentumScalar.dispose(),this.oneMinusDecay.dispose(),this.accumulatedMeanSquares!=null&&Object.keys(this.accumulatedMeanSquares).forEach(function(n){return e.accumulatedMeanSquares[n].dispose()}),this.accumulatedMeanGrads!=null&&this.centered&&Object.keys(this.accumulatedMeanGrads).forEach(function(n){return e.accumulatedMeanGrads[n].dispose()}),this.accumulatedMoments!=null&&Object.keys(this.accumulatedMoments).forEach(function(n){return e.accumulatedMoments[n].dispose()})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},t.fromConfig=function(e,n){return new e(n.learningRate,n.decay,n.momentum,n.epsilon,n.centered)},t.className="RMSPropOptimizer",t})(Yu);Ku(n3);xi.setBackend;xi.getBackend;xi.disposeVariables;xi.memory;Mk(gU);/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var fg=function(r,t){return fg=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var a in n)n.hasOwnProperty(a)&&(e[a]=n[a])},fg(r,t)};function Jc(r,t){fg(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var nd=function(){return nd=Object.assign||function(t){for(var e,n=1,a=arguments.length;n<a;n++){e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},nd.apply(this,arguments)};function ma(r,t,e,n){function a(i){return i instanceof e?i:new e(function(o){o(i)})}return new(e||(e=Promise))(function(i,o){function u(f){try{h(n.next(f))}catch(p){o(p)}}function l(f){try{h(n.throw(f))}catch(p){o(p)}}function h(f){f.done?i(f.value):a(f.value).then(u,l)}h((n=n.apply(r,[])).next())})}function ga(r,t){var e={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,a,i,o;return o={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function u(h){return function(f){return l([h,f])}}function l(h){if(n)throw new TypeError("Generator is already executing.");for(;e;)try{if(n=1,a&&(i=h[0]&2?a.return:h[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,h[1])).done)return i;switch(a=0,i&&(h=[h[0]&2,i.value]),h[0]){case 0:case 1:i=h;break;case 4:return e.label++,{value:h[1],done:!1};case 5:e.label++,a=h[1],h=[0];continue;case 7:h=e.ops.pop(),e.trys.pop();continue;default:if(i=e.trys,!(i=i.length>0&&i[i.length-1])&&(h[0]===6||h[0]===2)){e=0;continue}if(h[0]===3&&(!i||h[1]>i[0]&&h[1]<i[3])){e.label=h[1];break}if(h[0]===6&&e.label<i[1]){e.label=i[1],i=h;break}if(i&&e.label<i[2]){e.label=i[2],e.ops.push(h);break}i[2]&&e.ops.pop(),e.trys.pop();continue}h=t.call(r,e)}catch(f){h=[6,f],a=0}finally{n=i=0}if(h[0]&5)throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}}function ym(){for(var r=0,t=0,e=arguments.length;t<e;t++)r+=arguments[t].length;for(var n=Array(r),a=0,t=0;t<e;t++)for(var i=arguments[t],o=0,u=i.length;o<u;o++,a++)n[a]=i[o];return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var dS=function(r,t){return(dS=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var a in n)n.hasOwnProperty(a)&&(e[a]=n[a])})(r,t)};function Ua(r,t){function e(){this.constructor=r}dS(r,t),r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}function Mt(r,t,e,n){return new(e||(e=Promise))((function(a,i){function o(h){try{l(n.next(h))}catch(f){i(f)}}function u(h){try{l(n.throw(h))}catch(f){i(f)}}function l(h){h.done?a(h.value):new e((function(f){f(h.value)})).then(o,u)}l((n=n.apply(r,[])).next())}))}function Bt(r,t){var e,n,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(i[Symbol.iterator]=function(){return this}),i;function u(l){return function(h){return(function(f){if(e)throw new TypeError("Generator is already executing.");for(;o;)try{if(e=1,n&&(a=2&f[0]?n.return:f[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,f[1])).done)return a;switch(n=0,a&&(f=[2&f[0],a.value]),f[0]){case 0:case 1:a=f;break;case 4:return o.label++,{value:f[1],done:!1};case 5:o.label++,n=f[1],f=[0];continue;case 7:f=o.ops.pop(),o.trys.pop();continue;default:if(!(a=(a=o.trys).length>0&&a[a.length-1])&&(f[0]===6||f[0]===2)){o=0;continue}if(f[0]===3&&(!a||f[1]>a[0]&&f[1]<a[3])){o.label=f[1];break}if(f[0]===6&&o.label<a[1]){o.label=a[1],a=f;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(f);break}a[2]&&o.ops.pop(),o.trys.pop();continue}f=t.call(r,o)}catch(p){f=[6,p],n=0}finally{e=a=0}if(5&f[0])throw f[1];return{value:f[0]?f[1]:void 0,done:!0}})([l,h])}}}var r3=(function(){function r(t){this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return r.prototype.setPlatform=function(t,e){this.platform!=null&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+e+"."),this.platformName=t,this.platform=e},r.prototype.registerFlag=function(t,e,n){if(this.flagRegistry[t]={evaluationFn:e,setHook:n},this.urlFlags[t]!=null){var a=this.urlFlags[t];console.warn("Setting feature override from URL "+t+": "+a+"."),this.set(t,a)}},r.prototype.get=function(t){return t in this.flags?this.flags[t]:(this.flags[t]=this.evaluateFlag(t),this.flags[t])},r.prototype.getNumber=function(t){return this.get(t)},r.prototype.getBool=function(t){return this.get(t)},r.prototype.getFlags=function(){return this.flags},Object.defineProperty(r.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),r.prototype.set=function(t,e){if(this.flagRegistry[t]==null)throw new Error("Cannot set flag "+t+" as it has not been registered.");this.flags[t]=e,this.flagRegistry[t].setHook!=null&&this.flagRegistry[t].setHook(e)},r.prototype.evaluateFlag=function(t){if(this.flagRegistry[t]==null)throw new Error("Cannot evaluate flag '"+t+"': no evaluation function found.");return this.flagRegistry[t].evaluationFn()},r.prototype.setFlags=function(t){this.flags=Object.assign({},t)},r.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},r.prototype.populateURLFlags=function(){var t=this;if(this.global!==void 0&&this.global.location!==void 0&&this.global.location.search!==void 0){var e,n,a=(e=this.global.location.search,n={},e.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(function(i){for(var o=[],u=1;u<arguments.length;u++)o[u-1]=arguments[u];return a3(n,o[0],o[1]),o.join("=")})),n);"tfjsflags"in a&&a.tfjsflags.split(",").forEach((function(i){var o=i.split(":"),u=o[0],l=o[1];t.urlFlags[u]=(function(h,f){if((f=f.toLowerCase())==="true"||f==="false")return f==="true";if(""+ +f===f)return+f;throw new Error("Could not parse value flag value "+f+" for flag "+h+".")})(u,l)}))}},r})();function a3(r,t,e){r[decodeURIComponent(t)]=decodeURIComponent(e||"")}function yt(){return pS}var pS=null,rd=new Map,dg=new Map;function vS(r,t){var e=gS(r,t);return rd.get(e)}function ww(r){return dg.get(r)}function Ew(r){for(var t=rd.entries(),e=[];;){var n=t.next(),a=n.done,i=n.value;if(a)break;var o=i[0],u=i[1];o.split("_")[0]===r&&e.push(u)}return e}function mS(r){var t=r.kernelName,e=r.backendName,n=gS(t,e);if(rd.has(n))throw new Error("The kernel '"+t+"' for backend '"+e+"' is already registered");rd.set(n,r)}function i3(r){var t=r.kernelName;dg.has(t)&&console.warn("Overriding the gradient for '"+t+"'"),dg.set(t,r)}function gS(r,t){return t+"_"+r}function pg(r,t,e){return Math.max(r,Math.min(t,e))}function yS(r){return r%2==0?r:r+1}function o3(r){for(var t=0,e=0;e<r.length;e++)t+=r[e];return t}function G(r,t){if(!r)throw new Error(typeof t=="string"?t:t())}function Re(r,t,e){e===void 0&&(e=""),G(Wn(r,t),(function(){return e+" Shapes "+r+" and "+t+" must match"}))}function bl(r){G(r!=null,(function(){return"The input to the tensor constructor must be a non-null value."}))}function sl(r,t,e){if(t===void 0&&(t=[]),e===void 0&&(e=!1),t==null&&(t=[]),Array.isArray(r)||pi(r)&&!e)for(var n=0;n<r.length;++n)sl(r[n],t,e);else t.push(r);return t}function Ot(r){if(r.length===0)return 1;for(var t=r[0],e=1;e<r.length;e++)t*=r[e];return t}function Wn(r,t){if(r===t)return!0;if(r==null||t==null||r.length!==t.length)return!1;for(var e=0;e<r.length;e++)if(r[e]!==t[e])return!1;return!0}function pn(r){return r%1==0}function u3(r){if(Math.tanh!=null)return Math.tanh(r);if(r===1/0)return 1;if(r===-1/0)return-1;var t=Math.exp(2*r);return(t-1)/(t+1)}function vg(r){var t=Math.ceil(Math.sqrt(r));return[t,Math.ceil(r/t)]}function Ys(r,t){return t<=r.length?r:r+" ".repeat(t-r.length)}function Cw(r,t,e){return t===void 0&&(t=function(n){return 0}),new Promise((function(n,a){var i=0,o=function(){if(r())n();else{i++;var u=t(i);e!=null&&i>=e?a():setTimeout(o,u)}};o()}))}function s3(r,t){for(var e=1,n=-1,a=0;a<r.length;++a)if(r[a]>=0)e*=r[a];else if(r[a]===-1){if(n!==-1)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+n+" and dim "+a);n=a}else if(r[a]<0)throw Error("Shapes can not be < 0. Found "+r[a]+" at dim "+a);if(n===-1){if(t>0&&t!==e)throw Error("Size("+t+") must match the product of shape "+r);return r}if(e===0)throw Error("Cannot infer the missing size in ["+r+"] when there are 0 elements");if(t%e!=0)throw Error("The implicit shape can't be a fractional number. Got "+t+" / "+e);var i=r.slice();return i[n]=t/e,i}function In(r,t){var e=t.length;return G((r=r==null?t.map((function(n,a){return a})):[].concat(r)).every((function(n){return n>=-e&&n<e})),(function(){return"All values in axis param must be in range [-"+e+", "+e+") but got axis "+r})),G(r.every((function(n){return pn(n)})),(function(){return"All values in axis param must be integers but got axis "+r})),r.map((function(n){return n<0?e+n:n}))}function ku(r,t){for(var e=[],n=[],a=t!=null&&Array.isArray(t)&&t.length===0,i=t==null||a?null:In(t,r).sort(),o=0,u=0;u<r.length;++u){if(i!=null){if(i[o]===u&&r[u]!==1)throw new Error("Can't squeeze axis "+u+" since its dim '"+r[u]+"' is not 1");(i[o]==null||i[o]>u)&&r[u]===1&&(e.push(r[u]),n.push(u)),i[o]<=u&&o++}r[u]!==1&&(e.push(r[u]),n.push(u))}return{newShape:e,keptDims:n}}function ll(r,t){var e=null;if(r==null||r==="float32")e=new Float32Array(t);else if(r==="int32")e=new Int32Array(t);else{if(r!=="bool")throw new Error("Unknown data type "+r);e=new Uint8Array(t)}return e}function ad(r,t){var e=null;if(r==null||r==="float32")e=new Float32Array(t);else if(r==="int32")e=new Int32Array(t);else if(r==="bool")e=new Uint8Array(t);else{if(r!=="string")throw new Error("Unknown data type "+r);e=new Array(t)}return e}function l3(r,t){for(var e=0;e<r.length;e++){var n=r[e];if(isNaN(n)||!isFinite(n))throw Error("A tensor of type "+t+" being uploaded contains "+n+".")}}function c3(r){return r==="bool"||r==="complex64"||r==="float32"||r==="int32"||r==="string"}function h3(r,t){return t!=="complex64"&&(t!=="float32"||r==="complex64")&&(t!=="int32"||r==="float32"||r==="complex64")&&(t!=="bool"||r!=="bool")}function pi(r){return r instanceof Float32Array||r instanceof Int32Array||r instanceof Uint8Array}function xS(r){if(r==="float32"||r==="int32")return 4;if(r==="complex64")return 8;if(r==="bool")return 1;throw new Error("Unknown dtype "+r)}function f3(r){if(r==null)return 0;var t=0;return r.forEach((function(e){return t+=e.length})),t}function ty(r){return typeof r=="string"||r instanceof String}function d3(r){return typeof r=="boolean"}function p3(r){return typeof r=="number"}function th(r){return Array.isArray(r)?th(r[0]):r instanceof Float32Array?"float32":r instanceof Int32Array||r instanceof Uint8Array?"int32":p3(r)?"float32":ty(r)?"string":d3(r)?"bool":"float32"}function mg(r){return!!(r&&r.constructor&&r.call&&r.apply)}function gg(r,t){for(var e=t;e<r;++e)if(r%e==0)return e;return r}function $r(r){var t=r.length;if(t<2)return[];var e=new Array(t-1);e[t-2]=r[t-1];for(var n=t-3;n>=0;--n)e[n]=e[n+1]*r[n+1];return e}function bS(r,t,e){if(t==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(r)&&(r=sl(r)),e&&l3(r,t),(function(i,o){return i instanceof Float32Array&&o==="float32"||i instanceof Int32Array&&o==="int32"||i instanceof Uint8Array&&o==="bool"})(r,t))return r;if(t==null||t==="float32"||t==="complex64")return new Float32Array(r);if(t==="int32")return new Int32Array(r);if(t==="bool"){for(var n=new Uint8Array(r.length),a=0;a<n.length;++a)Math.round(r[a])!==0&&(n[a]=1);return n}throw new Error("Unknown data type "+t)}function Sw(r,t){if(r.length===0)return t[0];var e=r.reduce((function(n,a){return n*a}));if(e===0)return[];if(e!==t.length)throw new Error("["+r+"] does not match the input size.");return(function n(a,i,o){var u=new Array;if(i.length===1)for(var l=i[0],h=0;h<l;h++)u[h]=o[a+h];else{l=i[0];var f=i.slice(1),p=f.reduce((function(v,m){return v*m}));for(h=0;h<l;h++)u[h]=n(a+h*p,f,o)}return u})(0,r,t)}function wS(r,t){for(var e=eh(r,t),n=0;n<e.length;n++)e[n]=1;return e}function eh(r,t){if(t==null||t==="float32"||t==="complex64")return new Float32Array(r);if(t==="int32")return new Int32Array(r);if(t==="bool")return new Uint8Array(r);throw new Error("Unknown data type "+t)}function ui(){return yt().platform.now()}function ES(r){r.forEach((function(t){G(Number.isInteger(t)&&t>=0,(function(){return"Tensor must have a shape comprised of positive integers but got shape ["+r+"]."}))}))}function v3(r,t){return t===void 0&&(t="utf-8"),t=t||"utf-8",yt().platform.encode(r,t)}function id(r,t){return t===void 0&&(t="utf-8"),t=t||"utf-8",yt().platform.decode(r,t)}function yg(r,t,e){if(t===0)return 0;if(t===1)return r[0];for(var n=r[r.length-1],a=0;a<r.length-1;++a)n+=e[a]*r[a];return n}function CS(r,t,e){if(t===0)return[];if(t===1)return[r];for(var n=new Array(t),a=0;a<n.length-1;++a)n[a]=Math.floor(r/e[a]),r-=n[a]*e[a];return n[n.length-1]=r,n}var m3=(function(){function r(t,e){this.backendTimer=t,this.logger=e,e==null&&(this.logger=new g3)}return r.prototype.profileKernel=function(t,e,n){var a,i=this,o=this.backendTimer.time((function(){a=n()}));return a.forEach((function(u){u.data().then((function(l){(function(h,f,p){if(f!=="float32")return!1;for(var v=0;v<h.length;v++){var m=h[v];if(isNaN(m)||!isFinite(m))return console.warn("Found "+m+" in the result of '"+p+"'"),!0}})(l,u.dtype,t),o.then((function(h){var f="";h.getExtraProfileInfo!=null&&(f=h.getExtraProfileInfo()),i.logger.logKernelProfile(t,u,l,h.kernelMs,e,f)}))}))})),a},r})(),g3=(function(){function r(){}return r.prototype.logKernelProfile=function(t,e,n,a,i,o){var u=typeof a=="number"?Ys(a+"ms",9):a.error,l=Ys(t,25),h=e.rank,f=e.size,p=Ys(e.shape.toString(),14),v="";for(var m in i){var x=i[m].shape||e.shape,b=x.length;v+=m+": "+b+"D "+(b>0?x:"")+" "}console.log("%c"+l+"	%c"+u+"	%c"+h+"D "+p+"	%c"+f+"	%c"+v+"	%c"+o,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},r})(),Rw=20,bc=3,xm=7;function y3(r,t,e,n){var a=$r(t),i=(function(h,f,p,v){var m=Ot(f),x=v[v.length-1],b=new Array(x).fill(0),E=f.length,C=p==="complex64"?Ec(h):h;if(E>1)for(var R=0;R<m/x;R++)for(var _=R*x,A=0;A<x;A++)b[A]=Math.max(b[A],wc(C[_+A],0,p).length);return b})(r,t,e,a),o=t.length,u=(function h(f,p,v,m,x,b){b===void 0&&(b=!0);var E=v==="complex64"?2:1,C=p[0],R=p.length;if(R===0)return v==="complex64"?[wc(Ec(f)[0],0,v)]:v==="bool"?[SS(f[0])]:[f[0].toString()];if(R===1){if(C>Rw){var _=bc*E,A=Array.from(f.slice(0,_)),k=Array.from(f.slice((C-bc)*E,C*E));return v==="complex64"&&(A=Ec(A),k=Ec(k)),["["+A.map((function(at,V){return wc(at,x[V],v)})).join(", ")+", ..., "+k.map((function(at,V){return wc(at,x[C-bc+V],v)})).join(", ")+"]"]}return["["+(v==="complex64"?Ec(f):Array.from(f)).map((function(at,V){return wc(at,x[V],v)})).join(", ")+"]"]}var D=p.slice(1),P=m.slice(1),M=m[0]*E,O=[];if(C>Rw){for(var F=0;F<bc;F++){var W=(j=F*M)+M;O.push.apply(O,h(f.slice(j,W),D,v,P,x,!1))}for(O.push("..."),F=C-bc;F<C;F++)W=(j=F*M)+M,O.push.apply(O,h(f.slice(j,W),D,v,P,x,F===C-1))}else for(F=0;F<C;F++){var j;W=(j=F*M)+M,O.push.apply(O,h(f.slice(j,W),D,v,P,x,F===C-1))}var ot=R===2?",":"";for(O[0]="["+O[0]+ot,F=1;F<O.length-1;F++)O[F]=" "+O[F]+ot;var nt=`,
`;for(F=2;F<R;F++)nt+=`
`;return O[O.length-1]=" "+O[O.length-1]+"]"+(b?"":nt),O})(r,t,e,a,i),l=["Tensor"];return n&&(l.push("  dtype: "+e),l.push("  rank: "+o),l.push("  shape: ["+t+"]"),l.push("  values:")),l.push(u.map((function(h){return"    "+h})).join(`
`)),l.join(`
`)}function wc(r,t,e){return Ys(Array.isArray(r)?parseFloat(r[0].toFixed(xm))+" + "+parseFloat(r[1].toFixed(xm))+"j":ty(r)?"'"+r+"'":e==="bool"?SS(r):parseFloat(r.toFixed(xm)).toString(),t)}function SS(r){return r===0?"false":"true"}function Ec(r){for(var t=[],e=0;e<r.length;e+=2)t.push([r[e],r[e+1]]);return t}var Nc=(function(){function r(t,e,n){var a=this;if(this.dtype=e,this.shape=t.slice(),this.size=Ot(t),n!=null){var i=n.length;G(i===this.size,(function(){return"Length of values '"+i+"' does not match the size inferred by the shape '"+a.size+"'."}))}if(e==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||ad(e,this.size),this.strides=$r(t)}return r.prototype.set=function(t){for(var e=this,n=[],a=1;a<arguments.length;a++)n[a-1]=arguments[a];n.length===0&&(n=[0]),G(n.length===this.rank,(function(){return"The number of provided coordinates ("+n.length+") must match the rank ("+e.rank+")"}));var i=this.locToIndex(n);this.values[i]=t},r.prototype.get=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];t.length===0&&(t=[0]);for(var n=0,a=0,i=t;a<i.length;a++){var o=i[a];if(o<0||o>=this.shape[n]){var u="Requested out of range element at "+t+".   Buffer shape="+this.shape;throw new Error(u)}n++}for(var l=t[t.length-1],h=0;h<t.length-1;++h)l+=this.strides[h]*t[h];return this.values[l]},r.prototype.locToIndex=function(t){if(this.rank===0)return 0;if(this.rank===1)return t[0];for(var e=t[t.length-1],n=0;n<t.length-1;++n)e+=this.strides[n]*t[n];return e},r.prototype.indexToLoc=function(t){if(this.rank===0)return[];if(this.rank===1)return[t];for(var e=new Array(this.shape.length),n=0;n<e.length-1;++n)e[n]=Math.floor(t/this.strides[n]),t-=e[n]*this.strides[n];return e[e.length-1]=t,e},Object.defineProperty(r.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),r.prototype.toTensor=function(){return li().makeTensor(this.values,this.shape,this.dtype)},r})(),li=null,gt=null,RS=null,ze=(function(){function r(t,e,n,a){this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=e||"float32",this.size=Ot(t),this.strides=$r(t),this.dataId=n,this.id=a,this.rankType=this.rank<5?this.rank.toString():"higher"}return r.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},r.prototype.asScalar=function(){return this.throwIfDisposed(),G(this.size===1,(function(){return"The array must have only 1 element."})),this.reshape([])},r.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},r.prototype.as2D=function(t,e){return this.throwIfDisposed(),this.reshape([t,e])},r.prototype.as3D=function(t,e,n){return this.throwIfDisposed(),this.reshape([t,e,n])},r.prototype.as4D=function(t,e,n,a){return this.throwIfDisposed(),this.reshape([t,e,n,a])},r.prototype.as5D=function(t,e,n,a,i){return this.throwIfDisposed(),this.reshape([t,e,n,a,i])},r.prototype.asType=function(t){return this.throwIfDisposed(),gt.cast(this,t)},Object.defineProperty(r.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),r.prototype.buffer=function(){return Mt(this,void 0,void 0,(function(){var t;return Bt(this,(function(e){switch(e.label){case 0:return[4,this.data()];case 1:return t=e.sent(),[2,gt.buffer(this.shape,this.dtype,t)]}}))}))},r.prototype.bufferSync=function(){return gt.buffer(this.shape,this.dtype,this.dataSync())},r.prototype.array=function(){return Mt(this,void 0,void 0,(function(){var t;return Bt(this,(function(e){switch(e.label){case 0:return[4,this.data()];case 1:return t=e.sent(),[2,Sw(this.shape,t)]}}))}))},r.prototype.arraySync=function(){return Sw(this.shape,this.dataSync())},r.prototype.data=function(){return Mt(this,void 0,void 0,(function(){var t,e;return Bt(this,(function(n){switch(n.label){case 0:return this.throwIfDisposed(),t=li().read(this.dataId),this.dtype!=="string"?[3,2]:[4,t];case 1:e=n.sent();try{return[2,e.map((function(a){return id(a)}))]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}n.label=2;case 2:return[2,t]}}))}))},r.prototype.dataSync=function(){this.throwIfDisposed();var t=li().readSync(this.dataId);if(this.dtype==="string")try{return t.map((function(e){return id(e)}))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return t},r.prototype.bytes=function(){return Mt(this,void 0,void 0,(function(){var t;return Bt(this,(function(e){switch(e.label){case 0:return this.throwIfDisposed(),[4,li().read(this.dataId)];case 1:return t=e.sent(),this.dtype==="string"?[2,t]:[2,new Uint8Array(t.buffer)]}}))}))},r.prototype.dispose=function(){this.isDisposed||(li().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(r.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),r.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},r.prototype.toFloat=function(){return this.asType("float32")},r.prototype.toInt=function(){return this.asType("int32")},r.prototype.toBool=function(){return this.asType("bool")},r.prototype.print=function(t){return t===void 0&&(t=!1),gt.print(this,t)},r.prototype.reshape=function(t){return this.throwIfDisposed(),gt.reshape(this,t)},r.prototype.reshapeAs=function(t){return this.throwIfDisposed(),this.reshape(t.shape)},r.prototype.expandDims=function(t){return t===void 0&&(t=0),gt.expandDims(this,t)},r.prototype.cumsum=function(t,e,n){return t===void 0&&(t=0),e===void 0&&(e=!1),n===void 0&&(n=!1),gt.cumsum(this,t,e,n)},r.prototype.squeeze=function(t){return this.throwIfDisposed(),gt.squeeze(this,t)},r.prototype.clone=function(){return this.throwIfDisposed(),gt.clone(this)},r.prototype.toString=function(t){return t===void 0&&(t=!1),y3(this.dataSync(),this.shape,this.dtype,t)},r.prototype.gather=function(t,e){return e===void 0&&(e=0),this.throwIfDisposed(),gt.gather(this,t,e)},r.prototype.matMul=function(t,e,n){return e===void 0&&(e=!1),n===void 0&&(n=!1),this.throwIfDisposed(),gt.matMul(this,t,e,n)},r.prototype.dot=function(t){return this.throwIfDisposed(),gt.dot(this,t)},r.prototype.norm=function(t,e,n){return t===void 0&&(t="euclidean"),e===void 0&&(e=null),n===void 0&&(n=!1),this.throwIfDisposed(),gt.norm(this,t,e,n)},r.prototype.slice=function(t,e){return this.throwIfDisposed(),gt.slice(this,t,e)},r.prototype.reverse=function(t){return this.throwIfDisposed(),gt.reverse(this,t)},r.prototype.concat=function(t,e){return e===void 0&&(e=0),this.throwIfDisposed(),t instanceof r&&(t=[t]),gt.concat([this].concat(t),e)},r.prototype.split=function(t,e){return e===void 0&&(e=0),this.throwIfDisposed(),gt.split(this,t,e)},r.prototype.stack=function(t,e){return e===void 0&&(e=0),gt.stack([this,t],e)},r.prototype.unstack=function(t){return t===void 0&&(t=0),gt.unstack(this,t)},r.prototype.batchNormalization=function(t,e,n,a,i){return n===void 0&&(n=.001),RS("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(t,e,i,a,n)},r.prototype.all=function(t,e){return t===void 0&&(t=null),e===void 0&&(e=!1),this.throwIfDisposed(),gt.all(this,t,e)},r.prototype.any=function(t,e){return t===void 0&&(t=null),e===void 0&&(e=!1),this.throwIfDisposed(),gt.any(this,t,e)},r.prototype.logSumExp=function(t,e){return t===void 0&&(t=null),e===void 0&&(e=!1),this.throwIfDisposed(),gt.logSumExp(this,t,e)},r.prototype.sum=function(t,e){return t===void 0&&(t=null),e===void 0&&(e=!1),this.throwIfDisposed(),gt.sum(this,t,e)},r.prototype.prod=function(t,e){return t===void 0&&(t=null),e===void 0&&(e=!1),this.throwIfDisposed(),gt.prod(this,t,e)},r.prototype.mean=function(t,e){return t===void 0&&(t=null),e===void 0&&(e=!1),this.throwIfDisposed(),gt.mean(this,t,e)},r.prototype.min=function(t,e){return t===void 0&&(t=null),e===void 0&&(e=!1),this.throwIfDisposed(),gt.min(this,t,e)},r.prototype.max=function(t,e){return t===void 0&&(t=null),e===void 0&&(e=!1),this.throwIfDisposed(),gt.max(this,t,e)},r.prototype.argMin=function(t){return t===void 0&&(t=null),this.throwIfDisposed(),gt.argMin(this,t)},r.prototype.argMax=function(t){return t===void 0&&(t=null),this.throwIfDisposed(),gt.argMax(this,t)},r.prototype.cast=function(t){return this.throwIfDisposed(),gt.cast(this,t)},r.prototype.addStrict=function(t){return this.throwIfDisposed(),gt.addStrict(this,t)},r.prototype.atan2=function(t){return this.throwIfDisposed(),gt.atan2(this,t)},r.prototype.sub=function(t){return this.throwIfDisposed(),gt.sub(this,t)},r.prototype.subStrict=function(t){return this.throwIfDisposed(),gt.subStrict(this,t)},r.prototype.pow=function(t){return this.throwIfDisposed(),gt.pow(this,t)},r.prototype.powStrict=function(t){return this.throwIfDisposed(),gt.powStrict(this,t)},r.prototype.mul=function(t){return this.throwIfDisposed(),gt.mul(this,t)},r.prototype.mulStrict=function(t){return this.throwIfDisposed(),gt.mulStrict(this,t)},r.prototype.floorDiv=function(t){return this.throwIfDisposed(),gt.floorDiv(this,t)},r.prototype.divStrict=function(t){return this.throwIfDisposed(),gt.divStrict(this,t)},r.prototype.minimum=function(t){return this.throwIfDisposed(),gt.minimum(this,t)},r.prototype.minimumStrict=function(t){return this.throwIfDisposed(),gt.minimumStrict(this,t)},r.prototype.maximum=function(t){return this.throwIfDisposed(),gt.maximum(this,t)},r.prototype.maximumStrict=function(t){return this.throwIfDisposed(),gt.maximumStrict(this,t)},r.prototype.mod=function(t){return this.throwIfDisposed(),gt.mod(this,t)},r.prototype.modStrict=function(t){return this.throwIfDisposed(),gt.modStrict(this,t)},r.prototype.squaredDifferenceStrict=function(t){return this.throwIfDisposed(),gt.squaredDifferenceStrict(this,t)},r.prototype.notEqual=function(t){return this.throwIfDisposed(),gt.notEqual(this,t)},r.prototype.notEqualStrict=function(t){return this.throwIfDisposed(),gt.notEqualStrict(this,t)},r.prototype.less=function(t){return this.throwIfDisposed(),gt.less(this,t)},r.prototype.lessStrict=function(t){return this.throwIfDisposed(),gt.lessStrict(this,t)},r.prototype.equal=function(t){return this.throwIfDisposed(),gt.equal(this,t)},r.prototype.equalStrict=function(t){return this.throwIfDisposed(),gt.equalStrict(this,t)},r.prototype.lessEqual=function(t){return this.throwIfDisposed(),gt.lessEqual(this,t)},r.prototype.lessEqualStrict=function(t){return this.throwIfDisposed(),gt.lessEqualStrict(this,t)},r.prototype.greater=function(t){return this.throwIfDisposed(),gt.greater(this,t)},r.prototype.greaterStrict=function(t){return this.throwIfDisposed(),gt.greaterStrict(this,t)},r.prototype.greaterEqual=function(t){return this.throwIfDisposed(),gt.greaterEqual(this,t)},r.prototype.greaterEqualStrict=function(t){return this.throwIfDisposed(),gt.greaterEqualStrict(this,t)},r.prototype.logicalAnd=function(t){return this.throwIfDisposed(),gt.logicalAnd(this,t)},r.prototype.logicalOr=function(t){return this.throwIfDisposed(),gt.logicalOr(this,t)},r.prototype.logicalNot=function(){return this.throwIfDisposed(),gt.logicalNot(this)},r.prototype.logicalXor=function(t){return this.throwIfDisposed(),gt.logicalXor(this,t)},r.prototype.where=function(t,e){return this.throwIfDisposed(),gt.where(t,this,e)},r.prototype.neg=function(){return this.throwIfDisposed(),gt.neg(this)},r.prototype.ceil=function(){return this.throwIfDisposed(),gt.ceil(this)},r.prototype.floor=function(){return this.throwIfDisposed(),gt.floor(this)},r.prototype.sign=function(){return this.throwIfDisposed(),gt.sign(this)},r.prototype.isNaN=function(){return this.throwIfDisposed(),gt.isNaN(this)},r.prototype.isInf=function(){return this.throwIfDisposed(),gt.isInf(this)},r.prototype.isFinite=function(){return this.throwIfDisposed(),gt.isFinite(this)},r.prototype.exp=function(){return this.throwIfDisposed(),gt.exp(this)},r.prototype.expm1=function(){return this.throwIfDisposed(),gt.expm1(this)},r.prototype.log=function(){return this.throwIfDisposed(),gt.log(this)},r.prototype.log1p=function(){return this.throwIfDisposed(),gt.log1p(this)},r.prototype.sqrt=function(){return this.throwIfDisposed(),gt.sqrt(this)},r.prototype.rsqrt=function(){return this.throwIfDisposed(),gt.rsqrt(this)},r.prototype.square=function(){return this.throwIfDisposed(),gt.square(this)},r.prototype.reciprocal=function(){return this.throwIfDisposed(),gt.reciprocal(this)},r.prototype.abs=function(){return this.throwIfDisposed(),gt.abs(this)},r.prototype.clipByValue=function(t,e){return this.throwIfDisposed(),gt.clipByValue(this,t,e)},r.prototype.relu=function(){return this.throwIfDisposed(),gt.relu(this)},r.prototype.relu6=function(){return this.throwIfDisposed(),gt.relu6(this)},r.prototype.elu=function(){return this.throwIfDisposed(),gt.elu(this)},r.prototype.selu=function(){return this.throwIfDisposed(),gt.selu(this)},r.prototype.leakyRelu=function(t){return t===void 0&&(t=.2),this.throwIfDisposed(),gt.leakyRelu(this,t)},r.prototype.prelu=function(t){return this.throwIfDisposed(),gt.prelu(this,t)},r.prototype.sigmoid=function(){return this.throwIfDisposed(),gt.sigmoid(this)},r.prototype.logSigmoid=function(){return this.throwIfDisposed(),gt.logSigmoid(this)},r.prototype.softplus=function(){return this.throwIfDisposed(),gt.softplus(this)},r.prototype.zerosLike=function(){return this.throwIfDisposed(),gt.zerosLike(this)},r.prototype.onesLike=function(){return this.throwIfDisposed(),gt.onesLike(this)},r.prototype.sin=function(){return this.throwIfDisposed(),gt.sin(this)},r.prototype.cos=function(){return this.throwIfDisposed(),gt.cos(this)},r.prototype.tan=function(){return this.throwIfDisposed(),gt.tan(this)},r.prototype.asin=function(){return this.throwIfDisposed(),gt.asin(this)},r.prototype.acos=function(){return this.throwIfDisposed(),gt.acos(this)},r.prototype.atan=function(){return this.throwIfDisposed(),gt.atan(this)},r.prototype.sinh=function(){return this.throwIfDisposed(),gt.sinh(this)},r.prototype.cosh=function(){return this.throwIfDisposed(),gt.cosh(this)},r.prototype.tanh=function(){return this.throwIfDisposed(),gt.tanh(this)},r.prototype.asinh=function(){return this.throwIfDisposed(),gt.asinh(this)},r.prototype.acosh=function(){return this.throwIfDisposed(),gt.acosh(this)},r.prototype.atanh=function(){return this.throwIfDisposed(),gt.atanh(this)},r.prototype.erf=function(){return this.throwIfDisposed(),gt.erf(this)},r.prototype.round=function(){return this.throwIfDisposed(),gt.round(this)},r.prototype.step=function(t){return t===void 0&&(t=0),this.throwIfDisposed(),gt.step(this,t)},r.prototype.softmax=function(t){return t===void 0&&(t=-1),this.throwIfDisposed(),gt.softmax(this,t)},r.prototype.logSoftmax=function(t){return t===void 0&&(t=-1),this.throwIfDisposed(),gt.logSoftmax(this,t)},r.prototype.resizeBilinear=function(t,e){return e===void 0&&(e=!1),this.throwIfDisposed(),gt.image.resizeBilinear(this,t,e)},r.prototype.resizeNearestNeighbor=function(t,e){return e===void 0&&(e=!1),this.throwIfDisposed(),gt.image.resizeNearestNeighbor(this,t,e)},r.prototype.conv1d=function(t,e,n,a,i,o){return a===void 0&&(a="NWC"),i===void 0&&(i=1),this.throwIfDisposed(),gt.conv1d(this,t,e,n,a,i,o)},r.prototype.conv2d=function(t,e,n,a,i,o){return a===void 0&&(a="NHWC"),i===void 0&&(i=[1,1]),this.throwIfDisposed(),gt.conv2d(this,t,e,n,a,i,o)},r.prototype.conv2dTranspose=function(t,e,n,a,i){return this.throwIfDisposed(),gt.conv2dTranspose(this,t,e,n,a,i)},r.prototype.depthwiseConv2D=function(t,e,n,a,i,o){return a===void 0&&(a="NHWC"),i===void 0&&(i=[1,1]),this.throwIfDisposed(),gt.depthwiseConv2d(this,t,e,n,a,i,o)},r.prototype.separableConv2d=function(t,e,n,a,i,o){return i===void 0&&(i=[1,1]),o===void 0&&(o="NHWC"),this.throwIfDisposed(),gt.separableConv2d(this,t,e,n,a,i,o)},r.prototype.avgPool=function(t,e,n,a){return this.throwIfDisposed(),gt.avgPool(this,t,e,n,a)},r.prototype.maxPool=function(t,e,n,a){return this.throwIfDisposed(),gt.maxPool(this,t,e,n,a)},r.prototype.localResponseNormalization=function(t,e,n,a){return t===void 0&&(t=5),e===void 0&&(e=1),n===void 0&&(n=1),a===void 0&&(a=.5),gt.localResponseNormalization(this,t,e,n,a)},r.prototype.pool=function(t,e,n,a,i){return this.throwIfDisposed(),gt.pool(this,t,e,n,a,i)},r.prototype.variable=function(t,e,n){return t===void 0&&(t=!0),this.throwIfDisposed(),li().makeVariable(this,t,e,n)},r.prototype.unsortedSegmentSum=function(t,e){return this.throwIfDisposed(),gt.unsortedSegmentSum(this,t,e)},r.prototype.batchToSpaceND=function(t,e){return this.throwIfDisposed(),gt.batchToSpaceND(this,t,e)},r.prototype.spaceToBatchND=function(t,e){return this.throwIfDisposed(),gt.spaceToBatchND(this,t,e)},r.prototype.topk=function(t,e){return t===void 0&&(t=1),e===void 0&&(e=!0),this.throwIfDisposed(),gt.topk(this,t,e)},r.prototype.stridedSlice=function(t,e,n,a,i,o,u,l){return a===void 0&&(a=0),i===void 0&&(i=0),o===void 0&&(o=0),u===void 0&&(u=0),l===void 0&&(l=0),this.throwIfDisposed(),gt.stridedSlice(this,t,e,n,a,i,o,u,l)},r.prototype.depthToSpace=function(t,e){return this.throwIfDisposed(),gt.depthToSpace(this,t,e)},r.prototype.fft=function(){return this.throwIfDisposed(),gt.spectral.fft(this)},r.prototype.ifft=function(){return this.throwIfDisposed(),gt.spectral.ifft(this)},r.prototype.rfft=function(){return this.throwIfDisposed(),gt.spectral.rfft(this)},r.prototype.irfft=function(){return this.throwIfDisposed(),gt.spectral.irfft(this)},r})();Object.defineProperty(ze,Symbol.hasInstance,{value:function(r){return!!r&&r.dataId!=null&&r.shape!=null&&r.dtype!=null}});var _w,xg,bg,wg,Eg,cl=(function(r){function t(e,n,a,i){var o=r.call(this,e.shape,e.dtype,e.dataId,i)||this;return o.trainable=n,o.name=a,o}return Ua(t,r),t.prototype.assign=function(e){if(e.dtype!==this.dtype)throw new Error("dtype of the new value ("+e.dtype+") and previous value ("+this.dtype+") must match");if(!Wn(e.shape,this.shape))throw new Error("shape of the new value ("+e.shape+") and previous value ("+this.shape+") must match");li().disposeTensor(this),this.dataId=e.dataId,li().incRef(this,null)},t.prototype.dispose=function(){li().disposeVariable(this),this.isDisposedInternal=!0},t})(ze);Object.defineProperty(cl,Symbol.hasInstance,{value:function(r){return r instanceof ze&&r.assign!=null&&r.assign instanceof Function}}),(function(r){r.R0="R0",r.R1="R1",r.R2="R2",r.R3="R3",r.R4="R4",r.R5="R5",r.R6="R6"})(_w||(_w={})),(function(r){r.float32="float32",r.int32="int32",r.bool="int32",r.complex64="complex64"})(xg||(xg={})),(function(r){r.float32="float32",r.int32="int32",r.bool="bool",r.complex64="complex64"})(bg||(bg={})),(function(r){r.float32="float32",r.int32="float32",r.bool="float32",r.complex64="complex64"})(wg||(wg={})),(function(r){r.float32="complex64",r.int32="complex64",r.bool="complex64",r.complex64="complex64"})(Eg||(Eg={}));var x3={float32:wg,int32:xg,bool:bg,complex64:Eg};function Yn(r,t){if(r==="string"||t==="string"){if(r==="string"&&t==="string")return"string";throw new Error("Can not upcast "+r+" with "+t)}return x3[r][t]}function bm(r){return Yn(r,"int32")}function Qe(r,t){if(r.dtype===t.dtype)return[r,t];var e=Yn(r.dtype,t.dtype);return[r.cast(e),t.cast(e)]}function b3(r,t){G(r.dtype===t.dtype,(function(){return"The dtypes of the first("+r.dtype+") and second("+t.dtype+") input must match"}))}function _S(r){var t=[];return(function e(n,a,i){if(n!=null){if(n instanceof ze)return void a.push(n);if(o=n,!(!Array.isArray(o)&&typeof o!="object")){var o,u=n;for(var l in u){var h=u[l];i.has(h)||(i.add(h),e(h,a,i))}}}})(r,t,new Set),t}var wm,Aw=(function(){function r(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return r.prototype.dispose=function(){for(var t in this.registeredVariables)this.registeredVariables[t].dispose()},r})(),w3=(function(){function r(t){this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new Aw}return r.prototype.ready=function(){return Mt(this,void 0,void 0,(function(){var t,e,n;return Bt(this,(function(a){switch(a.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then((function(){}))];if(this.backendInstance!=null)return[2];t=this.getSortedBackends(),e=0,a.label=1;case 1:return e<t.length?(n=t[e],[4,this.initializeBackend(n).success]):[3,5];case 2:return a.sent()?[4,this.setBackend(n)]:[3,4];case 3:return a.sent(),[2];case 4:return e++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}}))}))},Object.defineProperty(r.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var t=this.initializeBackendsAndReturnBest(),e=t.name;if(t.asyncInit)throw new Error("The highest priority backend '"+e+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(e)}return this.backendInstance},enumerable:!0,configurable:!0}),r.prototype.backendNames=function(){return Object.keys(this.registryFactory)},r.prototype.findBackend=function(t){return!(t in this.registry)&&(!(t in this.registryFactory)||this.initializeBackend(t).asyncInit)?null:this.registry[t]},r.prototype.findBackendFactory=function(t){return t in this.registryFactory?this.registryFactory[t].factory:null},r.prototype.registerBackend=function(t,e,n){return n===void 0&&(n=1),t in this.registryFactory?(console.warn(t+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[t]={factory:e,priority:n},!0)},r.prototype.setBackend=function(t){return Mt(this,void 0,void 0,(function(){var e,n,a;return Bt(this,(function(i){switch(i.label){case 0:if(this.registryFactory[t]==null)throw new Error("Backend name '"+t+"' not found in registry");return this.backendName=t,this.registry[t]!=null?[3,4]:(this.backendInstance=null,e=this.initializeBackend(t),n=e.success,e.asyncInit?[4,n]:[3,2]);case 1:return a=i.sent(),[3,3];case 2:a=n,i.label=3;case 3:if(!a)return[2,!1];i.label=4;case 4:return this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new m3(this.backendInstance),[2,!0]}}))}))},r.prototype.setupRegisteredKernels=function(){var t=this;Ew(this.backendName).forEach((function(e){e.setupFunc!=null&&e.setupFunc(t.backendInstance)}))},r.prototype.disposeRegisteredKernels=function(t){var e=this;Ew(t).forEach((function(n){n.disposeFunc!=null&&n.disposeFunc(e.registry[t])}))},r.prototype.initializeBackend=function(t){var e=this,n=this.registryFactory[t];if(n==null)throw new Error("Cannot initialize backend "+t+", no registration found.");try{var a=n.factory();if(Promise.resolve(a)===a){var i=++this.pendingBackendInitId,o=a.then((function(u){return!(i<e.pendingBackendInitId)&&(e.registry[t]=u,e.pendingBackendInit=null,!0)})).catch((function(u){return!(i<e.pendingBackendInitId)&&(e.pendingBackendInit=null,console.warn("Initialization of backend "+t+" failed"),console.warn(u.stack||u.message),!1)}));return this.pendingBackendInit=o,{success:o,asyncInit:!0}}return this.registry[t]=a,{success:!0,asyncInit:!1}}catch(u){return console.warn("Initialization of backend "+t+" failed"),console.warn(u.stack||u.message),{success:!1,asyncInit:!1}}},r.prototype.removeBackend=function(t){if(!(t in this.registryFactory))throw new Error(t+" backend not found in registry");this.backendName===t&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,t in this.registry&&(this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t]),delete this.registryFactory[t],this.backendName===t&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},r.prototype.getSortedBackends=function(){var t=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((function(e,n){return t.registryFactory[n].priority-t.registryFactory[e].priority}))},r.prototype.initializeBackendsAndReturnBest=function(){for(var t=this.getSortedBackends(),e=0;e<t.length;e++){var n=t[e],a=this.initializeBackend(n),i=a.success,o=a.asyncInit;if(o||i)return{name:n,asyncInit:o}}throw new Error("Could not initialize any backends, all backend initializations failed.")},r.prototype.moveData=function(t,e){var n=this.state.tensorInfo.get(e),a=n.backend,i=this.readSync(e);a.disposeData(e),n.backend=t,t.move(e,i,n.shape,n.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},r.prototype.tidy=function(t,e){var n,a=this,i=null;if(e==null){if(typeof t!="function")throw new Error("Please provide a function to tidy()");e=t}else{if(typeof t!="string"&&!(t instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof e!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");i=t}return this.scopedRun((function(){return a.startScope(i)}),(function(){return a.endScope(n)}),(function(){return(n=e())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n}))},r.prototype.scopedRun=function(t,e,n){t();try{var a=n();return e(),a}catch(i){throw e(),i}},r.prototype.nextTensorId=function(){return r.nextTensorId++},r.prototype.nextVariableId=function(){return r.nextVariableId++},r.prototype.clone=function(t){var e=this.makeTensorFromDataId(t.dataId,t.shape,t.dtype),n={x:t};return this.addTapeNode(this.state.activeScope.name,n,[e],(function(a){return{x:function(){return a.toFloat()}}}),[],{}),e},r.prototype.runKernel=function(t,e,n,a,i){return this.runKernelFunc(null,e,null,t,n,a,i)},r.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},r.prototype.checkKernelForMemLeak=function(t,e,n){var a=this.backend.numDataIds(),i=0;n.forEach((function(l){i+=l.dtype==="complex64"?3:1}));var o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],u=a-e-i-o;if(u>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+u+" data ids) after running '"+t+"'")},r.prototype.runKernelFunc=function(t,e,n,a,i,o,u){var l,h=this,f=[],p=this.isTapeOn();a==null&&(a=this.state.activeScope!=null?this.state.activeScope.name:"");var v,m=this.state.numBytes,x=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var b,E=vS(a,this.backendName);if(E!=null)v=function(){var R=h.backend.numDataIds();b=E.kernelFunc({inputs:e,attrs:i,backend:h.backend});var _=Array.isArray(b)?b:[b];h.shouldCheckForMemLeaks()&&h.checkKernelForMemLeak(a,R,_);var A=_.map((function(P){var M=P.dataId,O=P.shape,F=P.dtype;return h.makeTensorFromDataId(M,O,F)}));if(p){var k=h.getTensorsForGradient(a,e,A);if(k==null){u==null&&(u=[]);var D=A.filter((function(P,M){return u[M]}));k=(o||[]).slice().concat(D)}f=h.saveTensorsForBackwardMode(k)}return A};else{var C=function(R){p&&(f=R.map((function(_){return h.keep(h.clone(_))})))};v=function(){var R=h.backend.numDataIds();b=h.tidy((function(){return t(h.backend,C)}));var _=Array.isArray(b)?b:[b];return h.shouldCheckForMemLeaks()&&h.checkKernelForMemLeak(a,R,_),_}}return this.scopedRun((function(){return h.state.kernelDepth++}),(function(){return h.state.kernelDepth--}),(function(){l=h.ENV.getBool("DEBUG")?h.profiler.profileKernel(a,e,(function(){return v()})):v()})),p&&this.addTapeNode(a,e,l,n,f,i),this.state.profiling&&this.state.activeProfile.kernels.push({name:a,bytesAdded:this.state.numBytes-m,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-x,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(e).map((function(R){return e[R].shape})),outputShapes:l.map((function(R){return R.shape}))}),Array.isArray(b)?l:l[0]},r.prototype.saveTensorsForBackwardMode=function(t){var e=this;return t.map((function(n){return e.keep(e.clone(n))}))},r.prototype.getTensorsForGradient=function(t,e,n){var a=ww(t);if(a!=null){var i=a.inputsToSave||[],o=a.outputsToSave||[],u=void 0;a.saveAllInputs?(G(Array.isArray(e),(function(){return"saveAllInputs is true, expected inputs to be an array."})),u=Object.keys(e).map((function(h){return e[h]}))):u=i.map((function(h){return e[h]}));var l=n.filter((function(h,f){return o[f]}));return u.concat(l)}return null},r.prototype.makeTensor=function(t,e,n,a){if(t==null)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",a=a||this.backend;var i=t;n==="string"&&ty(t[0])&&(i=t.map((function(f){return v3(f)})));var o=a.write(i,e,n),u=new ze(e,n,o,this.nextTensorId());if(this.incRef(u,a),n==="string"){var l=this.state.tensorInfo.get(o),h=f3(i);this.state.numBytes+=h-l.bytes,l.bytes=h}return u},r.prototype.makeTensorFromDataId=function(t,e,n,a){var i=new ze(e,n=n||"float32",t,this.nextTensorId());return this.incRef(i,a),i},r.prototype.makeVariable=function(t,e,n,a){e===void 0&&(e=!0),n=n||this.nextVariableId().toString(),a!=null&&a!==t.dtype&&(t=t.asType(a));var i=new cl(t,e,n,this.nextTensorId());if(this.state.registeredVariables[i.name]!=null)throw new Error("Variable with name "+i.name+" was already registered");return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i},r.prototype.incRef=function(t,e){var n=this.state.tensorInfo.has(t.dataId)?this.state.tensorInfo.get(t.dataId).refCount:0;if(this.state.numTensors++,t.dtype==="string"&&this.state.numStringTensors++,n===0){this.state.numDataBuffers++;var a=0;t.dtype!=="complex64"&&t.dtype!=="string"&&(a=t.size*xS(t.dtype)),this.state.tensorInfo.set(t.dataId,{backend:e||this.backend,dtype:t.dtype,shape:t.shape,bytes:a,refCount:0}),this.state.numBytes+=a}this.state.tensorInfo.get(t.dataId).refCount++,t instanceof cl||this.track(t)},r.prototype.disposeTensor=function(t){if(this.state.tensorInfo.has(t.dataId)){this.state.numTensors--,t.dtype==="string"&&this.state.numStringTensors--;var e=this.state.tensorInfo.get(t.dataId);e.refCount<=1?(t.dtype!=="complex64"&&(this.state.numBytes-=e.bytes),this.state.numDataBuffers--,e.backend.disposeData(t.dataId),this.state.tensorInfo.delete(t.dataId)):this.state.tensorInfo.get(t.dataId).refCount--}},r.prototype.disposeVariables=function(){for(var t in this.state.registeredVariables){var e=this.state.registeredVariables[t];this.disposeVariable(e)}},r.prototype.disposeVariable=function(t){this.disposeTensor(t),this.state.registeredVariables[t.name]!=null&&delete this.state.registeredVariables[t.name]},r.prototype.memory=function(){var t=this.backend.memory();return t.numTensors=this.state.numTensors,t.numDataBuffers=this.state.numDataBuffers,t.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(t.unreliable=!0,t.reasons==null&&(t.reasons=[]),t.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),t},r.prototype.profile=function(t){return Mt(this,void 0,void 0,(function(){var e,n;return Bt(this,(function(a){return this.state.profiling=!0,e=this.state.numBytes,n=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=t(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map((function(i){return i.totalBytesSnapshot}))),this.state.activeProfile.newBytes=this.state.numBytes-e,this.state.activeProfile.newTensors=this.state.numTensors-n,[2,this.state.activeProfile]}))}))},r.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},r.prototype.addTapeNode=function(t,e,n,a,i,o){var u=this,l={id:this.state.nextTapeNodeId++,kernelName:t,inputs:e,outputs:n,saved:i},h=ww(t);h!=null&&(a=h.gradFunc),a!=null&&(l.gradient=function(f){return f=f.map((function(p,v){if(p==null){var m=n[v],x=eh(m.size,m.dtype);return u.makeTensor(x,m.shape,m.dtype)}return p})),a(f.length>1?f:f[0],i,o)}),this.state.activeTape.push(l)},r.prototype.keep=function(t){return t.kept=!0,t},r.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},r.prototype.endTape=function(){this.state.gradientDepth--},r.prototype.startScope=function(t){var e={track:[],name:"unnamed scope",id:this.state.nextScopeId++};t&&(e.name=t),this.state.scopeStack.push(e),this.state.activeScope=e},r.prototype.endScope=function(t){for(var e=this,n=_S(t),a=new Set(n.map((function(l){return l.id}))),i=0;i<this.state.activeScope.track.length;i++){var o=this.state.activeScope.track[i];o.kept||a.has(o.id)||o.dispose()}var u=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach((function(l){l.kept||l.scopeId!==u.id||e.track(l)}))},r.prototype.gradients=function(t,e,n,a){var i=this;if(a===void 0&&(a=!1),G(e.length>0,(function(){return"gradients() received an empty list of xs."})),n!=null&&n.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '"+n.dtype+"'");var o=this.scopedRun((function(){return i.startTape()}),(function(){return i.endTape()}),(function(){return i.tidy("forward",t)}));G(o instanceof ze,(function(){return"The result y returned by f() must be a tensor."}));var u=(function(l,h,f){for(var p={},v={},m=0;m<h.length;m++)p[h[m].id]=!0;for(m=0;m<l.length;m++){var x=(D=l[m]).inputs;for(var b in x){for(var E=x[b],C=!1,R=0;R<h.length;R++)if(p[E.id]){D.outputs.forEach((function(F){return p[F.id]=!0})),C=!0,v[D.id]=!0;break}if(C)break}}var _={};_[f.id]=!0;var A={};for(m=l.length-1;m>=0;m--)for(x=(D=l[m]).inputs,R=0;R<D.outputs.length;R++)if(_[D.outputs[R].id]){for(var b in x)_[x[b].id]=!0,A[D.id]=!0;break}var k=[];for(m=0;m<l.length;m++){var D;if(v[(D=l[m]).id]&&A[D.id]){var P={};for(var b in D.inputs){var M=D.inputs[b];p[M.id]&&(P[b]=M)}var O=Object.assign({},D);O.inputs=P,O.outputs=D.outputs,k.push(O)}}return k})(this.state.activeTape,e,o);if(!a&&u.length===0&&e.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(function(){var l,h,f={};f[o.id]=n??(l=o.shape,h=wS(Ot(l),"float32"),rt.makeTensor(h,l,"float32")),(function(v,m,x){for(var b=function(C){var R=m[C],_=[];if(R.outputs.forEach((function(P){var M=v[P.id];M!=null?_.push(M):_.push(null)})),R.gradient==null)throw new Error("Cannot compute gradient: gradient function not found for "+R.kernelName+".");var A=R.gradient(_),k=function(P){if(!(P in A))throw new Error("Cannot backprop through input "+P+". Available gradients found: "+Object.keys(A)+".");var M=x((function(){return A[P]()}));if(M.dtype!=="float32")throw new Error("Error in gradient for op "+R.kernelName+". The gradient of input "+P+" must have 'float32' dtype, but has '"+M.dtype+"'");var O=R.inputs[P];if(!Wn(M.shape,O.shape))throw new Error("Error in gradient for op "+R.kernelName+". The gradient of input '"+P+"' has shape '"+M.shape+"', which does not match the shape of the input '"+O.shape+"'");if(v[O.id]==null)v[O.id]=M;else{var F=v[O.id];v[O.id]=F.add(M),F.dispose()}};for(var D in R.inputs)k(D)},E=m.length-1;E>=0;E--)b(E)})(f,u,(function(v){return i.tidy(v)}));var p=e.map((function(v){return f[v.id]}));return i.state.gradientDepth===0&&(i.state.activeTape.forEach((function(v){for(var m=0,x=v.saved;m<x.length;m++)x[m].dispose()})),i.state.activeTape=null),{value:o,grads:p}}))},r.prototype.customGrad=function(t){var e=this;return G(mg(t),(function(){return"The f passed in customGrad(f) must be a function."})),function(){for(var n,a=[],i=0;i<arguments.length;i++)a[i]=arguments[i];G(a.every((function(u){return u instanceof ze})),(function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"}));var o={};return a.forEach((function(u,l){o[l]=u})),e.runKernelFunc((function(u,l){return G((n=t.apply(void 0,a.concat([l]))).value instanceof ze,(function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"})),G(mg(n.gradFunc),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."})),n.value}),o,(function(u,l){var h=n.gradFunc(u,l),f=Array.isArray(h)?h:[h];G(f.length===a.length,(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."})),G(f.every((function(v){return v instanceof ze})),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."}));var p={};return f.forEach((function(v,m){p[m]=function(){return v}})),p}))}},r.prototype.readSync=function(t){return this.state.tensorInfo.get(t).backend.readSync(t)},r.prototype.read=function(t){return this.state.tensorInfo.get(t).backend.read(t)},r.prototype.time=function(t){return Mt(this,void 0,void 0,(function(){var e,n;return Bt(this,(function(a){switch(a.label){case 0:return e=ui(),[4,this.backend.time(t)];case 1:return(n=a.sent()).wallMs=ui()-e,[2,n]}}))}))},r.prototype.track=function(t){return this.state.activeScope!=null&&(t.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(t)),t},Object.defineProperty(r.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),r.prototype.reset=function(){for(var t in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new Aw,this.registry)this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},r.nextTensorId=0,r.nextVariableId=0,r})(),rt=(function(){var r=(function(){if(wm==null){var e=void 0;if(typeof window<"u")e=window;else if(typeof window<"u")e=window;else if(typeof process<"u")e=process;else{if(typeof self>"u")throw new Error("Could not find a global object");e=self}wm=e}return wm})();if(r._tfengine==null){var t=new r3(r);r._tfengine=new w3(t)}return(function(e){pS=e})(r._tfengine.ENV),li=function(){return r._tfengine},r._tfengine})();function AS(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var qi=yt();qi.registerFlag("DEBUG",(function(){return!1}),(function(r){r&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),qi.registerFlag("IS_BROWSER",(function(){return AS()})),qi.registerFlag("IS_NODE",(function(){return typeof process<"u"&&process.versions!==void 0&&process.versions.node!==void 0})),qi.registerFlag("IS_CHROME",(function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)})),qi.registerFlag("PROD",(function(){return!1})),qi.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(function(){return qi.getBool("DEBUG")})),qi.registerFlag("DEPRECATION_WARNINGS_ENABLED",(function(){return!0})),qi.registerFlag("IS_TEST",(function(){return!1}));var Oc,Kr,qr,_u={},Em={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function E3(r,t){_u[r]=t}function Ci(r){r in _u||(_u[r]=(function(e){if(e!==1&&e!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var n=(function(a){if(typeof OffscreenCanvas<"u"&&a===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")})(e);return n.addEventListener("webglcontextlost",(function(a){a.preventDefault(),delete _u[e]}),!1),e===1?n.getContext("webgl",Em)||n.getContext("experimental-webgl",Em):n.getContext("webgl2",Em)})(r));var t=_u[r];return t.isContextLost()?(delete _u[r],Ci(r)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),_u[r])}function Dd(r,t){return[t,r]}function Ac(r){var t=Ot(r);return vg(Math.ceil(t/4))}function nh(r,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(r/2))]}function ey(r,t){var e,n,a,i,o,u,l,h,f,p=r;return yt().getNumber("WEBGL_VERSION")===2?(e=p.R32F,n=p.R16F,a=p.RGBA16F,i=p.RGBA32F,o=p.RED,u=4,l=1,h=p.HALF_FLOAT,f=p.FLOAT):(e=r.RGBA,n=r.RGBA,a=r.RGBA,i=p.RGBA,o=r.RGBA,u=4,l=4,h=t!=null?t.HALF_FLOAT_OES:null,f=r.FLOAT),{internalFormatFloat:e,internalFormatHalfFloat:n,internalFormatPackedHalfFloat:a,internalFormatPackedFloat:i,textureFormatFloat:o,downloadTextureFormat:r.RGBA,downloadUnpackNumChannels:u,defaultNumChannels:l,textureTypeHalfFloat:h,textureTypeFloat:f}}function zt(r,t,e){var n=e();return t&&(function(a){var i=a.getError();if(i!==a.NO_ERROR)throw new Error("WebGL Error: "+_3(a,i))})(r),n}(function(r){r[r.DENSE=0]="DENSE",r[r.SHARED_BATCH=1]="SHARED_BATCH"})(Oc||(Oc={})),(function(r){r[r.RENDER=0]="RENDER",r[r.UPLOAD=1]="UPLOAD",r[r.PIXELS=2]="PIXELS",r[r.DOWNLOAD=3]="DOWNLOAD"})(Kr||(Kr={})),(function(r){r[r.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",r[r.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",r[r.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",r[r.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",r[r.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(qr||(qr={}));var C3=596e-10,S3=65504;function R3(r){return!!(yt().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||r===0||C3<Math.abs(r)&&Math.abs(r)<S3)}function _3(r,t){switch(t){case r.NO_ERROR:return"NO_ERROR";case r.INVALID_ENUM:return"INVALID_ENUM";case r.INVALID_VALUE:return"INVALID_VALUE";case r.INVALID_OPERATION:return"INVALID_OPERATION";case r.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case r.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case r.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+t}}function Tf(r,t,e){return io(r,t,(function(){return r.getExtension(e)}),'Extension "'+e+'" not supported on this browser.')}function A3(r,t,e){var n=io(r,t,(function(){return r.createShader(r.VERTEX_SHADER)}),"Unable to create vertex WebGLShader.");if(zt(r,t,(function(){return r.shaderSource(n,e)})),zt(r,t,(function(){return r.compileShader(n)})),r.getShaderParameter(n,r.COMPILE_STATUS)===!1)throw console.log(r.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}function T3(r,t,e){var n=io(r,t,(function(){return r.createShader(r.FRAGMENT_SHADER)}),"Unable to create fragment WebGLShader.");if(zt(r,t,(function(){return r.shaderSource(n,e)})),zt(r,t,(function(){return r.compileShader(n)})),r.getShaderParameter(n,r.COMPILE_STATUS)===!1)throw(function(a,i){var o=k3.exec(i);if(o==null)return console.log("Couldn't parse line number in error: "+i),void console.log(a);for(var u=+o[1],l=a.split(`
`),h=l.length.toString().length+2,f=l.map((function(E,C){return Ys((C+1).toString(),h)+E})),p=0,v=0;v<f.length;v++)p=Math.max(f[v].length,p);var m=f.slice(0,u-1),x=f.slice(u-1,u),b=f.slice(u);console.log(m.join(`
`)),console.log(i.split(`
`)[0]),console.log("%c "+Ys(x[0],p),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(b.join(`
`))})(e,r.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}var Cm,Sm,k3=/ERROR: [0-9]+:([0-9]+):/g;function D3(r,t){return io(r,t,(function(){return r.createProgram()}),"Unable to create WebGLProgram.")}function I3(r,t,e){if(zt(r,t,(function(){return r.linkProgram(e)})),r.getProgramParameter(e,r.LINK_STATUS)===!1)throw console.log(r.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function Rm(r,t,e){if(zt(r,t,(function(){return r.validateProgram(e)})),r.getProgramParameter(e,r.VALIDATE_STATUS)===!1)throw console.log(r.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function N3(r,t,e){var n=io(r,t,(function(){return r.createBuffer()}),"Unable to create WebGLBuffer");return zt(r,t,(function(){return r.bindBuffer(r.ARRAY_BUFFER,n)})),zt(r,t,(function(){return r.bufferData(r.ARRAY_BUFFER,e,r.STATIC_DRAW)})),n}function O3(r,t,e){var n=io(r,t,(function(){return r.createBuffer()}),"Unable to create WebGLBuffer");return zt(r,t,(function(){return r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,n)})),zt(r,t,(function(){return r.bufferData(r.ELEMENT_ARRAY_BUFFER,e,r.STATIC_DRAW)})),n}function M3(r,t){return io(r,t,(function(){return r.createTexture()}),"Unable to create WebGLTexture.")}function B3(r,t){var e=yt().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(r<=0||t<=0){var n="["+r+"x"+t+"]";throw new Error("Requested texture size "+n+" is invalid.")}if(r>e||t>e)throw n="["+r+"x"+t+"]",new Error("Requested texture size "+n+" greater than WebGL maximum on this browser / GPU "+("["+e+"x"+e+"]")+".")}function P3(r,t){return io(r,t,(function(){return r.createFramebuffer()}),"Unable to create WebGLFramebuffer.")}function Tw(r,t,e,n,a,i,o,u){var l=r.getAttribLocation(e,n);return l!==-1&&(zt(r,t,(function(){return r.bindBuffer(r.ARRAY_BUFFER,a)})),zt(r,t,(function(){return r.vertexAttribPointer(l,i,r.FLOAT,!1,o,u)})),zt(r,t,(function(){return r.enableVertexAttribArray(l)})),!0)}function F3(r,t,e,n){V3(r,n),zt(r,t,(function(){return r.activeTexture(r.TEXTURE0+n)})),zt(r,t,(function(){return r.bindTexture(r.TEXTURE_2D,e)}))}function L3(r,t,e,n){return io(r,t,(function(){return r.getUniformLocation(e,n)}),'uniform "'+n+'" not present in program.')}function z3(r,t,e){return r.getUniformLocation(t,e)}function U3(r,t,e,n,a,i){zt(r,t,(function(){return F3(r,t,n,i)})),zt(r,t,(function(){return r.uniform1i(a,i)}))}function _m(r,t,e,n){zt(r,t,(function(){return r.bindFramebuffer(r.FRAMEBUFFER,n)})),zt(r,t,(function(){return r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e,0)}))}function kw(r,t,e){zt(r,t,(function(){return r.bindFramebuffer(r.FRAMEBUFFER,e)})),zt(r,t,(function(){return r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,null,0)}))}function kf(r){var t=r.checkFramebufferStatus(r.FRAMEBUFFER);if(t!==r.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+W3(r,t))}function W3(r,t){switch(t){case r.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case r.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case r.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case r.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+t}}function io(r,t,e,n){var a=zt(r,t,(function(){return e()}));if(a==null)throw new Error(n);return a}function V3(r,t){var e=r.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,n=t+r.TEXTURE0;if(n<r.TEXTURE0||n>e)throw new Error("textureUnit must be in "+("[gl.TEXTURE0, gl.TEXTURE"+e+"]")+".")}function od(r,t){return t===void 0&&(t=2),Ot(r.slice(0,r.length-t))}function ud(r){if(r.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[r.length>1?r[r.length-2]:1,r[r.length-1]]}function Am(r){var t=[1,1,1];return r.length===0||r.length===1&&r[0]===1||(t=[od(r)].concat(ud(r))),t}function G3(r,t){var e;t===void 0&&(t=!1);var n=yt().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t&&(n*=2,(r=r.map((function(h,f){return f>=r.length-2?yS(r[f]):r[f]}))).length===1&&(r=[2,r[0]])),r.length!==2){var a=ku(r);r=a.newShape}var i=Ot(r);if(r.length<=1&&i<=n)return[1,i];if(r.length===2&&r[0]<=n&&r[1]<=n)return r;if(r.length===3&&r[0]*r[1]<=n&&r[2]<=n)return[r[0]*r[1],r[2]];if(r.length===3&&r[0]<=n&&r[1]*r[2]<=n)return[r[0],r[1]*r[2]];if(r.length===4&&r[0]*r[1]*r[2]<=n&&r[3]<=n)return[r[0]*r[1]*r[2],r[3]];if(r.length===4&&r[0]<=n&&r[1]*r[2]*r[3]<=n)return[r[0],r[1]*r[2]*r[3]];if(t){var o=od(r),u=2,l=2;return r.length&&(u=(e=ud(r))[0],l=e[1]),vg(i=o*(u/2)*(l/2)).map((function(h){return 2*h}))}return vg(i)}function Df(r){return r%2==0}function If(r,t){if(Wn(r=r.slice(-2),t=t.slice(-2))||!r.length||!t.length||r[0]===0||r[1]===0||t[0]===0||t[1]===0)return!0;if(r.length!==t.length){var e=r.slice(-1)[0],n=t.slice(-1)[0];if(e===n||Df(e)&&Df(n)&&(r[0]===1||t[0]===1))return!0}return r[1]===t[1]&&Df(r[0])&&Df(t[0])}function H3(r){if(Cm==null){var t=Ci(r);Cm=t.getParameter(t.MAX_TEXTURE_SIZE)}return Cm}function q3(r){if(Sm==null){var t=Ci(r);Sm=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,Sm)}function j3(r){if(r===0)return 0;var t=Ci(r);return ya(t,"EXT_disjoint_timer_query_webgl2")&&r===2?2:ya(t,"EXT_disjoint_timer_query")?1:0}function ya(r,t){return r.getExtension(t)!=null}function Dw(r){try{if(Ci(r)!=null)return!0}catch{return!1}return!1}function X3(r){if(r===0)return!1;var t=Ci(r);if(r===1){if(!ya(t,"OES_texture_float"))return!1}else if(!ya(t,"EXT_color_buffer_float"))return!1;return Cg(t)}function K3(r){if(r===0)return!1;var t=Ci(r);if(r!==1){if(ya(t,"EXT_color_buffer_float"))return Cg(t);if(ya(t,"EXT_color_buffer_half_float")){var e=t.getExtension("EXT_color_buffer_half_float");return(function(n,a){var i=ey(n,a),o=n.createTexture();n.bindTexture(n.TEXTURE_2D,o),n.texImage2D(n.TEXTURE_2D,0,i.internalFormatHalfFloat,1,1,0,i.textureFormatFloat,i.textureTypeHalfFloat,null);var u=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,u),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,o,0);var l=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(o),n.deleteFramebuffer(u),l})(t,e)}return!1}return!!ya(t,"OES_texture_float")&&!!ya(t,"WEBGL_color_buffer_float")&&Cg(t)}function Cg(r){var t=ey(r),e=r.createTexture();r.bindTexture(r.TEXTURE_2D,e),r.texImage2D(r.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);var n=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,n),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e,0);var a=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;return r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,null),r.deleteTexture(e),r.deleteFramebuffer(n),a}function Y3(r){return r===2&&Ci(r).fenceSync!=null}var Zt=yt();function TS(r){yt().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(r+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function Ee(r,t){return rt.tidy(r,t)}function _r(r){_S(r).forEach((function(t){return t.dispose()}))}function Q3(r){return rt.keep(r)}function sd(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];yt().getBool("IS_TEST")||console.warn.apply(console,r)}function eu(r,t){var e=r;if(pi(r))return t==="string"?[]:[r.length];if(!Array.isArray(r))return[];for(var n=[];Array.isArray(e)||pi(e)&&t!=="string";)n.push(e.length),e=e[0];return Array.isArray(r)&&yt().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&(function a(i,o,u){if(u=u||[],!Array.isArray(i)&&!pi(i))return void G(o.length===0,(function(){return"Element arr["+u.join("][")+"] is a primitive, but should be an array/TypedArray of "+o[0]+" elements"}));G(o.length>0,(function(){return"Element arr["+u.join("][")+"] should be a primitive, but is an array of "+i.length+" elements"})),G(i.length===o[0],(function(){return"Element arr["+u.join("][")+"] should have "+o[0]+" elements, but has "+i.length+" elements"}));for(var l=o.slice(1),h=0;h<i.length;++h)a(i[h],l,u.concat(h))})(r,n,[]),n}function Iw(r,t,e,n){if(r!=null&&(r!=="numeric"&&r!==t||r==="numeric"&&t==="string"))throw new Error("Argument '"+e+"' passed to '"+n+"' must be "+r+" tensor, but got "+t+" tensor")}function z(r,t,e,n){if(n===void 0&&(n="numeric"),r instanceof ze)return Iw(n,r.dtype,t,e),r;var a=th(r);if(a!=="string"&&["bool","int32","float32"].indexOf(n)>=0&&(a=n),Iw(n,a,t,e),r==null||!pi(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string"){var i=r==null?"null":r.constructor.name;throw new Error("Argument '"+t+"' passed to '"+e+"' must be a Tensor or TensorLike, but got '"+i+"'")}var o=eu(r,a);pi(r)||Array.isArray(r)||(r=[r]);var u=a!=="string"?bS(r,a,yt().getBool("DEBUG")):sl(r,[],!0);return rt.makeTensor(u,o,a)}function ld(r,t,e,n){if(n===void 0&&(n="numeric"),!Array.isArray(r))throw new Error("Argument "+t+" passed to "+e+" must be a `Tensor[]` or `TensorLike[]`");return r.map((function(a,i){return z(a,t+"["+i+"]",e)}),n)}function kS(r,t){for(var e=0;e<r.length;++e)if(r[r.length-e-1]!==t-1-e)return!1;return!0}function Z3(r,t,e){for(var n=r.length+t.length,a=[],i=0,o=0,u=0;u<n;u++)e.indexOf(u)===-1?a.push(r[i++]):a.push(t[o++]);return a}function nr(r,t){for(var e=[],n=r.length,a=0;a<n;a++)t.indexOf(a)===-1&&e.push(r[a]);return[e,t.map((function(i){return r[i]}))]}function Ar(r,t){return Z3(r,t.map((function(e){return 1})),t)}function Hr(r,t,e){G(kS(t,e),(function(){return r+" supports only inner-most axes for now. Got axes "+t+" and rank-"+e+" input."}))}function Si(r,t){if(kS(r,t))return null;for(var e=[],n=0;n<t;++n)r.indexOf(n)===-1&&e.push(n);return r.forEach((function(a){return e.push(a)})),e}function ny(r){return r.map((function(t,e){return[e,t]})).sort((function(t,e){return t[1]-e[1]})).map((function(t){return t[0]}))}function Ri(r,t){for(var e=[],n=t-r;n<t;++n)e.push(n);return e}function $3(r,t){var e=r[0].length;r.forEach((function(a,i){G(a.length===e,(function(){return"Error in concat"+e+"D: rank of tensors["+i+"] must be the same as the rank of the rest ("+e+")"}))})),G(t>=0&&t<e,(function(){return"Error in concat"+e+"D: axis must be between 0 and "+(e-1)+"."}));var n=r[0];r.forEach((function(a,i){for(var o=0;o<e;o++)G(o===t||a[o]===n[o],(function(){return"Error in concat"+e+"D: Shape of tensors["+i+"] ("+a+") does not match the shape of the rest ("+n+") along the non-concatenated axis "+i+"."}))}))}function hl(r,t){for(var e=r[0].slice(),n=1;n<r.length;n++)e[t]+=r[n][t];return e}function tt(r){var t=Object.keys(r);if(t.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+t.length+" keys.");var e=t[0],n=r[e];e.endsWith("_")&&(e=e.substring(0,e.length-1));var a=function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];rt.startScope(e);try{var u=n.apply(void 0,i);return u instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),rt.endScope(u),u}catch(l){throw rt.endScope(null),l}};return Object.defineProperty(a,"name",{value:e,configurable:!0}),a}Zt.registerFlag("HAS_WEBGL",(function(){return Zt.getNumber("WEBGL_VERSION")>0})),Zt.registerFlag("WEBGL_VERSION",(function(){return Dw(2)?2:Dw(1)?1:0})),Zt.registerFlag("WEBGL_BUFFER_SUPPORTED",(function(){return Zt.get("WEBGL_VERSION")===2})),Zt.registerFlag("WEBGL_CPU_FORWARD",(function(){return!0})),Zt.registerFlag("WEBGL_FORCE_F16_TEXTURES",(function(){return!1})),Zt.registerFlag("WEBGL_PACK",(function(){return Zt.getBool("HAS_WEBGL")})),Zt.registerFlag("WEBGL_PACK_NORMALIZATION",(function(){return Zt.getBool("WEBGL_PACK")})),Zt.registerFlag("WEBGL_PACK_CLIP",(function(){return Zt.getBool("WEBGL_PACK")})),Zt.registerFlag("WEBGL_PACK_DEPTHWISECONV",(function(){return!1})),Zt.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",(function(){return Zt.getBool("WEBGL_PACK")})),Zt.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",(function(){return Zt.getBool("WEBGL_PACK")})),Zt.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",(function(){return Zt.getBool("WEBGL_PACK")})),Zt.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",(function(){return Zt.getBool("WEBGL_PACK")})),Zt.registerFlag("WEBGL_PACK_REDUCE",(function(){return Zt.getBool("WEBGL_PACK")})),Zt.registerFlag("WEBGL_LAZILY_UNPACK",(function(){return Zt.getBool("WEBGL_PACK")})),Zt.registerFlag("WEBGL_CONV_IM2COL",(function(){return Zt.getBool("WEBGL_PACK")})),Zt.registerFlag("WEBGL_MAX_TEXTURE_SIZE",(function(){return H3(Zt.getNumber("WEBGL_VERSION"))})),Zt.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",(function(){return q3(Zt.getNumber("WEBGL_VERSION"))})),Zt.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",(function(){var r=Zt.getNumber("WEBGL_VERSION");return r===0?0:j3(r)})),Zt.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",(function(){return Zt.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(r=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(r)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(r.substr(0,4))));var r})),Zt.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",(function(){return X3(Zt.getNumber("WEBGL_VERSION"))})),Zt.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",(function(){return!Zt.getBool("WEBGL_FORCE_F16_TEXTURES")&&Zt.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")})),Zt.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",(function(){return K3(Zt.getNumber("WEBGL_VERSION"))})),Zt.registerFlag("WEBGL_FENCE_API_ENABLED",(function(){return Y3(Zt.getNumber("WEBGL_VERSION"))})),Zt.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",(function(){return Zt.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0})),RS=TS;var Kn=tt({complex_:function(r,t){var e=z(r,"real","complex"),n=z(t,"imag","complex");return Re(e.shape,n.shape,"real and imag shapes, "+e.shape+" and "+n.shape+", must match in call to tf.complex()."),rt.runKernelFunc((function(a){return a.complex(e,n)}),{$real:e,$imag:n})}}),va=tt({real_:function(r){var t=z(r,"input","real");return rt.runKernelFunc((function(e){return e.real(t)}),{$input:t})}}),ci=tt({imag_:function(r){var t=z(r,"input","imag");return rt.runKernelFunc((function(e){return e.imag(t)}),{$input:t})}});function Qn(r,t,e){return nu(r,t,eu(r,e),e)}function nu(r,t,e,n){if(n==null&&(n=th(r)),n==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!pi(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(t!=null){ES(t);var a=Ot(t),i=Ot(e);G(a===i,(function(){return"Based on the provided shape, ["+t+"], the tensor should have "+a+" values but has "+i}));for(var o=0;o<e.length;++o){var u=e[o],l=o!==e.length-1||u!==Ot(t.slice(o));G(e[o]===t[o]||!l,(function(){return"Error creating a new Tensor. Inferred shape ("+e+") does not match the provided shape ("+t+"). "}))}}return pi(r)||Array.isArray(r)||(r=[r]),t=t||e,r=n!=="string"?bS(r,n,yt().getBool("DEBUG")):sl(r,[],!0),rt.makeTensor(r,t,n)}function Ut(r,t){if((pi(r)&&t!=="string"||Array.isArray(r))&&t!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(t==="string"&&pi(r)&&!(r instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return nu(r,[],[],t)}function za(r,t){bl(r);var e=eu(r,t);if(e.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return nu(r,null,e,t)}function Mu(r,t,e){if(bl(r),t!=null&&t.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var n=eu(r,e);if(n.length!==2&&n.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(n.length===1&&t==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return nu(r,t,n,e)}function DS(r,t,e){if(bl(r),t!=null&&t.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var n=eu(r,e);if(n.length!==3&&n.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(n.length===1&&t==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return nu(r,t,n,e)}function si(r,t,e){if(bl(r),t!=null&&t.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var n=eu(r,e);if(n.length!==4&&n.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(n.length===1&&t==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return nu(r,t,n,e)}function J3(r,t,e){if(bl(r),t!=null&&t.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var n=eu(r,e);if(n.length!==5&&n.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(n.length===1&&t==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return nu(r,t,n,e)}function tW(r,t,e){if(bl(r),t!=null&&t.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var n=eu(r,e);if(n.length!==6&&n.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(n.length===1&&t==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return nu(r,t=t||n,n,e)}function eW(r,t,e,n){return t===void 0&&(t=!0),rt.makeVariable(r,t,e,n)}function wl(r,t){if(t===void 0&&(t="float32"),t==="complex64"){var e=wl(r,"float32"),n=sn(r,"float32");return Kn(e,n)}var a=wS(Ot(r),t);return rt.makeTensor(a,r,t)}function sn(r,t){if(t===void 0&&(t="float32"),t==="complex64"){var e=sn(r,"float32"),n=sn(r,"float32");return Kn(e,n)}var a=eh(Ot(r),t);return rt.makeTensor(a,r,t)}function Bu(r,t,e){return rt.runKernelFunc((function(n){return n.fill(r,t,e)}),{})}function nW(r,t,e){if(e<=0)throw new Error("The number of values should be positive.");return rt.runKernelFunc((function(n){return n.linspace(r,t,e)}),{})}function cd(r,t,e,n){if(e===void 0&&(e=1),n===void 0&&(n="float32"),e===0)throw new Error("Cannot have a step of zero");if(r===t||r<t&&e<0||t<r&&e>1)return sn([0],n);var a=eh(Math.abs(Math.ceil((t-r)/e)),n);t<r&&e===1&&(e=-1),a[0]=r;for(var i=1;i<a.length;i++)a[i]=a[i-1]+e;return za(a,n)}var IS=tt({onesLike_:function(r){var t=z(r,"x","onesLike");if(t.dtype==="complex64"){var e=IS(va(t)),n=me(ci(t));return Kn(e,n)}return rt.runKernelFunc((function(a){return a.onesLike(t)}),{x:t},(function(a,i){return{x:function(){return me(a)}}}),"OnesLike")}}),me=tt({zerosLike_:function(r){var t=z(r,"x","zerosLike");return rt.runKernelFunc((function(e){return e.zerosLike(t)}),{x:t},(function(e,n){return{x:function(){return me(e)}}}),"ZerosLike")}}),wa=tt({concat_:function(r,t){t===void 0&&(t=0),G(r.length>=1,(function(){return"Pass at least one tensor to concat"}));var e=ld(r,"tensors","concat");e[0].dtype==="complex64"&&e.forEach((function(u){if(u.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `+u.dtype+". ")})),t=In(t,e[0].shape)[0];var n=hl(e.map((function(u){return u.shape})),t);if(Ot(n)===0)return Qn([],n);if((e=e.filter((function(u){return u.size>0}))).length===1)return e[0];var a=e.map((function(u){return u.shape}));$3(a,t);var i=e,o={axis:t};return rt.runKernelFunc((function(u){return u.concat(e,t)}),i,(function(u){var l=a.map((function(h){return h[t]}));return ry(u,l,t).map((function(h){return function(){return h}}))}),"Concat",o)}}),rW=tt({concat1d_:function(r){return wa(r,0)}}),aW=tt({concat2d_:function(r,t){return wa(r,t)}}),iW=tt({concat3d_:function(r,t){return wa(r,t)}}),oW=tt({concat4d_:function(r,t){return wa(r,t)}}),ry=tt({split_:function(r,t,e){e===void 0&&(e=0);var n,a=z(r,"x","split");return e=In(e,a.shape)[0],typeof t=="number"?(G(a.shape[e]%t==0,(function(){return"Number of splits must evenly divide the axis."})),n=new Array(t).fill(a.shape[e]/t)):(G(a.shape[e]===t.reduce((function(i,o){return i+o})),(function(){return"The sum of sizes must match the size of the axis dimension."})),n=t),rt.runKernelFunc((function(i){return i.split(a,n,e)}),{$x:a},(function(i){return{$x:function(){return wa(i,e)}}}))}});function ee(r,t,e){return t===void 0&&(t="float32"),t=t||"float32",ES(r),new Nc(r,t,e)}function uW(r,t){t===void 0&&(t=!1),console.log(r.toString(t))}var NS=tt({batchToSpaceND_:function(r,t,e){var n=z(r,"x","batchToSpaceND"),a=t.reduce((function(i,o){return i*o}));return G(n.rank>=1+t.length,(function(){return"input rank is "+n.rank+" but should be > than blockShape.length "+t.length})),G(e.length===t.length,(function(){return"crops.length is "+e.length+" but should be equal to blockShape.length  "+t.length})),G(n.shape[0]%a==0,(function(){return"input tensor batch is "+n.shape[0]+" but is not divisible by the product of the elements of blockShape "+t.join(" * ")+" === "+a})),rt.runKernelFunc((function(i){return i.batchToSpaceND(n,t,e)}),{$x:n},(function(i){return{$x:function(){return i.spaceToBatchND(t,e)}}}))}}),sW=tt({cast_:function(r,t){var e=z(r,"x","cast");if(!c3(t))throw new Error("Failed to cast to unknown dtype "+t);if(t==="string"&&e.dtype!=="string"||t!=="string"&&e.dtype==="string")throw new Error("Only strings can be casted to strings");var n={dtype:t};return rt.runKernelFunc((function(a){return a.cast(e,t)}),{x:e},(function(a){return{x:function(){return a.clone()}}}),"Cast",n)}}),lW=tt({cumsum_:function(r,t,e,n){t===void 0&&(t=0),e===void 0&&(e=!1),n===void 0&&(n=!1);var a=z(r,"x","cumsum"),i=Si([t|=0],a.rank),o=a;i!=null&&(o=a.transpose(i));var u=Ri(1,a.rank)[0],l=rt.runKernelFunc((function(h){return h.cumsum(o,u,e,n)}),{permutedX:o},(function(h){return{permutedX:function(){return h.cumsum(t,e,!n)}}}));return i!=null&&(l=l.transpose(i)),l}}),cW=tt({depthToSpace_:function(r,t,e){e===void 0&&(e="NHWC");var n=z(r,"x","depthToSpace"),a=e==="NHWC"?n.shape[1]:n.shape[2],i=e==="NHWC"?n.shape[2]:n.shape[3],o=e==="NHWC"?n.shape[3]:n.shape[1];return G(a*t>=0,(function(){return`Negative dimension size caused by overflow when multiplying
      `+a+" and "+t+`  for depthToSpace with input shape
      `+n.shape})),G(i*t>=0,(function(){return`Negative dimension size caused by overflow when multiplying
      `+i+" and "+t+` for depthToSpace with input shape
          `+n.shape})),G(o%(t*t)==0,(function(){return"Dimension size must be evenly divisible by "+t*t+" but is "+o+" for depthToSpace with input shape "+n.shape})),rt.runKernelFunc((function(u){return u.depthToSpace(n,t,e)}),{$x:n})}}),zo=tt({expandDims_:function(r,t){t===void 0&&(t=0);var e=z(r,"x","expandDims",null);G(t<=e.rank,(function(){return"Axis must be <= rank of the tensor"}));var n=e.shape.slice();return t<0&&(G(-(e.rank+1)<=t,(function(){return"Axis must be in the interval ["+-(e.rank+1)+", "+e.rank+"]"})),t=e.rank+t+1),n.splice(t,0,1),Xi(e,n)}}),Xi=tt({reshape_:function(r,t){var e=z(r,"x","reshape",null);t=s3(t,e.size),G(e.size===Ot(t),(function(){return"new shape and old shape must have the same number of elements."}));var n={shape:t};return rt.runKernelFunc((function(a){return a.reshape(e,t)}),{x:e},(function(a){return{x:function(){return a.reshape(e.shape)}}}),"Reshape",n)}}),OS=tt({spaceToBatchND_:function(r,t,e){var n=z(r,"x","spaceToBatchND");return G(n.rank>=1+t.length,(function(){return"input rank "+n.rank+" should be > than [blockShape] "+t.length})),G(e.length===t.length,(function(){return"paddings.shape[0] "+e.length+" must be equal to [blockShape] "+t.length})),G(n.shape.reduce((function(a,i,o){return o>0&&o<=t.length?a&&(i+e[o-1][0]+e[o-1][1])%t[o-1]==0:a}),!0),(function(){return"input spatial dimensions "+n.shape.slice(1)+" with paddings "+e.toString()+" must be divisible by blockShapes "+t.toString()})),rt.runKernelFunc((function(a){return a.spaceToBatchND(n,t,e)}),{$x:n},(function(a){return{$x:function(){return a.batchToSpaceND(t,e)}}}))}}),MS=tt({squeeze_:function(r,t){var e=z(r,"x","squeeze");return Xi(e,ku(e.shape,t).newShape)}}),Yo=tt({stack_:function(r,t){t===void 0&&(t=0);var e=ld(r,"tensors","stack");if(G(e.length>=1,(function(){return"Pass at least one tensor to tf.stack"})),e.length===1)return e[0].expandDims(t);var n=e[0].rank,a=e[0].shape,i=e[0].dtype;G(t<=n,(function(){return"Axis must be <= rank of the tensor"})),e.forEach((function(u){Re(a,u.shape,"All tensors passed to stack must have matching shapes")})),e.forEach((function(u){G(i===u.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var o=e.map((function(u){return u.expandDims(t)}));return wa(o,t)}}),Id=tt({unstack_:function(r,t){t===void 0&&(t=0),t=t||0;var e=z(r,"x","unstack");G(t>=-e.shape.length&&t<e.shape.length,(function(){return"Axis = "+t+" is not in [-"+e.shape.length+", "+e.shape.length+")"})),t<0&&(t+=e.shape.length);var n={axis:t};return rt.runKernelFunc((function(a){return a.unstack(e,t)}),{x:e},(function(a){return{x:function(){return Yo(a,t)}}}),"Unpack",n)}}),hW=function(r,t){return Mt(this,void 0,void 0,(function(){var e,n,a,i,o,u,l,h,f,p;return Bt(this,(function(v){switch(v.label){case 0:return e=z(r,"x","setdiff1d"),n=z(t,"y","setdiff1d"),G(e.dtype===n.dtype,(function(){return"x and y should have the same dtype, but got x ("+e.dtype+") and y ("+n.dtype+")."})),G(e.rank===1,(function(){return"x should be 1D tensor, but got x ("+e.shape+")."})),G(n.rank===1,(function(){return"y should be 1D tensor, but got y ("+n.shape+")."})),[4,e.data()];case 1:return a=v.sent(),[4,n.data()];case 2:for(i=v.sent(),o=new Set(i),u=0,f=0;f<a.length;f++)o.has(a[f])||u++;for(l=new Nc([u],e.dtype),h=new Nc([u],"int32"),f=0,p=0;f<a.length;f++)o.has(a[f])||(l.values[p]=a[f],h.values[p]=f,p++);return[2,[l.toTensor(),h.toTensor()]]}}))}))};function hd(r,t,e,n){n===void 0&&(n=!0);var a=[];if(n)(a=a.concat(t.slice(0))).push(r[0]/e),a=a.concat(r.slice(1));else{a=a.concat(r[0]);for(var i=t.length,o=0;o<i;++o)a=a.concat([r[o+1]/t[o],t[o]]);a=a.concat(r.slice(i+1))}return a}function fd(r,t,e){e===void 0&&(e=!0);var n=[];if(e){n.push(t);for(var a=t+1;a<r;++a)a<=2*t?(n.push(a),n.push(a-(t+1))):n.push(a)}else{var i=[],o=[];for(a=1;a<r;++a)a>=2*t+1||a%2==1?o.push(a):i.push(a);n.push.apply(n,i),n.push(0),n.push.apply(n,o)}return n}function dd(r,t,e,n){n===void 0&&(n=!0);var a=[];n?a.push(r[0]/e):a.push(r[0]*e);for(var i=1;i<r.length;++i)i<=t.length?n?a.push(t[i-1]*r[i]):a.push(r[i]/t[i-1]):a.push(r[i]);return a}function BS(r,t){for(var e=[0],n=0;n<t;++n)e.push(r[n][0]);return e}function PS(r,t,e){for(var n=r.slice(0,1),a=0;a<e;++a)n.push(r[a+1]-t[a][0]-t[a][1]);return n}var FS="Add",Nd="Div",Od="SquaredDifference",LS="BroadcastTo",zS="OneHot",US="Identity",WS="Tile",VS="PadV2",Ea=tt({add_:function(r,t){var e,n=z(r,"a","add"),a=z(t,"b","add");e=Qe(n,a),n=e[0],a=e[1];var i={a:n,b:a};return rt.runKernelFunc((function(o,u){var l=o.add(n,a);return u([n,a]),l}),i,null,FS)}});function Go(r,t){for(var e=r.length,n=[],a=0;a<e;a++){var i=e-1-a,o=r[i]||1;(t[t.length-1-a]||1)>1&&o===1&&n.unshift(i)}return n}function Tn(r,t){for(var e=[],n=0;n<t.length;n++){var a=r[r.length-n-1],i=t.length-n-1,o=t[i];(a==null||a===1&&o>1)&&e.unshift(i)}return e}function he(r,t){for(var e=[],n=Math.max(r.length,t.length),a=0;a<n;a++){var i=r[r.length-a-1];i==null&&(i=1);var o=t[t.length-a-1];if(o==null&&(o=1),i===1)e.unshift(o);else if(o===1)e.unshift(i);else{if(i!==o)throw Error("Operands could not be broadcast together with shapes "+r+" and "+t+".");e.unshift(i)}}return e}var fW=tt({abs_:function(r){var t=z(r,"x","abs");return t.dtype==="complex64"?rt.runKernelFunc((function(e){return e.complexAbs(t)}),{$x:t}):rt.runKernelFunc((function(e,n){var a=e.abs(t);return n([t]),a}),{x:t},(function(e,n){var a=n[0];return{x:function(){return e.mul(a.toFloat().step(-1))}}}),"Abs")}}),dW=tt({acos_:function(r){var t=z(r,"x","acos");return rt.runKernelFunc((function(e,n){var a=e.acos(t);return n([t]),a}),{$x:t},(function(e,n){var a=n[0];return{$x:function(){return e.divStrict(Ut(1).sub(a.toFloat().square()).sqrt()).neg()}}}))}}),pW=tt({acosh_:function(r){var t=z(r,"x","acosh");return rt.runKernelFunc((function(e,n){var a=e.acosh(t);return n([t]),a}),{$x:t},(function(e,n){var a=n[0];return{$x:function(){return e.divStrict(a.toFloat().square().sub(1).sqrt())}}}))}}),vW=tt({asin_:function(r){var t=z(r,"x","asin");return rt.runKernelFunc((function(e,n){var a=e.asin(t);return n([t]),a}),{$x:t},(function(e,n){var a=n[0];return{$x:function(){return e.divStrict(Ut(1).sub(a.toFloat().square()).sqrt())}}}))}}),mW=tt({asinh_:function(r){var t=z(r,"x","asinh");return rt.runKernelFunc((function(e,n){var a=e.asinh(t);return n([t]),a}),{$x:t},(function(e,n){var a=n[0];return{$x:function(){return e.divStrict(Ut(1).add(a.toFloat().square()).sqrt())}}}))}}),gW=tt({atan_:function(r){var t=z(r,"x","atan");return rt.runKernelFunc((function(e,n){var a=e.atan(t);return n([t]),a}),{$x:t},(function(e,n){var a=n[0];return{$x:function(){return e.div(a.toFloat().square().add(1))}}}))}}),yW=tt({atanh_:function(r){var t=z(r,"x","atanh");return rt.runKernelFunc((function(e,n){var a=e.atanh(t);return n([t]),a}),{$x:t},(function(e,n){var a=n[0];return{$x:function(){return e.div(Ut(1).sub(a.toFloat().square()))}}}))}}),xW=tt({ceil_:function(r){var t=z(r,"x","ceil");return rt.runKernelFunc((function(e){return e.ceil(t)}),{$x:t},(function(e){return{$x:function(){return me(e)}}}))}}),bW=tt({clipByValue_:function(r,t,e){var n=z(r,"x","clipByValue");G(t<=e,(function(){return"Error in clip: min ("+t+") must be less than or equal to max ("+e+")."}));var a=[n],i={min:t,max:e};return rt.runKernelFunc((function(o,u){var l=o.clip(n,t,e);return u([n]),l}),{x:n},(function(o,u){var l=u[0];return{x:function(){return o.where(l.greaterEqual(t).logicalAnd(l.lessEqual(e)),me(o))}}}),"ClipByValue",i,a)}}),wW=tt({cos_:function(r){var t=z(r,"x","cos"),e=[t];return rt.runKernelFunc((function(n,a){var i=n.cos(t);return a([t]),i}),{x:t},(function(n,a){var i=a[0];return{x:function(){return i.toFloat().sin().neg().mul(n)}}}),"Cos",{},e)}}),EW=tt({cosh_:function(r){var t=z(r,"x","cosh");return rt.runKernelFunc((function(e,n){var a=e.cosh(t);return n([t]),a}),{$x:t},(function(e,n){var a=n[0];return{$x:function(){return a.toFloat().sinh().mulStrict(e)}}}))}}),CW=tt({erf_:function(r){var t=z(r,"x","erf");return G(t.dtype==="int32"||t.dtype==="float32",(function(){return"Input dtype must be `int32` or `float32`."})),t.dtype==="int32"&&(t=t.toFloat()),rt.runKernelFunc((function(e,n){var a=e.erf(t);return n([t]),a}),{$x:t},(function(e,n){var a=n[0];return{$x:function(){return e.mul(a.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}}))}}),SW=tt({exp_:function(r){var t=z(r,"x","exp");return rt.runKernelFunc((function(e,n){var a=e.exp(t);return n([a]),a}),{x:t},(function(e,n){return{x:function(){return e.mulStrict(n[0])}}}),"Exp",{},[],[!0])}}),RW=tt({expm1_:function(r){var t=z(r,"x","expm1");return rt.runKernelFunc((function(e,n){var a=e.expm1(t);return n([t]),a}),{$x:t},(function(e,n){var a=n[0];return{$x:function(){return e.mul(a.exp())}}}))}}),_W=tt({floor_:function(r){var t=z(r,"x","floor");return rt.runKernelFunc((function(e){return e.floor(t)}),{$x:t},(function(e){return{$x:function(){return me(e)}}}))}}),AW=tt({log_:function(r){var t=z(r,"x","log"),e=[t];return rt.runKernelFunc((function(n,a){var i=n.log(t);return a([t]),i}),{x:t},(function(n,a){var i=a[0];return{x:function(){return n.div(i.toFloat())}}}),"Log",{},e)}}),TW=tt({log1p_:function(r){var t=z(r,"x","log1p");return rt.runKernelFunc((function(e,n){var a=e.log1p(t);return n([t]),a}),{$x:t},(function(e,n){var a=n[0];return{$x:function(){return e.div(a.add(1))}}}))}}),kW=tt({logSigmoid_:function(r){var t=z(r,"x","logSigmoid");return rt.runKernelFunc((function(e,n){var a=e.softplus(t.neg()).neg();return n([t]),a}),{$x:t},(function(e,n){var a=n[0];return{$x:function(){return e.mul(a.neg().sigmoid())}}}))}}),ay=tt({neg_:function(r){var t=z(r,"x","neg"),e=[t];return rt.runKernelFunc((function(n){return n.neg(t)}),{x:t},(function(n){return{x:function(){return n.neg()}}}),"Neg",{},e)}}),DW=tt({reciprocal_:function(r){var t=z(r,"x","reciprocal");return rt.runKernelFunc((function(e,n){var a=e.reciprocal(t);return n([t]),a}),{$x:t},(function(e,n){var a=n[0];return{$x:function(){return e.div(a.square().neg())}}}))}}),IW=tt({round_:function(r){var t=z(r,"x","round");return rt.runKernelFunc((function(e){return e.round(t)}),{$x:t},(function(e){return{$x:function(){return me(e)}}}))}}),GS=tt({rsqrt_:function(r){var t=z(r,"x","rsqrt"),e=[t];return rt.runKernelFunc((function(n,a){var i=n.rsqrt(t);return a([t]),i}),{x:t},(function(n,a){var i=a[0];return{x:function(){return n.div(i.pow(1.5).mul(2)).neg()}}}),"Rsqrt",{},e)}}),NW=tt({sigmoid_:function(r){var t=z(r,"x","sigmoid");return rt.runKernelFunc((function(e,n){var a=e.sigmoid(t);return n([a]),a}),{x:t},(function(e,n){var a=n[0];return{x:function(){return e.mul(a.mul(Ut(1).sub(a)))}}}),"Sigmoid")}}),OW=tt({sign_:function(r){var t=z(r,"x","sign");return rt.runKernelFunc((function(e){return e.sign(t)}),{$x:t},(function(e){return{$x:function(){return me(e)}}}))}}),MW=tt({isNaN_:function(r){var t=z(r,"x","isNaN");return rt.runKernelFunc((function(e){return e.isNaN(t)}),{$x:t},(function(e){return{$x:function(){return me(e)}}}))}}),BW=tt({isInf_:function(r){var t=z(r,"x","isInf");return rt.runKernelFunc((function(e){return e.isInf(t)}),{$x:t},(function(e){return{$x:function(){return me(e)}}}))}}),PW=tt({isFinite_:function(r){var t=z(r,"x","isFinite");return rt.runKernelFunc((function(e){return e.isFinite(t)}),{$x:t},(function(e){return{$x:function(){return me(e)}}}))}}),FW=tt({sin_:function(r){var t=z(r,"x","sin"),e=[t];return rt.runKernelFunc((function(n,a){var i=n.sin(t);return a([t]),i}),{x:t},(function(n,a){var i=a[0];return{x:function(){return i.toFloat().cos().mul(n)}}}),"Sin",{},e)}}),LW=tt({sinh_:function(r){var t=z(r,"x","sinh");return rt.runKernelFunc((function(e,n){var a=e.sinh(t);return n([t]),a}),{$x:t},(function(e,n){var a=n[0];return{$x:function(){return a.toFloat().cosh().mulStrict(e)}}}))}}),zW=tt({softplus_:function(r){var t=z(r,"x","softplus");return rt.runKernelFunc((function(e,n){var a=e.softplus(t);return n([t]),a}),{$x:t},(function(e,n){var a=n[0];return{$x:function(){return e.mul(a.sigmoid())}}}))}}),UW=tt({sqrt_:function(r){var t=z(r,"x","sqrt");return rt.runKernelFunc((function(e,n){var a=e.sqrt(t);return n([t]),a}),{$x:t},(function(e,n){var a=n[0];return{$x:function(){return e.div(a.toFloat().sqrt().mul(2))}}}))}}),WW=tt({step_:function(r,t){t===void 0&&(t=0);var e=z(r,"x","step");return rt.runKernelFunc((function(n){return n.step(e,t)}),{$x:e},(function(n){return{$x:function(){return me(n)}}}))}}),VW=tt({tan_:function(r){var t=z(r,"x","tan");return rt.runKernelFunc((function(e,n){var a=e.tan(t);return n([t]),a}),{$x:t},(function(e,n){var a=n[0];return{$x:function(){return e.div(a.cos().square())}}}))}}),GW=tt({tanh_:function(r){var t=z(r,"x","tanh");return rt.runKernelFunc((function(e,n){var a=e.tanh(t);return n([a]),a}),{x:t},(function(e,n){var a=n[0];return{x:function(){return Ut(1).sub(a.square()).mulStrict(e)}}}),"Tanh",{},null,[!0])}}),HW=tt({addStrict_:function(r,t){var e=z(r,"a","addStrict"),n=z(t,"b","addStrict");return Re(e.shape,n.shape,"Error in addStrict: "),e.add(n)}}),qW=tt({atan2_:function(r,t){var e,n=z(r,"a","atan2"),a=z(t,"b","atan2");e=Qe(n,a),n=e[0],a=e[1];var i=he(n.shape,a.shape);return rt.runKernelFunc((function(o,u){var l=o.atan2(n,a);return u([n,a]),l}),{$a:n,$b:a},(function(o,u){var l=u[0],h=u[1];return{$a:function(){var f=Ea(l.square(),h.square()),p=o.mul(h.div(f)),v=Tn(l.shape,i);return v.length>0&&(p=p.sum(v)),p.reshape(l.shape)},$b:function(){var f=Ea(l.square(),h.square()),p=ay(o.mul(l.div(f))),v=Tn(h.shape,i);return v.length>0&&(p=p.sum(v)),p.reshape(h.shape)}}}))}}),jW=tt({divStrict_:function(r,t){var e=z(r,"a","div"),n=z(t,"b","div");return Re(e.shape,n.shape,"Error in divideStrict: "),e.div(n)}}),HS=tt({floorDiv_:function(r,t){var e,n=z(r,"a","floorDiv"),a=z(t,"b","floorDiv");e=Qe(n,a),n=e[0],a=e[1];var i=he(n.shape,a.shape);return rt.runKernelFunc((function(o,u){var l=o.floorDiv(n,a);return u([n,a]),l}),{a:n,b:a},(function(o,u){var l=u[0],h=u[1];return{a:function(){var f=o.div(h.toFloat()),p=Tn(l.shape,i);return p.length>0?f.sum(p).reshape(l.shape):f},b:function(){var f=o.mul(l.toFloat()),p=Tn(h.shape,i);p.length>0&&(f=f.sum(p).reshape(h.shape));var v=h.square();return f.div(v.toFloat()).neg()}}}),"FloorDiv")}}),iy=tt({maximum_:function(r,t){var e,n=z(r,"a","maximum"),a=z(t,"b","maximum");return e=Qe(n,a),n=e[0],a=e[1],n.dtype==="bool"&&(n=n.toInt(),a=a.toInt()),he(n.shape,a.shape),rt.runKernelFunc((function(i,o){var u=i.maximum(n,a);return o([n,a]),u}),{a:n,b:a},(function(i,o){var u=o[0],l=o[1];return{a:function(){return i.mul(u.greaterEqual(l).toFloat())},b:function(){return i.mul(u.less(l).toFloat())}}}),"Maximum")}}),XW=tt({maximumStrict_:function(r,t){var e=z(r,"a","maximumStrict"),n=z(t,"b","maximumStrict");return Re(e.shape,n.shape,"Error in maximumStrict: "),e.maximum(n)}}),qS=tt({minimum_:function(r,t){var e,n=z(r,"a","minimum"),a=z(t,"b","minimum");return e=Qe(n,a),n=e[0],a=e[1],n.dtype==="bool"&&(n=n.toInt(),a=a.toInt()),he(n.shape,a.shape),rt.runKernelFunc((function(i,o){var u=i.minimum(n,a);return o([n,a]),u}),{a:n,b:a},(function(i,o){var u=o[0],l=o[1];return{a:function(){return i.mul(u.lessEqual(l).toFloat())},b:function(){return i.mul(u.greater(l).toFloat())}}}),"Minimum")}}),KW=tt({minimumStrict_:function(r,t){var e=z(r,"a","minimumStrict"),n=z(t,"b","minimumStrict");return Re(e.shape,n.shape,"Error in minimumStrict: "),e.minimum(n)}}),YW=tt({mod_:function(r,t){var e,n=z(r,"a","mod"),a=z(t,"b","mod");e=Qe(n,a),n=e[0],a=e[1];var i=he(n.shape,a.shape);return rt.runKernelFunc((function(o,u){var l=o.mod(n,a);return u([n,a]),l}),{$a:n,$b:a},(function(o,u){var l=u[0],h=u[1];return{$a:function(){var f=Tn(l.shape,i);return f.length>0?o.sum(f).reshape(l.shape):o},$b:function(){var f=o.mul(l.div(h).floor().neg()),p=Tn(h.shape,i);return p.length>0?f.sum(p).reshape(h.shape):f}}}))}}),QW=tt({modStrict_:function(r,t){var e=z(r,"a","modStrict"),n=z(t,"b","modStrict");return Re(e.shape,n.shape,"Error in modStrict: "),e.mod(n)}}),un=tt({mul_:function(r,t){var e,n=z(r,"a","mul"),a=z(t,"b","mul");e=Qe(n,a),n=e[0],a=e[1];var i=he(n.shape,a.shape);return rt.runKernelFunc((function(o,u){var l=o.multiply(n,a);return u([n,a]),l}),{a:n,b:a},(function(o,u){var l=u[0],h=u[1];return{a:function(){var f=o.mul(h.toFloat()),p=Tn(l.shape,i);return p.length>0?f.sum(p).reshape(l.shape):f},b:function(){var f=o.mul(l.toFloat()),p=Tn(h.shape,i);return p.length>0?f.sum(p).reshape(h.shape):f}}}),"Mul")}}),ZW=tt({mulStrict_:function(r,t){var e=z(r,"a","mul"),n=z(t,"b","mul");return Re(e.shape,n.shape,"Error in multiplyStrict: "),e.mul(n)}}),pd=tt({pow_:function(r,t){var e,n=z(r,"base","pow"),a=z(t,"exp","pow");e=Qe(n,a),n=e[0],a=e[1];var i=he(n.shape,a.shape),o=[n,a];return rt.runKernelFunc((function(u,l){var h=u.pow(n,a);return l([n,a,h]),h}),{a:n,b:a},(function(u,l){var h=l[0],f=l[1],p=l[2];return{a:function(){var v=f.toFloat(),m=u.mul(v.mul(h.pow(v.sub(Ut(1))))),x=Tn(h.shape,i);return x.length>0&&(m=m.sum(x)),m.reshape(h.shape)},b:function(){var v=h.greater(0),m=h.log().where(v,me(h)),x=u.mul(p.mul(m)),b=Tn(f.shape,i);return b.length>0&&(x=x.sum(b)),x.reshape(f.shape)}}}),"Pow",{},o,[!0])}}),$W=tt({powStrict_:function(r,t){return Re(r.shape,t.shape,"Error in powStrict: "),r.pow(t)}}),JW=tt({squaredDifferenceStrict_:function(r,t){var e=z(r,"a","squaredDifferenceStrict"),n=z(t,"b","squaredDifferenceStrict");return Re(e.shape,n.shape,"Error in squaredDifferenceStrict: "),e.squaredDifference(n)}}),Fa=tt({sub_:function(r,t){var e,n=z(r,"a","sub"),a=z(t,"b","sub");e=Qe(n,a),n=e[0],a=e[1];var i=he(n.shape,a.shape);return rt.runKernelFunc((function(o){return o.subtract(n,a)}),{a:n,b:a},(function(o){return{a:function(){var u=o,l=Tn(n.shape,i);return l.length>0&&(u=u.sum(l)),u.reshape(n.shape)},b:function(){var u=o,l=Tn(a.shape,i);return l.length>0&&(u=u.sum(l)),u.neg().reshape(a.shape)}}}),"Sub")}}),tV=tt({subStrict_:function(r,t){var e=z(r,"a","subStrict"),n=z(t,"b","subStrict");return Re(e.shape,n.shape,"Error in subStrict: "),e.sub(n)}}),Qo=tt({div_:function(r,t){var e,n=z(r,"a","div"),a=z(t,"b","div");if(e=Qe(n,a),n=e[0],a=e[1],n.dtype==="int32"&&a.dtype==="int32")return HS(n,a);var i={a:n,b:a};return rt.runKernelFunc((function(o,u){var l=o.realDivide(n,a);return u([n,a]),l}),i,null,Nd,{})}});function jS(r,t){if(r.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+r.rank+".");if(t.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if(t.dtype!=="int32")throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+t.dtype+".");if(t.shape[t.rank-1]>r.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+t.shape[t.rank-1]+" vs. "+r.rank);if(r.size===0)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+r.shape+".");for(var e=t.shape,n=e[e.length-1],a=1,i=0;i<e.length-1;++i)a*=e[i];var o=r.shape,u=e.slice();u.pop();var l=1;for(i=n;i<r.rank;++i)l*=o[i],u.push(o[i]);var h=$r(r.shape).map((function(f){return f/l})).concat([1]).slice(0,n);return[u,a,l,h]}var XS=30;function Tm(r){return r<=XS?r:gg(r,Math.floor(Math.sqrt(r)))}function eV(r,t,e){var n=t.rank>1?t.shape[t.rank-1]:1,a=t.rank>1?t.rank-1:1,i="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+e.shape+", indices.shape: "+t.shape+", shape: "+r+", sliceDim: "+n+", and batchDim: "+a+".";if(e.rank<a)throw new Error(i+" update.rank < "+a+". ");if(r.length<n+(e.rank-a))throw new Error(i+" Output shape length < "+(n+(e.rank-a)));if(e.rank!==a+r.length-n)throw new Error(i+" update.rank != "+(a+r.length-n));for(var o=0;o<a;++o)if(e.shape[o]!==t.shape[o])throw new Error(i+" updates.shape["+o+"] ("+e.shape[o]+") != indices.shape["+o+"] ("+t.shape[o]+").");for(o=0;o<e.rank-a;++o)if(e.shape[o+a]!==r[o+n])throw new Error(i+" updates.shape["+(o+a)+"] ("+e.shape[o+a]+") != shape["+(o+a)+"] ("+r[o+a]+")")}function nV(r,t,e){if(t.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if(r.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+r.rank+".");if(t.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: "+t.dtype);if(e.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+e);if(e.length===0){if(t.size===0)throw new Error("Indices specified for empty output. indices shape: "+t.shape);if(r.size===0)throw new Error("Updates specified for empty output. updates shape: "+r.shape)}eV(e,t,r)}function vd(r,t,e){for(var n=t.shape.length,a=n>1?t.shape[n-1]:1,i=e.length,o=1,u=a;u<i;++u)o*=e[u];var l=a<1?1:a;return{sliceRank:a,numUpdates:Ot(t.shape)/l,sliceSize:o,strides:$r(e.slice(0,a)).concat([1]),outputSize:Ot(e)}}function rV(r,t,e){G(r.rank===t.length,(function(){return"Error in slice"+r.rank+"D: Length of begin "+t+" must match the rank of the array ("+r.rank+")."})),G(r.rank===e.length,(function(){return"Error in slice"+r.rank+"D: Length of size "+e+" must match the rank of the array ("+r.rank+")."}));for(var n=function(i){G(t[i]+e[i]<=r.shape[i],(function(){return"Error in slice"+r.rank+"D: begin["+i+"] + size["+i+"] ("+(t[i]+e[i])+") would overflow input.shape["+i+"] ("+r.shape[i]+")"}))},a=0;a<r.rank;++a)n(a)}function Nw(r){for(var t=[],e=0;r>0;)1&r&&t.push(e),r/=2,e++;return t}function oy(r,t,e){for(var n=[],a=0;a<r.length;a++)n[a]=Math.ceil((t[a]-r[a])/e[a]);return n}function aV(r,t,e,n,a){var i=t[a],o=e[a]||1;(r&1<<a||i==null)&&(i=o>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var u=n[a];return i<0&&(i+=u),i=pg(0,i,u-1)}function iV(r,t,e,n,a){var i=t[a],o=e[a]||1;(r&1<<a||i==null)&&(i=o>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var u=n[a];return i<0&&(i+=u),i=o>0?pg(0,i,u):pg(-1,i,u-1)}function KS(r,t,e){for(var n=e.length,a=0;a<e.length;a++)if(e[a]>1){n=a;break}for(a=n+1;a<e.length;a++)if(t[a]>0||e[a]!==r[a])return!1;return!0}function YS(r,t){for(var e=r.length>0?r[r.length-1]:1,n=0;n<r.length-1;n++)e+=r[n]*t[n];return e}function oV(r,t){G(mg(r),(function(){return"The f passed in variableGrads(f) must be a function"})),G(t==null||Array.isArray(t)&&t.every((function(f){return f instanceof cl})),(function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"}));var e=t!=null;if(!e)for(var n in t=[],rt.registeredVariables)t.push(rt.registeredVariables[n]);var a=e?t.filter((function(f){return!f.trainable})):null,i=t.length;G((t=t.filter((function(f){return f.trainable}))).length>0,(function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+i+" variables is trainable."}));var o=rt.gradients(r,t,null,!0),u=o.value,l=o.grads;G(l.some((function(f){return f!=null})),(function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."})),G(u.rank===0,(function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+u.rank+" tensor"}));var h={};return t.forEach((function(f,p){l[p]!=null&&(h[f.name]=l[p])})),a?.forEach((function(f){return h[f.name]=null})),{value:u,grads:h}}function Md(r){return rt.customGrad(r)}var Bd=tt({softmax_:function(r,t){t===void 0&&(t=-1);var e=z(r,"logits","softmax","float32");if(t===-1&&(t=e.rank-1),t!==e.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+e.rank+" and dim was "+t);return rt.runKernelFunc((function(n,a){var i=n.softmax(e,t);return a([i]),i}),{logits:e},(function(n,a){var i=a[0],o=n.mul(i);return{logits:function(){return o.sub(o.sum([t],!0).mul(i))}}}),"Softmax",{dim:t},[],[!0])}}),uV=tt({logSoftmax_:function(r,t){t===void 0&&(t=-1);var e=z(r,"logits","logSoftmax");if(t===-1&&(t=e.rank-1),t!==e.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+e.rank+" and axis was "+t);return Md((function(n,a){var i=n.max(t,!0),o=n.sub(i),u=o.toFloat().sub(o.exp().sum(t,!0).log());return a([u]),{value:u,gradFunc:function(l,h){var f=h[0].exp();return l.sub(l.sum(t,!0).mul(f))}}}))(e)}}),Ma=tt({transpose_:function(r,t){var e=z(r,"x","transpose");if(t==null&&(t=e.shape.map((function(a,i){return i})).reverse()),G(e.rank===t.length,(function(){return"Error in transpose: rank of input "+e.rank+" must match length of perm "+t+"."})),t.forEach((function(a){G(a>=0&&a<e.rank,(function(){return"All entries in 'perm' must be between 0 and "+(e.rank-1)+" but got "+t}))})),e.rank<=1)return e.clone();var n={perm:t};return rt.runKernelFunc((function(a){return a.transpose(e,t)}),{x:e},null,"Transpose",n)}}),QS=(function(){function r(t,e){this.backend=t,this.dataMover=e,this.data=new WeakMap,this.dataIdsCount=0}return r.prototype.get=function(t){return this.data.has(t)||this.dataMover.moveData(this.backend,t),this.data.get(t)},r.prototype.set=function(t,e){this.dataIdsCount++,this.data.set(t,e)},r.prototype.has=function(t){return this.data.has(t)},r.prototype.delete=function(t){return this.dataIdsCount--,this.data.delete(t)},r.prototype.numDataIds=function(){return this.dataIdsCount},r})(),ZS=(function(){function r(){}return r.prototype.time=function(t){return vt("time")},r.prototype.read=function(t){return vt("read")},r.prototype.readSync=function(t){return vt("readSync")},r.prototype.numDataIds=function(){return vt("numDataIds")},r.prototype.disposeData=function(t){return vt("disposeData")},r.prototype.write=function(t,e,n){return vt("write")},r.prototype.move=function(t,e,n,a){return vt("move")},r.prototype.memory=function(){return vt("memory")},r.prototype.floatPrecision=function(){return vt("floatPrecision")},r.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},r.prototype.batchMatMul=function(t,e,n,a){return vt("batchMatMul")},r.prototype.fusedBatchMatMul=function(t){return t.a,t.b,t.transposeA,t.transposeB,t.bias,t.activation,t.preluActivationWeights,vt("fusedBatchMatMul")},r.prototype.slice=function(t,e,n){return vt("slice")},r.prototype.stridedSlice=function(t,e,n,a){return vt("stridedSlice")},r.prototype.unstack=function(t,e){return vt("unstack")},r.prototype.reverse=function(t,e){return vt("reverse")},r.prototype.concat=function(t,e){return vt("concat")},r.prototype.neg=function(t){return vt("neg")},r.prototype.add=function(t,e){return vt("add")},r.prototype.addN=function(t){return vt("addN")},r.prototype.subtract=function(t,e){return vt("subtract")},r.prototype.multiply=function(t,e){return vt("multiply")},r.prototype.realDivide=function(t,e){return vt("realDivide")},r.prototype.floorDiv=function(t,e){return vt("floorDiv")},r.prototype.sum=function(t,e){return vt("sum")},r.prototype.prod=function(t,e){return vt("prod")},r.prototype.unsortedSegmentSum=function(t,e,n){return vt("unsortedSegmentSum")},r.prototype.argMin=function(t,e){return vt("argMin")},r.prototype.argMax=function(t,e){return vt("argMax")},r.prototype.equal=function(t,e){return vt("equal")},r.prototype.notEqual=function(t,e){return vt("notEqual")},r.prototype.less=function(t,e){return vt("less")},r.prototype.lessEqual=function(t,e){return vt("lessEqual")},r.prototype.greater=function(t,e){return vt("greater")},r.prototype.greaterEqual=function(t,e){return vt("greaterEqual")},r.prototype.logicalNot=function(t){return vt("logicalNot")},r.prototype.logicalAnd=function(t,e){return vt("logicalAnd")},r.prototype.logicalOr=function(t,e){return vt("logicalOr")},r.prototype.where=function(t){return vt("where")},r.prototype.select=function(t,e,n){return vt("select")},r.prototype.topk=function(t,e,n){return vt("topk")},r.prototype.min=function(t,e){return vt("min")},r.prototype.minimum=function(t,e){return vt("minimum")},r.prototype.mod=function(t,e){return vt("mod")},r.prototype.max=function(t,e){return vt("max")},r.prototype.maximum=function(t,e){return vt("maximum")},r.prototype.all=function(t,e){return vt("all")},r.prototype.any=function(t,e){return vt("any")},r.prototype.squaredDifference=function(t,e){return vt("squaredDifference")},r.prototype.ceil=function(t){return vt("ceil")},r.prototype.floor=function(t){return vt("floor")},r.prototype.round=function(t){return vt("round")},r.prototype.sign=function(t){return vt("sign")},r.prototype.isNaN=function(t){return vt("isNaN")},r.prototype.isInf=function(t){return vt("isInf")},r.prototype.isFinite=function(t){return vt("isFinite")},r.prototype.pow=function(t,e){return vt("pow")},r.prototype.exp=function(t){return vt("exp")},r.prototype.expm1=function(t){return vt("expm1")},r.prototype.softmax=function(t,e){return vt("softmax")},r.prototype.log=function(t){return vt("log")},r.prototype.log1p=function(t){return vt("log1p")},r.prototype.sqrt=function(t){return vt("sqrt")},r.prototype.rsqrt=function(t){return vt("rsqrt")},r.prototype.square=function(t){return vt("square")},r.prototype.reciprocal=function(t){return vt("reciprocal")},r.prototype.relu=function(t){return vt("relu")},r.prototype.relu6=function(t){return vt("relu6")},r.prototype.prelu=function(t,e){return vt("prelu")},r.prototype.elu=function(t){return vt("elu")},r.prototype.eluDer=function(t,e){return vt("eluDer")},r.prototype.selu=function(t){return vt("selu")},r.prototype.int=function(t){return vt("int")},r.prototype.clip=function(t,e,n){return vt("clip")},r.prototype.abs=function(t){return vt("abs")},r.prototype.complexAbs=function(t){return vt("complexAbs")},r.prototype.sigmoid=function(t){return vt("sigmoid")},r.prototype.softplus=function(t){return vt("softplus")},r.prototype.sin=function(t){return vt("sin")},r.prototype.cos=function(t){return vt("cos")},r.prototype.tan=function(t){return vt("tan")},r.prototype.asin=function(t){return vt("asin")},r.prototype.acos=function(t){return vt("acos")},r.prototype.atan=function(t){return vt("atan")},r.prototype.atan2=function(t,e){return vt("atan2")},r.prototype.sinh=function(t){return vt("sinh")},r.prototype.cosh=function(t){return vt("cosh")},r.prototype.tanh=function(t){return vt("tanh")},r.prototype.asinh=function(t){return vt("asinh")},r.prototype.acosh=function(t){return vt("acosh")},r.prototype.atanh=function(t){return vt("atanh")},r.prototype.erf=function(t){return vt("erf")},r.prototype.step=function(t,e){return vt("step")},r.prototype.fusedConv2d=function(t){return t.input,t.filter,t.convInfo,t.bias,t.activation,t.preluActivationWeights,vt("fusedConv2d")},r.prototype.conv2d=function(t,e,n){return vt("conv2d")},r.prototype.conv2dDerInput=function(t,e,n){return vt("conv2dDerInput")},r.prototype.conv2dDerFilter=function(t,e,n){return vt("conv2dDerFilter")},r.prototype.fusedDepthwiseConv2D=function(t){return t.input,t.filter,t.convInfo,t.bias,t.activation,t.preluActivationWeights,vt("fusedDepthwiseConv2D")},r.prototype.depthwiseConv2D=function(t,e,n){return vt("depthwiseConv2D")},r.prototype.depthwiseConv2DDerInput=function(t,e,n){return vt("depthwiseConv2DDerInput")},r.prototype.depthwiseConv2DDerFilter=function(t,e,n){return vt("depthwiseConv2DDerFilter")},r.prototype.conv3d=function(t,e,n){return vt("conv3d")},r.prototype.conv3dDerInput=function(t,e,n){return vt("conv3dDerInput")},r.prototype.conv3dDerFilter=function(t,e,n){return vt("conv3dDerFilter")},r.prototype.maxPool=function(t,e){return vt("maxPool")},r.prototype.maxPoolBackprop=function(t,e,n,a){return vt("maxPoolBackprop")},r.prototype.avgPool=function(t,e){return vt("avgPool")},r.prototype.avgPoolBackprop=function(t,e,n){return vt("avgPoolBackprop")},r.prototype.avgPool3d=function(t,e){return vt("avgPool3d")},r.prototype.avgPool3dBackprop=function(t,e,n){return vt("avgPool3dBackprop")},r.prototype.maxPool3d=function(t,e){return vt("maxPool3d")},r.prototype.maxPool3dBackprop=function(t,e,n,a){return vt("maxPool3dBackprop")},r.prototype.reshape=function(t,e){return vt("reshape")},r.prototype.cast=function(t,e){return vt("cast")},r.prototype.tile=function(t,e){return vt("tile")},r.prototype.pad=function(t,e,n){return vt("pad")},r.prototype.transpose=function(t,e){return vt("transpose")},r.prototype.gather=function(t,e,n){return vt("gather")},r.prototype.gatherND=function(t,e){return vt("gatherND")},r.prototype.scatterND=function(t,e,n){return vt("scatterND")},r.prototype.batchToSpaceND=function(t,e,n){return vt("batchToSpaceND")},r.prototype.spaceToBatchND=function(t,e,n){return vt("spaceToBatchND")},r.prototype.resizeBilinear=function(t,e,n,a){return vt("resizeBilinear")},r.prototype.resizeBilinearBackprop=function(t,e,n){return vt("resizeBilinearBackprop")},r.prototype.resizeNearestNeighbor=function(t,e,n,a){return vt("resizeNearestNeighbor")},r.prototype.resizeNearestNeighborBackprop=function(t,e,n){return vt("resizeNearestNeighborBackprop")},r.prototype.batchNormalization=function(t,e,n,a,i,o){return vt("batchNormalization")},r.prototype.localResponseNormalization4D=function(t,e,n,a,i){return vt("localResponseNormalization4D")},r.prototype.LRNGrad=function(t,e,n,a,i,o,u){return vt("LRNGrad")},r.prototype.multinomial=function(t,e,n,a){return vt("multinomial")},r.prototype.oneHot=function(t,e,n,a){return vt("oneHot")},r.prototype.cumsum=function(t,e,n,a){return vt("cumsum")},r.prototype.nonMaxSuppression=function(t,e,n,a,i){return vt("nonMaxSuppression")},r.prototype.fft=function(t){return vt("fft")},r.prototype.ifft=function(t){return vt("ifft")},r.prototype.complex=function(t,e){return vt("complex")},r.prototype.real=function(t){return vt("real")},r.prototype.imag=function(t){return vt("imag")},r.prototype.cropAndResize=function(t,e,n,a,i,o){return vt("cropAndResize")},r.prototype.depthToSpace=function(t,e,n){return vt("depthToSpace")},r.prototype.split=function(t,e,n){return vt("split")},r.prototype.sparseToDense=function(t,e,n,a){return vt("sparseToDense")},r.prototype.diag=function(t){return vt("diag")},r.prototype.fill=function(t,e,n){return vt("fill")},r.prototype.onesLike=function(t){return vt("onesLike")},r.prototype.zerosLike=function(t){return vt("zerosLike")},r.prototype.linspace=function(t,e,n){return vt("linspace")},r.prototype.dispose=function(){return vt("dispose")},r})();function vt(r){throw new Error("'"+r+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function Uu(r,t,e,n,a,i,o){o===void 0&&(o="channelsLast");var u,l=yd(t),h=l[0],f=l[1];if(o==="channelsLast")u=[h,f,r[3],r[3]];else{if(o!=="channelsFirst")throw new Error("Unknown dataFormat "+o);u=[h,f,r[1],r[1]]}return Qu(r,u,e,n,a,i,!1,o)}function md(r,t,e,n,a,i,o){o===void 0&&(o="NDHWC");var u,l,h=Sg(t),f=h[0],p=h[1],v=h[2];if(o==="NDHWC")l="channelsLast",u=[f,p,v,r[4],r[4]];else{if(o!=="NCDHW")throw new Error("Unknown dataFormat "+o);l="channelsFirst",u=[f,p,v,r[1],r[1]]}return gd(r,u,e,n,a,!1,l,i)}function Qu(r,t,e,n,a,i,o,u){o===void 0&&(o=!1),u===void 0&&(u="channelsLast");var l=[-1,-1,-1,-1],h=l[0],f=l[1],p=l[2],v=l[3];if(u==="channelsLast")h=r[0],f=r[1],p=r[2],v=r[3];else{if(u!=="channelsFirst")throw new Error("Unknown dataFormat "+u);h=r[0],v=r[1],f=r[2],p=r[3]}var m,x=t[0],b=t[1],E=t[3],C=yd(e),R=C[0],_=C[1],A=yd(n),k=A[0],D=A[1],P=Qs(x,k),M=Qs(b,D),O=(function(nt,at,V,X,Q,ut,B,$){var ht,ft,xt;if(typeof nt=="number"){ht={top:nt,bottom:nt,left:nt,right:nt,type:nt===0?"VALID":"NUMBER"};var wt=(function(Ft,Wt,Gt,$t,ue){$t==null&&($t=$S(Ft,Wt,Gt));var de=Ft[0],Te=Ft[1],je=Tc((de-Wt+2*$t)/Gt+1,ue);G(pn(je),(function(){return"The output # of rows ("+je+") must be an integer. Change the stride and/or zero pad parameters"}));var Se=Tc((Te-Wt+2*$t)/Gt+1,ue);return G(pn(Se),(function(){return"The output # of columns ("+Se+") must be an integer. Change the stride and/or zero pad parameters"})),[je,Se]})([at,V],ut,X,nt,$);ft=wt[0],xt=wt[1]}else if(nt==="same"){ft=Math.ceil(at/X),xt=Math.ceil(V/Q);var Rt=Math.max(0,(ft-1)*X+ut-at),Dt=Math.max(0,(xt-1)*Q+B-V),_t=Math.floor(Rt/2),Pt=Rt-_t,jt=Math.floor(Dt/2);ht={top:_t,bottom:Pt,left:jt,right:Dt-jt,type:"SAME"}}else{if(nt!=="valid")throw Error("Unknown padding parameter: "+nt);ht={top:0,bottom:0,left:0,right:0,type:"VALID"},ft=Math.ceil((at-ut+1)/X),xt=Math.ceil((V-B+1)/Q)}return{padInfo:ht,outHeight:ft,outWidth:xt}})(a,f,p,R,_,P,M,i),F=O.padInfo,W=O.outHeight,j=O.outWidth,ot=o?E*v:E;return u==="channelsFirst"?m=[h,ot,W,j]:u==="channelsLast"&&(m=[h,W,j,ot]),{batchSize:h,dataFormat:u,inHeight:f,inWidth:p,inChannels:v,outHeight:W,outWidth:j,outChannels:ot,padInfo:F,strideHeight:R,strideWidth:_,filterHeight:x,filterWidth:b,effectiveFilterHeight:P,effectiveFilterWidth:M,dilationHeight:k,dilationWidth:D,inShape:r,outShape:m,filterShape:t}}function gd(r,t,e,n,a,i,o,u){i===void 0&&(i=!1),o===void 0&&(o="channelsLast");var l=[-1,-1,-1,-1,-1],h=l[0],f=l[1],p=l[2],v=l[3],m=l[4];if(o==="channelsLast")h=r[0],f=r[1],p=r[2],v=r[3],m=r[4];else{if(o!=="channelsFirst")throw new Error("Unknown dataFormat "+o);h=r[0],m=r[1],f=r[2],p=r[3],v=r[4]}var x,b=t[0],E=t[1],C=t[2],R=t[4],_=Sg(e),A=_[0],k=_[1],D=_[2],P=Sg(n),M=P[0],O=P[1],F=P[2],W=Qs(b,M),j=Qs(E,O),ot=Qs(C,F),nt=(function(B,$,ht,ft,xt,wt,Rt,Dt,_t,Pt,jt){var Ft,Wt,Gt,$t;if(typeof B=="number"){Ft={top:B,bottom:B,left:B,right:B,front:B,back:B,type:B===0?"VALID":"NUMBER"};var ue=(function(Gn,Nn,On,Be,Fe,En){Fe==null&&(Fe=$S(Gn,Nn,Be));var Ga=Gn[0],El=Gn[1],Ha=Gn[2],qa=Tc((Ga-Nn+2*Fe)/Be+1,En);G(pn(qa),(function(){return"The output # of depths ("+qa+") must be an integer. Change the stride and/or zero pad parameters"}));var ur=Tc((El-Nn+2*Fe)/Be+1,En);G(pn(ur),(function(){return"The output # of rows ("+ur+") must be an integer. Change the stride and/or zero pad parameters"}));var Dr=Tc((Ha-Nn+2*Fe)/Be+1,En);return G(pn(Dr),(function(){return"The output # of columns ("+Dr+") must be an integer. Change the stride and/or zero pad parameters"})),[qa,ur,Dr,On]})([$,ht,ft,1],Dt,1,xt,B,jt);Wt=ue[0],Gt=ue[1],$t=ue[2]}else if(B==="same"){Wt=Math.ceil($/xt),Gt=Math.ceil(ht/wt),$t=Math.ceil(ft/Rt);var de=(Wt-1)*xt+Dt-$,Te=(Gt-1)*wt+_t-ht,je=($t-1)*Rt+Pt-ft,Se=Math.floor(de/2),vn=de-Se,Xe=Math.floor(Te/2),Ge=Te-Xe,ln=Math.floor(je/2);Ft={top:Xe,bottom:Ge,left:ln,right:je-ln,front:Se,back:vn,type:"SAME"}}else{if(B!=="valid")throw Error("Unknown padding parameter: "+B);Ft={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},Wt=Math.ceil(($-Dt+1)/xt),Gt=Math.ceil((ht-_t+1)/wt),$t=Math.ceil((ft-Pt+1)/Rt)}return{padInfo:Ft,outDepth:Wt,outHeight:Gt,outWidth:$t}})(a,f,p,v,A,k,D,W,j,ot,u),at=nt.padInfo,V=nt.outDepth,X=nt.outHeight,Q=nt.outWidth,ut=i?R*m:R;return o==="channelsFirst"?x=[h,ut,V,X,Q]:o==="channelsLast"&&(x=[h,V,X,Q,ut]),{batchSize:h,dataFormat:o,inDepth:f,inHeight:p,inWidth:v,inChannels:m,outDepth:V,outHeight:X,outWidth:Q,outChannels:ut,padInfo:at,strideDepth:A,strideHeight:k,strideWidth:D,filterDepth:b,filterHeight:E,filterWidth:C,effectiveFilterDepth:W,effectiveFilterHeight:j,effectiveFilterWidth:ot,dilationDepth:M,dilationHeight:O,dilationWidth:F,inShape:r,outShape:x,filterShape:t}}function $S(r,t,e,n){n===void 0&&(n=1);var a=Qs(t,n);return Math.floor((r[0]*(e-1)-e+a)/2)}function yd(r){return typeof r=="number"?[r,r,r]:r.length===2?[r[0],r[1],1]:r}function Sg(r){return typeof r=="number"?[r,r,r]:r}function Qs(r,t){return t<=1?r:r+(r-1)*(t-1)}function Tc(r,t){if(!t)return r;switch(t){case"round":return Math.round(r);case"ceil":return Math.ceil(r);case"floor":return Math.floor(r);default:throw new Error("Unknown roundingMode "+t)}}function fl(r){var t=yd(r),e=t[0],n=t[1],a=t[2];return e===1&&n===1&&a===1}function vr(r,t){return fl(r)||fl(t)}function uy(r){if(r==="NHWC")return"channelsLast";if(r==="NCHW")return"channelsFirst";throw new Error("Unknown dataFormat "+r)}function JS(r,t,e){if(t==="complex64"){if(r.dtype==="complex64")return r.clone();var n=sn(r.shape),a=r.toFloat(),i=e.complex(a,n);return n.dispose(),a.dispose(),i}if(!h3(r.dtype,t))return rt.makeTensorFromDataId(r.dataId,r.shape,t);if(r.dtype==="complex64"){var o=e.real(r);return i=o.cast(t),o.dispose(),i}if(t==="int32")return e.int(r);if(t==="bool"){var u=Ut(0,r.dtype);return i=e.notEqual(r,u),u.dispose(),i}throw new Error("Error in Cast: failed to cast "+r.dtype+" to "+t)}function Rg(r,t){return rt.makeTensorFromDataId(r.dataId,t,r.dtype)}function tR(r,t,e){var n=(t-r)/(e-1),a=eh(e,"float32");a[0]=r;for(var i=1;i<a.length;i++)a[i]=a[i-1]+n;return za(a,"float32")}function _g(r,t){if(r.length!==t.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+r.length+", imag: "+t.length+".");for(var e=new Float32Array(2*r.length),n=0;n<e.length;n+=2)e[n]=r[n/2],e[n+1]=t[n/2];return e}function Ow(r,t){return{real:r[2*t],imag:r[2*t+1]}}function sV(r,t,e,n){r[2*n]=t,r[2*n+1]=e}function lV(r,t,e){var n=(e?2:-2)*Math.PI*(r/t);return{real:Math.cos(n),imag:Math.sin(n)}}function cV(r,t,e){var n=(function(i,o,u){return(function(l,h,f){for(var p=0,v=l.length,m=0,x=!1;p<v;){var b=f(h,l[m=p+(v-p>>>1)]);b>0?p=m+1:(v=m,x=!b)}return x?p:-p-1})(i,o,u||hV)})(r,t,e),a=n<0?-(n+1):n;r.splice(a,0,t)}function hV(r,t){return r>t?1:r<t?-1:0}function sy(r,t,e,n,a){return eR(r,t,e,n,a,0).selectedIndices}function ly(r,t,e,n,a,i){var o=eR(r,t,e,n,a,i);return o.numValidOutputs.dispose(),{selectedIndices:o.selectedIndices,selectedScores:o.selectedScores}}function eR(r,t,e,n,a,i,o,u){u===void 0&&(u=!1);for(var l=Array.from(t).map((function(A,k){return{score:A,boxIndex:k,suppressBeginIndex:0}})).filter((function(A){return A.score>a})).sort(Mw),h=i>0?-.5/i:0,f=[],p=[];f.length<e&&l.length>0;){var v=l.pop(),m=v.score,x=v.boxIndex,b=v.suppressBeginIndex;if(m<a)break;for(var E=!1,C=f.length-1;C>=b;--C){var R=fV(r,x,f[C]);if(R>=n){E=!0;break}if(v.score=v.score*dV(n,h,R),v.score<=a)break}v.suppressBeginIndex=f.length,E||(v.score===m?(f.push(x),p.push(v.score)):v.score>a&&cV(l,v,Mw))}var _=f.length;return u&&(f.fill(0,_),p.fill(0,_)),{selectedIndices:za(f,"int32"),selectedScores:za(p,"float32"),numValidOutputs:Ut(_,"int32")}}function fV(r,t,e){var n=r.subarray(4*t,4*t+4),a=r.subarray(4*e,4*e+4),i=Math.min(n[0],n[2]),o=Math.min(n[1],n[3]),u=Math.max(n[0],n[2]),l=Math.max(n[1],n[3]),h=Math.min(a[0],a[2]),f=Math.min(a[1],a[3]),p=Math.max(a[0],a[2]),v=Math.max(a[1],a[3]),m=(u-i)*(l-o),x=(p-h)*(v-f);if(m<=0||x<=0)return 0;var b=Math.max(i,h),E=Math.max(o,f),C=Math.min(u,p),R=Math.min(l,v),_=Math.max(C-b,0)*Math.max(R-E,0);return _/(m+x-_)}function dV(r,t,e){var n=Math.exp(t*e*e);return e<=r?n:0}function Mw(r,t){return r.score-t.score||r.score===t.score&&t.boxIndex-r.boxIndex}function nR(r,t,e){var n=new Array(r.rank).fill(0),a=r.shape.slice();return t.map((function(i){a[e]=i;var o=r.slice(n,a);return n[e]+=i,o}))}function rR(r,t){for(var e=new Array(r.rank),n=0;n<e.length;n++)e[n]=r.shape[n]*t[n];var a=ee(e,r.dtype);for(n=0;n<a.values.length;++n){for(var i=a.indexToLoc(n),o=new Array(r.rank),u=0;u<o.length;u++)o[u]=i[u]%r.shape[u];var l=r.locToIndex(o);a.values[n]=r.values[l]}return a.toTensor()}function aR(r,t,e,n,a){for(var i=t[t.length-1],o=[r.length/i,i],u=o[0],l=o[1],h=ll(e,u*n),f=ll("int32",u*n),p=0;p<u;p++){for(var v=p*l,m=r.subarray(v,v+l),x=[],b=0;b<m.length;b++)x.push({value:m[b],index:b});x.sort((function(A,k){return k.value-A.value}));var E=p*n,C=h.subarray(E,E+n),R=f.subarray(E,E+n);for(b=0;b<n;b++)C[b]=x[b].value,R[b]=x[b].index}var _=t.slice();return _[_.length-1]=n,[Qn(h,_,e),Qn(f,_,"int32")]}function cy(r,t){for(var e=[],n=0;n<t.length;n++)t[n]&&e.push(n);var a=ee(r,"int32"),i=ee([e.length,r.length],"int32");for(n=0;n<e.length;n++){var o=a.indexToLoc(e[n]),u=n*r.length;i.values.set(o,u)}return i.toTensor()}var pV=function(r,t){this.outputShape=[],this.outputShape=r,this.variableNames=t.map((function(a,i){return"T"+i}));var e=[];this.variableNames.forEach((function(a){e.push("float v"+a+" = get"+a+"AtOutCoords();")}));var n=this.variableNames.map((function(a){return"v"+a})).join(" + ");this.userCode=`
      void main() {
        `+e.join(`
        `)+`

        float result = `+n+`;
        setOutput(result);
      }
    `},vV=function(r,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r,this.variableNames=t.map((function(a,i){return"T"+i}));var e=[];this.variableNames.forEach((function(a){e.push("vec4 v"+a+" = get"+a+"AtOutCoords();")}));var n=this.variableNames.map((function(a){return"v"+a})).join(" + ");this.userCode=`
      void main() {
        `+e.join(`
        `)+`

        vec4 result = `+n+`;
        setOutput(result);
      }
    `},mV=function(r,t,e){this.variableNames=["A"];var n=r.windowSize,a=r.batchSize,i=r.inSize,o=Math.ceil(i/n);e||this.variableNames.push("bestIndicesA"),this.outputShape=[a,o];var u=t==="max"?">":"<",l=e?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+n+`;

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < `+n+`; i++) {
          int inIdx = `+l+`;
          float candidate = getA(batch, inIdx);
          if (candidate `+u+` bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `};function iR(r,t){return["x","y","z","w","u","v"].slice(0,t).map((function(e){return r+"."+e}))}function Sr(r,t){return t===1?[r]:iR(r,t)}function ar(){var r,t,e,n,a,i,o,u,l,h;return yt().getNumber("WEBGL_VERSION")===2?(r="#version 300 es",t="in",e="out",n="in",a="texture",i="outputColor",o="out vec4 outputColor;",u=`
      bool isnan_custom(float val) {
        return (val > 0.0 || val < 0.0) ? false : val != 0.0;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `,l="",h=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(r="",t="attribute",e="varying",n="varying",a="texture2D",i="gl_FragColor",o="",u=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,l=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,h=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:r,attribute:t,varyingVs:e,varyingFs:n,texture2D:a,output:i,defineOutput:o,defineSpecialNaN:u,defineSpecialInf:l,defineRound:h}}function Iu(r,t,e){e===void 0&&(e="index");var n=$r(t);return n.map((function(a,i){return"int "+r[i]+" = "+e+" / "+a+"; "+(i===n.length-1?"int "+r[i+1]+" = "+e+" - "+r[i]+" * "+a:"index -= "+r[i]+" * "+a)+";"})).join("")}function hy(r){var t=$r(r).map((function(e){return e.toString()}));return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * `+t[0]+" + coords.y * "+t[1]+` + coords.z;
  }
`}var oR=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;function gV(r,t,e,n){var a=[];r.forEach((function(m){var x=Ot(m.shapeInfo.logicalShape);m.shapeInfo.isUniform?a.push("uniform float "+m.name+(x>1?"["+x+"]":"")+";"):(a.push("uniform sampler2D "+m.name+";"),a.push("uniform int offset"+m.name+";"))}));var i,o,u=a.join(`
`),l=r.map((function(m){return(function(x,b,E){E===void 0&&(E=!1);var C="";C+=E?uR(x):Ws(x);var R=x.shapeInfo.logicalShape,_=b.logicalShape;return R.length<=_.length&&(C+=E?(function(A,k){var D,P=A.name,M=P.charAt(0).toUpperCase()+P.slice(1),O="get"+M+"AtOutCoords",F=A.shapeInfo.logicalShape.length,W=k.logicalShape.length,j=Go(A.shapeInfo.logicalShape,k.logicalShape),ot=We(W),nt=W-F,at=["x","y","z","w","u","v"];D=F===0?"":W<2&&j.length>=1?"coords = 0;":j.map((function(ht){return"coords."+at[ht+nt]+" = 0;"})).join(`
`);var V="";V=W<2&&F>0?"coords":A.shapeInfo.logicalShape.map((function(ht,ft){return"coords."+at[ft+nt]})).join(", ");var X="return outputValue;",Q=Ot(A.shapeInfo.logicalShape)===1,ut=Ot(k.logicalShape)===1;if(F!==1||Q||ut){if(Q&&!ut)X=W===1?`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:`
        return vec4(outputValue.x);
      `;else if(j.length){var B=F-2,$=F-1;j.indexOf(B)>-1&&j.indexOf($)>-1?X="return vec4(outputValue.x);":j.indexOf(B)>-1?X="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":j.indexOf($)>-1&&(X="return vec4(outputValue.xx, outputValue.zz);")}}else X=`
      return vec4(outputValue.xy, outputValue.xy);
    `;return`
    vec4 `+O+`() {
      `+ot+` coords = getOutputCoords();
      `+D+`
      vec4 outputValue = get`+M+"("+V+`);
      `+X+`
    }
  `})(x,b):(function(A,k){var D=A.name,P=D.charAt(0).toUpperCase()+D.slice(1),M="get"+P+"AtOutCoords",O=k.texShape,F=A.shapeInfo.texShape,W=A.shapeInfo.logicalShape.length,j=k.logicalShape.length;if(!A.shapeInfo.isUniform&&W===j&&A.shapeInfo.flatOffset==null&&Wn(F,O))return`
      float `+M+`() {
        return sampleTexture(`+D+`, resultUV);
      }
    `;var ot,nt=We(j),at=Go(A.shapeInfo.logicalShape,k.logicalShape),V=j-W,X=["x","y","z","w","u","v"];ot=W===0?"":j<2&&at.length>=1?"coords = 0;":at.map((function(ut){return"coords."+X[ut+V]+" = 0;"})).join(`
`);var Q="";return Q=j<2&&W>0?"coords":A.shapeInfo.logicalShape.map((function(ut,B){return"coords."+X[B+V]})).join(", "),`
    float `+M+`() {
      `+nt+` coords = getOutputCoords();
      `+ot+`
      return get`+P+"("+Q+`);
    }
  `})(x,b)),C})(m,t,n)})).join(`
`),h=t.texShape,f=ar(),p=(function(m){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return `+m.texture2D+`(textureSampler, uv).r;
    }
  `})(f),v=(function(m){return m.version+`
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    `+m.varyingFs+` vec2 resultUV;
    `+m.defineOutput+`
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    `+m.defineSpecialNaN+`
    `+m.defineSpecialInf+`
    `+m.defineRound+`

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    `+yV+`
    `+xV+`
    `+bV+`
  `})(f);return t.isPacked?(i=(function(m,x){switch(m.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return(function(A,k){var D=[Math.ceil(k[0]/2),Math.ceil(k[1]/2)];return D[0]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * `+D[1]+`.0);
      }
    `:D[1]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * `+D[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+D[0]+", "+D[1]+`));
      return 2 * (resTexRC.x * `+D[1]+` + resTexRC.y);
    }
  `})(0,x);case 2:return(function(A,k){var D=[Math.ceil(k[0]/2),Math.ceil(k[1]/2)];if(Wn(A,k))return`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(`+D[0]+", "+D[1]+`));
      }
    `;var P=Math.ceil(A[1]/2);return`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+D[0]+", "+D[1]+`));

      int index = resTexRC.x * `+D[1]+` + resTexRC.y;
      int r = 2 * (index / `+P+`);
      int c = imod(index, `+P+`) * 2;

      return ivec2(r, c);
    }
  `})(m,x);case 3:return b=m,E=x,C=[Math.ceil(E[0]/2),Math.ceil(E[1]/2)],R=Math.ceil(b[2]/2),_=R*Math.ceil(b[1]/2),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+C[0]+", "+C[1]+`));
      int index = resTexRC.x * `+C[1]+` + resTexRC.y;

      int b = index / `+_+`;
      index -= b * `+_+`;

      int r = 2 * (index / `+R+`);
      int c = imod(index, `+R+`) * 2;

      return ivec3(b, r, c);
    }
  `;default:return(function(A,k){for(var D=[Math.ceil(k[0]/2),Math.ceil(k[1]/2)],P=Math.ceil(A[A.length-1]/2),M=P*Math.ceil(A[A.length-2]/2),O=M,F="",W="b, r, c",j=2;j<A.length-1;j++)O*=A[A.length-j-1],F=`
      int b`+j+" = index / "+O+`;
      index -= b`+j+" * "+O+`;
    `+F,W="b"+j+", "+W;return`
    ivec`+A.length+` getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+D[0]+", "+D[1]+`));
      int index = resTexRC.x * `+D[1]+` + resTexRC.y;

      `+F+`

      int b = index / `+M+`;
      index -= b * `+M+`;

      int r = 2 * (index / `+P+`);
      int c = imod(index, `+P+`) * 2;

      return ivec`+A.length+"("+W+`);
    }
  `})(m,x)}var b,E,C,R,_})(t.logicalShape,h),o=(function(m){return`
    void setOutput(vec4 val) {
      `+m.output+` = val;
    }
  `})(f)):(i=(function(m,x){switch(m.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return(function(C,R){return R[0]===1?`
      int getOutputCoords() {
        return int(resultUV.x * `+R[1]+`.0);
      }
    `:R[1]===1?`
      int getOutputCoords() {
        return int(resultUV.y * `+R[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+R[0]+", "+R[1]+`));
      return resTexRC.x * `+R[1]+` + resTexRC.y;
    }
  `})(0,x);case 2:return(function(C,R){return Wn(C,R)?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(`+R[0]+", "+R[1]+`));
      }
    `:C[1]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+R[0]+", "+R[1]+`));
        int index = resTexRC.x * `+R[1]+` + resTexRC.y;
        return ivec2(index, 0);
      }
    `:C[0]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+R[0]+", "+R[1]+`));
        int index = resTexRC.x * `+R[1]+` + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+R[0]+", "+R[1]+`));
      int index = resTexRC.x * `+R[1]+` + resTexRC.y;
      int r = index / `+C[1]+`;
      int c = index - r * `+C[1]+`;
      return ivec2(r, c);
    }
  `})(m,x);case 3:return b=x,E=Iu(["r","c","d"],m),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+b[0]+", "+b[1]+`));
      int index = resTexRC.x * `+b[1]+` + resTexRC.y;
      `+E+`
      return ivec3(r, c, d);
    }
  `;case 4:return(function(C,R){var _=Iu(["r","c","d","d2"],C);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+R[0]+", "+R[1]+`));
      int index = resTexRC.x * `+R[1]+` + resTexRC.y;
      `+_+`
      return ivec4(r, c, d, d2);
    }
  `})(m,x);case 5:return(function(C,R){var _=Iu(["r","c","d","d2","d3"],C);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(`+R[0]+`,
                             `+R[1]+`));

      int index = resTexRC.x * `+R[1]+` + resTexRC.y;

      `+_+`

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `})(m,x);case 6:return(function(C,R){var _=Iu(["r","c","d","d2","d3","d4"],C);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+R[0]+", "+R[1]+`));
      int index = resTexRC.x * `+R[1]+` + resTexRC.y;

      `+_+`

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `})(m,x);default:throw new Error(m.length+"-D output sampling is not yet supported")}var b,E})(t.logicalShape,h),o=(function(m){return`
    void setOutput(float val) {
      `+m.output+` = vec4(val, 0, 0, 0);
    }
  `})(f)),n&&(v+=wV),[v,p,o,u,i,l,e].join(`
`)}function Ws(r){var t=r.shapeInfo.logicalShape;switch(t.length){case 0:return(function(e){var n=e.name,a="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return"float "+a+"() {return "+n+";}";var i=e.shapeInfo.texShape,o=i[0],u=i[1];if(o===1&&u===1)return`
      float `+a+`() {
        return sampleTexture(`+n+`, halfCR);
      }
    `;var l=e.shapeInfo.texShape,h=l[0],f=l[1],p=Su(n);return`
    float `+a+`() {
      vec2 uv = uvFromFlat(`+h+", "+f+", "+p+`);
      return sampleTexture(`+n+`, uv);
    }
  `})(r);case 1:return(function(e){var n=e.name,a="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return`
      float `+a+`(int index) {
        `+Ms(e)+`
      }
    `;var i=e.shapeInfo.texShape,o=i[0],u=i[1];if(u===1&&o===1)return`
      float `+a+`(int index) {
        return sampleTexture(`+n+`, halfCR);
      }
    `;var l=Su(n);return u===1?`
      float `+a+`(int index) {
        vec2 uv = vec2(0.5, (float(index + `+l+") + 0.5) / "+o+`.0);
        return sampleTexture(`+n+`, uv);
      }
    `:o===1?`
      float `+a+`(int index) {
        vec2 uv = vec2((float(index + `+l+") + 0.5) / "+u+`.0, 0.5);
        return sampleTexture(`+n+`, uv);
      }
    `:`
    float `+a+`(int index) {
      vec2 uv = uvFromFlat(`+o+", "+u+", index + "+l+`);
      return sampleTexture(`+n+`, uv);
    }
  `})(r);case 2:return(function(e){var n=e.shapeInfo.logicalShape,a=e.name,i="get"+a.charAt(0).toUpperCase()+a.slice(1),o=e.shapeInfo.texShape;if(o!=null&&Wn(n,o)){var u=o[0],l=o[1];return`
    float `+i+`(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(`+l+".0, "+u+`.0);
      return sampleTexture(`+a+`, uv);
    }
  `}var h=ku(n),f=h.newShape,p=h.keptDims,v=f;if(v.length<n.length){var m=Vs(e,v);return`
      `+Ws(m)+`
      float `+i+`(int row, int col) {
        return `+i+"("+Gs(["row","col"],p)+`);
      }
    `}if(e.shapeInfo.isUniform)return`
      float `+i+`(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(`+n[1]+`, 1)));
        `+Ms(e)+`
      }
    `;var x=o[0],b=o[1],E=Su(a);return b===1?`
    float `+i+`(int row, int col) {
      float index = dot(vec3(row, col, `+E+"), vec3("+n[1]+`, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / `+x+`.0);
      return sampleTexture(`+a+`, uv);
    }
  `:x===1?`
    float `+i+`(int row, int col) {
      float index = dot(vec3(row, col, `+E+"), vec3("+n[1]+`, 1, 1));
      vec2 uv = vec2((index + 0.5) / `+b+`.0, 0.5);
      return sampleTexture(`+a+`, uv);
    }
  `:`
  float `+i+`(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * `+n[1]+" + col + "+E+`;
    vec2 uv = uvFromFlat(`+x+", "+b+`, index);
    return sampleTexture(`+a+`, uv);
  }
`})(r);case 3:return(function(e){var n=e.shapeInfo.logicalShape,a=e.name,i="get"+a.charAt(0).toUpperCase()+a.slice(1),o=n[1]*n[2],u=n[2],l=ku(n),h=l.newShape,f=l.keptDims,p=h;if(p.length<n.length){var v=Vs(e,p);return`
        `+Ws(v)+`
        float `+i+`(int row, int col, int depth) {
          return `+i+"("+Gs(["row","col","depth"],f)+`);
        }
      `}if(e.shapeInfo.isUniform)return`
      float `+i+`(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(`+o+", "+u+`, 1)));
        `+Ms(e)+`
      }
    `;var m=e.shapeInfo.texShape,x=m[0],b=m[1],E=e.shapeInfo.flatOffset;if(b===o&&E==null)return`
        float `+i+`(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(`+u+`, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(`+b+".0, "+x+`.0);
          return sampleTexture(`+a+`, uv);
        }
      `;if(b===u&&E==null)return`
    float `+i+`(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(`+n[1]+`, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+b+".0, "+x+`.0);
      return sampleTexture(`+a+`, uv);
    }
  `;var C=Su(a);return`
      float `+i+`(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * `+o+" + col * "+u+" + depth + "+C+`;
        vec2 uv = uvFromFlat(`+x+", "+b+`, index);
        return sampleTexture(`+a+`, uv);
      }
  `})(r);case 4:return(function(e){var n=e.shapeInfo.logicalShape,a=e.name,i="get"+a.charAt(0).toUpperCase()+a.slice(1),o=n[3],u=n[2]*o,l=n[1]*u,h=ku(n),f=h.newShape,p=h.keptDims;if(f.length<n.length){var v=Vs(e,f);return`
      `+Ws(v)+`
      float `+i+`(int row, int col, int depth, int depth2) {
        return `+i+"("+Gs(["row","col","depth","depth2"],p)+`);
      }
    `}if(e.shapeInfo.isUniform)return`
      float `+i+`(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(`+l+", "+u+", "+o+`, 1)));
        `+Ms(e)+`
      }
    `;var m=e.shapeInfo.flatOffset,x=e.shapeInfo.texShape,b=x[0],E=x[1];if(E===l&&m==null)return`
      float `+i+`(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(`+u+", "+o+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+E+".0, "+b+`.0);
        return sampleTexture(`+a+`, uv);
      }
    `;if(E===o&&m==null)return`
      float `+i+`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`+n[1]*n[2]+", "+n[2]+`, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+E+".0, "+b+`.0);
        return sampleTexture(`+a+`, uv);
      }
    `;var C=Su(a);return`
    float `+i+`(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+l+" + col * "+u+` +
          depth * `+o+` + depth2;
      vec2 uv = uvFromFlat(`+b+", "+E+", index + "+C+`);
      return sampleTexture(`+a+`, uv);
    }
  `})(r);case 5:return(function(e){var n=e.shapeInfo.logicalShape,a=e.name,i="get"+a.charAt(0).toUpperCase()+a.slice(1),o=n[4],u=n[3]*o,l=n[2]*u,h=n[1]*l,f=ku(n),p=f.newShape,v=f.keptDims;if(p.length<n.length){var m=Vs(e,p);return`
      `+Ws(m)+`
      float `+i+`(int row, int col, int depth, int depth2, int depth3) {
        return `+i+"("+Gs(["row","col","depth","depth2","depth3"],v)+`);
      }
    `}if(e.shapeInfo.isUniform)return`
      float `+i+`(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(`+h+", "+l+", "+u+", "+o+`)) +
          depth3;
        `+Ms(e)+`
      }
    `;var x=e.shapeInfo.flatOffset,b=e.shapeInfo.texShape,E=b[0],C=b[1];if(C===h&&x==null)return`
      float `+i+`(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(`+l+", "+u+", "+o+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+C+".0, "+E+`.0);
        return sampleTexture(`+a+`, uv);
      }
    `;if(C===o&&x==null)return`
      float `+i+`(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(`+n[1]*n[2]*n[3]+`,
               `+n[2]*n[3]+", "+n[3]+`, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+C+".0, "+E+`.0);
        return sampleTexture(`+a+`, uv);
      }
    `;var R=Su(a);return`
    float `+i+`(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+h+" + col * "+l+" + depth * "+u+` +
          depth2 * `+o+" + depth3 + "+R+`;
      vec2 uv = uvFromFlat(`+E+", "+C+`, index);
      return sampleTexture(`+a+`, uv);
    }
  `})(r);case 6:return(function(e){var n=e.shapeInfo.logicalShape,a=e.name,i="get"+a.charAt(0).toUpperCase()+a.slice(1),o=ku(n),u=o.newShape,l=o.keptDims;if(u.length<n.length){var h=Vs(e,u);return`
      `+Ws(h)+`
      float `+i+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return `+i+"("+Gs(["row","col","depth","depth2","depth3","depth4"],l)+`);
      }
    `}var f=n[5],p=n[4]*f,v=n[3]*p,m=n[2]*v,x=n[1]*m;if(e.shapeInfo.isUniform)return`
      float `+i+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(`+x+", "+m+", "+v+", "+p+`)) +
          dot(
            vec2(depth3, depth4),
            vec2(`+f+`, 1)));
        `+Ms(e)+`
      }
    `;var b=e.shapeInfo.flatOffset,E=e.shapeInfo.texShape,C=E[0],R=E[1];if(R===x&&b==null)return`
      float `+i+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(`+m+", "+v+", "+p+", "+f+`)) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+R+".0, "+C+`.0);
        return sampleTexture(`+a+`, uv);
      }
    `;if(R===f&&b==null)return`
      float `+i+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(`+n[1]*n[2]*n[3]*n[4]+`,
               `+n[2]*n[3]*n[4]+`,
               `+n[3]*n[4]+`,
               `+n[4]+`)) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+R+".0, "+C+`.0);
        return sampleTexture(`+a+`, uv);
      }
    `;var _=Su(a);return`
    float `+i+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+x+" + col * "+m+" + depth * "+v+` +
          depth2 * `+p+" + depth3 * "+f+" + depth4 + "+_+`;
      vec2 uv = uvFromFlat(`+C+", "+R+`, index);
      return sampleTexture(`+a+`, uv);
    }
  `})(r);default:throw new Error(t.length+"-D input sampling is not yet supported")}}function uR(r){var t,e,n;switch(r.shapeInfo.logicalShape.length){case 0:return t=r.name,e="get"+t.charAt(0).toUpperCase()+t.slice(1),n=ar(),`
    vec4 `+e+`() {
      return `+n.texture2D+"("+t+`, halfCR);
    }
  `;case 1:return(function(a){var i=a.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),u=a.shapeInfo.texShape,l=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)],h=ar();return`
    vec4 `+o+`(int index) {
      vec2 uv = packedUVfrom1D(
        `+l[0]+", "+l[1]+`, index);
      return `+h.texture2D+"("+i+`, uv);
    }
  `})(r);case 2:return(function(a){var i=a.shapeInfo.logicalShape,o=a.name,u="get"+o.charAt(0).toUpperCase()+o.slice(1),l=a.shapeInfo.texShape,h=l[0],f=l[1],p=ar();if(l!=null&&Wn(i,l))return`
      vec4 `+u+`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`+f+".0, "+h+`.0);

        return `+p.texture2D+"("+o+`, uv);
      }
    `;var v=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)],m=Math.ceil(i[1]/2);return`
    vec4 `+u+`(int row, int col) {
      vec2 uv = packedUVfrom2D(`+m+", "+v[0]+", "+v[1]+`, row, col);
      return `+p.texture2D+"("+o+`, uv);
    }
  `})(r);case 3:return(function(a){var i=a.shapeInfo.logicalShape,o=a.name,u="get"+o.charAt(0).toUpperCase()+o.slice(1),l=a.shapeInfo.texShape,h=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)];if(i[0]===1){var f=i.slice(1),p=Vs(a,f);return`
        `+uR(p)+`
        vec4 `+u+`(int b, int row, int col) {
          return `+u+"("+Gs(["b","row","col"],[1,2])+`);
        }
      `}var v=h[0],m=h[1],x=Math.ceil(i[2]/2),b=x*Math.ceil(i[1]/2),E=ar();return`
    vec4 `+u+`(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        `+v+", "+m+", "+b+", "+x+`, b, row, col);
      return `+E.texture2D+"("+o+`, uv);
    }
  `})(r);default:return(function(a){for(var i=a.shapeInfo.logicalShape,o=i.length,u=a.name,l="get"+u.charAt(0).toUpperCase()+u.slice(1),h=a.shapeInfo.texShape,f=[Math.ceil(h[0]/2),Math.ceil(h[1]/2)],p=f[0],v=f[1],m=Math.ceil(i[o-1]/2),x=m*Math.ceil(i[o-2]/2),b="int b, int row, int col",E="b * "+x+" + (row / 2) * "+m+" + (col / 2)",C=2;C<o-1;C++)b="int b"+C+", "+b,x*=i[o-C-1],E="b"+C+" * "+x+" + "+E;var R=ar();return`
    vec4 `+l+"("+b+`) {
      int index = `+E+`;
      int texR = index / `+v+`;
      int texC = index - texR * `+v+`;
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+v+", "+p+`);
      return `+R.texture2D+"("+u+`, uv);
    }
  `})(r)}}var yV=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,xV=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,bV=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,wV=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function Su(r){return"offset"+r}function Ms(r){var t=r.name,e=Ot(r.shapeInfo.logicalShape);return e<2?"return "+t+";":`
    for (int i = 0; i < `+e+`; i++) {
      if (i == index) {
        return `+t+`[i];
      }
    }
  `}function We(r){if(r<=1)return"int";if(r===2)return"ivec2";if(r===3)return"ivec3";if(r===4)return"ivec4";if(r===5)return"ivec5";if(r===6)return"ivec6";throw Error("GPU for rank "+r+" is not yet supported")}function Vs(r,t){var e=JSON.parse(JSON.stringify(r));return e.shapeInfo.logicalShape=t,e}function Gs(r,t){return t.map((function(e){return r[e]})).join(", ")}var EV=function(r,t,e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,G(r.length>2,(function(){return"Packed arg"+(e.charAt(0).toUpperCase()+e.slice(1))+" supports only inputs with rank above 2."}));var a=r[r.length-1],i=Math.ceil(a/t);this.outputShape=r.slice(0,-1),i>1&&this.outputShape.push(i),n||this.variableNames.push("bestIndicesA");var o,u,l=this.outputShape,h=l.length,f=We(h),p=Sr("coords",h);if(i===1){var v=We(u=h+1);o=`
        `+v+" sourceLocR = "+v+"("+p.join()+`, 0);
        ++`+p[h-1]+`;
        `+v+" sourceLocG = "+v+"("+p.join()+`, 0);
        ++`+p[h-2]+`;
        `+v+" sourceLocA = "+v+"("+p.join()+`, 0);
        --`+p[h-1]+`;
        `+v+" sourceLocB = "+v+"("+p.join()+`, 0);
        --`+p[h-2]+";"}else u=h,o=`
        `+f+` sourceLocR = coords;
        ++`+p[h-1]+`;
        `+f+` sourceLocG = coords;
        ++`+p[h-2]+`;
        `+f+` sourceLocA = coords;
        --`+p[h-1]+`;
        `+f+` sourceLocB = coords;
        --`+p[h-2]+";";var m=["x","y","z","w","u","v"].slice(0,u),x="."+m[u-1],b=m.map((function(M){return"int "+M})),E=Sr("sourceLocR",u-1).concat("inIdx.r"),C=Sr("sourceLocG",u-1).concat("inIdx.g"),R=Sr("sourceLocB",u-1).concat("inIdx.b"),_=Sr("sourceLocA",u-1).concat("inIdx.a"),A=e==="max"?"greaterThan":"lessThan",k=n?"":`
          inIdx = round(vec4(getBestIndicesAChannel(`+E.join()+`),
                             getBestIndicesAChannel(`+C.join()+`),
                             getBestIndicesAChannel(`+R.join()+`),
                             getBestIndicesAChannel(`+_.join()+")));",D=`vec4(
            getAChannel(`+E.join()+`),
            hasNextCol ? getAChannel(`+C.join()+`) : 0.,
            hasNextRow ? getAChannel(`+R.join()+`) : 0.,
            hasNextRow && hasNextCol ? getAChannel(`+_.join()+") : 0.)",P=n?"":`
      float getBestIndicesAChannel(`+b.join()+`) {
        return getChannel(getBestIndicesA(`+m.join()+`),
                                          vec2(`+m.slice(-2).join()+`));
      }`;this.userCode=`
      float getAChannel(`+b.join()+`) {
        return getChannel(getA(`+m.join()+`),
                               vec2(`+m.slice(-2).join()+`));
      }
      `+P+`
      void main() {
        `+f+` coords = getOutputCoords();
        bool hasNextCol = `+p[h-1]+" < "+(l[h-1]-1)+`;
        bool hasNextRow = `+p[h-2]+" < "+(l[h-2]-1)+`;
        `+o+`
        ivec4 srcIdx = ivec4(sourceLocR`+x+", sourceLocG"+x+`,
          sourceLocB`+x+", sourceLocA"+x+") * "+t+`;
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = `+D+`;

        for (int i = 0; i < `+t+`; i++) {
          inIdx = srcIdx;
          `+k+`
          vec4 candidate = `+D+`;
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(`+A+`(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `},CV=function(r){this.variableNames=["dy"],this.outputShape=r.inShape;var t=r.filterHeight,e=r.filterWidth,n=r.strideHeight,a=r.strideWidth,i=r.dilationHeight,o=r.dilationWidth,u=r.effectiveFilterHeight,l=r.effectiveFilterWidth,h=u-1-r.padInfo.top,f=l-1-r.padInfo.left,p=1/(t*e);this.userCode=`
      const ivec2 pads = ivec2(`+h+", "+f+`);
      const float avgMultiplier = float(`+p+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+u+`;
            wR += `+i+`) {
          float dyR = float(dyRCorner + wR) / `+n+`.0;

          if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+l+`;
            wC+= `+o+`) {
            float dyC = float(dyCCorner + wC) / `+a+`.0;

            if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `},SV=function(r){this.variableNames=["dy"],this.outputShape=r.inShape;var t=r.filterDepth,e=r.filterHeight,n=r.filterWidth,a=r.strideDepth,i=r.strideHeight,o=r.strideWidth,u=r.dilationDepth,l=r.dilationHeight,h=r.dilationWidth,f=r.effectiveFilterDepth,p=r.effectiveFilterHeight,v=r.effectiveFilterWidth,m=f-1-r.padInfo.front,x=p-1-r.padInfo.top,b=v-1-r.padInfo.left,E=1/(t*e*n);this.userCode=`
      const ivec3 pads = ivec3(`+m+", "+x+", "+b+`);
      const float avgMultiplier = float(`+E+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+f+`;
            wD += `+u+`) {
          float dyD = float(dyDCorner + wD) / `+a+`.0;

          if (dyD < 0.0 || dyD >= `+r.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+p+`;
              wR += `+l+`) {
            float dyR = float(dyRCorner + wR) / `+i+`.0;

            if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+v+`;
                wC += `+h+`) {
              float dyC = float(dyCCorner + wC) / `+o+`.0;

              if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `},RV=function(r,t,e,n,a,i){this.outputShape=[],this.variableNames=["x","mean","variance"],he(r,t),he(r,e);var o="0.0";n!=null&&(he(r,n),this.variableNames.push("offset"),o="getOffsetAtOutCoords()");var u="1.0";a!=null&&(he(r,a),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=r,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = `+o+`;
        float scale = `+u+`;
        float inv = scale * inversesqrt(variance + float(`+i+`));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `},_V=function(r,t,e,n,a,i){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],he(r,t),he(r,e);var o="vec4(0.0)";n!=null&&(he(r,n),this.variableNames.push("offset"),o="getOffsetAtOutCoords()");var u="vec4(1.0)";a!=null&&(he(r,a),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=r,this.userCode=`
      void main() {
        vec4 offset = `+o+`;
        vec4 scale = `+u+`;

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(`+i+`));

        setOutput((x - mean) * inv + offset);
      }
    `},AV="return areal * breal - aimag * bimag;",TV="return areal * bimag + aimag * breal;",Bw=function(r,t,e){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=he(t,e),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        `+r+`
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `},km="return a + b;",Dm="return a - b;",Pw="return a * b;",kV=`
if (a == b) {
  return 1.0;
};
return a / b;`,sR="return (a < 0.) ? b * a : a;",on=function(r,t,e){this.variableNames=["A","B"],this.outputShape=he(t,e),this.userCode=`
      float binaryOperation(float a, float b) {
        `+r+`
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `},DV=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,lR=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`,ii=function(r,t,e,n){n===void 0&&(n=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=he(t,e);var a=this.outputShape.length,i="";if(n)if(a===0||Ot(this.outputShape)===1)i=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(i=`
          `+We(a)+` coords = getOutputCoords();
        `,a===1)i+=`
            result.y = (coords + 1) >= `+this.outputShape[0]+` ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{var o=Sr("coords",a);i+=`
            bool nextRowOutOfBounds =
              (`+o[a-2]+" + 1) >= "+this.outputShape[a-2]+`;
            bool nextColOutOfBounds =
              (`+o[a-1]+" + 1) >= "+this.outputShape[a-1]+`;
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        `+r+`
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        `+i+`

        setOutput(result);
      }
    `},IV=(function(){function r(t){this.variableNames=["A"],this.outputShape=t,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}return r.prototype.getCustomSetupFunc=function(t,e){var n=this;return function(a,i){n.minLoc==null&&(n.minLoc=a.getUniformLocationNoThrow(i,"minVal"),n.maxLoc=a.getUniformLocationNoThrow(i,"maxVal")),a.gl.uniform1f(n.minLoc,t),a.gl.uniform1f(n.maxLoc,e)}},r})(),NV=(function(){function r(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}return r.prototype.getCustomSetupFunc=function(t,e){var n=this;return function(a,i){n.minLoc==null&&(n.minLoc=a.getUniformLocationNoThrow(i,"minVal"),n.maxLoc=a.getUniformLocationNoThrow(i,"maxVal")),a.gl.uniform1f(n.minLoc,t),a.gl.uniform1f(n.maxLoc,e)}},r})(),OV=function(r){this.variableNames=["real","imag"],this.outputShape=r,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `},MV=function(r){this.outputShape=[],this.outputShape=hl(r,1),this.variableNames=r.map((function(u,l){return"T"+l}));var t=new Array(r.length-1);t[0]=r[0][1];for(var e=1;e<t.length;e++)t[e]=t[e-1]+r[e][1];var n=["if (yC < "+t[0]+") setOutput(getT0(yR, yC));"];for(e=1;e<t.length;e++){var a=t[e-1];n.push("else if (yC < "+t[e]+") setOutput(getT"+e+"(yR, yC-"+a+"));")}var i=t.length,o=t[t.length-1];n.push("else setOutput(getT"+i+"(yR, yC-"+o+"));"),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        `+n.join(`
        `)+`
      }
    `},BV=function(r,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=hl(r,t);var e=this.outputShape,n=e.length,a=We(n),i=Sr("coords",n),o=["x","y","z","w","u","v"].slice(0,n);this.variableNames=r.map((function(E,C){return"T"+C}));var u=new Array(r.length-1);u[0]=r[0][t];for(var l=1;l<u.length;l++)u[l]=u[l-1]+r[l][t];var h=o[t],f=o.slice(-2),p=o.join(),v="if ("+h+" < "+u[0]+`) {
        return getChannel(
            getT0(`+p+"), vec2("+f.join()+`));
        }`;for(l=1;l<u.length;l++){var m=u[l-1];v+=`
        if (`+h+" < "+u[l]+"  && "+h+" >= "+u[l-1]+`) {
          return getChannel(
            getT`+l+"("+Nf(o,h,m)+`),
            vec2(`+Nf(f,h,m)+`));
        }`}var x=u.length,b=u[u.length-1];v+=`
        return getChannel(
          getT`+x+"("+Nf(o,h,b)+`),
          vec2(`+Nf(f,h,b)+"));",this.userCode=`
      float getValue(`+o.map((function(E){return"int "+E}))+`) {
        `+v+`
      }

      void main() {
        `+a+` coords = getOutputCoords();
        vec4 result = vec4(getValue(`+i+`), 0., 0., 0.);

        `+i[n-1]+" = "+i[n-1]+` + 1;
        if (`+i[n-1]+" < "+e[n-1]+`) {
          result.g = getValue(`+i+`);
        }

        `+i[n-2]+" = "+i[n-2]+` + 1;
        if (`+i[n-2]+" < "+e[n-2]+`) {
          result.a = getValue(`+i+`);
        }

        `+i[n-1]+" = "+i[n-1]+` - 1;
        if (`+i[n-2]+" < "+e[n-2]+` &&
            `+i[n-1]+" < "+e[n-1]+`) {
          result.b = getValue(`+i+`);
        }
        setOutput(result);
      }
    `};function Nf(r,t,e){var n=r.indexOf(t);return r.map((function(a,i){return i===n?a+" - "+e:a})).join()}var PV=function(r){this.variableNames=["x","dy"],this.outputShape=r.filterShape;var t=r.strideHeight,e=r.strideWidth,n=r.padInfo.top,a=r.padInfo.left,i=r.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < `+r.batchSize+`; b++) {
          for (int yR = 0; yR < `+r.outHeight+`; yR++) {
            int xR = wR + yR * `+t+" - "+n+`;

            if (xR < 0 || xR >= `+r.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+r.outWidth+`; yC++) {
              int xC = wC + yC * `+e+" - "+a+`;

              if (xC < 0 || xC >= `+r.inWidth+`) {
                continue;
              }

              if (`+i+`) {
                float dyValue = getDy(b, yR, yC, d2);
                float xValue = getX(b, xR, xC, d1);
                dotProd += (xValue * dyValue);
              } else {
                float dyValue = getDy(b, d2, yR, yC);
                float xValue = getX(b, d1, xR, xC);
                dotProd += (xValue * dyValue);
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `},FV=function(r){this.variableNames=["dy","W"],this.outputShape=r.inShape;var t=r.filterHeight,e=r.filterWidth,n=r.strideHeight,a=r.strideWidth,i=r.dataFormat==="channelsLast",o=t-1-r.padInfo.top,u=e-1-r.padInfo.left,l=i?1:2,h=i?2:3,f=i?3:1;this.userCode=`
      const ivec2 pads = ivec2(`+o+", "+u+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[`+f+`];

        ivec2 dyCorner = ivec2(coords[`+l+"], coords["+h+`]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+t+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+n+`.0;

          if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+t+` - 1 - wR;

          for (int wC = 0; wC < `+e+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+a+`.0;

            if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+e+` - 1 - wC;

            for (int d2 = 0; d2 < `+r.outChannels+`; d2++) {

              if (`+i+`) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `},LV=function(r){this.variableNames=["x","dy"],this.outputShape=r.filterShape;var t=r.strideDepth,e=r.strideHeight,n=r.strideWidth,a=r.padInfo.front,i=r.padInfo.top,o=r.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < `+r.batchSize+`; b++) {
          for (int yF = 0; yF < `+r.outDepth+`; yF++) {
            int xF = wF + yF * `+t+" - "+a+`;

            if (xF < 0 || xF >= `+r.inDepth+`) {
              continue;
            }

            for (int yR = 0; yR < `+r.outHeight+`; yR++) {
              int xR = wR + yR * `+e+" - "+i+`;

              if (xR < 0 || xR >= `+r.inHeight+`) {
                continue;
              }

              for (int yC = 0; yC < `+r.outWidth+`; yC++) {
                int xC = wC + yC * `+n+" - "+o+`;

                if (xC < 0 || xC >= `+r.inWidth+`) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},zV=function(r){this.variableNames=["dy","W"],this.outputShape=r.inShape;var t=r.filterDepth,e=r.filterHeight,n=r.filterWidth,a=r.strideDepth,i=r.strideHeight,o=r.strideWidth,u=t-1-r.padInfo.front,l=e-1-r.padInfo.top,h=n-1-r.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(`+u+", "+l+", "+h+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < `+t+`; wF++) {
          float dyF = float(dyFCorner + wF) / `+a+`.0;

          if (dyF < 0.0 || dyF >= `+r.outDepth+`.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = `+t+` - 1 - wF;

          for (int wR = 0; wR < `+e+`; wR++) {
            float dyR = float(dyRCorner + wR) / `+i+`.0;

            if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = `+e+` - 1 - wR;

            for (int wC = 0; wC < `+n+`; wC++) {
              float dyC = float(dyCCorner + wC) / `+o+`.0;

              if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = `+n+` - 1 - wC;

              for (int d2 = 0; d2 < `+r.outChannels+`; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},UV=function(r){this.variableNames=["x","dy"],this.outputShape=r.filterShape;var t=r.strideHeight,e=r.strideWidth,n=r.padInfo.top,a=r.padInfo.left,i=r.outChannels/r.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * `+i+` + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < `+r.batchSize+`; b++) {
          for (int yR = 0; yR < `+r.outHeight+`; yR++) {
            int xR = wR + yR * `+t+" - "+n+`;

            if (xR < 0 || xR >= `+r.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+r.outWidth+`; yC++) {
              int xC = wC + yC * `+e+" - "+a+`;

              if (xC < 0 || xC >= `+r.inWidth+`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `},WV=function(r){this.variableNames=["dy","W"],this.outputShape=r.inShape;var t=r.filterHeight,e=r.filterWidth,n=r.strideHeight,a=r.strideWidth,i=t-1-r.padInfo.top,o=e-1-r.padInfo.left,u=r.outChannels/r.inChannels;this.userCode=`
      const ivec2 pads = ivec2(`+i+", "+o+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < `+t+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+n+`.0;

          if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+t+` - 1 - wR;

          for (int wC = 0; wC < `+e+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+a+`.0;

            if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+e+` - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < `+u+`; dm++) {
              int d2 = d1 * `+u+` + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `},Fw=function(r,t,e,n){t===void 0&&(t=!1),e===void 0&&(e=null),n===void 0&&(n=!1),this.variableNames=["x","W"],this.outputShape=r.outShape;var a=r.padInfo.top,i=r.padInfo.left,o=r.strideHeight,u=r.strideWidth,l=r.dilationHeight,h=r.dilationWidth,f=r.filterHeight,p=r.filterWidth,v=4*Math.floor(r.inChannels/4),m=r.inChannels%4,x=r.dataFormat==="channelsLast",b=x?1:2,E=x?2:3,C=x?3:1,R="",_="";e&&(R=n?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+e+`
        }`:`
          float activation(float x) {
            `+e+`
          }
        `,_="result = activation(result);");var A=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),n&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+R+`

      const ivec2 strides = ivec2(`+o+", "+u+`);
      const ivec2 pads = ivec2(`+a+", "+i+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[`+C+`];

        ivec2 xRCCorner =
            ivec2(coords[`+b+"], coords["+E+`]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+f+`; wR++) {
          int xR = xRCorner + wR * `+l+`;

          if (xR < 0 || xR >= `+r.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+p+`; wC++) {
            int xC = xCCorner + wC * `+h+`;

            if (xC < 0 || xC >= `+r.inWidth+`) {
              continue;
            }

            for (int d1 = 0; d1 < `+v+`; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (`+x+`) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (`+(m===1)+`) {

              if (`+x+`) {
                dotProd +=
                    getX(batch, xR, xC, `+v+`) *
                    getW(wR, wC, `+v+`, d2);
              } else {
                dotProd +=
                    getX(batch, `+v+`, xR, xC) *
                    getW(wR, wC, `+v+`, d2);
              }

            } else if (`+(m===2)+`) {
              vec2 wValues = vec2(
                getW(wR, wC, `+v+`, d2),
                getW(wR, wC, `+v+` + 1, d2)
              );

              if (`+x+`) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, `+v+`),
                  getX(batch, xR, xC, `+v+` + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, `+v+`, xR, xC),
                  getX(batch, `+v+` + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (`+(m===3)+`) {
              vec3 wValues = vec3(
                getW(wR, wC, `+v+`, d2),
                getW(wR, wC, `+v+` + 1, d2),
                getW(wR, wC, `+v+` + 2, d2)
              );

              if (`+x+`) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, `+v+`),
                  getX(batch, xR, xC, `+v+` + 1),
                  getX(batch, xR, xC, `+v+` + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, `+v+`, xR, xC),
                  getX(batch, `+v+` + 1, xR, xC),
                  getX(batch, `+v+` + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        `+A+`
        `+_+`
        setOutput(result);
      }
    `},VV=function(r){this.variableNames=["x","W"],this.outputShape=r.outShape;var t=r.padInfo.front,e=r.padInfo.top,n=r.padInfo.left,a=r.strideDepth,i=r.strideHeight,o=r.strideWidth,u=r.dilationDepth,l=r.dilationHeight,h=r.dilationWidth,f=r.filterDepth,p=r.filterHeight,v=r.filterWidth,m=4*Math.floor(r.inChannels/4),x=r.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(`+a+", "+i+", "+o+`);
      const ivec3 pads = ivec3(`+t+", "+e+", "+n+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < `+f+`; wF++) {
          int xF = xFCorner + wF * `+u+`;

          if (xF < 0 || xF >= `+r.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+p+`; wR++) {
            int xR = xRCorner + wR * `+l+`;

            if (xR < 0 || xR >= `+r.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+v+`; wC++) {
              int xC = xCCorner + wC * `+h+`;

              if (xC < 0 || xC >= `+r.inWidth+`) {
                continue;
              }

              for (int d1 = 0; d1 < `+m+`; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (`+(x===1)+`) {
                dotProd +=
                  getX(batch, xF, xR, xC, `+m+`) *
                  getW(wF, wR, wC, `+m+`, d2);
              } else if (`+(x===2)+`) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, `+m+`),
                  getX(batch, xF, xR, xC, `+m+` + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, `+m+`, d2),
                  getW(wF, wR, wC, `+m+` + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (`+(x===3)+`) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, `+m+`),
                  getX(batch, xF, xR, xC, `+m+` + 1),
                  getX(batch, xF, xR, xC, `+m+` + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, `+m+`, d2),
                  getW(wF, wR, wC, `+m+` + 1, d2),
                  getW(wF, wR, wC, `+m+` + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},Lw=function(r,t,e,n){t===void 0&&(t=!1),e===void 0&&(e=null),n===void 0&&(n=!1),this.variableNames=["x","W"],this.outputShape=r.outShape;var a=r.inHeight,i=r.inWidth,o=r.padInfo.top,u=r.padInfo.left,l=r.strideHeight,h=r.strideWidth,f=r.dilationHeight,p=r.dilationWidth,v=r.filterHeight,m=r.filterWidth,x=r.outChannels/r.inChannels,b="",E="";e&&(b=n?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+e+`
        }`:`
          float activation(float x) {
            `+e+`
          }
        `,E="result = activation(result);");var C=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),n&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+b+`

      const ivec2 strides = ivec2(`+l+", "+h+`);
      const ivec2 pads = ivec2(`+o+", "+u+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `+x+`;
        int q = d2 - d1 * `+x+`;

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < `+v+`; wR++) {
          int xR = xRCorner + wR * `+f+`;

          if (xR < 0 || xR >= `+a+`) {
            continue;
          }

          for (int wC = 0; wC < `+m+`; wC++) {
            int xC = xCCorner + wC * `+p+`;

            if (xC < 0 || xC >= `+i+`) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        `+C+`
        `+E+`
        setOutput(result);
      }
    `},zw=function(r,t,e,n){t===void 0&&(t=!1),e===void 0&&(e=null),n===void 0&&(n=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r.outShape;for(var a=r.inHeight,i=r.inWidth,o=r.padInfo.top,u=r.padInfo.left,l=r.strideHeight,h=r.strideWidth,f=r.dilationHeight,p=r.dilationWidth,v=r.filterHeight,m=r.filterWidth,x=m,b="int xR; int xC; int xCOffset;",E=0;E<v;E++)for(var C=0;C<m;C++)b+=`
          vec4 xTexelR`+E+"C"+2*C+` = vec4(0.);
          vec4 wR`+E+"C"+C+` = vec4(0.);
          vec4 xR`+E+"C"+C+" = vec4(0.);";for(E=0;E<v;E++)for(var R=0;R<x;R++){if(b+=`
          xR = xRCorner + `+E*f+`;
          xC = xCCorner + `+(C=2*R)*p+`;
        `,h===1){if(C<m&&(b+=u%2==1?`
                xCOffset = xC + 1;
                if(xR >= 0 && xR < `+a+" && xCOffset >= 0 && xCOffset < "+i+`) {
                  xTexelR`+E+"C"+C+` = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+i+`) {
                    xTexelR`+E+"C"+C+`.zw = vec2(0.);
                  }
                } else {
                  xTexelR`+E+"C"+C+` = vec4(0.);
                }

                xCOffset = xC + 1 - 2;
                if(xR >= 0 && xR < `+a+" && xCOffset >= 0 && xCOffset < "+i+`) {
                  vec4 previous = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+i+`) {
                    previous.zw = vec2(0.);
                  }

                  xR`+E+"C"+C+" = vec4(previous.zw, xTexelR"+E+"C"+C+`.xy);
                } else {
                  xR`+E+"C"+C+" = vec4(0, 0, xTexelR"+E+"C"+C+`.xy);
                }
              `:`
                if(xR >= 0 && xR < `+a+" && xC >= 0 && xC < "+i+`) {
                  xTexelR`+E+"C"+C+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+E+"C"+C+` = vec4(0.);
                }

                xR`+E+"C"+C+" = xTexelR"+E+"C"+C+`;
              `,C+1<m)){var _=u%2==0?yS(p):p;p%2==0&&u%2==1||p%2!=0&&u%2!=1?(b+=`
                  xCOffset = xC + `+u%2+" + "+_+`;

                  if(xR >= 0 && xR < `+a+` &&
                    xCOffset >= 0 && xCOffset < `+i+`) {
                    xTexelR`+E+"C"+(C+2)+` = getX(batch, xR, xCOffset, d1);
                  }
                `,p>1&&(b+=`
                    xCOffset -= 2;
                    if(xR >= 0 && xR < `+a+` &&
                      xCOffset >= 0 && xCOffset < `+i+`) {
                      xTexelR`+E+"C"+C+` = getX(batch, xR, xCOffset, d1);
                    } else {
                      xTexelR`+E+"C"+C+` = vec4(0.);
                    }
                  `),b+=`
                  xR`+E+"C"+(C+1)+` = vec4(
                    xTexelR`+E+"C"+C+".zw, xTexelR"+E+"C"+(C+2)+`.xy);
                `):b+=`
                  xCOffset = xC + `+_+`;

                  if(xR >= 0 && xR < `+a+` &&
                    xCOffset >= 0 && xCOffset < `+i+`) {
                    xTexelR`+E+"C"+(C+2)+` = getX(batch, xR, xCOffset, d1);
                  }

                  xR`+E+"C"+(C+1)+" = xTexelR"+E+"C"+(C+2)+`;
                `}}else C<m&&(b+=`
              if(xR >= 0 && xR < `+a+`) {
            `,u%2==1?(b+=`
                xCOffset = xC + 1 - `+h+`;
                if(xCOffset >= 0 && xCOffset < `+i+`) {
                  xTexelR`+E+"C"+C+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+E+"C"+C+` = vec4(0.);
                }

                if(xC + 1 >= 0 && xC + 1 < `+i+`) {
                  xTexelR`+E+"C"+(C+2)+` = getX(batch, xR, xC + 1, d1);
                } else {
                  xTexelR`+E+"C"+(C+2)+` = vec4(0.);
                }

                xR`+E+"C"+C+` = vec4(
                  xTexelR`+E+"C"+C+".zw, xTexelR"+E+"C"+(C+2)+`.zw);
              `,C+1<m&&(b+=`
                  vec4 final = vec4(0.);
                  xCOffset = xC + 1 + `+h+`;
                  if(xCOffset >= 0 && xCOffset < `+i+`) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xR`+E+"C"+(C+1)+" = vec4(xTexelR"+E+"C"+(C+2)+`.xy, final.xy);
                `)):(b+=`
                if(xC >= 0 && xC < `+i+`) {
                  xTexelR`+E+"C"+C+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+E+"C"+C+` = vec4(0.);
                }

                xCOffset = xC + `+h+`;
                if(xCOffset >= 0 && xCOffset < `+i+`) {
                  xTexelR`+E+"C"+(C+2)+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+E+"C"+(C+2)+` = vec4(0.);
                }

                xR`+E+"C"+C+` = vec4(
                  xTexelR`+E+"C"+C+".xy, xTexelR"+E+"C"+(C+2)+`.xy);
              `,C+1<m&&(b+=`
                  xR`+E+"C"+(C+1)+` = vec4(
                    xTexelR`+E+"C"+C+".zw, xTexelR"+E+"C"+(C+2)+`.zw);
                `)),b+="}");C<m&&(b+=`
            vec4 wTexelR`+E+"C"+C+" = getW("+E+", "+C+`, d1, q);
            wR`+E+"C"+C+" = vec4(wTexelR"+E+"C"+C+".xz, wTexelR"+E+"C"+C+`.xz);
          `,C+1<m&&(b+=`
              vec4 wTexelR`+E+"C"+(C+1)+" = getW("+E+", "+(C+1)+`, d1, q);
              wR`+E+"C"+(C+1)+` =
                vec4(wTexelR`+E+"C"+(C+1)+".xz, wTexelR"+E+"C"+(C+1)+".xz);"))}for(E=0;E<v;E++)for(C=0;C<m;C++)b+="dotProd += xR"+E+"C"+C+" * wR"+E+"C"+C+";";var A="",k="";e&&(A=n?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+e+`
        }`:`vec4 activation(vec4 x) {
          `+e+`
        }`,k="result = activation(result);");var D=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),n&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+A+`

      const ivec2 strides = ivec2(`+l+", "+h+`);
      const ivec2 pads = ivec2(`+o+", "+u+`);

      void main() {

        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2;
        int q = 0;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        vec4 dotProd = vec4(0.);

        `+b+`

        vec4 result = dotProd;
        `+D+`
        `+k+`
        setOutput(result);
      }
    `},GV=function(r,t,e,n,a){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var i=r[0],o=r[1],u=r[2],l=r[3],h=t[0],f=e[0],p=e[1];this.outputShape=[h,f,p,l];var v=n==="bilinear"?1:0,m=[o-1+".0",u-1+".0"],x=m[0],b=m[1],E=f>1?[""+(o-1)/(f-1),"(y2-y1) * height_ratio","y1*"+x+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+x],C=E[0],R=E[1],_=E[2],A=p>1?[""+(u-1)/(p-1),"(x2-x1) * width_ratio","x1*"+b+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+b],k=A[0],D=A[1],P=A[2];this.userCode=`
      const float height_ratio = float(`+C+`);
      const float width_ratio = float(`+k+`);
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= `+i+`) {
          return;
        }

        float height_scale = `+R+`;
        float width_scale = `+D+`;

        float in_y = `+_+`;
        if( in_y < 0.0 || in_y > `+x+` ) {
          setOutput(float(`+a+`));
          return;
        }
        float in_x = `+P+`;
        if( in_x < 0.0 || in_x > `+b+` ) {
          setOutput(float(`+a+`));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(`+v+` == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `},HV=function(r,t,e){this.variableNames=["x"],this.outputShape=r;var n=r.length,a=r[r.length-1],i=e?"<":">";this.userCode=`
      int getIndex(int i) {
        `+(e?"return "+a+" -i - 1;":"return i;")+`
      }

      void main() {
        `+We(n)+` coords = getOutputCoords();
        int end = `+Uw(n,"coords")+`;
        float val = 0.0;
        for (int i = `+a+` - 1; i >= 0; i -= 1) {
          int idx = getIndex(i);
          if (idx `+i+` end) {
            continue;
          }
          if (idx == end && `+t+`) {
            continue;
          }
          `+Uw(n,"coords")+` = idx;
          val += getX(`+(function(o,u){if(o===1)return""+u;if(o===2)return u+".x, "+u+".y";if(o===3)return u+".x, "+u+".y, "+u+".z";if(o===4)return u+".x, "+u+".y, "+u+".z, "+u+".w";throw Error("Cumulative sum for rank "+o+" is not yet supported")})(n,"coords")+`);
        }
        setOutput(val);
      }
    `};function Uw(r,t){if(r===1)return""+t;if(r===2)return t+".y";if(r===3)return t+".z";if(r===4)return t+".w";throw Error("Cumulative sum for rank "+r+" is not yet supported")}var qV=function(r){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Oc.DENSE;var t=Ac(r),e=ar();this.outputShape=r,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+Iu(["r","c","d"],r)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+t[0]+", "+t[1]+`));
        int index = 4 * (resTexRC.x * `+t[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        `+e.output+` = result;
      }
    `},jV=function(r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Oc.DENSE;var t=Ac(r),e=ar();this.outputShape=r,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+Iu(["r","c","d"],r)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+t[0]+", "+t[1]+`));
        int index = 4 * (resTexRC.x * `+t[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        `+e.output+` = result;
      }
    `},XV=(function(){function r(t,e,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=e,this.dataFormat=n,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = `+this.getHeightCoordString()+`;
      int w = `+this.getWidthCoordString()+`;
      int d = `+this.getDepthCoordString()+`;

      int in_h = h / `+e+`;
      int offset_h = imod(h, `+e+`);
      int in_w = w / `+e+`;
      int offset_w = imod(w, `+e+`);
      int offset_d = (offset_h * `+e+` + offset_w) *
        `+this.getOutputDepthSize()+`;
      int in_d = d + offset_d;

      float result = `+this.getInputSamplingString()+`;
      setOutput(result);
    }
  `}return r.prototype.getHeightCoordString=function(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"},r.prototype.getWidthCoordString=function(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"},r.prototype.getDepthCoordString=function(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"},r.prototype.getOutputDepthSize=function(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]},r.prototype.getInputSamplingString=function(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},r})(),KV=function(r){this.variableNames=["X"],this.outputShape=[r,r],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `},YV=function(r){this.variableNames=["A"],this.outTexUsage=Kr.DOWNLOAD;var t=ar();this.outputShape=r,this.userCode=`
      `+oR+`

      void main() {
        float x = getAAtOutCoords();
        `+t.output+` = encode_float(x);
      }
    `},QV=function(r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Kr.DOWNLOAD;var t=ar();this.outputShape=r,this.userCode=`
      `+oR+`

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        `+t.output+` = encode_float(x);
      }
    `},ZV=function(r,t,e){e===void 0&&(e=!1),this.variableNames=["A"];var n=ar(),a=t[0],i=t[1];this.outputShape=r;var o="result";e&&(o="floor(result * 255. + 0.5)"),this.userCode=`
      `+hy(r)+`

      void main() {
        ivec3 coords = getOutputCoords();

        int flatIndex = getFlatIndex(coords);
        int offset = imod(flatIndex, 4);

        flatIndex = idiv(flatIndex, 4, 1.);
        
        int r = flatIndex / `+i+`;
        int c = imod(flatIndex, `+i+`);
        vec2 uv = (vec2(c, r) + halfCR) / vec2(`+i+".0, "+a+`.0);
        vec4 values = `+n.texture2D+`(A, uv);

        float result;

        if(offset == 0) {
          result = values[0];
        } else if(offset == 1) {
          result = values[1];
        } else if(offset == 2) {
          result = values[2];
        } else {
          result = values[3];
        }

        `+n.output+" = vec4("+o+`, 0., 0., 0.);
      }
    `},$V=function(r,t,e){e===void 0&&(e=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var n=ar(),a=t[0],i=t[1];this.outputShape=r;var o="",u="result";e&&(u="floor(result * 255. + 0.5)");for(var l=0;l<=1;l++)for(var h=0;h<=1;h++){var f=2*l+h;o+=`
          localCoords = coords;
          if(localCoords[2] + `+h+" < "+r[2]+`) {
            localCoords[2] += `+h+`;
            if(localCoords[1] + `+l+" < "+r[1]+`) {
              localCoords[1] += `+l+`;

              flatIndex = getFlatIndex(localCoords);
              offset = imod(flatIndex, 4);

              flatIndex = idiv(flatIndex, 4, 1.);

              r = flatIndex / `+i+`;
              c = imod(flatIndex, `+i+`);
              uv = (vec2(c, r) + halfCR) / vec2(`+i+".0, "+a+`.0);
              values = `+n.texture2D+`(A, uv);

              if(offset == 0) {
                result[`+f+`] = values[0];
              } else if(offset == 1) {
                result[`+f+`] = values[1];
              } else if(offset == 2) {
                result[`+f+`] = values[2];
              } else {
                result[`+f+`] = values[3];
              }
            }
          }
        `}this.userCode=`
      `+hy(r)+`

      void main() {
        ivec3 coords = getOutputCoords();

        vec4 result = vec4(0.);
        int flatIndex, r, c, offset;
        ivec3 localCoords;
        vec2 uv;
        vec4 values;

        `+o+`

        `+n.output+" = "+u+`;
      }
    `},JV="return real * expR - imag * expI;",t6="return real * expI + imag * expR;",Ww=function(r,t,e){this.variableNames=["real","imag"];var n=t[1];this.outputShape=t;var a=e?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,i=e?n+".0":"1.0";this.userCode=`
      const float exponentMultiplier = `+a+`;

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        `+r+`
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(`+n+`);
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < `+n+`; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / `+i+`;
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `},e6=(function(){function r(t,e){this.outputShape=[],this.variableNames=["x"],this.outputShape=t,this.userCode=`
      uniform float value;
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}return r.prototype.getCustomSetupFunc=function(t){var e=this;return function(n,a){e.valueLoc==null&&(e.valueLoc=n.getUniformLocationNoThrow(a,"value")),n.gl.uniform1f(e.valueLoc,t)}},r})(),n6=function(r,t,e){this.variableNames=["A","indices"];var n=r.slice();n[e]=t,this.outputShape=n,this.rank=n.length;var a=We(this.rank),i=(function(o,u){var l=o.length;if(l>4)throw Error("Gather for rank "+l+" is not yet supported");if(l===1)return"int(getIndices(resRC))";for(var h=["resRC.x","resRC.y","resRC.z","resRC.w"],f=[],p=0;p<o.length;p++)p===u?f.push("int(getIndices("+h[p]+"))"):f.push(""+h[p]);return f.join()})(r,e);this.userCode=`
      void main() {
        `+a+` resRC = getOutputCoords();
        setOutput(getA(`+i+`));
      }
    `},r6=function(r,t,e){this.sliceDim=r,this.strides=t,this.variableNames=["x","indices"],this.outputShape=e;var n=We(t.length),a=We(e.length),i=this.sliceDim>1?"strides[j]":"strides";this.userCode=`
        `+n+" strides = "+n+"("+this.strides+`);
         void main() {
          `+a+` coords = getOutputCoords();
          int flattenIndex = 0;
          for (int j = 0; j < `+this.sliceDim+`; j++) {
            int index = round(getIndices(coords[0], j));
            flattenIndex += index * `+i+`;
          }
          setOutput(getX(flattenIndex, coords[1]));
        }
      `};function a6(r,t){var e=ar();return A3(r,t,e.version+`
    precision highp float;
    `+e.attribute+` vec3 clipSpacePos;
    `+e.attribute+` vec2 uv;
    `+e.varyingVs+` vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`)}function i6(r,t){return N3(r,t,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function o6(r,t){return O3(r,t,new Uint16Array([0,1,2,2,1,3]))}function rh(r,t,e,n,a,i,o){B3(e,n);var u=M3(r,t),l=r.TEXTURE_2D;return zt(r,t,(function(){return r.bindTexture(l,u)})),zt(r,t,(function(){return r.texParameteri(l,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE)})),zt(r,t,(function(){return r.texParameteri(l,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE)})),zt(r,t,(function(){return r.texParameteri(l,r.TEXTURE_MIN_FILTER,r.NEAREST)})),zt(r,t,(function(){return r.texParameteri(l,r.TEXTURE_MAG_FILTER,r.NEAREST)})),zt(r,t,(function(){return r.texImage2D(l,0,a,e,n,0,i,o,null)})),zt(r,t,(function(){return r.bindTexture(r.TEXTURE_2D,null)})),u}function u6(r,t,e,n,a){var i=Dd(e,n);return rh(r,t,i[0],i[1],a.internalFormatFloat,a.textureFormatFloat,r.FLOAT)}function s6(r,t,e,n,a){var i=Dd(e,n);return rh(r,t,i[0],i[1],a.internalFormatHalfFloat,a.textureFormatFloat,a.textureTypeHalfFloat)}function l6(r,t,e,n,a){var i=Dd(e,n);return rh(r,t,i[0],i[1],r.RGBA,r.RGBA,r.UNSIGNED_BYTE)}function c6(r,t,e,n,a){var i=nh(e,n);return rh(r,t,i[0],i[1],a.internalFormatPackedFloat,r.RGBA,r.FLOAT)}function h6(r,t,e,n,a){var i=nh(e,n);return rh(r,t,i[0],i[1],a.internalFormatPackedHalfFloat,r.RGBA,a.textureTypeHalfFloat)}function f6(r,t,e,n){return zt(r,t,(function(){return r.bindBuffer(r.ARRAY_BUFFER,n)})),Tw(r,t,e,"clipSpacePos",n,3,20,0)&&Tw(r,t,e,"uv",n,2,20,12)}function d6(r,t,e,n,a,i,o){var u,l,h;zt(r,t,(function(){return r.bindTexture(r.TEXTURE_2D,e)})),i instanceof Uint8Array?(u=new Uint8Array(n*a*4),l=r.UNSIGNED_BYTE,h=r.RGBA):(u=new Float32Array(n*a*4),l=r.FLOAT,h=o.internalFormatPackedFloat),u.set(i),zt(r,t,(function(){return r.texImage2D(r.TEXTURE_2D,0,h,n,a,0,r.RGBA,l,u)})),zt(r,t,(function(){return r.bindTexture(r.TEXTURE_2D,null)}))}function p6(r,t,e,n){zt(r,t,(function(){return r.bindTexture(r.TEXTURE_2D,e)})),n.data instanceof Uint8Array?zt(r,t,(function(){return r.texImage2D(r.TEXTURE_2D,0,r.RGBA,n.width,n.height,0,r.RGBA,r.UNSIGNED_BYTE,n.data)})):zt(r,t,(function(){return r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,n)})),zt(r,t,(function(){return r.bindTexture(r.TEXTURE_2D,null)}))}function v6(r,t,e,n,a){var i=r.createBuffer();zt(r,t,(function(){return r.bindBuffer(r.PIXEL_PACK_BUFFER,i)}));var o=16*e*n;return zt(r,t,(function(){return r.bufferData(r.PIXEL_PACK_BUFFER,o,r.STREAM_READ)})),zt(r,t,(function(){return r.readPixels(0,0,n,e,r.RGBA,r.FLOAT,0)})),zt(r,t,(function(){return r.bindBuffer(r.PIXEL_PACK_BUFFER,null)})),i}function m6(r,t,e){var n=r,a=new Float32Array(e);return n.bindBuffer(n.PIXEL_PACK_BUFFER,t),n.getBufferSubData(n.PIXEL_PACK_BUFFER,0,a),n.bindBuffer(n.PIXEL_PACK_BUFFER,null),a}function g6(r,t,e,n,a){var i=Dd(e,n),o=i[0],u=i[1],l=new Uint8Array(e*n*4);return zt(r,t,(function(){return r.readPixels(0,0,o,u,a.downloadTextureFormat,r.UNSIGNED_BYTE,l)})),new Float32Array(l.buffer)}function y6(r,t,e,n,a,i,o,u){var l=r,h=new Float32Array((function(f,p){var v=nh(f,p);return v[0]*v[1]*4})(i,o));return l.bindBuffer(l.PIXEL_PACK_BUFFER,t),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,h),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),h}function x6(r,t,e,n){var a=new Float32Array(e*n*4);return zt(r,t,(function(){return r.readPixels(0,0,n,e,r.RGBA,r.FLOAT,a)})),a}var b6=(function(){function r(t){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var e=yt().getNumber("WEBGL_VERSION");t!=null?(this.gl=t,E3(e,t)):this.gl=Ci(e);var n="WEBGL_color_buffer_float";if(yt().getNumber("WEBGL_VERSION")===1){if(this.textureFloatExtension=Tf(this.gl,this.debug,"OES_texture_float"),ya(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=Tf(this.gl,this.debug,"OES_texture_half_float");else if(yt().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(n),ya(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=Tf(this.gl,this.debug,"EXT_color_buffer_half_float");else if(yt().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(n="EXT_color_buffer_float",ya(this.gl,n))this.colorBufferFloatExtension=this.gl.getExtension(n);else{if(!ya(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=i6(this.gl,this.debug),this.indexBuffer=o6(this.gl,this.debug),this.framebuffer=P3(this.gl,this.debug),this.textureConfig=ey(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(r.prototype,"debug",{get:function(){return yt().getBool("DEBUG")},enumerable:!0,configurable:!0}),r.prototype.dispose=function(){var t=this;if(!this.disposed){this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var e=this.gl;zt(e,this.debug,(function(){return e.finish()})),zt(e,this.debug,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,null)})),zt(e,this.debug,(function(){return e.deleteFramebuffer(t.framebuffer)})),zt(e,this.debug,(function(){return e.bindBuffer(e.ARRAY_BUFFER,null)})),zt(e,this.debug,(function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)})),zt(e,this.debug,(function(){return e.deleteBuffer(t.indexBuffer)})),this.disposed=!0}},r.prototype.createFloat32MatrixTexture=function(t,e){return this.throwIfDisposed(),u6(this.gl,this.debug,t,e,this.textureConfig)},r.prototype.createFloat16MatrixTexture=function(t,e){return this.throwIfDisposed(),s6(this.gl,this.debug,t,e,this.textureConfig)},r.prototype.createUnsignedBytesMatrixTexture=function(t,e){return this.throwIfDisposed(),l6(this.gl,this.debug,t,e,this.textureConfig)},r.prototype.uploadPixelDataToTexture=function(t,e){this.throwIfDisposed(),p6(this.gl,this.debug,t,e)},r.prototype.uploadDenseMatrixToTexture=function(t,e,n,a){this.throwIfDisposed(),d6(this.gl,this.debug,t,e,n,a,this.textureConfig)},r.prototype.createFloat16PackedMatrixTexture=function(t,e){return this.throwIfDisposed(),h6(this.gl,this.debug,t,e,this.textureConfig)},r.prototype.createPackedMatrixTexture=function(t,e){return this.throwIfDisposed(),c6(this.gl,this.debug,t,e,this.textureConfig)},r.prototype.deleteMatrixTexture=function(t){var e=this;this.throwIfDisposed(),this.outputTexture===t&&(kw(this.gl,this.debug,this.framebuffer),this.outputTexture=null),zt(this.gl,this.debug,(function(){return e.gl.deleteTexture(t)}))},r.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(t,e,n){var a=this;return this.downloadMatrixDriver(t,(function(){return g6(a.gl,a.debug,e,n,a.textureConfig)}))},r.prototype.downloadPackedMatrixFromBuffer=function(t,e,n,a,i,o){return y6(this.gl,t,0,0,0,i,o,this.textureConfig)},r.prototype.downloadFloat32MatrixFromBuffer=function(t,e){return m6(this.gl,t,e)},r.prototype.createBufferFromTexture=function(t,e,n){this.bindTextureToFrameBuffer(t);var a=v6(this.gl,this.debug,e,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),a},r.prototype.createAndWaitForFence=function(){var t=this.createFence(this.gl);return this.pollFence(t)},r.prototype.createFence=function(t){var e,n,a=this;if(yt().getBool("WEBGL_FENCE_API_ENABLED")){var i=t,o=i.fenceSync(i.SYNC_GPU_COMMANDS_COMPLETE,0);t.flush(),n=function(){var u=i.clientWaitSync(o,0,0);return u===i.ALREADY_SIGNALED||u===i.CONDITION_SATISFIED},e=o}else yt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(e=this.beginQuery(),this.endQuery(),n=function(){return a.isQueryAvailable(e,yt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):n=function(){return!0};return{query:e,isFencePassed:n}},r.prototype.downloadMatrixFromPackedTexture=function(t,e,n){var a=this;return this.downloadMatrixDriver(t,(function(){return x6(a.gl,a.debug,e,n)}))},r.prototype.createProgram=function(t){this.throwIfDisposed();var e=this.gl,n=T3(e,this.debug,t),a=a6(e,this.debug),i=D3(e,this.debug);return zt(e,this.debug,(function(){return e.attachShader(i,a)})),zt(e,this.debug,(function(){return e.attachShader(i,n)})),I3(e,this.debug,i),this.debug&&Rm(e,this.debug,i),this.vertexAttrsAreBound||(this.setProgram(i),this.vertexAttrsAreBound=f6(e,this.debug,this.program,this.vertexBuffer)),i},r.prototype.deleteProgram=function(t){var e=this;this.throwIfDisposed(),t===this.program&&(this.program=null),t!=null&&zt(this.gl,this.debug,(function(){return e.gl.deleteProgram(t)}))},r.prototype.setProgram=function(t){var e=this;this.throwIfDisposed(),this.program=t,this.program!=null&&this.debug&&Rm(this.gl,this.debug,this.program),zt(this.gl,this.debug,(function(){return e.gl.useProgram(t)}))},r.prototype.getUniformLocation=function(t,e,n){return n===void 0&&(n=!0),this.throwIfDisposed(),n?L3(this.gl,this.debug,t,e):z3(this.gl,t,e)},r.prototype.getAttributeLocation=function(t,e){var n=this;return this.throwIfDisposed(),zt(this.gl,this.debug,(function(){return n.gl.getAttribLocation(t,e)}))},r.prototype.getUniformLocationNoThrow=function(t,e){return this.throwIfDisposed(),this.gl.getUniformLocation(t,e)},r.prototype.setInputMatrixTexture=function(t,e,n){this.throwIfDisposed(),this.throwIfNoProgram(),U3(this.gl,this.debug,this.program,t,e,n)},r.prototype.setOutputMatrixTexture=function(t,e,n){this.setOutputMatrixTextureDriver(t,n,e)},r.prototype.setOutputPackedMatrixTexture=function(t,e,n){this.throwIfDisposed();var a=nh(e,n),i=a[0],o=a[1];this.setOutputMatrixTextureDriver(t,i,o)},r.prototype.setOutputMatrixWriteRegion=function(t,e,n,a){this.setOutputMatrixWriteRegionDriver(n,t,a,e)},r.prototype.setOutputPackedMatrixWriteRegion=function(t,e,n,a){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},r.prototype.debugValidate=function(){this.program!=null&&Rm(this.gl,this.debug,this.program),kf(this.gl)},r.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var t=this.gl;this.debug&&this.debugValidate(),zt(t,this.debug,(function(){return t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0)}))},r.prototype.blockUntilAllProgramsCompleted=function(){var t=this;this.throwIfDisposed(),zt(this.gl,this.debug,(function(){return t.gl.finish()}))},r.prototype.getQueryTimerExtension=function(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=Tf(this.gl,this.debug,yt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},r.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},r.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},r.prototype.beginQuery=function(){if(yt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var t=this.gl,e=this.getQueryTimerExtensionWebGL2(),n=t.createQuery();return t.beginQuery(e.TIME_ELAPSED_EXT,n),n}var a=this.getQueryTimerExtensionWebGL1(),i=a.createQueryEXT();return a.beginQueryEXT(a.TIME_ELAPSED_EXT,i),i},r.prototype.endQuery=function(){if(yt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")!==2){var t=this.getQueryTimerExtensionWebGL1();t.endQueryEXT(t.TIME_ELAPSED_EXT)}else{var e=this.gl,n=this.getQueryTimerExtensionWebGL2();e.endQuery(n.TIME_ELAPSED_EXT)}},r.prototype.waitForQueryAndGetTime=function(t){return Mt(this,void 0,void 0,(function(){var e=this;return Bt(this,(function(n){switch(n.label){case 0:return[4,Cw((function(){return e.disposed||e.isQueryAvailable(t,yt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}))];case 1:return n.sent(),[2,this.getQueryTime(t,yt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}}))}))},r.prototype.getQueryTime=function(t,e){if(e===0)return null;if(e===2){var n=this.gl;return n.getQueryParameter(t,n.QUERY_RESULT)/1e6}var a=this.getQueryTimerExtensionWebGL1();return a.getQueryObjectEXT(t,a.QUERY_RESULT_EXT)/1e6},r.prototype.isQueryAvailable=function(t,e){if(e===0)return!0;if(e===2){var n=this.gl,a=this.getQueryTimerExtensionWebGL2(),i=n.getQueryParameter(t,n.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(a.GPU_DISJOINT_EXT)),i&&!this.disjoint}return i=(a=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(t,a.QUERY_RESULT_AVAILABLE_EXT),this.disjoint==null&&(this.disjoint=this.gl.getParameter(a.GPU_DISJOINT_EXT)),i&&!this.disjoint},r.prototype.pollFence=function(t){var e=this;return new Promise((function(n){e.addItemToPoll((function(){return t.isFencePassed()}),(function(){return n()}))}))},r.prototype.pollItems=function(){for(var t=(function(n){for(var a=0;a<n.length&&n[a]();++a);return a-1})(this.itemsToPoll.map((function(n){return n.isDoneFn}))),e=0;e<=t;++e)(0,this.itemsToPoll[e].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(t+1)},r.prototype.addItemToPoll=function(t,e){var n=this;this.itemsToPoll.push({isDoneFn:t,resolveFn:e}),this.itemsToPoll.length>1||Cw((function(){return n.pollItems(),n.itemsToPoll.length===0}))},r.prototype.bindTextureToFrameBuffer=function(t){this.throwIfDisposed(),_m(this.gl,this.debug,t,this.framebuffer),this.debug&&kf(this.gl)},r.prototype.unbindTextureToFrameBuffer=function(){this.outputTexture!=null?(_m(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&kf(this.gl)):kw(this.gl,this.debug,this.framebuffer)},r.prototype.downloadMatrixDriver=function(t,e){this.bindTextureToFrameBuffer(t);var n=e();return this.unbindTextureToFrameBuffer(),n},r.prototype.setOutputMatrixTextureDriver=function(t,e,n){this.throwIfDisposed();var a=this.gl;_m(a,this.debug,t,this.framebuffer),this.debug&&kf(a),this.outputTexture=t,zt(a,this.debug,(function(){return a.viewport(0,0,e,n)})),zt(a,this.debug,(function(){return a.scissor(0,0,e,n)}))},r.prototype.setOutputMatrixWriteRegionDriver=function(t,e,n,a){var i=this;this.throwIfDisposed(),zt(this.gl,this.debug,(function(){return i.gl.scissor(t,e,n,a)}))},r.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},r.prototype.throwIfNoProgram=function(){if(this.program==null)throw new Error("No GPU program is currently set.")},r})();function Vw(r,t){if(r.length!==t.length)throw Error("Binary was compiled with "+r.length+" inputs, but was executed with "+t.length+" inputs");r.forEach((function(e,n){var a=e.logicalShape,i=t[n],o=i.shape;if(!Wn(a,o))throw Error("Binary was compiled with different shapes than the current args. Shapes "+a+" and "+o+" must match");if(!e.isUniform||!i.isUniform){var u=e.texShape,l=i.isUniform?null:i.texData.texShape;if(!Wn(u,l))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+u+" and "+l+" must match")}}))}var w6=function(r,t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r;for(var n=e.filterWidth,a=e.inChannels,i=e.strideWidth,o=e.strideHeight,u=e.padInfo,l=e.outWidth,h=e.dilationWidth,f=e.dilationHeight,p=e.dataFormat,v=u.left,m=u.top,x=a*n,b=ar(),E=p==="channelsLast",C=E?0:1,R=E?1:2,_="",A=0;A<=1;A++)for(var k=0;k<=1;k++)_+=`
          blockIndex = rc.y + `+k+`;
          pos = rc.x + `+A+`;

          if(blockIndex < `+r[1]+" && pos < "+r[0]+`) {
            offsetY = int(blockIndex / (`+l+")) * "+o+" - "+m+`;
            d0 = offsetY + `+f+" * (pos / "+x+`);

            if(d0 < `+t[C]+` && d0 >= 0) {

              offsetX = int(mod(float(blockIndex), `+l+".) * "+i+". - "+v+`.);
              d1 = offsetX + `+h+" * (int(mod(float(pos), "+x+".) / "+a+`.));

              if(d1 < `+t[R]+` && d1 >= 0) {

                ch = int(mod(float(pos), `+a+`.));

                if (`+E+`) {
                  innerDims = vec2(d1, ch);
                  result[`+(2*A+k)+`] = getChannel(
                    getA(d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[`+(2*A+k)+`] = getChannel(
                    getA(ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec2 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        `+_+`

        `+b.output+` = result;
      }
    `},E6=function(r,t,e,n,a){this.variableNames=["x"],this.outputShape=[];var i,o=t,u=r[3]-1;this.outputShape=r;var l="float("+e+") + float("+n+") * sum";i=a===.5?"inversesqrt("+l+")":a===1?"1.0/("+l+")":"exp(log("+l+") * float(-"+a+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -`+o+"; j <= "+o+`; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  `+u+`) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * `+i+`;
        setOutput(val);
      }
    `},C6=function(r,t,e,n,a){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=r,this.depth=r[3],this.depthRadius=t,this.bias=e,this.alpha=n,this.beta=a,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < `+this.depth+`; ++d) {
          int depthBegin = int(max(0.0, float(d - `+t+`)));
          int depthEnd = int(min(float(`+this.depth+`),
              float(d + `+t+` + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = `+this.depth+`;

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(`+n+") * norm + float("+e+`);

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(`+n+`)
                * float(`+a+`)
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * `+a+`);
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `},S6=function(r,t,e,n,a){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var i,o=t,u=r[3]-1;this.outputShape=r;var l="float("+e+") + float("+n+") * sum";i=a===.5?"inversesqrt("+l+")":a===1?"1.0/("+l+")":"exp(log("+l+") * float(-"+a+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < `+this.outputShape[3]+`;
        bool hasNextRow = c < `+this.outputShape[2]+`;

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - `+o+`;
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - `+o+"; j <= "+o+`; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(`+u+`));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * `+i+`;
        setOutput(result);
      }
    `},R6=function(r){this.variableNames=["dy","maxPos"],this.outputShape=r.inShape;var t=r.strideHeight,e=r.strideWidth,n=r.dilationHeight,a=r.effectiveFilterHeight,i=r.effectiveFilterWidth,o=a-1-r.padInfo.top,u=i-1-r.padInfo.left,l=a*i-1;this.userCode=`
      const ivec2 pads = ivec2(`+o+", "+u+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+a+`;
          wR += `+n+`) {
          float dyR = float(dyRCorner + wR) / `+t+`.0;

          if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+i+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+e+`.0;

            if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = `+l+` - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * `+i+` + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `},_6=function(r){this.variableNames=["dy","maxPos"],this.outputShape=r.inShape;var t=r.strideDepth,e=r.strideHeight,n=r.strideWidth,a=r.dilationDepth,i=r.dilationHeight,o=r.dilationWidth,u=r.effectiveFilterDepth,l=r.effectiveFilterHeight,h=r.effectiveFilterWidth,f=u-1-r.padInfo.front,p=l-1-r.padInfo.top,v=h-1-r.padInfo.left,m=u*l*h-1;this.userCode=`
      const ivec3 pads = ivec3(`+f+", "+p+", "+v+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+u+`;
           wD += `+a+`) {
          float dyD = float(dyDCorner + wD) / `+t+`.0;

          if (dyD < 0.0 || dyD >= `+r.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+l+`;
              wR += `+i+`) {
            float dyR = float(dyRCorner + wR) / `+e+`.0;

            if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+h+`;
                wC += `+o+`) {
              float dyC = float(dyCCorner + wC) / `+n+`.0;

              if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = `+m+` -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * `+l+" * "+h+` +
                  wR * `+h+` + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `},Im=function(r,t,e,n,a,i,o){e===void 0&&(e=!1),n===void 0&&(n=!1),a===void 0&&(a=!1),i===void 0&&(i=null),o===void 0&&(o=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;var u=e?r[1]:r[2],l=Math.ceil(u/2),h=e?"i * 2, rc.y":"rc.y, i * 2",f=n?"rc.z, i * 2":"i * 2, rc.z",p=e?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],v=n?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],m="",x="";i&&(m=o?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+i+`
        }`:`vec4 activation(vec4 x) {
          `+i+`
        }`,x="result = activation(result);");var b=a?"result += getBiasAtOutCoords();":"";a&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+m+`

      const float sharedDimension = `+l+`.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < `+l+`; i++) {
          vec4 a = getMatrixA(rc.x, `+h+`);
          vec4 b = getMatrixB(rc.x, `+f+`);

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (`+p[0]+" * "+v[0]+`);
          result += (`+p[1]+" * "+v[1]+`);
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        `+b+`

        `+x+`

        setOutput(result);
      }
    `},A6=(function(){function r(t,e,n){this.variableNames=["probs"],this.outputShape=[t,n],this.userCode=`
      uniform float seed;

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < `+(e-1)+`; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(`+(e-1)+`));
      }
    `}return r.prototype.getCustomSetupFunc=function(t){var e=this;return function(n,a){e.seedLoc==null&&(e.seedLoc=n.getUniformLocation(a,"seed")),n.gl.uniform1f(e.seedLoc,t)}},r})(),T6=function(r,t,e,n){this.variableNames=["indices"],this.outputShape=[r,t],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(`+n+"), float("+e+`),
                      float(index == coords.y)));
      }
    `},k6=function(r){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=r;var t=r.length;if(t===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{var e=Sr("rc",t),n=We(t),a=(function(u,l,h){if(u===1)return"rc > "+l[0];for(var f="",p=u-2;p<u;p++)f+=h[p]+" >= "+l[p],p<u-1&&(f+="||");return f})(t,r,e),i=(function(u,l,h,f){if(u===1)return"";var p=f.slice(-2);return`
    int r = `+p[0]+`;
    int c = `+p[1]+`;
    int rp1 = r + 1;
    int cp1 = c + 1;

    bool cEdge = cp1 >= `+l+`;
    bool rEdge = rp1 >= `+h+`;
  `})(t,r[r.length-1],r[r.length-2],e),o=(function(u,l){var h=u.length,f=(function(p,v){for(var m=[],x=0;x<=1;x++)for(var b=0;b<=1;b++){for(var E=(x===0?"r":"rp1")+", "+(b===0?"c":"cp1"),C=2;C<p;C++)E=v[v.length-1-C]+","+E;m.push(E)}return m})(h,l);return h===1?`getA(rc),
            rc + 1 >= `+u[0]+` ? 0. : getA(rc + 1),
            0, 0`:"getA("+f[0]+`),
          cEdge ? 0. : getA(`+f[1]+`),
          rEdge ? 0. : getA(`+f[2]+`),
          rEdge || cEdge ? 0. : getA(`+f[3]+")"})(r,e);this.userCode=`
        void main() {
          `+n+` rc = getOutputCoords();

          if(`+a+`) {
            setOutput(vec4(0));
          } else {
            `+i+`

            setOutput(vec4(`+o+`));
          }
        }
      `}},D6=function(r,t,e){this.variableNames=["x"],this.outputShape=t.map((function(l,h){return l[0]+r[h]+l[1]}));var n=r.length,a=We(n),i=t.map((function(l){return l[0]})).join(","),o=t.map((function(l,h){return l[0]+r[h]})).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,n);this.userCode=n!==1?`
      `+a+" start = "+a+"("+i+`);
      `+a+" end = "+a+"("+o+`);

      void main() {
        `+a+` outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(float(`+e+`));
        } else {
          `+a+` coords = outC - start;
          setOutput(getX(`+u+`));
        }
      }
    `:`
        int start = `+i+`;
        int end = `+o+`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(float(`+e+`));
          } else {
            setOutput(getX(outC - start));
          }
        }
      `},I6=function(r,t,e){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map((function(E,C){return E[0]+r[C]+E[1]}));for(var n=r.length,a=We(n),i=t.map((function(E){return E[0]})).join(","),o=t.map((function(E,C){return E[0]+r[C]})).join(","),u=Sr("rc",n),l=Sr("source",n),h=u[n-1]+" < "+this.outputShape[n-1],f=n===1?"source":"vec2("+l.slice(-2).join()+")",p=[a+" rc = outputLoc;",u[n-1]+` += 1;
       if(`+h+`) {
      `,n===1?"":`}
       rc = outputLoc;
       `+u[n-2]+` += 1;
       if(`+u[n-2]+" < "+this.outputShape[n-2]+") {",n===1?"":"  "+u[n-1]+` += 1;
         if(`+h+") {"],v=n===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",m="",x=0,b=n===1?2:4;x<b;x++)m+=`
        `+p[x]+`
        if (`+v+`) {
          result[`+x+"] = float("+e+`);
        } else {
          `+a+` source = rc - start;
          result[`+x+"] = getChannel(getX("+l.join()+"), "+f+`);
        }
      `;m+=n===1?"} ":"}}",this.userCode=`
      const `+a+" start = "+a+"("+i+`);
      const `+a+" end = "+a+"("+o+`);

      void main() {
        `+a+` outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        `+m+`
        setOutput(result);
      }
    `},kc=function(r,t,e,n,a){if(n===void 0&&(n=!1),a===void 0&&(a=!1),this.variableNames=["x"],t==="avg"&&e)throw new Error("Cannot compute positions for average pool.");var i=r.filterWidth,o=r.strideHeight,u=r.strideWidth,l=r.dilationHeight,h=r.dilationWidth,f=r.effectiveFilterHeight,p=r.effectiveFilterWidth,v=r.padInfo.top,m=r.padInfo.left;this.outputShape=r.outShape;var x=t==="avg",b="((batch  * "+r.inHeight+" + xR) * "+r.inWidth+" + xC) * "+r.inChannels+" + d",E="(xR * "+r.inWidth+" + xC) * "+r.inChannels+" + d",C="0.0";if(x||(C="-1.0 / 1e-20"),e)this.userCode=`
        const ivec2 strides = ivec2(`+o+", "+u+`);
        const ivec2 pads = ivec2(`+v+", "+m+`);

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < `+f+`;
              wR += `+l+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+r.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+p+`;
                wC += `+h+`) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= `+r.inWidth+`) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value >= currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = `+(n?a?b:E:"wR * "+p+" + wC")+`;
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var R=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";t==="avg"&&(R="avgValue / count");var _=4*Math.floor(i/4),A=i%4,k=`
      if (`+x+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(`+o+", "+u+`);
      const ivec2 pads = ivec2(`+v+", "+m+`);
      const float initializationValue = `+C+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= `+r.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+C+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < `+f+`;
            wR += `+l+`) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= `+r.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+_+`; wC += 4) {
            int xC = xCCorner + wC * `+h+`;

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+h+`, d),
              getValue(batch, xR, xC + 2 * `+h+`, d),
              getValue(batch, xR, xC + 3 * `+h+`, d)
            );

            `+k+`
          }

          int xC = xCCorner + `+_+`;
          if (`+(A===1)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            `+k+`
          } else if (`+(A===2)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+h+`, d),
              initializationValue,
              initializationValue
            );

            `+k+`
          } else if (`+(A===3)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+h+`, d),
              getValue(batch, xR, xC + 2 * `+h+`, d),
              initializationValue
            );

            `+k+`
          }
        }
        setOutput(`+R+`);
      }
    `}},Nm=function(r,t,e,n,a){if(n===void 0&&(n=!1),a===void 0&&(a=!1),this.variableNames=["x"],t==="avg"&&e)throw new Error("Cannot compute positions for average pool.");var i=r.filterWidth,o=r.strideDepth,u=r.strideHeight,l=r.strideWidth,h=r.dilationDepth,f=r.dilationHeight,p=r.dilationWidth,v=r.effectiveFilterDepth,m=r.effectiveFilterHeight,x=r.effectiveFilterWidth,b=r.padInfo.front,E=r.padInfo.top,C=r.padInfo.left;this.outputShape=r.outShape;var R=t==="avg",_="0.0";if(R||(_="-1.0 / 1e-20"),e)this.userCode=`
        const ivec3 strides =
            ivec3(`+o+", "+u+", "+l+`);
        const ivec3 pads = ivec3(`+b+", "+E+", "+C+`);

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < `+v+`;
              wD += `+h+`) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= `+r.inDepth+`) {
              continue;
            }

            for (int wR = 0; wR < `+m+`;
                wR += `+f+`) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= `+r.inHeight+`) {
                continue;
              }

              for (int wC = 0; wC < `+x+`;
                  wC += `+p+`) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= `+r.inWidth+`) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value >= currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = `+(n?a?"(((batch * "+r.inDepth+" + xD) * "+r.inHeight+" + xR) * "+r.inWidth+" + xC) * "+r.inChannels+" + ch":"((xD * "+r.inHeight+" + xR) * "+r.inWidth+" + xC) * "+r.inChannels+" + ch":"wD * "+m+" * "+x+` +
                      wR * `+x+" + wC")+`;
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var A=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";t==="avg"&&(A="avgValue / count");var k=4*Math.floor(i/4),D=i%4,P=`
      if (`+R+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(`+o+", "+u+", "+l+`);
      const ivec3 pads = ivec3(`+b+", "+E+", "+C+`);
      const float initializationValue = `+_+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= `+r.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+_+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < `+v+`;
            wD += `+h+`) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= `+r.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+m+`;
            wR += `+f+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+r.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+k+`; wC += 4) {
              int xC = xCCorner + wC * `+p+`;

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+p+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+p+`, ch),
                getValue(batch, xD, xR, xC + 3 * `+p+`, ch)
              );

              `+P+`
            }

            int xC = xCCorner + `+k+`;
            if (`+(D===1)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              `+P+`
            } else if (`+(D===2)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+p+`, ch),
                initializationValue,
                initializationValue
              );

              `+P+`
            } else if (`+(D===3)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+p+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+p+`, ch),
                initializationValue
              );

              `+P+`
            }
          }
          setOutput(`+A+`);
        }
      }
    `}},N6=function(r,t){this.variableNames=["x"];var e=r.windowSize,n=r.batchSize,a=r.inSize,i=Math.ceil(a/e);this.outputShape=[n,i];var o="0.0",u="";t==="prod"?o="1.0":t==="min"?(o="1.0 / 1e-20",u="min"):t==="max"&&(o="-1.0 / 1e-20",u="max");var l=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";t==="sum"?l="sumValue":t==="prod"?l="prodValue":t==="all"?l="allValue":t==="any"&&(l="anyValue");var h=4*Math.floor(e/4),f=e%4,p=`
      if (`+(t==="sum")+`) {
        sumValue += dot(values, ones);
      } else if (`+(t==="prod")+`) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = `+u+`(values, minMaxValue);
      }
    `,v="vec4";t==="all"?(o="1.0",p=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,v="bvec4"):t==="any"&&(o="0.0",p=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,v="bvec4");var m="";a%e>0&&(m=`
        if (inIdx < 0 || inIdx >= `+a+`) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = `+o+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `+m+`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+e+`;

        vec4 minMaxValue = vec4(`+o+`);
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < `+h+`; i += 4) {
          int inIdx = inOffset + i;
          `+v+" values = "+v+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `+p+`
        }

        int inIdx = inOffset + `+h+`;
        if (`+(f===1)+`) {
          `+v+" values = "+v+`(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          `+p+`
        } else if (`+(f===2)+`) {
          `+v+" values = "+v+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          `+p+`
        } else if (`+(f===3)+`) {
          `+v+" values = "+v+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          `+p+`
        }
        setOutput(`+l+`);
      }
    `},O6=function(r,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r;for(var e="",n=0;n<4;n++){var a="thisRC = rc;";n%2==1&&(a+="thisRC.z += 1;"),n>1&&(a+="thisRC.y += 1;"),e+=`
        `+a+`
        `+(n>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+`
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[`+n+`] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        `+(n>0?"}":"")+`
      `}this.userCode=`
      
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      `+Iu(["r","c","d"],t)+`
      return ivec3(r, c, d);
    }
  
      `+hy(r)+`

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = `+r[1]+`;
        int cols = `+r[2]+`;

        `+e+`

        setOutput(result);
      }
    `},M6=function(r,t,e){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var n=t.shape,a=n[1],i=n[2],o=r.shape,u=o[1],l=o[2],h=[e&&u>1?a-1:a,e&&l>1?i-1:i],f=[e&&u>1?u-1:u,e&&l>1?l-1:l],p=h[0]/f[0],v=h[1]/f[1],m=1/p,x=1/v,b=2*Math.ceil(m)+2,E=2*Math.ceil(x)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+p+`);
        const float widthScale = float(`+v+`);

        const float invHeightScale = float(`+m+`);
        const float invWidthScale = float(`+x+`);

        const int winHeight = int(`+b+`);
        const int winWidth = int(`+E+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+u+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+l+`) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), `+(a-1)+`.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), `+(i-1)+`.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `},B6=function(r,t,e,n){this.variableNames=["A"],this.outputShape=[];var a=r[0],i=r[1],o=r[2],u=r[3];this.outputShape=[a,t,e,u];var l=[n&&t>1?i-1:i,n&&e>1?o-1:o],h=[n&&t>1?t-1:t,n&&e>1?e-1:e];this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+l[0]/h[0]+`,
          `+l[1]/h[1]+`);
      const vec2 inputShapeRC = vec2(`+i+".0, "+o+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `},P6=function(r,t,e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var a=r[0],i=r[1],o=r[2],u=r[3];this.outputShape=[a,t,e,u];var l=[n&&t>1?i-1:i,n&&e>1?o-1:o],h=[n&&t>1?t-1:t,n&&e>1?e-1:e];this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          `+l[0]/h[0]+`,
          `+l[1]/h[1]+`,
          `+l[1]/h[1]+`);
      const vec3 inputShapeRC = vec3(`+i+".0, "+o+`.0,
                                     `+o+`.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < `+(u-1)+`;
        bool hasNextRow = coords.z < `+(e-1)+`;

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `},F6=function(r,t,e){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var n=t.shape,a=n[1],i=n[2],o=r.shape,u=o[1],l=o[2],h=[e&&u>1?a-1:a,e&&l>1?i-1:i],f=[e&&u>1?u-1:u,e&&l>1?l-1:l],p=h[0]/f[0],v=h[1]/f[1],m=1/p,x=1/v,b=2*Math.ceil(m)+2,E=2*Math.ceil(x)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+p+`);
        const float widthScale = float(`+v+`);

        const float invHeightScale = float(`+m+`);
        const float invWidthScale = float(`+x+`);

        const int winHeight = int(`+b+`);
        const int winWidth = int(`+E+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+u+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+l+`) {
              continue;
            }

            float sourceFracRow =
              float(`+h[0]+`) *
                (float(dyR) / float(`+f[0]+`));

            float sourceFracCol =
                float(`+h[1]+`) *
                  (float(dyC) / float(`+f[1]+`));

            int sourceNearestRow = int(min(
                float(int(`+a+`) - 1),
                `+e+` ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(`+i+`) - 1),
                `+e+` ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `},L6=function(r,t,e,n){this.variableNames=["A"],this.outputShape=[];var a=r[0],i=r[1],o=r[2],u=r[3];this.outputShape=[a,t,e,u];var l=[n&&t>1?i-1:i,n&&e>1?o-1:o],h=[n&&t>1?t-1:t,n&&e>1?e-1:e],f=n?"0.5":"0.0";this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+l[0]/h[0]+`,
          `+l[1]/h[1]+`);
      const vec2 inputShapeRC = vec2(`+i+".0, "+o+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `+f+`)));

        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `},z6=function(r,t){this.variableNames=["x"];var e=r.length;if(e>4)throw new Error("WebGL backend: Reverse of rank-"+e+" tensor is not yet supported");if(this.outputShape=r,e!==1){var n=r.map((function(i,o){return(function(u){return t.indexOf(u)!==-1&&r[u]!==1?r[u]+" - coords["+u+"] - 1":"coords["+u+"]"})(o)})).join(","),a=We(e);this.userCode=`
      void main() {
        `+a+` coords = getOutputCoords();
        setOutput(getX(`+n+`));
      }
    `}else this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(`+r[0]+` - coord - 1));
        }
      `},U6=function(r,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var e=r.length;if(e>4)throw new Error("WebGL backend: Reverse of rank-"+e+" tensor is not yet supported");this.outputShape=r;var n=Sr("rc",e),a=n[e-1]+" + 1 < "+this.outputShape[e-1],i=n[e-2]+" + 1 < "+this.outputShape[e-2],o=We(e);function u(l){var h=r.map((function(f,p){return(function(v,m){return t.indexOf(v)!==-1&&r[v]!==1?r[v]+" - "+m[v]+" - 1":""+m[v]})(p,l)}));return"getChannel(getX("+h.join(",")+"), vec2("+h.slice(-2).join(",")+"))"}this.userCode=e===1?`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(`+r[0]+` - rc - 1),
            `+r[0]+` - rc - 1);
          if(`+a+`){
              result.g = getChannel(getX(`+r[0]+` - (rc  + 1) - 1),
                `+r[0]+` - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:`
        void main() {
          `+o+` rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = `+(function(l){return u(l)})(n.slice())+`;
          if(`+a+`){
            result.g = `+(function(l){return l[e-1]="("+l[e-1]+" + 1)",u(l)})(n.slice())+`;
          }
          if(`+i+`) {
            result.b = `+(function(l){return l[e-2]="("+l[e-2]+" + 1)",u(l)})(n.slice())+`;
            if(`+a+`) {
              result.a = `+(function(l){return l[e-1]="("+l[e-1]+" + 1)",l[e-2]="("+l[e-2]+" + 1)",u(l)})(n.slice())+`;
            }
          }
          setOutput(result);
        }
    `},Gw=function(r,t,e,n,a,i,o){this.variableNames=["updates","indices","defaultValue"],this.outputShape=i;var u=We(a.length),l=We(i.length),h="";e===1?h="i":e===2&&(h="i, j");var f="getIndices("+h+")",p="";n===1?p="i":n===2&&(p="i, coords[1]");var v="getUpdates("+p+")",m=t>1?"strides[j]":"strides";this.userCode=`
        `+u+" strides = "+u+"("+a+`);

        void main() {
          `+l+` coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < `+r+`; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < `+t+`; j++) {
              int index = round(`+f+`);
              flattenedIndex += index * `+m+`;
            }
            if (flattenedIndex == coords[0]) {
              sum += `+v+`;
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `},W6=function(r,t){this.variableNames=["x","segmentIds"];var e=r.windowSize,n=r.batchSize,a=r.inSize,i=r.numSegments,o=i*Math.ceil(a/e);this.outputShape=[n,o];var u=4*Math.floor(e/4),l=e%4,h=`
        sumValue += dot(values, segFilter);
    `,f="";a%e>0&&(f=`
        if (inIdx < 0 || inIdx >= `+a+`) {
          return initializationValue;
        }
      `);var p="";a%e>0&&(p=`
        if (inIdx < 0 || inIdx >= `+a+`) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = 0.0;

      float getValue(int batch, int inIdx) {
        `+f+`
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        `+p+`
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          `+i+")) * float("+e+`));
        int currentSeg = int(mod(float(outIdx), float(`+i+`)));

        float sumValue = 0.0;

        for (int i = 0; i < `+u+`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          `+h+`
        }

        int inIdx = inOffset + `+u+`;
        if (`+(l===1)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          `+h+`
        } else if (`+(l===2)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          `+h+`
        } else if (`+(l===3)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          `+h+`
        }
        setOutput(sumValue);
      }
    `},V6=function(r,t,e){var n,a;if(this.variableNames=["c","a","b"],this.outputShape=t,e>4)throw Error("Where for rank "+e+" is not yet supported");if(e===1)a="resRC",n="resRC";else{for(var i=["resRC.x","resRC.y","resRC.z","resRC.w"],o=[],u=[],l=0;l<t.length;l++)u.push(""+i[l]),l<r&&o.push(""+i[l]);n=o.join(),a=u.join()}var h=We(e);this.userCode=`
      void main() {
        `+h+` resRC = getOutputCoords();
        float cVal = getC(`+n+`);
        if (cVal >= 1.0) {
          setOutput(getA(`+a+`));
        } else {
          setOutput(getB(`+a+`));
        }
      }
    `},G6=(function(){function r(t){this.variableNames=["source"],this.outputShape=t,this.rank=t.length;var e,n=We(this.rank),a="uniform int start["+this.rank+"];",i=(function(o){if(o===1)return"sourceLoc";if(o<=6)return Om.slice(0,o).map((function(u){return"sourceLoc."+u})).join(",");throw Error("Slicing for rank "+o+" is not yet supported")})(this.rank);e=`
        `+n+` sourceLoc;
        `+n+` coords = getOutputCoords();
        `+t.map((function(o,u){return"sourceLoc."+Om[u]+" = start["+u+"] + coords."+Om[u]+";"})).join(`
`)+`
      `,this.userCode=`
      `+a+`
      void main() {
        `+e+`
        setOutput(getSource(`+i+`));
      }
    `}return r.prototype.getCustomSetupFunc=function(t){var e=this;if(t.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+t.length+")");return function(n,a){e.startLoc==null&&(e.startLoc=n.getUniformLocationNoThrow(a,"start"),e.startLoc==null)||n.gl.uniform1iv(e.startLoc,t)}},r})(),Om=["x","y","z","w","u","v"],H6=(function(){function r(t){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.rank=t.length;var e=We(this.rank),n=Sr("coords",this.rank),a=Sr("sourceLoc",this.rank),i=this.rank===1?"sourceLoc":"vec2("+a.slice(-2).join()+")",o="getChannel(getSource("+a.join()+"), "+i+")",u=`
      result.x = `+o+`;
      if (++`+n[this.rank-1]+" < "+t[this.rank-1]+`) {
        ++`+a[this.rank-1]+`;
        result.y = `+o+`;
        --`+a[this.rank-1]+`;
      }
    `,l=this.rank===1?"":`
      --`+n[this.rank-1]+`;
      if (++`+n[this.rank-2]+" < "+t[this.rank-2]+`) {
        ++`+a[this.rank-2]+`;
        result.z = `+o+`;
        if (++`+n[this.rank-1]+" < "+t[this.rank-1]+`) {
          ++`+a[this.rank-1]+`;
          result.w = `+o+`;
        }
      }
    `,h=this.rank<=4?`sourceLoc = coords +
            `+e+"("+t.map((function(f,p){return"start["+p+"]"})).join()+");":t.map((function(f,p){return a[p]+" = "+n[p]+" + start["+p+"];"})).join(`
`);this.userCode=`
      uniform int start[`+this.rank+`];
      void main() {
        `+e+` coords = getOutputCoords();
        `+e+` sourceLoc;
        `+h+`
        vec4 result = vec4(0.);
        `+u+`
        `+l+`
        setOutput(result);
      }
    `}return r.prototype.getCustomSetupFunc=function(t){var e=this;if(t.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+t.length+")");return function(n,a){e.startLoc==null&&(e.startLoc=n.getUniformLocationNoThrow(a,"start"),e.startLoc==null)||n.gl.uniform1iv(e.startLoc,t)}},r})(),q6=function(r,t,e){this.variableNames=["x"],this.outputShape=e;var n=e.length,a=We(e.length),i=We(e.length),o="";if(n===1)o="coords * strides + begin";else{var u=0;o=e.map((function(l,h){return u++,e.length===1?"coords * strides["+h+"] + begin["+h+"]":"coords["+(u-1)+"] * strides["+h+"] + begin["+h+"]"})).join(",")}this.userCode=`
      `+a+" begin = "+a+"("+r+`);
      `+a+" strides = "+a+"("+t+`);

      void main() {
        `+i+` coords = getOutputCoords();
        setOutput(getX(`+o+`));
      }
    `},j6=(function(){function r(t){this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return r.prototype.acquireTexture=function(t,e,n){var a,i=Hw(e,n),o=qw(t,i,n);if(o in this.freeTextures||(this.freeTextures[o]=[]),o in this.usedTextures||(this.usedTextures[o]=[]),this.freeTextures[o].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var u=this.freeTextures[o].shift();return this.usedTextures[o].push(u),u}return this.numUsedTextures++,this.log(),i===qr.PACKED_2X2_FLOAT32?a=this.gpgpu.createPackedMatrixTexture(t[0],t[1]):i===qr.PACKED_2X2_FLOAT16?a=this.gpgpu.createFloat16PackedMatrixTexture(t[0],t[1]):i===qr.UNPACKED_FLOAT32?a=this.gpgpu.createFloat32MatrixTexture(t[0],t[1]):i===qr.UNPACKED_FLOAT16?a=this.gpgpu.createFloat16MatrixTexture(t[0],t[1]):i===qr.PACKED_4X1_UNSIGNED_BYTE&&(a=this.gpgpu.createUnsignedBytesMatrixTexture(t[0],t[1])),this.usedTextures[o].push(a),a},r.prototype.releaseTexture=function(t,e,n,a){if(this.freeTextures!=null){var i=qw(e,Hw(n,a),a);i in this.freeTextures||(this.freeTextures[i]=[]),this.freeTextures[i].push(t),this.numFreeTextures++,this.numUsedTextures--;var o=this.usedTextures[i],u=o.indexOf(t);if(u<0)throw new Error("Cannot release a texture that was never provided by this texture manager");o.splice(u,1),this.log()}},r.prototype.log=function(){if(this.logEnabled){var t=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+t+")")}},r.prototype.getNumUsedTextures=function(){return this.numUsedTextures},r.prototype.getNumFreeTextures=function(){return this.numFreeTextures},r.prototype.dispose=function(){var t=this;if(this.freeTextures!=null){for(var e in this.freeTextures)this.freeTextures[e].forEach((function(n){t.gpgpu.deleteMatrixTexture(n)}));for(var e in this.usedTextures)this.usedTextures[e].forEach((function(a){t.gpgpu.deleteMatrixTexture(a)}));this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},r})();function Hw(r,t){if(r===Kr.UPLOAD)return qr.PACKED_2X2_FLOAT32;if(r===Kr.RENDER||r==null)return(function(e){return yt().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?qr.PACKED_2X2_FLOAT32:qr.UNPACKED_FLOAT32:e?qr.PACKED_2X2_FLOAT16:qr.UNPACKED_FLOAT16})(t);if(r===Kr.DOWNLOAD||r===Kr.PIXELS)return qr.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+r)}function qw(r,t,e){return r[0]+"_"+r[1]+"_"+t+"_"+e}var X6=function(r,t){this.variableNames=["A"];for(var e=new Array(r.length),n=0;n<e.length;n++)e[n]=r[n]*t[n];this.outputShape=e,this.rank=e.length;var a=We(this.rank),i=(function(o){var u=o.length;if(u>5)throw Error("Tile for rank "+u+" is not yet supported");if(u===1)return"imod(resRC, "+o[0]+")";for(var l=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],h=[],f=0;f<o.length;f++)h.push("imod("+l[f]+", "+o[f]+")");return h.join()})(r);this.userCode=`
      void main() {
        `+a+` resRC = getOutputCoords();
        setOutput(getA(`+i+`));
      }
    `},fy=1.7580993408473768,dy=1.0507009873554805,re=function(r,t){this.variableNames=["A"],this.outputShape=r,this.userCode=`
      float unaryOperation(float x) {
        `+t+`
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `},Wa="if (isnan(x)) return x;",K6="return x;",jw="return abs(x);",cR=Wa+`
  return (x < 0.0) ? 0.0 : x;
`,hR=Wa+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,fR="return (x >= 0.0) ? x : (exp(x) - 1.0);",Y6=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = `+fy+`;
  float scale = `+dy+`;
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,Xw="return -x;",Kw="return ceil(x);",Yw="return floor(x);",Qw="return exp(x);",Zw="return exp(x) - 1.0;",Q6=Wa+`
  return sin(x);
`,Z6=Wa+`
  return cos(x);
`,$6=Wa+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,J6=Wa+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,tG=Wa+`
  return atan(x);
`,eG=Wa+"return log(x + sqrt(x * x + 1.0));",nG=Wa+`
  if (x < 1.0) return NAN;
  return log(x + sqrt(x * x - 1.0));`,rG=Wa+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
  return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,Of="return x;",aG="return x;",dR=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,pR=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,vR=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,Cc=function(r,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r,this.userCode=`
      vec4 unaryOperation(vec4 x) {
        `+t+`
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `},iG=function(r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=r;var t=r.length,e=Sr("rc",t),n=We(t),a=(function(u,l){if(u===1)return"rc";for(var h="",f=0;f<u;f++)h+=l[f],f<u-1&&(h+=",");return h})(t,e),i=e.slice(-2),o=t<=1?"rc":"vec2("+i.join(",")+")";this.userCode=`
      void main() {
        `+n+` rc = getOutputCoords();
        vec4 packedInput = getA(`+a+`);

        setOutput(getChannel(packedInput, `+o+`));
      }
    `},Mf={};function Bf(r,t){if(t===void 0&&(t=!1),r==="linear")return t?aG:K6;if(r==="relu")return t?dR:cR;if(r==="elu")return t?vR:fR;if(r==="relu6")return t?pR:hR;if(r==="prelu")return t?lR:sR;throw new Error("Activation "+r+" has not been implemented for the WebGL backend.")}var oG=600,uG=(function(r){function t(e){var n,a=r.call(this)||this;if(a.pendingRead=new WeakMap,a.pendingDisposal=new WeakSet,a.dataRefCount=new WeakMap,a.numBytesInGPU=0,a.uploadWaitMs=0,a.downloadWaitMs=0,a.warnedAboutMemory=!1,a.pendingDeletes=0,a.disposed=!1,!yt().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(e==null){var i=Ci(yt().getNumber("WEBGL_VERSION"));a.binaryCache=((n=yt().getNumber("WEBGL_VERSION"))in Mf||(Mf[n]={}),Mf[n]),a.gpgpu=new b6(i),a.canvas=i.canvas,a.gpgpuCreatedLocally=!0}else a.gpgpu=e,a.binaryCache={},a.gpgpuCreatedLocally=!1,a.canvas=e.gl.canvas;return a.textureManager=new j6(a.gpgpu),a.numMBBeforeWarning=yt().global.screen==null?1024:yt().global.screen.height*yt().global.screen.width*window.devicePixelRatio*oG/1024/1024,a.texData=new QS(a,rt),a}return Ua(t,r),t.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},t.prototype.write=function(e,n,a){if(yt().getBool("DEBUG")&&this.checkNumericalProblems(e),a==="complex64"&&e!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var i={};return this.texData.set(i,{shape:n,dtype:a,values:e,usage:Kr.UPLOAD}),i},t.prototype.move=function(e,n,a,i){if(yt().getBool("DEBUG")&&this.checkNumericalProblems(n),i==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:a,dtype:i,values:n,usage:Kr.UPLOAD})},t.prototype.readSync=function(e){var n=this.texData.get(e),a=n.values,i=n.dtype,o=n.complexTensors,u=n.slice,l=n.shape,h=n.isPacked;if(u!=null){var f=void 0;f=h?new Cc(l,Of):new re(l,Of);var p=this.runWebGLProgram(f,[{dataId:e,shape:l,dtype:i}],i),v=this.readSync(p.dataId);return this.disposeData(p.dataId),v}if(a!=null)return this.convertAndCacheOnCPU(e);if(i==="string")return a;var m,x,b=this.activeTimers!=null;return b&&(m=ui()),i==="complex64"?x=_g(o.real.dataSync(),o.imag.dataSync()):x=this.getValuesFromTexture(e),b&&(this.downloadWaitMs+=ui()-m),this.convertAndCacheOnCPU(e,x)},t.prototype.read=function(e){return Mt(this,void 0,void 0,(function(){var n,a,i,o,u,l,h,f,p,v,m,x,b,E,C,R,_,A,k,D,P,M;return Bt(this,(function(O){switch(O.label){case 0:if(this.pendingRead.has(e))return n=this.pendingRead.get(e),[2,new Promise((function(F){return n.push(F)}))];if(a=this.texData.get(e),i=a.values,o=a.shape,u=a.slice,l=a.dtype,h=a.complexTensors,f=a.isPacked,u!=null)return p=void 0,p=f?new Cc(o,Of):new re(o,Of),v=this.runWebGLProgram(p,[{dataId:e,shape:o,dtype:l}],l),m=this.read(v.dataId),this.disposeData(v.dataId),[2,m];if(i!=null)return[2,this.convertAndCacheOnCPU(e)];if(!yt().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&yt().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return x=null,l!=="complex64"&&yt().get("WEBGL_BUFFER_SUPPORTED")&&(b=this.decode(e),E=this.texData.get(b.dataId),x=(M=this.gpgpu).createBufferFromTexture.apply(M,[E.texture].concat(Ac(o)))),this.pendingRead.set(e,[]),l==="complex64"?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:O.sent(),O.label=2;case 2:return l!=="complex64"?[3,4]:[4,Promise.all([h.real.data(),h.imag.data()])];case 3:return R=O.sent(),_=R[0],A=R[1],C=_g(_,A),[3,5];case 4:x==null?C=this.getValuesFromTexture(e):(k=Ot(o),C=this.gpgpu.downloadFloat32MatrixFromBuffer(x,k)),O.label=5;case 5:return b!=null&&this.disposeData(b.dataId),D=this.convertAndCacheOnCPU(e,C),P=this.pendingRead.get(e),this.pendingRead.delete(e),P.forEach((function(F){return F(D)})),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e),this.pendingDeletes--),[2,D]}}))}))},t.prototype.checkNumericalProblems=function(e){if(e!=null)for(var n=0;n<e.length;n++){var a=e[n];if(!R3(a))throw yt().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value "+a+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'"):Error("The value "+a+" cannot be represented on this device.")}},t.prototype.getValuesFromTexture=function(e){var n,a=this.texData.get(e),i=a.shape,o=a.dtype,u=a.isPacked,l=Ot(i);if(yt().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var h=this.decode(e),f=this.texData.get(h.dataId),p=(n=this.gpgpu).downloadMatrixFromPackedTexture.apply(n,[f.texture].concat(Ac(i))).subarray(0,l);return this.disposeData(h.dataId),p}var v=yt().getBool("WEBGL_PACK")&&u===!0,m=v?Am(i):i,x=v?new QV(m):new YV(m),b=this.runWebGLProgram(x,[{shape:m,dtype:o,dataId:e}],"float32"),E=this.texData.get(b.dataId),C=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(E.texture,E.texShape[0],E.texShape[1]).subarray(0,l);return this.disposeData(b.dataId),C},t.prototype.time=function(e){return Mt(this,void 0,void 0,(function(){var n,a,i,o,u,l,h;return Bt(this,(function(f){switch(f.label){case 0:return n=this.activeTimers,a=[],i=!1,this.programTimersStack==null?(this.programTimersStack=a,i=!0):this.activeTimers.push(a),this.activeTimers=a,e(),o=sl(this.activeTimers.map((function(p){return p.query}))).filter((function(p){return p!=null})),u=sl(this.activeTimers.map((function(p){return p.name}))).filter((function(p){return p!=null})),this.activeTimers=n,i&&(this.programTimersStack=null),l={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},yt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(o)]:[3,2];case 1:return h=f.sent(),l.kernelMs=o3(h),l.getExtraProfileInfo=function(){return h.map((function(p,v){return{name:u[v],ms:p}})).map((function(p){return p.name+": "+p.ms})).join(", ")},[3,3];case 2:l.kernelMs={error:"WebGL query timers are not supported in this environment."},f.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,l]}}))}))},t.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},t.prototype.startTimer=function(){return yt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:ui(),endMs:null}},t.prototype.endTimer=function(e){return yt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=ui(),e)},t.prototype.getQueryTime=function(e){return Mt(this,void 0,void 0,(function(){var n;return Bt(this,(function(a){return yt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(e)]:[2,(n=e).endMs-n.startMs]}))}))},t.prototype.disposeData=function(e){if(!this.pendingDisposal.has(e)){if(this.pendingRead.has(e))return this.pendingDisposal.add(e),void this.pendingDeletes++;if(this.texData.has(e)){this.releaseGPUData(e);var n=this.texData.get(e).complexTensors;n!=null&&(n.real.dispose(),n.imag.dispose()),this.texData.delete(e)}}},t.prototype.releaseGPUData=function(e){var n=this.texData.get(e),a=n.texture,i=n.dtype,o=n.texShape,u=n.usage,l=n.isPacked,h=n.slice,f=h&&h.origDataId||e,p=this.dataRefCount.get(f);p>1?this.dataRefCount.set(f,p-1):(this.dataRefCount.delete(f),a!=null&&(this.numBytesInGPU-=this.computeBytes(o,i),this.textureManager.releaseTexture(a,o,u,l)));var v=this.texData.get(e);v.texture=null,v.texShape=null,v.isPacked=!1,v.slice=null},t.prototype.getTexture=function(e){return this.uploadToGPU(e),this.texData.get(e).texture},t.prototype.getDataInfo=function(e){return this.texData.get(e)},t.prototype.getCPUBackend=function(){return yt().getBool("WEBGL_CPU_FORWARD")?(this.cpuBackend==null&&(this.cpuBackend=rt.findBackend("cpu")),this.cpuBackend):null},t.prototype.shouldExecuteOnCPU=function(e,n){var a=this;return n===void 0&&(n=128),this.getCPUBackend()!=null&&e.every((function(i){return a.texData.get(i.dataId).texture==null&&Ot(i.shape)<n}))},t.prototype.getGPGPUContext=function(){return this.gpgpu},t.prototype.complex=function(e,n){var a=this.makeOutput(e.shape,"complex64");return this.texData.get(a.dataId).complexTensors={real:rt.keep(e.clone()),imag:rt.keep(n.clone())},a},t.prototype.real=function(e){return this.texData.get(e.dataId).complexTensors.real.clone()},t.prototype.imag=function(e){return this.texData.get(e.dataId).complexTensors.imag.clone()},t.prototype.slice=function(e,n,a){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.slice(e,n,a);if(Ot(a)===0)return Qn([],a,e.dtype);var i=this.texData.get(e.dataId).isPacked,o=KS(e.shape,n,a);if(i||!o){var u=yt().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new H6(a):new G6(a),l=u.getCustomSetupFunc(n);return this.compileAndRun(u,[e],null,l)}return this.uploadToGPU(e.dataId),this.shallowSlice(e,n,a)},t.prototype.shallowSlice=function(e,n,a){var i=this.texData.get(e.dataId),o=this.makeOutput(a,e.dtype),u=this.texData.get(o.dataId);Object.assign(u,i),u.shape=a,u.dtype=e.dtype;var l=YS(n,e.strides);i.slice&&(l+=i.slice.flatOffset),u.slice={flatOffset:l,origDataId:i.slice&&i.slice.origDataId||e.dataId};var h=this.dataRefCount.get(u.slice.origDataId)||1;return this.dataRefCount.set(u.slice.origDataId,h+1),o},t.prototype.stridedSlice=function(e,n,a,i){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.stridedSlice(e,n,a,i);var o=oy(n,a,i);if(o.some((function(l){return l===0})))return Qn([],o);var u=new q6(n,i,o);return this.compileAndRun(u,[e])},t.prototype.reverse=function(e,n){var a=yt().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new U6(e.shape,n):new z6(e.shape,n);return this.compileAndRun(a,[e])},t.prototype.concat=function(e,n){if(e[0].dtype==="complex64"){var a=e.map((function(m){return va(m)})),i=e.map((function(m){return ci(m)}));return Kn(this.concat(a,n),this.concat(i,n))}if(this.shouldExecuteOnCPU(e))return this.cpuBackend.concat(e,n);if(e.length===1)return e[0];if(e.length>yt().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var o=Math.floor(e.length/2),u=this.concat(e.slice(0,o),n),l=this.concat(e.slice(o),n);return this.concat([u,l],n)}if(yt().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&e[0].rank>1){var h=new BV(e.map((function(m){return m.shape})),n);return this.compileAndRun(h,e)}var f=hl(e.map((function(m){return m.shape})),n),p=e.map((function(m){return m.as2D(-1,Ot(m.shape.slice(n)))})),v=new MV(p.map((function(m){return m.shape})));return this.compileAndRun(v,p).reshape(f)},t.prototype.neg=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.neg(e);if(yt().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Xw,e.dtype);var n=new re(e.shape,Xw);return this.compileAndRun(n,[e])},t.prototype.batchMatMul=function(e,n,a,i){var o=a?e.shape[2]:e.shape[1],u=i?n.shape[1]:n.shape[2],l=a?e.shape[1]:e.shape[2],h=e.shape[0];if((o===1||u===1)&&l>1e3){a&&(e=Ma(e,[0,2,1])),i&&(n=Ma(n,[0,2,1]));var f=u===1?e:e.as3D(h,l,1),p=u===1?2:1,v=u===1?n.as3D(h,1,l):n;return this.multiply(f,v).sum(p,!0)}var m=Yn(e.dtype,n.dtype),x=new Im(e.shape,[h,o,u],a,i);return this.compileAndRun(x,[e,n],m)},t.prototype.fusedBatchMatMul=function(e){var n=e.a,a=e.b,i=e.transposeA,o=e.transposeB,u=e.bias,l=e.activation,h=e.preluActivationWeights,f=i?n.shape[2]:n.shape[1],p=o?a.shape[1]:a.shape[2],v=n.shape[0],m=Yn(n.dtype,a.dtype),x=u!=null,b=h!=null,E=l?Bf(l,!0):null,C=new Im(n.shape,[v,f,p],i,o,x,E,b),R=[n,a];return u&&R.push(u),h&&R.push(h),this.compileAndRun(C,R,m)},t.prototype.multiply=function(e,n){if(e.dtype==="complex64"){var a=this.texData.get(e.dataId),i=this.texData.get(n.dataId),o=new Bw(AV,e.shape,n.shape),u=new Bw(TV,e.shape,n.shape),l=[this.makeComplexComponentTensorInfo(e,a.complexTensors.real),this.makeComplexComponentTensorInfo(e,a.complexTensors.imag),this.makeComplexComponentTensorInfo(n,i.complexTensors.real),this.makeComplexComponentTensorInfo(n,i.complexTensors.imag)],h=this.compileAndRun(o,l),f=this.compileAndRun(u,l),p=this.complex(h,f);return h.dispose(),f.dispose(),p}if(this.shouldExecuteOnCPU([e,n]))return this.cpuBackend.multiply(e,n);if(yt().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,n,Pw,e.dtype);var v=new on(Pw,e.shape,n.shape);return this.compileAndRun(v,[e,n],e.dtype)},t.prototype.batchNormalization=function(e,n,a,i,o,u){var l=[e,n,a],h=null;u!=null&&(h=u.shape,l.push(u));var f=null;if(o!=null&&(f=o.shape,l.push(o)),yt().getBool("WEBGL_PACK_NORMALIZATION")){var p=new _V(e.shape,n.shape,a.shape,h,f,i);return this.compileAndRun(p,l)}var v=new RV(e.shape,n.shape,a.shape,h,f,i);return this.compileAndRun(v,l)},t.prototype.localResponseNormalization4D=function(e,n,a,i,o){var u=yt().getBool("WEBGL_PACK_NORMALIZATION")?new S6(e.shape,n,a,i,o):new E6(e.shape,n,a,i,o);return this.compileAndRun(u,[e])},t.prototype.LRNGrad=function(e,n,a,i,o,u,l){var h=new C6(n.shape,i,o,u,l);return this.compileAndRun(h,[n,a,e])},t.prototype.tile=function(e,n){if(e.dtype==="string"){var a=this.readSync(e.dataId).map((function(o){return id(o)}));return rR(ee(e.shape,e.dtype,a),n)}var i=new X6(e.shape,n);return this.compileAndRun(i,[e])},t.prototype.pad=function(e,n,a){var i=yt().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new I6(e.shape,n,a):new D6(e.shape,n,a);return this.compileAndRun(i,[e])},t.prototype.gather=function(e,n,a){if(this.shouldExecuteOnCPU([e,n]))return this.cpuBackend.gather(e,n,a);var i=new n6(e.shape,n.size,a);return this.compileAndRun(i,[e,n])},t.prototype.batchToSpaceND=function(e,n,a){G(e.rank<=4,(function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"}));var i=n.reduce((function(p,v){return p*v})),o=hd(e.shape,n,i),u=fd(o.length,n.length),l=dd(e.shape,n,i),h=BS(a,n.length),f=PS(l,a,n.length);return Ma(e.reshape(o),u).reshape(l).slice(h,f)},t.prototype.spaceToBatchND=function(e,n,a){G(e.rank<=4,(function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"}));var i=n.reduce((function(v,m){return v*m})),o=[[0,0]];o.push.apply(o,a);for(var u=1+n.length;u<e.shape.length;++u)o.push([0,0]);var l=e.pad(o),h=hd(l.shape,n,i,!1),f=fd(h.length,n.length,!1),p=dd(l.shape,n,i,!1);return Ma(l.reshape(h),f).reshape(p)},t.prototype.reduce=function(e,n,a){var i=e.shape[0],o=e.shape[1],u=Tm(o),l=new N6({windowSize:u,inSize:o,batchSize:i},n),h=this.compileAndRun(l,[e],a);return h.shape[1]===1?h:this.reduce(h,n,a)},t.prototype.argReduce=function(e,n,a){a===void 0&&(a=null);var i=e.shape[0],o=e.shape[1];a!=null&&(i=a.shape[0],o=a.shape[1]);var u=Tm(o),l=new mV({windowSize:u,inSize:o,batchSize:i},n,a==null),h=[e];a!=null&&h.push(a);var f=this.compileAndRun(l,h,"int32");return f.shape[1]===1?f:this.argReduce(e,n,f)},t.prototype.argReducePacked=function(e,n,a){a===void 0&&(a=null);var i=a!=null?a.shape:e.shape,o=Tm(i[i.length-1]),u=new EV(i,o,n,a==null),l=a==null?[e]:[e,a],h=this.compileAndRun(u,l,"int32");return h.rank===e.rank?this.argReducePacked(e,n,h):h},t.prototype.sum=function(e,n){Hr("sum",n,e.rank);var a=nr(e.shape,n),i=a[0],o=Ot(a[1]),u=e.as2D(-1,o),l=bm(e.dtype);return this.reduce(u,"sum",l).reshape(i)},t.prototype.prod=function(e,n){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.prod(e,n);var a=nr(e.shape,n),i=a[0],o=Ot(a[1]),u=e.as2D(-1,o),l=bm(e.dtype);return this.reduce(u,"prod",l).reshape(i)},t.prototype.unsortedSegmentSum=function(e,n,a){var i=0,o=Si([i],e.rank),u=e;o!=null&&(u=Ma(e,o),i=Ri(1,e.rank)[0]);var l=(function(m,x,b){for(var E=[],C=m.length,R=0;R<C;R++)R!==x?E.push(m[R]):E.push(b);return E})(u.shape,i,a),h=Ot([u.shape[i]]),f=u.as2D(-1,h),p=bm(e.dtype),v=this.segOpCompute(f,"unsortedSegmentSum",n,p,a).reshape(l);return o!=null&&(v=Ma(v,ny(o))),v},t.prototype.segOpCompute=function(e,n,a,i,o){var u=e.shape[0],l=e.shape[1],h=(function(v,m){var x,b=!1;for(v<=XS?(x=v,b=!0):x=gg(v,Math.floor(Math.sqrt(v)));!b;)x>m||x===v?b=!0:x=gg(v,x+1);return x})(l,o),f=new W6({windowSize:h,inSize:l,batchSize:u,numSegments:o}),p=this.compileAndRun(f,[e,a],i);return p.shape[1]===o?p:(a=cd(0,o).tile([l/h]),this.segOpCompute(p,n,a,i,o))},t.prototype.argMinMaxReduce=function(e,n,a){var i=[n];if(Hr("arg"+a.charAt(0).toUpperCase()+a.slice(1),i,e.rank),!yt().getBool("WEBGL_PACK_REDUCE")||e.rank<=2){var o=nr(e.shape,i),u=o[0],l=Ot(o[1]),h=e.as2D(-1,l);return this.argReduce(h,a).reshape(u)}return this.argReducePacked(e,a)},t.prototype.argMin=function(e,n){return this.argMinMaxReduce(e,n,"min")},t.prototype.argMax=function(e,n){return this.argMinMaxReduce(e,n,"max")},t.prototype.cumsum=function(e,n,a,i){if(n!==e.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(e.rank-1)+" but got axis="+n);var o=new HV(e.shape,a,i);return this.compileAndRun(o,[e])},t.prototype.equal=function(e,n){if(yt().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,n,`
  return vec4(equal(a, b));
`,"bool");var a=new on("return float(a == b);",e.shape,n.shape);return this.compileAndRun(a,[e,n],"bool")},t.prototype.notEqual=function(e,n){if(yt().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,n,`
  return vec4(notEqual(a, b));
`,"bool");var a=new on("return float(a != b);",e.shape,n.shape);return this.compileAndRun(a,[e,n],"bool")},t.prototype.less=function(e,n){if(this.shouldExecuteOnCPU([e,n]))return this.cpuBackend.less(e,n);if(yt().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,n,`
  return vec4(lessThan(a, b));
`,"bool");var a=new on("return float(a < b);",e.shape,n.shape);return this.compileAndRun(a,[e,n],"bool")},t.prototype.lessEqual=function(e,n){if(yt().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,n,`
  return vec4(lessThanEqual(a, b));
`,"bool");var a=new on("return float(a <= b);",e.shape,n.shape);return this.compileAndRun(a,[e,n],"bool")},t.prototype.greater=function(e,n){if(this.shouldExecuteOnCPU([e,n]))return this.cpuBackend.greater(e,n);if(yt().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,n,`
  return vec4(greaterThan(a, b));
`,"bool");var a=new on("return float(a > b);",e.shape,n.shape);return this.compileAndRun(a,[e,n],"bool")},t.prototype.greaterEqual=function(e,n){if(yt().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,n,`
  return vec4(greaterThanEqual(a, b));
`,"bool");var a=new on("return float(a >= b);",e.shape,n.shape);return this.compileAndRun(a,[e,n],"bool")},t.prototype.logicalNot=function(e){var n=new re(e.shape,"return float(!(x >= 1.0));");return this.compileAndRun(n,[e])},t.prototype.logicalAnd=function(e,n){if(yt().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,n,`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,"bool");var a=new on("return float(a >= 1.0 && b >= 1.0);",e.shape,n.shape);return this.compileAndRun(a,[e,n],"bool")},t.prototype.logicalOr=function(e,n){if(yt().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,n,`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,"bool");var a=new on("return float(a >= 1.0 || b >= 1.0);",e.shape,n.shape);return this.compileAndRun(a,[e,n],"bool")},t.prototype.select=function(e,n,a){var i=new V6(e.rank,n.shape,n.rank);return this.compileAndRun(i,[e,n,a],Yn(n.dtype,a.dtype))},t.prototype.where=function(e){sd("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var n=e.dataSync();return cy(e.shape,n)},t.prototype.topk=function(e,n,a){return aR(e.dataSync(),e.shape,e.dtype,n)},t.prototype.min=function(e,n){Hr("min",n,e.rank);var a=nr(e.shape,n),i=a[0],o=Ot(a[1]),u=e.as2D(-1,o);return this.reduce(u,"min",u.dtype).reshape(i)},t.prototype.minimum=function(e,n){if(this.shouldExecuteOnCPU([e,n]))return this.cpuBackend.minimum(e,n);var a=yt().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ii(`
  vec4 result = vec4(min(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,e.shape,n.shape):new on(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return min(a, b);
`,e.shape,n.shape);return this.compileAndRun(a,[e,n])},t.prototype.mod=function(e,n){var a=yt().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ii(`
  vec4 result = mod(a, b);
  vec4 isNaN = vec4(equal(b, vec4(0.0)));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,e.shape,n.shape):new on(`if (b == 0.0) return NAN;
  return mod(a, b);`,e.shape,n.shape);return this.compileAndRun(a,[e,n])},t.prototype.max=function(e,n){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.max(e,n);Hr("max",n,e.rank);var a=nr(e.shape,n),i=a[0],o=Ot(a[1]),u=e.as2D(-1,o);return this.reduce(u,"max",u.dtype).reshape(i)},t.prototype.maximum=function(e,n){if(this.shouldExecuteOnCPU([e,n]))return this.cpuBackend.maximum(e,n);var a=yt().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ii(`
  vec4 result = vec4(max(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,e.shape,n.shape):new on(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return max(a, b);
`,e.shape,n.shape);return this.compileAndRun(a,[e,n])},t.prototype.all=function(e,n){Hr("all",n,e.rank);var a=nr(e.shape,n),i=a[0],o=Ot(a[1]),u=e.as2D(-1,o);return this.reduce(u,"all",u.dtype).reshape(i)},t.prototype.any=function(e,n){Hr("any",n,e.rank);var a=nr(e.shape,n),i=a[0],o=Ot(a[1]),u=e.as2D(-1,o);return this.reduce(u,"any",u.dtype).reshape(i)},t.prototype.floorDiv=function(e,n){if(yt().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,n,`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,"int32");var a=new on(`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,e.shape,n.shape);return this.compileAndRun(a,[e,n],"int32")},t.prototype.add=function(e,n){if(e.dtype==="complex64"&&n.dtype==="complex64")return this.complexSeparableBinaryOp(e,n,km);if(this.shouldExecuteOnCPU([e,n]))return this.cpuBackend.add(e,n);var a=Yn(e.dtype,n.dtype);if(yt().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,n,km,a);var i=new on(km,e.shape,n.shape);return this.compileAndRun(i,[e,n],a)},t.prototype.packedUnaryOp=function(e,n,a){var i=new Cc(e.shape,n);return this.compileAndRun(i,[e],a)},t.prototype.packedBinaryOp=function(e,n,a,i,o){o===void 0&&(o=!1);var u=new ii(a,e.shape,n.shape,o);return this.compileAndRun(u,[e,n],i)},t.prototype.complexSeparableBinaryOp=function(e,n,a){var i=this,o=this.texData.get(e.dataId),u=this.texData.get(n.dataId),l=[[o.complexTensors.real,u.complexTensors.real],[o.complexTensors.imag,u.complexTensors.imag]].map((function(v){var m=v[0],x=v[1],b=i.makeComplexComponentTensorInfo(e,m),E=i.makeComplexComponentTensorInfo(n,x),C=new on(a,e.shape,n.shape);return i.compileAndRun(C,[b,E],Yn(m.dtype,x.dtype))})),h=l[0],f=l[1],p=this.complex(h,f);return h.dispose(),f.dispose(),p},t.prototype.makeComplexComponentTensorInfo=function(e,n){return{dataId:n.dataId,dtype:n.dtype,shape:e.shape}},t.prototype.addN=function(e){if(e.length===1)return e[0];if(e.length>yt().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var n=Math.floor(e.length/2),a=this.addN(e.slice(0,n)),i=this.addN(e.slice(n));return this.addN([a,i])}var o=e.map((function(h){return h.dtype})).reduce((function(h,f){return Yn(h,f)})),u=e.map((function(h){return h.shape})),l=yt().getBool("WEBGL_PACK")?new vV(e[0].shape,u):new pV(e[0].shape,u);return this.compileAndRun(l,e,o)},t.prototype.subtract=function(e,n){if(e.dtype==="complex64"&&n.dtype==="complex64")return this.complexSeparableBinaryOp(e,n,Dm);if(this.shouldExecuteOnCPU([e,n]))return this.cpuBackend.subtract(e,n);var a=Yn(e.dtype,n.dtype);if(yt().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,n,Dm,e.dtype);var i=new on(Dm,e.shape,n.shape);return this.compileAndRun(i,[e,n],a)},t.prototype.pow=function(e,n){var a=yt().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ii(`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,e.shape,n.shape):new on(`
if(a < 0.0 && floor(b) < b){
  return NAN;
}
if (b == 0.0) {
  return 1.0;
}
return (round(mod(b, 2.0)) != 1) ?
    pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,e.shape,n.shape),i=Yn(e.dtype,n.dtype);return this.compileAndRun(a,[e,n],i)},t.prototype.ceil=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.ceil(e);if(yt().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Kw,e.dtype);var n=new re(e.shape,Kw);return this.compileAndRun(n,[e])},t.prototype.floor=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.floor(e);if(yt().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Yw,e.dtype);var n=new re(e.shape,Yw);return this.compileAndRun(n,[e])},t.prototype.sign=function(e){var n=new re(e.shape,`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`);return this.compileAndRun(n,[e])},t.prototype.isNaN=function(e){var n=new re(e.shape,"return float(isnan(x));");return this.compileAndRun(n,[e],"bool")},t.prototype.isInf=function(e){var n=new re(e.shape,"return float(isinf(x));");return this.compileAndRun(n,[e],"bool")},t.prototype.isFinite=function(e){var n=new re(e.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(n,[e],"bool")},t.prototype.round=function(e){var n=new re(e.shape,`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`);return this.compileAndRun(n,[e])},t.prototype.exp=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.exp(e);if(yt().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Qw,e.dtype);var n=new re(e.shape,Qw);return this.compileAndRun(n,[e])},t.prototype.expm1=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.expm1(e);if(yt().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Zw,e.dtype);var n=new re(e.shape,Zw);return this.compileAndRun(n,[e])},t.prototype.softmax=function(e,n){var a=In([n],e.shape),i=this.max(e,a),o=Ar(i.shape,a),u=this.subtract(e,i.reshape(o)),l=this.exp(u),h=this.sum(l,a).reshape(o);return Qo(l,h)},t.prototype.log=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.log(e);if(yt().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,`
  vec4 result = log(x);
  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));
  result.r = isNaN.r == 1.0 ? NAN : result.r;
  result.g = isNaN.g == 1.0 ? NAN : result.g;
  result.b = isNaN.b == 1.0 ? NAN : result.b;
  result.a = isNaN.a == 1.0 ? NAN : result.a;

  return result;
`,e.dtype);var n=new re(e.shape,`if (x < 0.0) return NAN;
  return log(x);`);return this.compileAndRun(n,[e])},t.prototype.log1p=function(e){var n=new re(e.shape,"return log(1.0 + x);");return this.compileAndRun(n,[e])},t.prototype.sqrt=function(e){var n=new re(e.shape,"return sqrt(x);");return this.compileAndRun(n,[e])},t.prototype.rsqrt=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.rsqrt(e);var n=new re(e.shape,"return inversesqrt(x);");return this.compileAndRun(n,[e])},t.prototype.reciprocal=function(e){var n=new re(e.shape,"return 1.0 / x;");return this.compileAndRun(n,[e])},t.prototype.relu=function(e){var n;return n=yt().getBool("WEBGL_PACK")?new Cc(e.shape,dR):new re(e.shape,cR),this.compileAndRun(n,[e])},t.prototype.relu6=function(e){var n;return n=yt().getBool("WEBGL_PACK")?new Cc(e.shape,pR):new re(e.shape,hR),this.compileAndRun(n,[e])},t.prototype.prelu=function(e,n){var a=yt().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ii(lR,e.shape,n.shape):new on(sR,e.shape,n.shape);return this.compileAndRun(a,[e,n])},t.prototype.elu=function(e){if(yt().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,vR,e.dtype);var n=new re(e.shape,fR);return this.compileAndRun(n,[e])},t.prototype.eluDer=function(e,n){var a=yt().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ii(`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,e.shape,n.shape):new on("return (b >= 1.0) ? a : a * (b + 1.0);",e.shape,n.shape);return this.compileAndRun(a,[e,n])},t.prototype.selu=function(e){var n=new re(e.shape,Y6);return this.compileAndRun(n,[e])},t.prototype.int=function(e){var n=new re(e.shape,"return float(int(x));");return this.compileAndRun(n,[e],"int32")},t.prototype.clip=function(e,n,a){var i,o=(i=yt().getBool("WEBGL_PACK_CLIP")?new NV(e.shape):new IV(e.shape)).getCustomSetupFunc(n,a);return this.compileAndRun(i,[e],null,o)},t.prototype.abs=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.abs(e);if(yt().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,jw,e.dtype);var n=new re(e.shape,jw);return this.compileAndRun(n,[e])},t.prototype.complexAbs=function(e){var n=this.texData.get(e.dataId),a=new OV(e.shape),i=[this.makeComplexComponentTensorInfo(e,n.complexTensors.real),this.makeComplexComponentTensorInfo(e,n.complexTensors.imag)];return this.compileAndRun(a,i)},t.prototype.sigmoid=function(e){var n=new re(e.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(n,[e])},t.prototype.softplus=function(e){var n=new re(e.shape,`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`);return this.compileAndRun(n,[e])},t.prototype.sin=function(e){var n=new re(e.shape,Q6);return this.compileAndRun(n,[e])},t.prototype.cos=function(e){var n=new re(e.shape,Z6);return this.compileAndRun(n,[e])},t.prototype.tan=function(e){var n=new re(e.shape,"return tan(x);");return this.compileAndRun(n,[e])},t.prototype.asin=function(e){var n=new re(e.shape,$6);return this.compileAndRun(n,[e])},t.prototype.acos=function(e){var n=new re(e.shape,J6);return this.compileAndRun(n,[e])},t.prototype.atan=function(e){var n=new re(e.shape,tG);return this.compileAndRun(n,[e])},t.prototype.atan2=function(e,n){var a=yt().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ii(`
  vec4 result = atan(a, b);
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,e.shape,n.shape):new on(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return atan(a, b);
`,e.shape,n.shape);return this.compileAndRun(a,[e,n])},t.prototype.sinh=function(e){var n=new re(e.shape,`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`);return this.compileAndRun(n,[e])},t.prototype.cosh=function(e){var n=new re(e.shape,`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`);return this.compileAndRun(n,[e])},t.prototype.tanh=function(e){var n=new re(e.shape,`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`);return this.compileAndRun(n,[e])},t.prototype.asinh=function(e){var n=new re(e.shape,eG);return this.compileAndRun(n,[e])},t.prototype.acosh=function(e){var n=new re(e.shape,nG);return this.compileAndRun(n,[e])},t.prototype.atanh=function(e){var n=new re(e.shape,rG);return this.compileAndRun(n,[e])},t.prototype.erf=function(e){var n=new re(e.shape,`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = 0.3275911;
  float a1 = 0.254829592;
  float a2 = -0.284496736;
  float a3 = 1.421413741;
  float a4 = -1.453152027;
  float a5 = 1.061405429;

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`);return this.compileAndRun(n,[e])},t.prototype.step=function(e,n){var a=new re(e.shape,(function(i){return i===void 0&&(i=0),Wa+`
    return x > 0.0 ? 1.0 : float(`+i+`);
  `})(n));return this.compileAndRun(a,[e])},t.prototype.conv2dByMatMul=function(e,n,a,i,o,u){var l=e.shape,h=this.texData.get(e.dataId),f=a.inChannels,p=l[0]*l[1]*l[2],v=a.outChannels,m=a.dataFormat==="channelsLast",x=(p===1||v===1)&&f>1e3,b=l[2]%2!=0&&!!h.isPacked;if(x||!yt().getBool("WEBGL_LAZILY_UNPACK")||!yt().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!b){var E=m?l[0]*l[1]*l[2]:l[0]*l[2]*l[3],C=this.reshape(e,[1,E,a.inChannels]),R=this.reshape(n,[1,a.inChannels,a.outChannels]);return this.reshape(this.fusedBatchMatMul({a:C,b:R,transposeA:!1,transposeB:!1,bias:i,activation:o,preluActivationWeights:u}),a.outShape)}var _=m?l[0]*l[1]*(l[2]+1):l[0]*l[2]*(l[3]+1),A={dataId:e.dataId,shape:[1,_,a.inChannels],dtype:e.dtype},k=h.shape;h.shape=h.shape.slice(),h.shape[h.shape.length-2]++,G(If(h.shape,A.shape),(function(){return"packed reshape "+h.shape+" to "+A.shape+" isn't free"}));var D=this.reshape(n,[1,a.inChannels,a.outChannels]),P=this.fusedBatchMatMul({a:A,b:D,transposeA:!1,transposeB:!1,bias:i,activation:o,preluActivationWeights:u}),M=this.texData.get(P.dataId);return G(M.isPacked,(function(){return"batchMatMul result is expected to be packed"})),h.shape=k,M.shape=a.outShape,rt.makeTensorFromDataId(P.dataId,a.outShape,P.dtype)},t.prototype.conv2dWithIm2Row=function(e,n,a,i,o,u){var l=a.filterWidth,h=a.filterHeight,f=a.inChannels,p=a.outWidth,v=a.outHeight,m=a.dataFormat==="channelsLast",x=l*h*f,b=v*p,E=[x,b],C=e.squeeze([0]),R=n.reshape([1,x,-1]),_=new w6(E,C.shape,a),A=this.compileAndRun(_,[C]).reshape([1,E[0],E[1]]),k=i!=null,D=u!=null,P=o?Bf(o,!0):null,M=new Im(A.shape,[1,b,a.outChannels],!0,!1,k,P,D),O=[A,R];i&&O.push(i),D&&O.push(u);var F=this.compileAndRun(M,O);return m?F.reshape([1,v,p,a.outChannels]):F.reshape([1,a.outChannels,v,p])},t.prototype.fusedConv2d=function(e){var n=e.input,a=e.filter,i=e.convInfo,o=e.bias,u=e.activation,l=e.preluActivationWeights;if(i.filterHeight===1&&i.filterWidth===1&&i.dilationHeight===1&&i.dilationWidth===1&&i.strideHeight===1&&i.strideWidth===1&&(i.padInfo.type==="SAME"||i.padInfo.type==="VALID"))return this.conv2dByMatMul(n,a,i,o,u,l);if(yt().getBool("WEBGL_CONV_IM2COL")&&n.shape[0]===1)return this.conv2dWithIm2Row(n,a,i,o,u,l);var h=o!=null,f=l!=null,p=u?Bf(u,!1):null,v=new Fw(i,h,p,f),m=[n,a];return o&&m.push(o),l&&m.push(l),this.compileAndRun(v,m)},t.prototype.conv2d=function(e,n,a){if(a.filterHeight===1&&a.filterWidth===1&&a.dilationHeight===1&&a.dilationWidth===1&&a.strideHeight===1&&a.strideWidth===1&&(a.padInfo.type==="SAME"||a.padInfo.type==="VALID"))return this.conv2dByMatMul(e,n,a);if(yt().getBool("WEBGL_CONV_IM2COL")&&e.shape[0]===1)return this.conv2dWithIm2Row(e,n,a);var i=new Fw(a);return this.compileAndRun(i,[e,n])},t.prototype.conv2dDerInput=function(e,n,a){var i=new FV(a);return this.compileAndRun(i,[e,n])},t.prototype.conv2dDerFilter=function(e,n,a){var i=new PV(a);return this.compileAndRun(i,[e,n])},t.prototype.fusedDepthwiseConv2D=function(e){var n,a=e.input,i=e.filter,o=e.convInfo,u=e.bias,l=e.activation,h=e.preluActivationWeights,f=yt().getBool("WEBGL_PACK_DEPTHWISECONV")&&o.strideWidth<=2&&o.outChannels/o.inChannels==1,p=l?Bf(l,f):null,v=[a,i],m=u!=null,x=h!=null;return m&&v.push(u),x&&v.push(h),f?(n=new zw(o,m,p,x),this.compileAndRun(n,v)):(n=new Lw(o,m,p,x),this.compileAndRun(n,v))},t.prototype.depthwiseConv2D=function(e,n,a){var i;return yt().getBool("WEBGL_PACK_DEPTHWISECONV")&&a.strideWidth<=2&&a.outChannels/a.inChannels==1?(i=new zw(a),this.compileAndRun(i,[e,n])):(i=new Lw(a),this.compileAndRun(i,[e,n]))},t.prototype.depthwiseConv2DDerInput=function(e,n,a){var i=new WV(a);return this.compileAndRun(i,[e,n])},t.prototype.depthwiseConv2DDerFilter=function(e,n,a){var i=new UV(a);return this.compileAndRun(i,[e,n])},t.prototype.conv3d=function(e,n,a){var i=new VV(a);return this.compileAndRun(i,[e,n])},t.prototype.conv3dDerInput=function(e,n,a){var i=new zV(a);return this.compileAndRun(i,[e,n])},t.prototype.conv3dDerFilter=function(e,n,a){var i=new LV(a);return this.compileAndRun(i,[e,n])},t.prototype.maxPool=function(e,n){var a=new kc(n,"max",!1);return this.compileAndRun(a,[e])},t.prototype.avgPool=function(e,n){var a=new kc(n,"avg",!1);return this.compileAndRun(a,[e],"float32")},t.prototype.maxPoolBackprop=function(e,n,a,i){var o=new kc(i,"max",!0),u=this.compileAndRun(o,[n]),l=new R6(i),h=this.compileAndRun(l,[e,u],n.dtype);return u.dispose(),h},t.prototype.avgPoolBackprop=function(e,n,a){var i=new CV(a);return this.compileAndRun(i,[e],n.dtype)},t.prototype.cast=function(e,n){return JS(e,n,this)},t.prototype.unstack=function(e,n){for(var a=e.shape[n],i=new Array(e.rank-1),o=0,u=0;u<e.rank;u++)u!==n&&(i[o++]=e.shape[u]);var l=new Array(e.rank).fill(0),h=e.shape.slice();h[n]=1;var f=new Array(a);for(u=0;u<f.length;u++)l[n]=u,f[u]=this.slice(e,l,h).reshape(i);return f},t.prototype.avgPool3d=function(e,n){var a=new Nm(n,"avg",!1);return this.compileAndRun(a,[e],"float32")},t.prototype.avgPool3dBackprop=function(e,n,a){var i=new SV(a);return this.compileAndRun(i,[e],n.dtype)},t.prototype.maxPool3d=function(e,n){var a=new Nm(n,"max",!1);return this.compileAndRun(a,[e],"float32")},t.prototype.maxPool3dBackprop=function(e,n,a,i){var o=new Nm(i,"max",!0),u=this.compileAndRun(o,[n]),l=new _6(i),h=this.compileAndRun(l,[e,u],n.dtype);return u.dispose(),h},t.prototype.reshape=function(e,n){var a=this.texData.get(e.dataId);if(a.isPacked&&!If(e.shape,n)&&(a.texture===null||!If(a.shape,n))){var i=this.packedReshape(e,n);return rt.makeTensorFromDataId(i.dataId,i.shape,i.dtype)}return Rg(e,n)},t.prototype.resizeBilinear=function(e,n,a,i){var o=yt().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new P6(e.shape,n,a,i):new B6(e.shape,n,a,i);return this.compileAndRun(o,[e],"float32")},t.prototype.resizeBilinearBackprop=function(e,n,a){var i=new M6(e,n,a);return this.compileAndRun(i,[e])},t.prototype.resizeNearestNeighbor=function(e,n,a,i){var o=new L6(e.shape,n,a,i);return this.compileAndRun(o,[e])},t.prototype.resizeNearestNeighborBackprop=function(e,n,a){var i=new F6(e,n,a);return this.compileAndRun(i,[e])},t.prototype.multinomial=function(e,n,a,i){var o=n?e:Bd(e),u=o.shape[0],l=o.shape[1],h=new A6(u,l,a),f=h.getCustomSetupFunc(i);return this.compileAndRun(h,[o],"int32",f)},t.prototype.oneHot=function(e,n,a,i){var o=new T6(e.size,n,a,i);return this.compileAndRun(o,[e])},t.prototype.diag=function(e){var n=new KV(e.size);return this.compileAndRun(n,[e])},t.prototype.nonMaxSuppression=function(e,n,a,i,o){return sd("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),sy(e.dataSync(),n.dataSync(),a,i,o)},t.prototype.cropAndResize=function(e,n,a,i,o,u){var l=new GV(e.shape,n.shape,i,o,u);return this.compileAndRun(l,[e,n,a],"float32")},t.prototype.depthToSpace=function(e,n,a){G(n>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: "+n}));var i=e.shape[0],o=a==="NHWC"?e.shape[1]:e.shape[2],u=a==="NHWC"?e.shape[2]:e.shape[3],l=a==="NHWC"?e.shape[3]:e.shape[1],h=o*n,f=u*n,p=l/(n*n),v=new XV(a==="NHWC"?[i,h,f,p]:[i,p,h,f],n,a);return this.compileAndRun(v,[e])},t.prototype.split=function(e,n,a){return nR(e,n,a)},t.prototype.scatterND=function(e,n,a){var i=vd(0,e,a),o=i.sliceRank,u=i.numUpdates,l=i.sliceSize,h=i.strides,f=i.outputSize,p=[f/l,l],v=e.reshape([u,o]),m=n.reshape([u,l]);if(f===0)return Rg(Qn([]),a);var x=Ut(0),b=new Gw(u,o,v.rank,m.rank,h,p);return this.compileAndRun(b,[m,v,x]).reshape(a)},t.prototype.sparseToDense=function(e,n,a,i){var o=vd(0,e,a),u=o.sliceRank,l=o.numUpdates,h=o.strides,f=o.outputSize,p=new Gw(l,u,e.rank,n.rank,h,[f,1]);return this.compileAndRun(p,[n,e,i]).reshape(a)},t.prototype.fft=function(e){return this.fftImpl(e,!1)},t.prototype.ifft=function(e){return this.fftImpl(e,!0)},t.prototype.fftImpl=function(e,n){var a=this.texData.get(e.dataId),i=new Ww(JV,e.shape,n),o=new Ww(t6,e.shape,n),u=[this.makeComplexComponentTensorInfo(e,a.complexTensors.real),this.makeComplexComponentTensorInfo(e,a.complexTensors.imag)],l=this.compileAndRun(i,u),h=this.compileAndRun(o,u),f=this.complex(l,h).as2D(e.shape[0],e.shape[1]);return l.dispose(),h.dispose(),f},t.prototype.gatherND=function(e,n){var a=n.shape,i=a[a.length-1],o=jS(e,n),u=o[0],l=o[1],h=o[2],f=o[3],p=n.reshape([l,i]),v=e.reshape([e.size/h,h]),m=new r6(i,f,[l,h]);return this.compileAndRun(m,[v,p]).reshape(u)},t.prototype.fill=function(e,n,a){if((a=a||th(n))==="string"){var i=ad(a,Ot(e));return i.fill(n),rt.makeTensor(i,e,a,this)}var o=new e6(e,n),u=o.getCustomSetupFunc(n);return this.compileAndRun(o,[],a,u)},t.prototype.onesLike=function(e){if(e.dtype==="string")throw new Error("onesLike is not supported under string dtype");return this.fill(e.shape,1,e.dtype)},t.prototype.zerosLike=function(e){return this.fill(e.shape,e.dtype==="string"?"":0,e.dtype)},t.prototype.linspace=function(e,n,a){return tR(e,n,a)},t.prototype.makeTensorInfo=function(e,n){var a=this.write(null,e,n);return this.texData.get(a).usage=null,{dataId:a,shape:e,dtype:n}},t.prototype.makeOutput=function(e,n){var a=this.makeTensorInfo(e,n).dataId;return rt.makeTensorFromDataId(a,e,n,this)},t.prototype.unpackTensor=function(e){var n=new iG(e.shape);return this.runWebGLProgram(n,[e],e.dtype)},t.prototype.packTensor=function(e){var n=new k6(e.shape);return this.runWebGLProgram(n,[e],e.dtype,null,!0)},t.prototype.packedReshape=function(e,n){var a=[od(e.shape)].concat(ud(e.shape)),i={dtype:e.dtype,shape:a,dataId:e.dataId},o=[od(n)].concat(ud(n)),u=new O6(o,a),l=this.runWebGLProgram(u,[i],e.dtype,null,!0);return{dataId:l.dataId,shape:n,dtype:l.dtype}},t.prototype.decode=function(e){var n,a=this.texData.get(e),i=a.isPacked,o=a.shape,u=a.dtype,l=Am(o);return n=i?new jV(l):new qV(l),{dtype:u,shape:o,dataId:this.runWebGLProgram(n,[{shape:l,dtype:u,dataId:e}],u,null,!0).dataId}},t.prototype.runWebGLProgram=function(e,n,a,i,o){var u=this;o===void 0&&(o=!1);var l=this.makeTensorInfo(e.outputShape,a),h=this.texData.get(l.dataId);if(e.packedOutput&&(h.isPacked=!0),e.outPackingScheme===Oc.DENSE){var f=Ac(e.outputShape);h.texShape=f.map((function(_){return 2*_}))}if(e.outTexUsage!=null&&(h.usage=e.outTexUsage),Ot(l.shape)===0)return h.values=ll(l.dtype,0),l;var p=[],v=n.map((function(_){if(_.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var A=u.texData.get(_.dataId);if(A.texture==null){if(!e.packedInputs&&Ot(_.shape)<=yt().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:_.shape,texData:null,isUniform:!0,uniformValues:A.values};e.packedInputs&&(A.isPacked=!0,A.shape=_.shape)}else if(!!A.isPacked!=!!e.packedInputs)_=A.isPacked?u.unpackTensor(_):u.packTensor(_),p.push(_),A=u.texData.get(_.dataId);else if(A.isPacked&&!If(A.shape,_.shape)){var k=_,D=_.shape;_.shape=A.shape,_=u.packedReshape(_,D),p.push(_),A=u.texData.get(_.dataId),k.shape=D}return u.uploadToGPU(_.dataId),{shape:_.shape,texData:A,isUniform:!1}}));this.uploadToGPU(l.dataId);var m,x={shape:l.shape,texData:h,isUniform:!1},b=(function(_,A,k){var D="";A.concat(k).forEach((function(O){var F=O.texData!=null&&O.texData.slice!=null&&O.texData.slice.flatOffset>0,W=O.isUniform?"uniform":O.texData.texShape;D+=O.shape+"_"+W+"_"+F}));var P=_.userCode,M=_.constructor.name;return M+="_"+D+"_"+P})(e,v,x),E=this.getAndSaveBinary(b,(function(){return(function(_,A,k,D){var P=A.userCode,M=k.map((function(Q,ut){var B={logicalShape:Q.shape,texShape:Q.isUniform?null:Q.texData.texShape,isUniform:Q.isUniform,isPacked:!Q.isUniform&&Q.texData.isPacked,flatOffset:null};return Q.texData!=null&&Q.texData.slice!=null&&Q.texData.slice.flatOffset>0&&(B.flatOffset=Q.texData.slice.flatOffset),{name:A.variableNames[ut],shapeInfo:B}})),O=M.map((function(Q){return Q.shapeInfo})),F={logicalShape:D.shape,texShape:D.texData.texShape,isUniform:!1,isPacked:D.texData.isPacked,flatOffset:null},W=gV(M,F,P,A.packedInputs),j=_.createProgram(W),ot=null,nt=_.getUniformLocation(j,"NAN",!1);yt().getNumber("WEBGL_VERSION")===1&&(ot=_.getUniformLocation(j,"INFINITY",!1));for(var at={},V=0;V<A.variableNames.length;V++){var X=A.variableNames[V];at[X]=_.getUniformLocation(j,X,!1),at["offset"+X]=_.getUniformLocation(j,"offset"+X,!1)}return{program:A,source:W,webGLProgram:j,uniformLocations:at,inShapeInfos:O,outShapeInfo:F,infLoc:ot,nanLoc:nt}})(u.gpgpu,e,v,x)})),C=this.activeTimers!=null;if(C&&(m=this.startTimer()),(function(_,A,k,D,P){Vw(A.inShapeInfos,k),Vw([A.outShapeInfo],[D]);var M=D.texData.texture,O=D.texData.texShape;D.texData.isPacked?_.setOutputPackedMatrixTexture(M,O[0],O[1]):_.setOutputMatrixTexture(M,O[0],O[1]),_.setProgram(A.webGLProgram),yt().getNumber("WEBGL_VERSION")===1&&A.infLoc!==null&&_.gl.uniform1f(A.infLoc,1/0),A.nanLoc!==null&&_.gl.uniform1f(A.nanLoc,NaN),k.forEach((function(F,W){var j=A.program.variableNames[W],ot=A.uniformLocations[j],nt=A.uniformLocations["offset"+j];if(ot!=null)if(F.isUniform)if(Ot(F.shape)<2)_.gl.uniform1f(ot,F.uniformValues[0]);else{var at=F.uniformValues;at instanceof Float32Array||(at=new Float32Array(at)),_.gl.uniform1fv(ot,at)}else F.texData.slice!=null&&nt!=null&&_.gl.uniform1i(nt,F.texData.slice.flatOffset),_.setInputMatrixTexture(F.texData.texture,ot,W)})),P?.(_,A.webGLProgram),_.executeProgram()})(this.gpgpu,E,v,x,i),p.forEach((function(_){return u.disposeData(_.dataId)})),C&&(m=this.endTimer(m),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(m)})),!yt().getBool("WEBGL_LAZILY_UNPACK")&&h.isPacked&&o===!1){var R=this.unpackTensor(l);return this.disposeData(l.dataId),R}return l},t.prototype.compileAndRun=function(e,n,a,i,o){o===void 0&&(o=!1),a=a||n[0].dtype;var u=this.runWebGLProgram(e,n,a,i,o);return rt.makeTensorFromDataId(u.dataId,u.shape,u.dtype)},t.prototype.getAndSaveBinary=function(e,n){return e in this.binaryCache||(this.binaryCache[e]=n()),this.binaryCache[e]},t.prototype.getTextureManager=function(){return this.textureManager},t.prototype.dispose=function(){var e=this;this.disposed||(yt().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach((function(n){e.gpgpu.deleteProgram(e.binaryCache[n].webGLProgram),delete e.binaryCache[n]})),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},t.prototype.floatPrecision=function(){var e=this;return this.floatPrecisionValue==null&&(this.floatPrecisionValue=Ee((function(){if(!yt().get("WEBGL_RENDER_FLOAT32_ENABLED")){var n=yt().getBool("DEBUG");yt().set("DEBUG",!1);var a=e.abs(Ut(1e-8)).dataSync()[0];if(yt().set("DEBUG",n),a>0)return 32}return 16}))),this.floatPrecisionValue},t.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},t.prototype.uploadToGPU=function(e){var n,a=this.texData.get(e),i=a.shape,o=a.dtype,u=a.values,l=a.texture,h=a.usage,f=a.isPacked;if(l==null){var p,v=this.activeTimers!=null;v&&(p=ui());var m=a.texShape;if(m==null&&(m=G3(i,f),a.texShape=m),u!=null){var x=Am(i),b=void 0,E=m[1],C=m[0],R=u instanceof Uint8Array;f?(E=(n=nh(m[0],m[1]))[0],C=n[1],b=new $V(x,[C,E],R)):b=new ZV(x,[C,E],R);var _=this.makeTensorInfo([C,E],o);this.texData.get(_.dataId).usage=R?Kr.PIXELS:Kr.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(_.dataId),E,C,u);var A=this.runWebGLProgram(b,[_],o,null,!0),k=this.texData.get(A.dataId);a.texture=k.texture,a.texShape=k.texShape,a.isPacked=k.isPacked,a.usage=k.usage,this.disposeData(_.dataId),this.texData.delete(A.dataId),a.values=null,v&&(this.uploadWaitMs+=ui()-p)}else{var D=this.acquireTexture(m,h,o,f);a.texture=D}}},t.prototype.convertAndCacheOnCPU=function(e,n){var a=this.texData.get(e),i=a.dtype;return this.releaseGPUData(e),n!=null&&(a.values=(function(o,u){if(u==="float32"||u==="complex64")return o;if(u==="int32"||u==="bool"){for(var l=u==="int32"?new Int32Array(o.length):new Uint8Array(o.length),h=0;h<l.length;++h)l[h]=Math.round(o[h]);return l}throw new Error("Unknown dtype "+u)})(n,i)),a.values},t.prototype.acquireTexture=function(e,n,a,i){if(this.numBytesInGPU+=this.computeBytes(e,a),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var o=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+o+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(e,n,i)},t.prototype.computeBytes=function(e,n){return e[0]*e[1]*xS(n)},t})(ZS);AS()&&rt.registerBackend("webgl",(function(){return new uG}),2);function Zu(r,t){return r(t={exports:{}},t.exports),t.exports}var sG=Zu((function(r){(function(t,e,n){function a(u){var l,h=this,f=(l=4022871197,function(p){p=p.toString();for(var v=0;v<p.length;v++){var m=.02519603282416938*(l+=p.charCodeAt(v));m-=l=m>>>0,l=(m*=l)>>>0,l+=4294967296*(m-=l)}return 23283064365386963e-26*(l>>>0)});h.next=function(){var p=2091639*h.s0+23283064365386963e-26*h.c;return h.s0=h.s1,h.s1=h.s2,h.s2=p-(h.c=0|p)},h.c=1,h.s0=f(" "),h.s1=f(" "),h.s2=f(" "),h.s0-=f(u),h.s0<0&&(h.s0+=1),h.s1-=f(u),h.s1<0&&(h.s1+=1),h.s2-=f(u),h.s2<0&&(h.s2+=1),f=null}function i(u,l){return l.c=u.c,l.s0=u.s0,l.s1=u.s1,l.s2=u.s2,l}function o(u,l){var h=new a(u),f=l&&l.state,p=h.next;return p.int32=function(){return 4294967296*h.next()|0},p.double=function(){return p()+11102230246251565e-32*(2097152*p()|0)},p.quick=p,f&&(typeof f=="object"&&i(f,h),p.state=function(){return i(h,{})}),p}e&&e.exports?e.exports=o:this.alea=o})(0,r)})),lG=Zu((function(r){(function(t,e,n){function a(u){var l=this,h="";l.x=0,l.y=0,l.z=0,l.w=0,l.next=function(){var p=l.x^l.x<<11;return l.x=l.y,l.y=l.z,l.z=l.w,l.w^=l.w>>>19^p^p>>>8},u===(0|u)?l.x=u:h+=u;for(var f=0;f<h.length+64;f++)l.x^=0|h.charCodeAt(f),l.next()}function i(u,l){return l.x=u.x,l.y=u.y,l.z=u.z,l.w=u.w,l}function o(u,l){var h=new a(u),f=l&&l.state,p=function(){return(h.next()>>>0)/4294967296};return p.double=function(){do var v=((h.next()>>>11)+(h.next()>>>0)/4294967296)/2097152;while(v===0);return v},p.int32=h.next,p.quick=p,f&&(typeof f=="object"&&i(f,h),p.state=function(){return i(h,{})}),p}e&&e.exports?e.exports=o:this.xor128=o})(0,r)})),cG=Zu((function(r){(function(t,e,n){function a(u){var l=this,h="";l.next=function(){var p=l.x^l.x>>>2;return l.x=l.y,l.y=l.z,l.z=l.w,l.w=l.v,(l.d=l.d+362437|0)+(l.v=l.v^l.v<<4^p^p<<1)|0},l.x=0,l.y=0,l.z=0,l.w=0,l.v=0,u===(0|u)?l.x=u:h+=u;for(var f=0;f<h.length+64;f++)l.x^=0|h.charCodeAt(f),f==h.length&&(l.d=l.x<<10^l.x>>>4),l.next()}function i(u,l){return l.x=u.x,l.y=u.y,l.z=u.z,l.w=u.w,l.v=u.v,l.d=u.d,l}function o(u,l){var h=new a(u),f=l&&l.state,p=function(){return(h.next()>>>0)/4294967296};return p.double=function(){do var v=((h.next()>>>11)+(h.next()>>>0)/4294967296)/2097152;while(v===0);return v},p.int32=h.next,p.quick=p,f&&(typeof f=="object"&&i(f,h),p.state=function(){return i(h,{})}),p}e&&e.exports?e.exports=o:this.xorwow=o})(0,r)})),hG=Zu((function(r){(function(t,e,n){function a(u){var l=this;l.next=function(){var h,f,p=l.x,v=l.i;return h=p[v],f=(h^=h>>>7)^h<<24,f^=(h=p[v+1&7])^h>>>10,f^=(h=p[v+3&7])^h>>>3,f^=(h=p[v+4&7])^h<<7,h=p[v+7&7],f^=(h^=h<<13)^h<<9,p[v]=f,l.i=v+1&7,f},(function(h,f){var p,v=[];if(f===(0|f))v[0]=f;else for(f=""+f,p=0;p<f.length;++p)v[7&p]=v[7&p]<<15^f.charCodeAt(p)+v[p+1&7]<<13;for(;v.length<8;)v.push(0);for(p=0;p<8&&v[p]===0;++p);for(p==8?v[7]=-1:v[p],h.x=v,h.i=0,p=256;p>0;--p)h.next()})(l,u)}function i(u,l){return l.x=u.x.slice(),l.i=u.i,l}function o(u,l){u==null&&(u=+new Date);var h=new a(u),f=l&&l.state,p=function(){return(h.next()>>>0)/4294967296};return p.double=function(){do var v=((h.next()>>>11)+(h.next()>>>0)/4294967296)/2097152;while(v===0);return v},p.int32=h.next,p.quick=p,f&&(f.x&&i(f,h),p.state=function(){return i(h,{})}),p}e&&e.exports?e.exports=o:this.xorshift7=o})(0,r)})),fG=Zu((function(r){(function(t,e,n){function a(u){var l=this;l.next=function(){var h,f,p=l.w,v=l.X,m=l.i;return l.w=p=p+1640531527|0,f=v[m+34&127],h=v[m=m+1&127],f^=f<<13,h^=h<<17,f^=f>>>15,h^=h>>>12,f=v[m]=f^h,l.i=m,f+(p^p>>>16)|0},(function(h,f){var p,v,m,x,b,E=[],C=128;for(f===(0|f)?(v=f,f=null):(f+="\0",v=0,C=Math.max(C,f.length)),m=0,x=-32;x<C;++x)f&&(v^=f.charCodeAt((x+32)%f.length)),x===0&&(b=v),v^=v<<10,v^=v>>>15,v^=v<<4,v^=v>>>13,x>=0&&(b=b+1640531527|0,m=(p=E[127&x]^=v+b)==0?m+1:0);for(m>=128&&(E[127&(f&&f.length||0)]=-1),m=127,x=512;x>0;--x)v=E[m+34&127],p=E[m=m+1&127],v^=v<<13,p^=p<<17,v^=v>>>15,p^=p>>>12,E[m]=v^p;h.w=b,h.X=E,h.i=m})(l,u)}function i(u,l){return l.i=u.i,l.w=u.w,l.X=u.X.slice(),l}function o(u,l){u==null&&(u=+new Date);var h=new a(u),f=l&&l.state,p=function(){return(h.next()>>>0)/4294967296};return p.double=function(){do var v=((h.next()>>>11)+(h.next()>>>0)/4294967296)/2097152;while(v===0);return v},p.int32=h.next,p.quick=p,f&&(f.X&&i(f,h),p.state=function(){return i(h,{})}),p}e&&e.exports?e.exports=o:this.xor4096=o})(0,r)})),dG=Zu((function(r){(function(t,e,n){function a(u){var l=this,h="";l.next=function(){var p=l.b,v=l.c,m=l.d,x=l.a;return p=p<<25^p>>>7^v,v=v-m|0,m=m<<24^m>>>8^x,x=x-p|0,l.b=p=p<<20^p>>>12^v,l.c=v=v-m|0,l.d=m<<16^v>>>16^x,l.a=x-p|0},l.a=0,l.b=0,l.c=-1640531527,l.d=1367130551,u===Math.floor(u)?(l.a=u/4294967296|0,l.b=0|u):h+=u;for(var f=0;f<h.length+20;f++)l.b^=0|h.charCodeAt(f),l.next()}function i(u,l){return l.a=u.a,l.b=u.b,l.c=u.c,l.d=u.d,l}function o(u,l){var h=new a(u),f=l&&l.state,p=function(){return(h.next()>>>0)/4294967296};return p.double=function(){do var v=((h.next()>>>11)+(h.next()>>>0)/4294967296)/2097152;while(v===0);return v},p.int32=h.next,p.quick=p,f&&(typeof f=="object"&&i(f,h),p.state=function(){return i(h,{})}),p}e&&e.exports?e.exports=o:this.tychei=o})(0,r)})),Au=Zu((function(r){(function(t,e){var n,a=this,i=256,o=6,u="random",l=e.pow(i,o),h=e.pow(2,52),f=2*h,p=i-1;function v(C,R,_){var A=[],k=b((function M(O,F){var W,j=[],ot=typeof O;if(F&&ot=="object")for(W in O)try{j.push(M(O[W],F-1))}catch{}return j.length?j:ot=="string"?O:O+"\0"})((R=R==1?{entropy:!0}:R||{}).entropy?[C,E(t)]:C??(function(){try{var M;return n&&(M=n.randomBytes)?M=M(i):(M=new Uint8Array(i),(a.crypto||a.msCrypto).getRandomValues(M)),E(M)}catch{var O=a.navigator,F=O&&O.plugins;return[+new Date,a,F,a.screen,E(t)]}})(),3),A),D=new m(A),P=function(){for(var M=D.g(o),O=l,F=0;M<h;)M=(M+F)*i,O*=i,F=D.g(1);for(;M>=f;)M/=2,O/=2,F>>>=1;return(M+F)/O};return P.int32=function(){return 0|D.g(4)},P.quick=function(){return D.g(4)/4294967296},P.double=P,b(E(D.S),t),(R.pass||_||function(M,O,F,W){return W&&(W.S&&x(W,D),M.state=function(){return x(D,{})}),F?(e[u]=M,O):M})(P,k,"global"in R?R.global:this==e,R.state)}function m(C){var R,_=C.length,A=this,k=0,D=A.i=A.j=0,P=A.S=[];for(_||(C=[_++]);k<i;)P[k]=k++;for(k=0;k<i;k++)P[k]=P[D=p&D+C[k%_]+(R=P[k])],P[D]=R;(A.g=function(M){for(var O,F=0,W=A.i,j=A.j,ot=A.S;M--;)O=ot[W=p&W+1],F=F*i+ot[p&(ot[W]=ot[j=p&j+O])+(ot[j]=O)];return A.i=W,A.j=j,F})(i)}function x(C,R){return R.i=C.i,R.j=C.j,R.S=C.S.slice(),R}function b(C,R){for(var _,A=C+"",k=0;k<A.length;)R[p&k]=p&(_^=19*R[p&k])+A.charCodeAt(k++);return E(R)}function E(C){return String.fromCharCode.apply(0,C)}if(e["seed"+u]=v,b(e.random(),t),r.exports){r.exports=v;try{n=require("crypto")}catch{}}})([],Math)}));Au.alea=sG,Au.xor128=lG,Au.xorwow=cG,Au.xorshift7=hG,Au.xor4096=fG,Au.tychei=dG;var Pd=Au.alea,pG=tt({addN_:function(r){G(Array.isArray(r),(function(){return"The argument passed to tf.addN() must be a list of tensors"})),G(r.length>=1,(function(){return"Must pass at least one tensor to tf.addN(), but got "+r.length}));var t=r.map((function(a,i){return z(a,"tensors"+i,"addN")})),e=t[0];t.forEach((function(a){if(a.dtype!==e.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")})),t.forEach((function(a){if(!Wn(a.shape,e.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}));var n=t;return rt.runKernelFunc((function(a,i){return a.addN(t)}),n,null,"AddN")}});function Fd(){TS("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}function mR(r){return r.rank===0||r.rank===1?r.as4D(1,1,1,r.size):r.rank===2?r.as4D(1,1,r.shape[0],r.shape[1]):r.rank===3?r.as4D(1,r.shape[0],r.shape[1],r.shape[2]):r}function gR(r,t,e,n,a,i){i==null&&(i=.001);var o,u,l=z(r,"x","batchNorm"),h=z(t,"mean","batchNorm"),f=z(e,"variance","batchNorm");a!=null&&(o=z(a,"scale","batchNorm")),n!=null&&(u=z(n,"offset","batchNorm")),G(h.rank===f.rank,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),G(u==null||h.rank===u.rank,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),G(o==null||h.rank===o.rank,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}));var p={x:l,scale:o,offset:u,mean:h,variance:f},v={varianceEpsilon:i};return rt.runKernelFunc((function(m,x){var b=mR(l),E=m.batchNormalization(b,Pf(h),Pf(f),i,Pf(o),Pf(u));return x([l,h,f,o]),E}),p,null,"FusedBatchNorm",v).reshape(l.shape)}function Pf(r){return r==null?null:r.rank===0?r.as1D():r.rank===1?r:r.rank===2?r.as4D(1,1,r.shape[0],r.shape[1]):r.rank===3?r.as4D(1,r.shape[0],r.shape[1],r.shape[2]):r}var vG=tt({batchNormalization_:function(r,t,e,n,a,i){return n===void 0&&(n=.001),Fd(),gR(r,t,e,i,a,n)}}),ah=tt({batchNorm_:gR});function yR(r,t,e,n,a,i){var o,u,l=z(r,"x","batchNorm"),h=z(t,"mean","batchNorm"),f=z(e,"variance","batchNorm");return a!=null&&(o=z(a,"scale","batchNorm")),n!=null&&(u=z(n,"offset","batchNorm")),G(l.rank===2,(function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+l.rank+"."})),G(h.rank===2||h.rank===1,(function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+h.rank+"."})),G(f.rank===2||f.rank===1,(function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+f.rank+"."})),o!=null&&G(o.rank===2||o.rank===1,(function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+o.rank+"."})),u!=null&&G(u.rank===2||u.rank===1,(function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+u.rank+"."})),ah(l,h,f,u,o,i)}var mG=tt({batchNormalization2d_:function(r,t,e,n,a,i){return n===void 0&&(n=.001),Fd(),yR(r,t,e,i,a,n)}}),gG=tt({batchNorm2d_:yR});function xR(r,t,e,n,a,i){var o,u,l=z(r,"x","batchNorm"),h=z(t,"mean","batchNorm"),f=z(e,"variance","batchNorm");return a!=null&&(o=z(a,"scale","batchNorm")),n!=null&&(u=z(n,"offset","batchNorm")),G(l.rank===3,(function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+l.rank+"."})),G(h.rank===3||h.rank===1,(function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+h.rank+"."})),G(f.rank===3||f.rank===1,(function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+f.rank+"."})),o!=null&&G(o.rank===3||o.rank===1,(function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+o.rank+"."})),u!=null&&G(u.rank===3||u.rank===1,(function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+u.rank+"."})),ah(l,h,f,u,o,i)}var yG=tt({batchNormalization3d_:function(r,t,e,n,a,i){return n===void 0&&(n=.001),Fd(),xR(r,t,e,i,a,n)}}),xG=tt({batchNorm3d_:xR});function bR(r,t,e,n,a,i){var o,u,l=z(r,"x","batchNorm"),h=z(t,"mean","batchNorm"),f=z(e,"variance","batchNorm");return a!=null&&(o=z(a,"scale","batchNorm")),n!=null&&(u=z(n,"offset","batchNorm")),G(l.rank===4,(function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+l.rank+"."})),G(h.rank===4||h.rank===1,(function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+h.rank+"."})),G(f.rank===4||f.rank===1,(function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+f.rank+"."})),o!=null&&G(o.rank===4||o.rank===1,(function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+o.rank+"."})),u!=null&&G(u.rank===4||u.rank===1,(function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+u.rank+"."})),ah(l,h,f,u,o,i)}var bG=tt({batchNormalization4d_:function(r,t,e,n,a,i){return n===void 0&&(n=.001),Fd(),bR(r,t,e,i,a,n)}}),wG=tt({batchNorm4d_:bR}),wR=tt({broadcastTo_:function(r,t){var e=z(r,"broadcastTo","x"),n=e.shape;if(t.some((function(p){return!(p>0)||p%1!=0})))throw new Error("broadcastTo(): Invalid broadcast shape ["+t+"].");if(t.length<e.rank)throw new Error("broadcastTo(): shape.length="+t.length+" < input.rank="+e.rank+".");if(t.length>e.rank){for(var a=e.shape.slice();a.length<t.length;)a.unshift(1);e=e.reshape(a)}for(var i=e.shape,o=Array.from(t),u=t.length-1;u>=0;u--)if(i[u]===t[u])o[u]=1;else if(e.shape[u]!==1)throw new Error("broadcastTo(): ["+n+"] cannot be broadcast to ["+t+"].");var l=o.map((function(p,v){return p>1?v:-1})).filter((function(p){return p>=0}));if(l.length===0)return e.clone();var h={x:e},f={shape:t,inputShape:i};return rt.runKernelFunc((function(p){return p.tile(e,o)}),h,(function(p){return{x:function(){return p.sum(l,!0)}}}),LS,f)}}),EG=tt({clone_:function(r){var t=z(r,"x","clone",null);return rt.runKernelFunc((function(){return rt.makeTensorFromDataId(t.dataId,t.shape,t.dtype)}),{x:t},null,US)}}),Ld=tt({logicalAnd_:function(r,t){var e=z(r,"a","logicalAnd","bool"),n=z(t,"b","logicalAnd","bool");return he(e.shape,n.shape),rt.runKernelFunc((function(a){return a.logicalAnd(e,n)}),{a:e,b:n},null,"LogicalAnd")}}),CG=tt({logicalNot_:function(r){var t=z(r,"x","logicalNot","bool");return rt.runKernelFunc((function(e){return e.logicalNot(t)}),{$x:t})}}),ER=tt({logicalOr_:function(r,t){var e=z(r,"a","logicalOr","bool"),n=z(t,"b","logicalOr","bool");return he(e.shape,n.shape),rt.runKernelFunc((function(a){return a.logicalOr(e,n)}),{$a:e,$b:n})}}),SG=tt({logicalXor_:function(r,t){var e=z(r,"a","logicalXor","bool"),n=z(t,"b","logicalXor","bool");return he(e.shape,n.shape),ER(r,t).logicalAnd(Ld(r,t).logicalNot())}}),Wu=tt({where_:function(r,t,e){var n=z(t,"a","where"),a=z(e,"b","where"),i=z(r,"condition","where","bool");return Re(n.shape,a.shape,"Error in where: "),i.rank===1?G(i.shape[0]===n.shape[0],(function(){return"The first dimension of `a` must match the size of `condition`."})):Re(i.shape,a.shape,"Error in where: "),rt.runKernelFunc((function(o,u){var l=o.select(i,n,a);return u([i]),l}),{$condition:i,$a:n,$b:a},(function(o,u){var l=u[0];return{$condition:function(){return me(l).toFloat()},$a:function(){return o.mul(l.cast(o.dtype))},$b:function(){return o.mul(l.logicalNot().cast(o.dtype))}}}))}}),CR=function(r){return Mt(this,void 0,void 0,(function(){var t,e,n;return Bt(this,(function(a){switch(a.label){case 0:return[4,(t=z(r,"condition","whereAsync","bool")).data()];case 1:return e=a.sent(),n=cy(t.shape,e),r!==t&&t.dispose(),[2,n]}}))}))},SR=tt({divNoNan_:function(r,t){var e,n=z(r,"a","div"),a=z(t,"b","div");n=(e=Qe(n,a))[0],a=e[1];var i=Qo(n,a),o=me(i),u=a.equal(o);return Wu(u,o,i)}}),Zs=tt({tile_:function(r,t){var e=z(r,"x","tile",null);G(e.rank===t.length,(function(){return"Error in transpose: rank of input "+e.rank+" must match length of reps "+t+"."}));var n=[e],a={x:e},i={reps:t};return rt.runKernelFunc((function(o,u){var l=o.tile(e,t);return u([e]),l}),a,null,WS,i,n)}}),RR=tt({eye_:function(r,t,e,n){n===void 0&&(n="float32"),t==null&&(t=r);for(var a=ee([r,t],n),i=r<=t?r:t,o=0;o<i;++o)a.set(1,o,o);var u=a.toTensor().as2D(r,t);if(e==null)return u;if(e.length===1)return Zs(zo(u,0),[e[0],1,1]);if(e.length===2)return Zs(zo(zo(u,0),0),[e[0],e[1],1,1]);if(e.length===3)return Zs(zo(zo(zo(u,0),0),0),[e[0],e[1],e[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+e.length+"D.")}}),RG=tt({multinomial_:function(r,t,e,n){n===void 0&&(n=!1);var a=z(r,"logits","multinomial"),i=a.size,o=a.rank;if(i<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+i+".");if(o>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+o);e=e||Math.random();var u=o===1?a.as2D(1,-1):a,l=rt.runKernelFunc((function(h){return h.multinomial(u,n,t,e)}),{logits2D:u});return o===1?l.as1D():l}}),xd=tt({oneHot_:function(r,t,e,n){if(e===void 0&&(e=1),n===void 0&&(n=0),t<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+t);var a=z(r,"indices","oneHot","int32"),i=a.shape.concat([t]),o={indices:a=a.flatten()},u={depth:t,onValue:e,offValue:n};return rt.runKernelFunc((function(l,h){return h([a]),l.oneHot(a,t,e,n)}),o,null,zS,u).reshape(i)}}),oo=tt({pad_:function(r,t,e){e===void 0&&(e=0);var n=z(r,"x","pad");if(n.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var a={paddings:t,constantValue:e},i={x:n};return rt.runKernelFunc((function(o,u){return u([n]),o.pad(n,t,e)}),i,null,VS,a)}}),_G=tt({pad1d_:function(r,t,e){return e===void 0&&(e=0),G(t.length===2,(function(){return"Invalid number of paddings. Must be length of 2."})),oo(r,[t],e)}}),AG=tt({pad2d_:function(r,t,e){return e===void 0&&(e=0),G(t.length===2&&t[0].length===2&&t[1].length===2,(function(){return"Invalid number of paddings. Must be length of 2 each."})),oo(r,t,e)}}),TG=tt({pad3d_:function(r,t,e){return e===void 0&&(e=0),G(t.length===3&&t[0].length===2&&t[1].length===2&&t[2].length===2,(function(){return"Invalid number of paddings. Must be length of 2 each."})),oo(r,t,e)}}),kG=tt({pad4d_:function(r,t,e){return e===void 0&&(e=0),G(t.length===4&&t[0].length===2&&t[1].length===2&&t[2].length===2&&t[3].length===2,(function(){return"Invalid number of paddings. Must be length of 2 each."})),oo(r,t,e)}}),DG=tt({rand_:function(r,t,e){var n=Ot(r),a=null;if(e==null||e==="float32")a=new Float32Array(n);else if(e==="int32")a=new Int32Array(n);else{if(e!=="bool")throw new Error("Unknown data type "+e);a=new Uint8Array(n)}for(var i=0;i<n;i++)a[i]=t();return rt.makeTensor(a,r,e)}}),py=(function(){function r(t,e,n,a,i){this.mean=t,this.stdDev=e,this.dtype=n,this.nextVal=NaN,this.truncated=a,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var o=i||Math.random();this.random=Pd(o.toString())}return r.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var t=this.nextVal;return this.nextVal=NaN,t}for(var e,n,a=!1;!a;){var i=void 0,o=void 0,u=void 0;do u=(i=2*this.random()-1)*i+(o=2*this.random()-1)*o;while(u>=1||u===0);var l=Math.sqrt(-2*Math.log(u)/u);e=this.mean+this.stdDev*i*l,n=this.mean+this.stdDev*o*l,this.truncated&&!this.isValidTruncated(e)||(a=!0)}return this.truncated&&!this.isValidTruncated(n)||(this.nextVal=this.convertValue(n)),this.convertValue(e)},r.prototype.convertValue=function(t){return this.dtype==null||this.dtype==="float32"?t:Math.round(t)},r.prototype.isValidTruncated=function(t){return t<=this.upper&&t>=this.lower},r})(),IG=(function(){function r(t,e,n,a){this.alpha=t,this.beta=1/e,this.dtype=n;var i=a||Math.random();this.randu=Pd(i.toString()),this.randn=new py(0,1,n,!1,this.randu()),this.d=t<1?t+2/3:t-1/3,this.c=1/Math.sqrt(9*this.d)}return r.prototype.nextValue=function(){for(var t,e,n,a,i,o;;){do a=this.randn.nextValue(),o=1+this.c*a;while(o<=0);if(o*=o*o,e=1-.331*(t=a*a)*t,n=.5*t+this.d*(1-o+Math.log(o)),(i=this.randu())<e||Math.log(i)<n)break}return o=1/this.beta*this.d*o,this.alpha<1&&(o*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(o)},r.prototype.convertValue=function(t){return this.dtype==="float32"?t:Math.round(t)},r})(),NG=(function(){function r(t,e,n,a){var i=this;if(t===void 0&&(t=0),e===void 0&&(e=1),this.canReturnFloat=function(){return i.dtype==null||i.dtype==="float32"},this.min=t,this.range=e-t,this.dtype=n,a==null&&(a=Math.random()),typeof a=="number"&&(a=a.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+t+" - "+e+" <= 1 and dtype is not float");this.random=Pd(a)}return r.prototype.convertValue=function(t){return this.canReturnFloat()?t:Math.round(t)},r.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},r})(),OG=tt({randomGamma_:function(r,t,e,n,a){if(e===void 0&&(e=1),n===void 0&&(n="float32"),e==null&&(e=1),n==null&&(n="float32"),n!=="float32"&&n!=="int32")throw new Error("Unsupported data type "+n);for(var i=new IG(t,e,n,a),o=ee(r,n),u=0;u<o.values.length;u++)o.values[u]=i.nextValue();return o.toTensor()}}),MG=tt({randomNormal_:function(r,t,e,n,a){if(t===void 0&&(t=0),e===void 0&&(e=1),n!=null&&n==="bool")throw new Error("Unsupported data type "+n);for(var i=new py(t,e,n,!1,a),o=ee(r,n),u=0;u<o.values.length;u++)o.values[u]=i.nextValue();return o.toTensor()}}),_R=tt({randomUniform_:function(r,t,e,n,a){t===void 0&&(t=0),e===void 0&&(e=1),n===void 0&&(n="float32");for(var i=ee(r,n),o=new NG(t,e,null,a),u=0;u<i.values.length;u++)i.values[u]=o.nextValue();return i.toTensor()}}),AR=tt({square_:function(r){var t=z(r,"x","square"),e=[t];return rt.runKernelFunc((function(n,a){return a([t]),n.square(t)}),{x:t},null,"Square",{},e,[])}}),TR=tt({squaredDifference_:function(r,t){var e,n=z(r,"a","squaredDifference"),a=z(t,"b","squaredDifference");e=Qe(n,a),n=e[0],a=e[1],he(n.shape,a.shape);var i={a:n,b:a},o=[n,a];return rt.runKernelFunc((function(u,l){var h=u.squaredDifference(n,a);return l([n,a]),h}),i,(function(u,l){var h=l[0],f=l[1],p=Ut(2);return{a:function(){return u.mul(h.sub(f).mul(p))},b:function(){return u.mul(f.sub(h).mul(p))}}}),Od,{},o,[])}}),BG=tt({truncatedNormal_:function(r,t,e,n,a){if(t===void 0&&(t=0),e===void 0&&(e=1),n!=null&&n==="bool")throw new Error("Unsupported data type $ { dtype }");for(var i=new py(t,e,n,!0,a),o=ee(r,n),u=0;u<o.values.length;u++)o.values[u]=i.nextValue();return o.toTensor()}}),kR=tt({equal_:function(r,t){var e,n=z(r,"a","equal"),a=z(t,"b","equal");return e=Qe(n,a),n=e[0],a=e[1],he(n.shape,a.shape),rt.runKernelFunc((function(i){return i.equal(n,a)}),{$a:n,$b:a})}}),PG=tt({equalStrict_:function(r,t){var e=z(r,"a","equalStrict"),n=z(t,"b","equalStrict");return Re(e.shape,n.shape,"Error in equalStrict: "),e.equal(n)}}),FG=tt({greater_:function(r,t){var e,n=z(r,"a","greater"),a=z(t,"b","greater");return e=Qe(n,a),n=e[0],a=e[1],he(n.shape,a.shape),rt.runKernelFunc((function(i){return i.greater(n,a)}),{a:n,b:a},null,"Greater")}}),DR=tt({greaterEqual_:function(r,t){var e,n=z(r,"a","greaterEqual"),a=z(t,"b","greaterEqual");return e=Qe(n,a),n=e[0],a=e[1],he(n.shape,a.shape),rt.runKernelFunc((function(i,o){var u=i.greaterEqual(n,a);return o([n,a]),u}),{a:n,b:a},(function(i,o){var u=o[0],l=o[1];return{a:function(){return me(u)},b:function(){return me(l)}}}),"GreaterEqual")}}),LG=tt({greaterEqualStrict_:function(r,t){var e=z(r,"a","greaterEqualStrict"),n=z(t,"b","greaterEqualStrict");return Re(e.shape,n.shape,"Error in greaterEqualStrict: "),e.greaterEqual(n)}}),zG=tt({greaterStrict_:function(r,t){var e=z(r,"a","greaterStrict"),n=z(t,"b","greaterStrict");return Re(e.shape,n.shape,"Error in greaterStrict: "),e.greater(n)}}),UG=tt({less_:function(r,t){var e,n=z(r,"a","less"),a=z(t,"b","less");return e=Qe(n,a),n=e[0],a=e[1],he(n.shape,a.shape),rt.runKernelFunc((function(i){return i.less(n,a)}),{a:n,b:a},null,"Less")}}),WG=tt({lessEqual_:function(r,t){var e,n=z(r,"a","lessEqual"),a=z(t,"b","lessEqual");return e=Qe(n,a),n=e[0],a=e[1],he(n.shape,a.shape),rt.runKernelFunc((function(i,o){var u=i.lessEqual(n,a);return o([n,a]),u}),{a:n,b:a},null,"LessEqual")}}),VG=tt({lessEqualStrict_:function(r,t){var e=z(r,"a","lessEqualStrict"),n=z(t,"b","lessEqualStrict");return Re(e.shape,n.shape,"Error in lessEqualStrict: "),e.lessEqual(n)}}),GG=tt({lessStrict_:function(r,t){var e=z(r,"a","lessStrict"),n=z(t,"b","lessStrict");return Re(e.shape,n.shape,"Error in lessStrict: "),e.less(n)}}),HG=tt({notEqual_:function(r,t){var e,n=z(r,"a","notEqual"),a=z(t,"b","notEqual");return e=Qe(n,a),n=e[0],a=e[1],he(n.shape,a.shape),rt.runKernelFunc((function(i){return i.notEqual(n,a)}),{a:n,b:a},null,"NotEqual")}}),qG=tt({notEqualStrict_:function(r,t){var e=z(r,"a","notEqualStrict"),n=z(t,"b","notEqualStrict");return Re(e.shape,n.shape,"Error in notEqualStrict: "),e.notEqual(n)}});function $w(r,t){for(var e=[],n=r;n<t;++n)e.push(n);return e}function Jw(r){for(var t=[],e=0;e<r.length;++e)for(var n=0;n<r[e].length;++n)t.push(r[e][n]);return t}var vy=tt({gather_:function(r,t,e){e===void 0&&(e=0);var n=z(r,"x","gather"),a=z(t,"indices","gather","int32");e=In(e,n.shape)[0];var i=(function(o,u,l){for(var h=o.shape[l],f=[],p=1,v=1,m=0;m<l;m++)f.push(o.shape[m]),p*=o.shape[m];for(m=0;m<u.rank;m++)f.push(u.shape[m]);for(m=l+1;m<o.rank;m++)f.push(o.shape[m]),v*=o.shape[m];return{batchSize:p,sliceSize:v,dimSize:h,outputShape:f}})(n,a,e);return rt.runKernelFunc((function(o,u){var l=o.gather(n,a.flatten(),e);return u([a]),l}),{x:n,indices:a},(function(o,u){var l=u[0];return{x:function(){var h=n.shape,f=l.size,p=h.slice(0,e),v=p.length,m=h.slice(e,h.length).slice(1),x=m.length,b=$w(0,v),E=$w(v+1,v+1+x),C=Jw([p,[f],m]),R=o.reshape(C),_=l.reshape([f]),A=Jw([[v],b,E]),k=R.transpose(A),D=IR(k,_,n.shape[e]),P=ny(A);return D=D.transpose(P)},indices:function(){return l}}}),"Gather",{axis:e}).reshape(i.outputShape)}}),IR=tt({unsortedSegmentSum_:function(r,t,e){var n=z(r,"x","unsortedSegmentSum"),a=z(t,"segmentIds","unsortedSegmentSum","int32");return G(pn(e),(function(){return"numSegments must be of dtype int"})),rt.runKernelFunc((function(i,o){var u=i.unsortedSegmentSum(n,a,e);return o([a]),u}),{$x:n},(function(i,o){var u=o[0];return{$x:function(){return(function(l,h){for(var f=iy(h,me(h)),p=vy(l,f),v=DR(h,Ut(0,"int32")),m=p.rank-v.rank,x=0;x<m;++x)v=zo(v,x+1);v=Ld(v,wl(p.shape,"bool"));var b=me(p);return Wu(v,p,b)})(i,u)}}}))}}),jG=function(r,t,e){return Mt(this,void 0,void 0,(function(){var n,a,i,o,u,l,h,f,p,v,m,x,b;return Bt(this,(function(E){switch(E.label){case 0:for(n=z(r,"tensor","boolMask"),a=z(t,"mask","boolMask","bool"),i=e??0,o=a.rank,u=n.shape,G(o>0,(function(){return"mask cannot be scalar"})),Re(u.slice(i,i+o),a.shape,"mask's shape must match the first K dimensions of tensor's shape,"),l=1,h=i;h<i+o;h++)l*=u[h];return f=u.slice(0,i).concat([l],u.slice(i+o)),p=n.reshape(f),v=a.reshape([-1]),[4,CR(v)];case 1:return m=E.sent(),x=m.squeeze([1]),b=vy(p,x,i),r!==n&&n.dispose(),t!==a&&a.dispose(),x.dispose(),p.dispose(),v.dispose(),m.dispose(),[2,b]}}))}))};function NR(r,t,e,n,a,i,o){i===void 0&&(i="NHWC"),G(r.length===t.rank,(function(){return"Length of inShape ("+r.length+") and rank of dy ("+t.rank+") must match"}));var u=r,l=t,h=!1;t.rank===3&&(h=!0,l=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]),u=[1,r[0],r[1],r[2]]),G(u.length===4,(function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+u.length+"."})),G(l.rank===4,(function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+l.rank})),G(e.rank===4,(function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+e.rank}));var f=i==="NHWC"?u[3]:u[1],p=i==="NHWC"?l.shape[3]:l.shape[1];G(f===e.shape[2],(function(){return"Error in conv2dDerInput: depth of input ("+f+") must match input depth for filter "+e.shape[2]+"."})),G(p===e.shape[3],(function(){return"Error in conv2dDerInput: depth of output ("+p+") must match output depth for filter "+e.shape[3]+"."})),o!=null&&G(pn(a),(function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+a+"."}));var v=uy(i),m=Qu(u,e.shape,n,1,a,o,!1,v),x=rt.runKernelFunc((function(b,E){var C=b.conv2dDerInput(l,e,m);return E([e,l]),C}),{dy4D:l,filter:e},(function(b,E){var C=E[0],R=E[1];return{dy4D:function(){return $u(b,C,n,a,i,1,o)},filter:function(){return my(b,R,C.shape,n,a,i,o)}}}));return h?x.as3D(x.shape[1],x.shape[2],x.shape[3]):x}function Mm(r){var t=(function(i){return typeof i=="number"?[i,i,i]:i.length===2?[i[0],i[1],1]:i})(r),e=t[0],n=t[1],a=t[2];return e===1&&n===1&&a===1}function OR(r,t,e,n,a){G(r.length===t.rank,(function(){return"Length of inShape ("+r.length+") and rank of dy ("+t.rank+") must match"}));var i=r,o=t,u=!1;t.rank===4&&(u=!0,o=t.as5D(1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]),i=[1,r[0],r[1],r[2],r[3]]);var l=i[4],h=o.shape[4];G(i.length===5,(function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+i.length+"."})),G(o.rank===5,(function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+o.rank})),G(e.rank===5,(function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+e.rank})),G(l===e.shape[3],(function(){return"Error in conv3dDerInput: depth of input ("+l+") must match input depth for filter "+e.shape[3]+"."})),G(h===e.shape[4],(function(){return"Error in conv3dDerInput: depth of output ("+h+") must match output depth for filter "+e.shape[4]+"."}));var f=gd(i,e.shape,n,1,a),p=rt.runKernelFunc((function(v){return v.conv3dDerInput(o,e,f)}),{dy5D:o});return u?p.as4D(p.shape[1],p.shape[2],p.shape[3],p.shape[4]):p}var XG=tt({conv1d_:function(r,t,e,n,a,i,o){a===void 0&&(a="NWC"),i===void 0&&(i=1);var u=z(r,"x","conv1d"),l=z(t,"filter","conv1d"),h=u,f=!1;u.rank===2&&(f=!0,h=u.as3D(1,u.shape[0],u.shape[1])),G(h.rank===3,(function(){return"Error in conv1d: input must be rank 3, but got rank "+h.rank+"."})),G(l.rank===3,(function(){return"Error in conv1d: filter must be rank 3, but got rank "+l.rank+"."})),o!=null&&G(pn(n),(function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+n+"."})),G(h.shape[2]===l.shape[1],(function(){return"Error in conv1d: depth of input ("+h.shape[2]+") must match input depth for filter "+l.shape[1]+"."})),G(vr(e,i),(function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+e+" and dilation '"+i+"'"})),G(a==="NWC",(function(){return"Error in conv1d: got dataFormat of "+a+" but only NWC is currently supported."}));var p=l.as4D(1,l.shape[0],l.shape[1],l.shape[2]),v=h.as4D(h.shape[0],1,h.shape[1],h.shape[2]),m=$u(v,p,[1,e],n,"NHWC",[1,i],o);return f?m.as2D(m.shape[2],m.shape[3]):m.as3D(m.shape[0],m.shape[2],m.shape[3])}}),$u=tt({conv2d_:function(r,t,e,n,a,i,o){a===void 0&&(a="NHWC"),i===void 0&&(i=[1,1]);var u=z(r,"x","conv2d"),l=z(t,"filter","conv2d"),h=u,f=!1;u.rank===3&&(f=!0,h=u.as4D(1,u.shape[0],u.shape[1],u.shape[2])),G(h.rank===4,(function(){return"Error in conv2d: input must be rank 4, but got rank "+h.rank+"."})),G(l.rank===4,(function(){return"Error in conv2d: filter must be rank 4, but got rank "+l.rank+"."})),o!=null&&G(pn(n),(function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+n+"."}));var p=a==="NHWC"?h.shape[3]:h.shape[1];G(p===l.shape[2],(function(){return"Error in conv2d: depth of input ("+p+") must match input depth for filter "+l.shape[2]+"."})),G(vr(e,i),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+i+"'"}));var v=uy(a),m=Qu(h.shape,l.shape,e,i,n,o,!1,v),x=[l,h],b=rt.runKernelFunc((function(E,C){var R=E.conv2d(h,l,m);return C([l,h]),R}),{x:h,filter:l},(function(E,C){var R=C,_=R[0],A=R[1];return G(fl(i),(function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+i+"'"})),{x:function(){return MR(A.shape,E,_,e,n,a)},filter:function(){return my(A,E,_.shape,e,n,a)}}}),"Conv2D",m,x);return f?b.as3D(b.shape[1],b.shape[2],b.shape[3]):b}}),KG=tt({conv3d_:function(r,t,e,n,a,i){a===void 0&&(a="NDHWC"),i===void 0&&(i=[1,1,1]);var o=z(r,"x","conv3d"),u=z(t,"filter","conv3d"),l=o,h=!1;o.rank===4&&(h=!0,l=o.as5D(1,o.shape[0],o.shape[1],o.shape[2],o.shape[3])),G(l.rank===5,(function(){return"Error in conv3d: input must be rank 5, but got rank "+l.rank+"."})),G(u.rank===5,(function(){return"Error in conv3d: filter must be rank 5, but got rank "+u.rank+"."})),G(l.shape[4]===u.shape[3],(function(){return"Error in conv3d: depth of input ("+l.shape[4]+") must match input depth for filter "+u.shape[3]+"."})),G((function(v,m){return Mm(v)||Mm(m)})(e,i),(function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+i+"'"})),G(a==="NDHWC",(function(){return"Error in conv3d: got dataFormat of "+a+" but only NDHWC is currently supported."}));var f=gd(l.shape,u.shape,e,i,n),p=rt.runKernelFunc((function(v,m){var x=v.conv3d(l,u,f);return m([l,u]),x}),{x:l,$filter:u},(function(v,m){G(Mm(i),(function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+i+"'"}));var x=m[0],b=m[1];return{x:function(){return OR(x.shape,v,b,e,n)},$filter:function(){return(function(E,C,R,_,A){var k=E;E.rank===4&&(k=E.as5D(1,E.shape[0],E.shape[1],E.shape[2],E.shape[3]));var D=C;D.rank===4&&(D=C.as5D(1,C.shape[0],C.shape[1],C.shape[2],C.shape[3])),G(k.rank===5,(function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+k.shape+"."})),G(D.rank===5,(function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+D.shape+"."})),G(R.length===5,(function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+R+"."})),G(k.shape[4]===R[3],(function(){return"Error in conv3dDerFilter: depth of input "+k.shape[4]+") must match input depth in filter ("+R[3]+"."})),G(D.shape[4]===R[4],(function(){return"Error in conv3dDerFilter: depth of dy ("+D.shape[4]+") must match output depth for filter ("+R[4]+")."}));var P=gd(k.shape,R,_,1,A);return rt.runKernelFunc((function(M){return M.conv3dDerFilter(k,D,P)}),{x5D:k,dy5D:D})})(x,v,b.shape,e,n)}}}));return h?p.as4D(p.shape[1],p.shape[2],p.shape[3],p.shape[4]):p}}),my=tt({conv2dDerFilter_:function(r,t,e,n,a,i,o){i===void 0&&(i="NHWC");var u=r;r.rank===3&&(u=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var l=t;l.rank===3&&(l=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),G(u.rank===4,(function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+u.shape+"."})),G(l.rank===4,(function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+l.shape+"."})),G(e.length===4,(function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+e+"."}));var h=i==="NHWC"?u.shape[3]:u.shape[1],f=i==="NHWC"?l.shape[3]:l.shape[1];G(h===e[2],(function(){return"Error in conv2dDerFilter: depth of input "+h+") must match input depth in filter ("+e[2]+"."})),G(f===e[3],(function(){return"Error in conv2dDerFilter: depth of dy ("+f+") must match output depth for filter ("+e[3]+")."})),o!=null&&G(pn(a),(function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+a+"."}));var p=uy(i),v=Qu(u.shape,e,n,1,a,o,!1,p);return rt.runKernelFunc((function(m){return m.conv2dDerFilter(u,l,v)}),{x4D:u,dy4D:l})}}),MR=tt({conv2dDerInput_:NR}),gy=tt({depthwiseConv2d_:function(r,t,e,n,a,i,o){i===void 0&&(i=[1,1]);var u=z(r,"x","depthwiseConv2d"),l=z(t,"filter","depthwiseConv2d"),h=u,f=!1;u.rank===3&&(f=!0,h=u.as4D(1,u.shape[0],u.shape[1],u.shape[2])),G(h.rank===4,(function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+h.rank+"."})),G(l.rank===4,(function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+l.rank+"."})),G(h.shape[3]===l.shape[2],(function(){return"Error in depthwiseConv2d: number of input channels ("+h.shape[3]+") must match the inChannels dimension in filter "+l.shape[2]+"."})),i==null&&(i=[1,1]),G(vr(e,i),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+i+"'"})),o!=null&&G(pn(n),(function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+n+"."}));var p=Qu(h.shape,l.shape,e,i,n,o,!0),v=[h,l],m=rt.runKernelFunc((function(x,b){var E=x.depthwiseConv2D(h,l,p);return b([h,l]),E}),{x:h,filter:l},(function(x,b){G(fl(i),(function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+i+"'"}));var E=b[0],C=b[1];return{x:function(){return BR(E.shape,x,C,p)},filter:function(){return PR(E,x,C.shape,p)}}}),"DepthwiseConv2dNative",p,v);return f?m.as3D(m.shape[1],m.shape[2],m.shape[3]):m}}),BR=tt({depthwiseConv2dDerInput_:function(r,t,e,n){var a=t,i=!1;t.rank===3&&(i=!0,a=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var o=rt.runKernelFunc((function(u){return u.depthwiseConv2DDerInput(a,e,n)}),{dy4D:a});return i?o.as3D(o.shape[1],o.shape[2],o.shape[3]):o}}),PR=tt({depthwiseConv2dDerFilter_:function(r,t,e,n){var a=r;r.rank===3&&(a=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var i=t;return i.rank===3&&(i=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),rt.runKernelFunc((function(o){return o.depthwiseConv2DDerFilter(a,i,n)}),{x4D:a,dy4D:i})}}),FR=tt({separableConv2d_:function(r,t,e,n,a,i,o){i===void 0&&(i=[1,1]),o===void 0&&(o="NHWC");var u=z(r,"x","separableConv2d"),l=z(t,"depthwiseFilter","separableConv2d"),h=z(e,"pointwiseFilter","separableConv2d"),f=u,p=!1;if(u.rank===3&&(p=!0,f=u.as4D(1,u.shape[0],u.shape[1],u.shape[2])),o==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");G(f.rank===4,(function(){return"Error in separableConv2d: input must be rank 4, but got rank "+f.rank+"."})),G(l.rank===4,(function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+l.rank+"."})),G(h.rank===4,(function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+l.rank+"."})),G(h.shape[0]===1,(function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+h.shape[0]+"."})),G(h.shape[1]===1,(function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+h.shape[1]+"."}));var v=l.shape[2],m=l.shape[3];G(h.shape[2]===v*m,(function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+v*m+", but got "+h.shape[2]+"."}));var x=gy(f,l,n,a,o,i),b=$u(x,h,1,"valid",o);return p?b.as3D(b.shape[1],b.shape[2],b.shape[3]):b}}),YG=tt({conv2dTranspose_:function(r,t,e,n,a,i){return NR(e,z(r,"x","conv2dTranspose"),z(t,"filter","conv2dTranspose"),n,a,"NHWC",i)}}),QG=tt({conv3dTranspose_:function(r,t,e,n,a){return OR(e,z(r,"x","conv3dTranspose"),z(t,"filter","conv3dTranspose"),n,a)}}),LR=tt({matMul_:function(r,t,e,n){var a;e===void 0&&(e=!1),n===void 0&&(n=!1);var i=z(r,"a","matMul"),o=z(t,"b","matMul");a=Qe(i,o),i=a[0],o=a[1];var u=e?i.shape[i.rank-2]:i.shape[i.rank-1],l=n?o.shape[o.rank-1]:o.shape[o.rank-2],h=e?i.shape[i.rank-1]:i.shape[i.rank-2],f=n?o.shape[o.rank-2]:o.shape[o.rank-1],p=i.shape.slice(0,-2),v=o.shape.slice(0,-2),m=Ot(p),x=Ot(v);G(i.rank>=2&&o.rank>=2&&i.rank===o.rank,(function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+i.rank+" and "+o.rank+"."})),G(Wn(p,v),(function(){return"Error in matMul: outer dimensions ("+p+") and ("+v+") of Tensors with shapes "+i.shape+" and "+o.shape+" must match."})),G(u===l,(function(){return"Error in matMul: inner shapes ("+u+") and ("+l+") of Tensors with shapes "+i.shape+" and "+o.shape+" and transposeA="+e+" and transposeB="+n+" must match."}));var b=i.shape.slice(0,-2).concat([h,f]),E=e?i.as3D(m,u,h):i.as3D(m,h,u),C=n?o.as3D(x,f,l):o.as3D(x,l,f),R={transposeA:e,transposeB:n};return rt.runKernelFunc((function(_,A){var k=_.batchMatMul(E,C,e,n);return A([E,C]),k}),{a:E,b:C},(function(_,A){var k=A,D=k[0],P=k[1];return e||n?!e&&n?{a:function(){return _.matMul(P,!1,!1)},b:function(){return _.matMul(D,!0,!1)}}:e&&!n?{a:function(){return P.matMul(_,!1,!0)},b:function(){return D.matMul(_,!1,!1)}}:{a:function(){return P.matMul(_,!0,!0)},b:function(){return _.matMul(D,!0,!0)}}:{a:function(){return _.matMul(P,!1,!0)},b:function(){return D.matMul(_,!0,!1)}}}),"BatchMatMul",R).reshape(b)}}),ZG=tt({dot_:function(r,t){var e=z(r,"t1","dot"),n=z(t,"t2","dot");G(!(e.rank!==1&&e.rank!==2||n.rank!==1&&n.rank!==2),(function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+e.rank+" and "+n.rank+"."}));var a=e.rank===1?e.size:e.shape[1],i=n.rank===1?n.size:n.shape[0];return G(a===i,(function(){return"Error in dot: inner dimensions of inputs must match, but got "+a+" and "+i+"."})),e.rank===1&&n.rank===1?e.as2D(1,-1).matMul(n.as2D(-1,1)).asScalar():e.rank===1&&n.rank===2?e.as2D(1,-1).matMul(n.as2D(n.shape[0],n.shape[1])).as1D():e.rank===2&&n.rank===1?e.matMul(n.as2D(-1,1)).as1D():e.matMul(n.as2D(n.shape[0],n.shape[1]))}}),$G=tt({outerProduct_:function(r,t){var e=z(r,"v1","outerProduct"),n=z(t,"v2","outerProduct");return G(e.rank===1&&n.rank===1,(function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+e.rank+" and "+n.rank+"."})),e.as2D(-1,1).matMul(n.as2D(1,-1))}}),ih=tt({reverse_:function(r,t){var e=z(r,"x","reverse");if(e.rank===0)return e.clone();var n=In(t,e.shape);return rt.runKernelFunc((function(a){return a.reverse(e,n)}),{$x:e},(function(a){return{$x:function(){return a.reverse(n)}}})).reshapeAs(e)}}),JG=tt({reverse1d_:function(r){var t=z(r,"x","reverse");return G(t.rank===1,(function(){return"Error in reverse1D: x must be rank 1 but got rank "+t.rank+"."})),ih(t,0)}}),t5=tt({reverse2d_:function(r,t){var e=z(r,"x","reverse");return G(e.rank===2,(function(){return"Error in reverse2D: x must be rank 2 but got rank "+e.rank+"."})),ih(e,t)}}),e5=tt({reverse3d_:function(r,t){var e=z(r,"x","reverse");return G(e.rank===3,(function(){return"Error in reverse3D: x must be rank 3 but got rank "+e.rank+"."})),ih(e,t)}}),n5=tt({reverse4d_:function(r,t){var e=z(r,"x","reverse");return G(e.rank===4,(function(){return"Error in reverse4D: x must be rank 4 but got rank "+e.rank+"."})),ih(e,t)}});function zR(r,t,e,n,a,i){var o=z(r,"x","maxPool"),u=o,l=!1;o.rank===3&&(l=!0,u=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),G(u.rank===4,(function(){return"Error in maxPool: input must be rank 4 but got rank "+u.rank+"."})),G(vr(e,n),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+n+"'"})),i!=null&&G(pn(a),(function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+a+"."}));var h=Uu(u.shape,t,e,n,a,i);if(h.filterWidth===1&&h.filterHeight===1&&Wn(h.inShape,h.outShape))return o.clone();var f=[u],p=rt.runKernelFunc((function(v,m){var x=v.maxPool(u,h);return m([u,x]),x}),{x:u},(function(v,m){var x=m[0],b=m[1];return{x:function(){return(function(E,C,R,_,A,k,D,P){var M=z(E,"dy","maxPoolBackprop"),O=z(C,"input","maxPoolBackprop"),F=z(R,"output","maxPoolBackprop");G(O.rank===M.rank,(function(){return"Rank of input ("+O.rank+") does not match rank of dy ("+M.rank+")"})),G(vr(A,k),(function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+A+" and dilations '"+k+"'"})),G(M.rank===4,(function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+M.rank+"."})),G(O.rank===4,(function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+O.rank+"."}));var W=Uu(O.shape,_,A,k,D,P);return rt.runKernelFunc((function(j){return j.maxPoolBackprop(M,O,F,W)}),{$dy:M,$input:O})})(v,x,b,t,e,n,a)}}}),"MaxPool",h,f);return l?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}function UR(r,t,e,n,a,i){var o=z(r,"x","avgPool","float32");G(vr(e,n),(function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+n+"'"}));var u=o,l=!1;o.rank===3&&(l=!0,u=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),G(u.rank===4,(function(){return"Error in avgPool: x must be rank 4 but got rank "+u.rank+"."})),i!=null&&G(pn(a),(function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+a+"."}));var h=Uu(u.shape,t,e,n,a,i);if(h.filterWidth===1&&h.filterHeight===1&&Wn(h.inShape,h.outShape))return o.clone();var f=rt.runKernelFunc((function(p){return p.avgPool(u,h)}),{x:u},(function(p){return{x:function(){return(function(v,m,x,b,E,C){var R=z(v,"dy","avgPoolBackprop"),_=z(m,"input","avgPoolBackprop");G(_.rank===R.rank,(function(){return"Rank of input ("+_.rank+") does not match rank of dy ("+R.rank+")"})),G(vr(b,E),(function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+b+" and dilations '"+E+"'"}));var A=_,k=R,D=!1;_.rank===3&&(D=!0,A=_.as4D(1,_.shape[0],_.shape[1],_.shape[2]),k=R.as4D(1,R.shape[0],R.shape[1],R.shape[2])),G(k.rank===4,(function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+k.rank+"."})),G(A.rank===4,(function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+A.rank+"."}));var P=Uu(A.shape,x,b,E,C),M=rt.runKernelFunc((function(O){return O.avgPoolBackprop(k,A,P)}),{dy4D:k,input4D:A});return D?M.as3D(M.shape[1],M.shape[2],M.shape[3]):M})(p,u,t,e,n,a)}}}),"AvgPool",h);return f=f.cast(o.dtype),l?f.as3D(f.shape[1],f.shape[2],f.shape[3]):f}var Vr=tt({maxPool_:function(r,t,e,n,a){return zR(r,t,e,1,n,a)}}),r5=tt({avgPool_:function(r,t,e,n,a){return UR(r,t,e,1,n,a)}}),a5=tt({pool_:function(r,t,e,n,a,i){a==null&&(a=[1,1]),i==null&&(i=1),n===0&&(n="valid");var o=z(r,"x","maxPool"),u=o,l=!1;o.rank===3&&(l=!0,u=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),G(vr(i,a),(function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+i+" and dilations '"+a+"'"}));var h,f=Uu(u.shape,t,i,a,n),p=[f.dilationHeight,f.dilationWidth];h=n==="same"?(function(A,k){var D=A.map((function(O,F){return O+(O-1)*(k[F]-1)})).map((function(O){return O-1})),P=D.map((function(O){return Math.floor(O/2)})),M=D.map((function(O,F){return O-P[F]}));return D.map((function(O,F){return[P[F],M[F]]}))})([f.filterHeight,f.filterWidth],p):[[0,0],[0,0]];var v=p[0]===1&&p[1]===1,m=(function(A,k,D){var P=D.map((function(nt){return nt[0]})),M=D.map((function(nt){return nt[1]})),O=A.concat(P,M),F=k.map((function(nt,at){return(nt-O[at]%nt)%nt})),W=M.map((function(nt,at){return nt+F[at]})),j=k.map((function(nt,at){return[P[at],W[at]]})),ot=k.map((function(nt,at){return[0,F[at]]}));return[j,ot]})([f.inHeight,f.inWidth],p,h),x=m[0],b=m[1],E=v?n:"valid",C=v?u:OS(u,p,x),R=(e==="avg"?function(){return UR(C,t,i,1,E)}:function(){return zR(C,t,i,1,E)})(),_=v?R:NS(R,p,b);return l?_.as3D(_.shape[1],_.shape[2],_.shape[3]):_}}),i5=tt({maxPool3d_:function(r,t,e,n,a,i,o){i===void 0&&(i="NDHWC");var u=z(r,"x","maxPool3d"),l=u,h=!1;u.rank===4&&(h=!0,l=u.as5D(1,u.shape[0],u.shape[1],u.shape[2],u.shape[3])),o==null&&(o=[1,1,1]),G(l.rank===5,(function(){return"Error in maxPool3d: x must be rank 5 but got rank "+l.rank+"."})),G(i==="NDHWC",(function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+i})),G(vr(e,o),(function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+o+"'"})),a!=null&&G(pn(n),(function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+n+"."}));var f=md(l.shape,t,e,o,n,a,i),p=rt.runKernelFunc((function(v,m){var x=v.maxPool3d(l,f);return m([l,x]),x}),{x:l},(function(v,m){var x=m[0],b=m[1];return{x:function(){return(function(E,C,R,_,A,k,D,P){var M=z(E,"dy","maxPool3dBackprop"),O=z(C,"input","maxPool3dBackprop"),F=z(R,"output","maxPool3dBackprop"),W=M,j=O,ot=F,nt=!1;O.rank===4&&(nt=!0,W=M.as5D(1,M.shape[0],M.shape[1],M.shape[2],M.shape[3]),j=O.as5D(1,O.shape[0],O.shape[1],O.shape[2],O.shape[3]),ot=F.as5D(1,F.shape[0],F.shape[1],F.shape[2],F.shape[3])),G(W.rank===5,(function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+W.rank+"."})),G(j.rank===5,(function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+j.rank+"."})),G(ot.rank===5,(function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+ot.rank+"."})),k==null&&(k=[1,1,1]),G(vr(A,k),(function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+A+" and dilations '"+k+"'"})),P!=null&&G(pn(D),(function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+P+" but got pad "+D+"."}));var at=md(j.shape,_,A,k,D,P),V=rt.runKernelFunc((function(X){return X.maxPool3dBackprop(W,j,ot,at)}),{dy5D:W,input5D:j});return nt?V.as4D(V.shape[1],V.shape[2],V.shape[3],V.shape[4]):V})(v,x,b,t,e,o,n,a)}}}));return h?p.as4D(p.shape[1],p.shape[2],p.shape[3],p.shape[4]):p}}),o5=tt({avgPool3d_:function(r,t,e,n,a,i,o){i===void 0&&(i="NDHWC");var u=z(r,"x","avgPool3d","float32"),l=u,h=!1;u.rank===4&&(h=!0,l=u.as5D(1,u.shape[0],u.shape[1],u.shape[2],u.shape[3])),o==null&&(o=[1,1,1]),G(l.rank===5,(function(){return"Error in avgPool3d: x must be rank 5 but got rank "+l.rank+"."})),G(i==="NDHWC",(function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+i})),G(vr(e,o),(function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+o+"'"})),a!=null&&G(pn(n),(function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+n+"."}));var f=md(l.shape,t,e,o,n,a,i),p=rt.runKernelFunc((function(v){return v.avgPool3d(l,f)}),{x:l},(function(v){return{x:function(){return(function(m,x,b,E,C,R,_){var A=z(m,"dy","avgPool3dBackprop"),k=z(x,"input","avgPool3dBackprop"),D=A,P=k,M=!1;k.rank===4&&(M=!0,D=A.as5D(1,A.shape[0],A.shape[1],A.shape[2],A.shape[3]),P=k.as5D(1,k.shape[0],k.shape[1],k.shape[2],k.shape[3])),G(D.rank===5,(function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+D.rank+"."})),G(P.rank===5,(function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+P.rank+"."})),C==null&&(C=[1,1,1]),G(vr(E,C),(function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+E+" and dilations '"+C+"'"})),_!=null&&G(pn(R),(function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+_+" but got pad "+R+"."}));var O=md(P.shape,b,E,C,R,_),F=rt.runKernelFunc((function(W){return W.avgPool3dBackprop(D,P,O)}),{dy5D:D,input5D:P});return M?F.as4D(F.shape[1],F.shape[2],F.shape[3],F.shape[4]):F})(v,l,t,e,o,n,a)}}}));return p=p.cast(l.dtype),h?p.as4D(p.shape[1],p.shape[2],p.shape[3],p.shape[4]):p}}),u5=tt({maxPoolWithArgmax_:function(r,t,e,n,a){a===void 0&&(a=!1);var i=z(r,"x","maxPoolWithArgmax"),o={filterSize:t,strides:e,pad:n,includeBatchInIndex:a},u=rt.runKernel("MaxPoolWithArgmax",{x:i},o);return{result:u[0],indexes:u[1]}}}),Zo=tt({slice_:function(r,t,e){var n,a,i=z(r,"x","slice");if(i.rank===0)throw new Error("Slicing scalar is not possible");(n=typeof t=="number"?[t].concat(new Array(i.rank-1).fill(0)):t.length<i.rank?t.concat(new Array(i.rank-t.length).fill(0)):t.slice()).forEach((function(l){G(l!==-1,(function(){return"slice() does not support negative begin indexing."}))})),a=(a=e==null?new Array(i.rank).fill(-1):typeof e=="number"?[e].concat(new Array(i.rank-1).fill(-1)):e.length<i.rank?e.concat(new Array(i.rank-e.length).fill(-1)):e).map((function(l,h){return l>=0?l:(G(l===-1,(function(){return"Negative size values should be exactly -1 but got "+l+" for the slice() size at index "+h+"."})),i.shape[h]-n[h])})),rV(i,n,a);var o=i.shape,u={begin:n,size:a};return rt.runKernelFunc((function(l){return l.slice(i,n,a)}),{x:i},(function(l){for(var h=[],f=0;f<l.rank;f++)h.push([n[f],o[f]-n[f]-a[f]]);return{x:function(){return oo(l,h)}}}),"Slice",u)}}),s5=tt({slice1d_:function(r,t,e){var n=z(r,"x","slice1d");return G(n.rank===1,(function(){return"slice1d expects a rank-1 tensor, but got a rank-"+n.rank+" tensor"})),Zo(n,[t],[e])}}),l5=tt({slice2d_:function(r,t,e){var n=z(r,"x","slice2d");return G(n.rank===2,(function(){return"slice2d expects a rank-2 tensor, but got a rank-"+n.rank+" tensor"})),Zo(n,t,e)}}),c5=tt({slice3d_:function(r,t,e){var n=z(r,"x","slice3d");return G(n.rank===3,(function(){return"slice3d expects a rank-3 tensor, but got a rank-"+n.rank+" tensor"})),Zo(n,t,e)}}),h5=tt({slice4d_:function(r,t,e){var n=z(r,"x","slice4d");return G(n.rank===4,(function(){return"slice4d expects a rank-4 tensor, but got a rank-"+n.rank+" tensor"})),Zo(n,t,e)}});function WR(r,t,e,n,a){return t.rank<e.rank&&(t=t.reshape(Ar(t.shape,n))),r.rank<e.rank&&(r=r.reshape(Ar(r.shape,n))),{x:function(){var i=r.mul(e.equal(t).cast(r.dtype));return a==null?i:i.transpose(a)}}}var f5=tt({all_:function(r,t,e){t===void 0&&(t=null),e===void 0&&(e=!1);var n=z(r,"x","all","bool"),a=In(t,n.shape),i=a,o=Si(i,n.rank);o!=null&&(n=n.transpose(o),i=Ri(i.length,n.rank));var u=rt.runKernelFunc((function(h){return h.all(n,i)}),{$x:n});if(e){var l=Ar(u.shape,a);return u.reshape(l)}return u}}),d5=tt({any_:function(r,t,e){t===void 0&&(t=null),e===void 0&&(e=!1);var n=z(r,"x","any","bool"),a=In(t,n.shape),i=a,o=Si(i,n.rank);o!=null&&(n=n.transpose(o),i=Ri(i.length,n.rank));var u=rt.runKernelFunc((function(h){return h.any(n,i)}),{$x:n});if(e){var l=Ar(u.shape,a);return u.reshape(l)}return u}}),p5=tt({argMax_:function(r,t){t===void 0&&(t=0);var e=z(r,"x","argMax");t==null&&(t=0);var n=In(t,e.shape),a=Si(n,e.rank);a!=null&&(e=e.transpose(a),n=Ri(n.length,e.rank));var i={axis:n[0]},o=[e];return rt.runKernelFunc((function(u,l){var h=u.argMax(e,n[0]);return l([e]),h}),{x:e},(function(u,l){var h=l[0];return{x:function(){return me(h)}}}),"ArgMax",i,o)}}),v5=tt({argMin_:function(r,t){t===void 0&&(t=0);var e=z(r,"x","argMin");t==null&&(t=0);var n=In(t,e.shape),a=Si(n,e.rank);return a!=null&&(e=e.transpose(a),n=Ri(n.length,e.rank)),rt.runKernelFunc((function(i,o){var u=i.argMin(e,n[0]);return o([e]),u}),{$x:e},(function(i,o){var u=o[0];return{$x:function(){return me(u)}}}))}}),m5=tt({logSumExp_:function(r,t,e){t===void 0&&(t=null),e===void 0&&(e=!1);var n=z(r,"x","logSumExp"),a=In(t,n.shape),i=n.max(a,!0),o=n.sub(i).exp().sum(a).log(),u=i.reshape(o.shape).add(o);if(e){var l=Ar(u.shape,a);return u.reshape(l)}return u}}),g5=tt({max_:function(r,t,e){t===void 0&&(t=null),e===void 0&&(e=!1);var n=z(r,"x","max"),a=n,i=In(t,n.shape),o=i,u=Si(o,n.rank);u!=null&&(n=n.transpose(u),o=Ri(o.length,n.rank));var l=[n],h=rt.runKernelFunc((function(p,v){var m=p.max(n,o);return v([a,m]),m}),{x:n},(function(p,v){return WR(p,v[1],v[0],i,u)}),"Max",{axes:o},l,[!0]);if(e){var f=Ar(h.shape,i);h=h.reshape(f)}return h}}),y5=tt({mean_:function(r,t,e){t===void 0&&(t=null),e===void 0&&(e=!1);var n=z(r,"x","mean"),a=In(t,n.shape),i=Ot(nr(n.shape,a)[1]);return Md((function(o){var u=Ut(i);return{value:(u.dtype===o.dtype?o:o.cast(u.dtype)).div(u).sum(t,e),gradFunc:function(l){var h=o.shape.slice();return a.forEach((function(f){h[f]=1})),l.reshape(h).mul(wl(o.shape,"float32")).div(i)}}}))(n)}}),x5=tt({min_:function(r,t,e){t===void 0&&(t=null),e===void 0&&(e=!1);var n=z(r,"x","min"),a=n,i=In(t,n.shape),o=i,u=Si(o,n.rank);u!=null&&(n=n.transpose(u),o=Ri(o.length,n.rank));var l=[n],h=rt.runKernelFunc((function(p,v){var m=p.min(n,o);return v([a,m]),m}),{x:n},(function(p,v){return WR(p,v[1],v[0],i,u)}),"Min",{axes:o},l,[!0]);if(e){var f=Ar(h.shape,i);h=h.reshape(f)}return h}}),b5=tt({moments_:function(r,t,e){t===void 0&&(t=null),e===void 0&&(e=!1);var n=In(t,(r=z(r,"x","moments")).shape),a=r.mean(n,e),i=a.shape;e||(i=Ar(a.shape,n));var o=r.toFloat().sub(a.reshape(i)).square();return{mean:a,variance:o.mean(n,e)}}}),Uo=tt({sum_:function(r,t,e){t===void 0&&(t=null),e===void 0&&(e=!1);var n=z(r,"x","sum");n.dtype==="bool"&&(n=n.toInt());var a=In(t,n.shape);return Md((function(i){var o=Si(a,i.rank),u=a,l=i;o!=null&&(l=i.transpose(o),u=Ri(u.length,i.rank));var h=function(m){var x=i.shape.slice();return a.forEach((function(b){x[b]=1})),m.reshape(x).mul(wl(i.shape,"float32"))},f={axes:u},p=rt.runKernelFunc((function(m){return m.sum(l,u)}),{x:l},(function(m){return{x:function(){return h(m)}}}),"Sum",f);if(e){var v=Ar(p.shape,a);p=p.reshape(v)}return{value:p,gradFunc:h}}))(n)}}),w5=tt({prod_:function(r,t,e){t===void 0&&(t=null),e===void 0&&(e=!1);var n=z(r,"x","prod");n.dtype==="bool"&&(n=n.toInt());var a=In(t,n.shape),i=Si(a,n.rank),o=a,u=n;i!=null&&(u=n.transpose(i),o=Ri(o.length,n.rank));var l=rt.runKernelFunc((function(f){return f.prod(u,o)}),{permutedX:u});if(e){var h=Ar(l.shape,a);l=l.reshape(h)}return l}}),VR=tt({elu_:function(r){var t=z(r,"x","elu");return rt.runKernelFunc((function(e,n){var a=e.elu(t);return n([a]),a}),{$x:t},(function(e,n){var a=n[0];return{$x:function(){return rt.runKernelFunc((function(i){return i.eluDer(e,a)}),{dy:e,y:a})}}}))}}),E5=tt({leakyRelu_:function(r,t){t===void 0&&(t=.2);var e=z(r,"x","leakyRelu");return iy(Ut(t).mul(e),e)}}),GR=tt({prelu_:function(r,t){var e=z(r,"x","prelu"),n=z(t,"alpha","prelu");return rt.runKernelFunc((function(a,i){var o=a.prelu(e,n);return i([e,n]),o}),{x:e,alpha:n},(function(a,i){var o=i[0],u=i[1],l=o.greater(0);return{x:function(){return Wu(l,a,a.mul(u))},alpha:function(){var h=Wu(l,me(a),a.mul(o)),f=Tn(u.shape,a.shape);return f.length>0&&(h=h.sum(f)),h.reshape(u.shape)}}}),"Prelu")}}),zd=tt({relu_:function(r){var t=z(r,"x","relu");return t.dtype==="bool"?t.toInt():rt.runKernelFunc((function(e,n){var a=e.relu(t);return n([t]),a}),{x:t},(function(e,n){var a=n[0];return{x:function(){return e.mulStrict(a.step().toFloat())}}}),"Relu")}}),HR=tt({relu6_:function(r){var t=z(r,"x","relu6");return t.dtype==="bool"?t.toInt():rt.runKernelFunc((function(e,n){var a=e.relu6(t);return n([t]),a}),{x:t},(function(e,n){var a=n[0],i=a.lessEqual(6).mul(a.step());return{x:function(){return e.mulStrict(i.toFloat())}}}),"Relu6")}}),C5=tt({selu_:function(r){var t=z(r,"x","selu");return rt.runKernelFunc((function(e,n){var a=e.selu(t);return n([t]),a}),{$x:t},(function(e,n){var a=n[0];return{$x:function(){var i=a.greater(Ut(0)),o=Ut(fy),u=Ut(dy),l=e.mul(u),h=e.mul(o).mul(a.toFloat().exp());return Wu(i,l,h)}}}))}}),S5=tt({localResponseNormalization_:function(r,t,e,n,a){t===void 0&&(t=5),e===void 0&&(e=1),n===void 0&&(n=1),a===void 0&&(a=.5);var i=z(r,"x","localResponseNormalization");G(i.rank===4||i.rank===3,(function(){return`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `+i.rank+"."})),G(pn(t),(function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+t+"."}));var o=i,u=!1;i.rank===3&&(u=!0,o=i.as4D(1,i.shape[0],i.shape[1],i.shape[2]));var l=rt.runKernelFunc((function(h,f){var p=h.localResponseNormalization4D(o,t,e,n,a);return f([o,p]),p}),{x4D:o},(function(h,f){var p=f[0],v=f[1];return{x4D:function(){return rt.runKernelFunc((function(m){return m.LRNGrad(h,p,v,t,e,n,a)}),{})}}}));return u?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l}}),qR=tt({norm_:function(r,t,e,n){t===void 0&&(t="euclidean"),e===void 0&&(e=null),n===void 0&&(n=!1);var a=(function u(l,h,f){if(f===void 0&&(f=null),l.rank===0)return l.abs();if(l.rank!==1&&f===null)return u(l.reshape([-1]),h,f);if(l.rank===1||typeof f=="number"||Array.isArray(f)&&f.length===1){if(h===1)return l.abs().sum(f);if(h===1/0)return l.abs().max(f);if(h===-1/0)return l.abs().min(f);if(h==="euclidean"||h===2)return l.abs().pow(Ut(2,"int32")).sum(f).sqrt();throw new Error("Error in norm: invalid ord value: "+h)}if(Array.isArray(f)&&f.length===2){if(h===1)return l.abs().sum(f[0]).max(f[1]-1);if(h===1/0)return l.abs().sum(f[1]).max(f[0]);if(h===-1/0)return l.abs().sum(f[1]).min(f[0]);if(h==="fro"||h==="euclidean")return l.square().sum(f).sqrt();throw new Error("Error in norm: invalid ord value: "+h)}throw new Error("Error in norm: invalid axis: "+f)})(r=z(r,"x","norm"),t,e),i=a.shape;if(n){var o=In(e,r.shape);i=Ar(a.shape,o)}return a.reshape(i)}}),R5=tt({basicLSTMCell_:function(r,t,e,n,a,i){var o=z(r,"forgetBias","basicLSTMCell"),u=z(t,"lstmKernel","basicLSTMCell"),l=z(e,"lstmBias","basicLSTMCell"),h=z(n,"data","basicLSTMCell"),f=z(a,"c","basicLSTMCell"),p=z(i,"h","basicLSTMCell"),v=h.concat(p,1).matMul(u).add(l),m=v.shape[0],x=v.shape[1]/4,b=[m,x],E=v.slice([0,0],b),C=v.slice([0,x],b),R=v.slice([0,2*x],b),_=v.slice([0,3*x],b),A=E.sigmoid().mulStrict(C.tanh()).addStrict(f.mulStrict(o.add(R).sigmoid())),k=A.tanh().mulStrict(_.sigmoid());return[A,k]}}),_5=tt({multiRNNCell_:function(r,t,e,n){for(var a=z(t,"data","multiRNNCell"),i=ld(e,"c","multiRNNCell"),o=ld(n,"h","multiRNNCell"),u=a,l=[],h=0;h<r.length;h++){var f=r[h](u,i[h],o[h]);l.push(f[0]),l.push(f[1]),u=f[1]}var p=[],v=[];for(h=0;h<l.length;h+=2)p.push(l[h]),v.push(l[h+1]);return[p,v]}}),A5=tt({movingAverage_:function(r,t,e,n,a){a===void 0&&(a=!0);var i=z(r,"v","movingAverage"),o=z(t,"x","movingAverage"),u=z(e,"decay","movingAverage");b3(i,o),G(Wn(i.shape,o.shape),(function(){return"Shape mismatch in v and x"}));var l=Ut(1),h=l.sub(u),f=o.sub(i).mul(h);if(a){G(n!=null,(function(){return"When using zeroDebias: true, step is required."}));var p=z(n,"step","movingAverage");f=f.div(l.sub(pd(u,p)))}return i.add(f)}}),T5=tt({stridedSlice_:function(r,t,e,n,a,i,o,u,l){if(a===void 0&&(a=0),i===void 0&&(i=0),o===void 0&&(o=0),u===void 0&&(u=0),l===void 0&&(l=0),n==null&&(n=new Array(t.length)),o!==0)throw new Error("ellipsis mask is not yet supported");var h=z(r,"x","stridedSlice"),f=Nw(u),p=h.shape.slice();f.forEach((function(E){t[E]=0,e[E]=1,p.splice(E,0,1)})),h=h.reshape(p);for(var v=0;v<h.rank;v++)t[v]=aV(a,t,n,h.shape,v),e[v]=iV(i,e,n,h.shape,v),n[v]=n[v]||1;var m=Nw(l);m.forEach((function(E){e[E]=t[E]+1,n[E]=1}));var x=oy(t,e,n),b=x.filter((function(E,C){return m.indexOf(C)===-1}));return n.every((function(E){return E===1}))?Zo(h,t,x).reshape(b):rt.runKernelFunc((function(E){return E.stridedSlice(h,t,e,n)}),{$x:h}).reshape(b)}}),k5=tt({topk_:function(r,t,e){t===void 0&&(t=1),e===void 0&&(e=!0);var n=z(r,"x","topk");if(n.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var a=n.shape[n.shape.length-1];if(t>a)throw new Error("'k' passed to topk() must be <= the last dimension ("+a+") but got "+t);var i=rt.runKernelFunc((function(o){return o.topk(n,t,e)}),{$x:n});return{values:i[0],indices:i[1]}}}),D5=tt({scatterND_:function(r,t,e){var n=z(r,"indices","scatterND","int32"),a=z(t,"updates","scatterND");return nV(a,n,e),rt.runKernelFunc((function(i){return i.scatterND(n,a,e)}),{indices:n,updates:a},null,"ScatterNd",{shape:e})}}),yy=tt({fft_:function(r){G(r.dtype==="complex64",(function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+r.dtype+"."}));var t=r.shape[r.shape.length-1],e=r.size/t,n=r.as2D(e,t);return rt.runKernelFunc((function(a){return a.fft(n)}),{input:r}).reshape(r.shape)}}),bd=tt({ifft_:function(r){G(r.dtype==="complex64",(function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+r.dtype+"."}));var t=r.shape[r.shape.length-1],e=r.size/t,n=r.as2D(e,t);return rt.runKernelFunc((function(a){return a.ifft(n)}),{input:r}).reshape(r.shape)}}),xy=tt({rfft_:function(r,t){G(r.dtype==="float32",(function(){return"The dtype for rfft() must be real value but got "+r.dtype}));var e,n=r.shape[r.shape.length-1],a=r.size/n;if(t!=null&&t<n){var i=r.shape.map((function(C){return 0})),o=r.shape.map((function(C){return C}));o[r.shape.length-1]=t,e=r.slice(i,o),n=t}else if(t!=null&&t>n){var u=r.shape.map((function(C){return C}));u[r.shape.length-1]=t-n,e=r.concat(sn(u),r.shape.length-1),n=t}else e=r;var l=e.zerosLike(),h=Kn(e,l).as2D(a,n),f=yy(h),p=Math.floor(n/2)+1,v=va(f),m=ci(f),x=v.split([p,n-p],v.shape.length-1),b=m.split([p,n-p],m.shape.length-1),E=e.shape.slice();return E[e.shape.length-1]=p,Kn(x[0],b[0]).reshape(E)}}),jR=tt({irfft_:function(r){var t=r.shape[r.shape.length-1],e=r.size/t;if(t<=2){var n=r.as2D(e,t),a=bd(n);return va(a)}var i=[e,2*(t-1)],o=va(r).as2D(e,t),u=ci(r).as2D(e,t),l=o.slice([0,1],[e,t-2]).reverse(1),h=u.slice([0,1],[e,t-2]).reverse(1).mul(Ut(-1)),f=o.concat(l,1),p=u.concat(h,1);return n=Kn(f,p).as2D(i[0],i[1]),a=bd(n),va(a)}}),I5=Object.freeze({fft:yy,ifft:bd,rfft:xy,irfft:jR}),N5=tt({sparseToDense_:function(r,t,e,n){n===void 0&&(n=0);var a=z(r,"sparseIndices","sparseToDense","int32"),i=z(t,"sparseValues","sparseToDense"),o=z(n,"defaultValue","sparseToDense",i.dtype);return(function(u,l,h,f){if(u.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+u.dtype+".");if(u.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+u.shape+".");var p=u.rank>0?u.shape[0]:1,v=u.rank>1?u.shape[1]:1;if(h.length!==v)throw new Error("outputShape has incorrect number of elements:, "+h.length+", should be: "+v+".");var m=l.size;if(l.rank!==0&&(l.rank!==1||m!==p))throw new Error("sparseValues has incorrect shape "+l.shape+", should be [] or ["+p+"]");if(l.dtype!==f.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")})(a,i,e,o),rt.runKernelFunc((function(u){return u.sparseToDense(a,i,e,o)}),{$sparseIndices:a,$sparseValues:i,$defaultValue:o})}}),O5=tt({gatherND_:function(r,t){var e=z(t,"indices","gatherND","int32"),n=z(r,"x","gatherND");return rt.runKernelFunc((function(a){return a.gatherND(n,e)}),{x:n,indices:e},null,"GatherNd")}}),M5=tt({diag_:function(r){var t=z(r,"x","diag").flatten(),e=r.shape.concat(r.shape);return rt.runKernelFunc((function(n){return n.diag(t)}),{$x:t}).reshape(e)}}),B5=tt({dropout_:function(r,t,e,n){var a=z(r,"x","dropout");if(G(a.dtype==="float32",(function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+a.dtype+" tensor instead."})),G(t>=0&&t<1,(function(){return"rate must be a float in the range [0, 1), but got "+t+"."})),t===0)return r instanceof ze?a.clone():a;var i=(function(l,h){if(h==null)return l.shape.slice();if(Wn(l.shape,h))return h;if(l.shape.length===h.length){for(var f=[],p=0;p<l.shape.length;p++)h[p]==null&&l.shape[p]!=null?f.push(l.shape[p]):f.push(h[p]);return f}return h})(a,e),o=1-t,u=_R(i,0,1,"float32",n).add(o).floor().div(o);return a.mul(u)}});function XR(r,t,e){for(var n=1-r%2,a=new Float32Array(r),i=0;i<r;++i){var o=2*Math.PI*i/(r+n-1);a[i]=t-e*Math.cos(o)}return za(a,"float32")}var by=tt({hannWindow_:function(r){return XR(r,.5,.5)}}),KR=tt({hammingWindow_:function(r){return XR(r,.54,.46)}}),wy=tt({frame_:function(r,t,e,n,a){n===void 0&&(n=!1),a===void 0&&(a=0);for(var i=0,o=[];i+t<=r.size;)o.push(Zo(r,i,t)),i+=e;if(n)for(;i<r.size;){var u=i+t-r.size,l=wa([Zo(r,i,t-u),Bu([u],a)]);o.push(l),i+=e}return o.length===0?Mu([],[0,t]):wa(o).as2D(o.length,t)}}),YR=tt({stft_:function(r,t,e,n,a){var i;a===void 0&&(a=by),n==null&&(i=t,n=Math.floor(Math.pow(2,Math.ceil(Math.log(i)/Math.log(2)))));for(var o=wy(r,t,e),u=un(o,a(t)),l=[],h=0;h<o.shape[0];h++)l.push(xy(u.slice([h,0],[1,t]),n));return wa(l)}}),P5=Object.freeze({hannWindow:by,hammingWindow:KR,frame:wy,stft:YR}),ir,F5=function(r,t,e){return e===void 0&&(e=1),Mt(this,void 0,void 0,(function(){var n,a,i,o,u,l,h,f,p,v,m,x,b,E;return Bt(this,(function(C){switch(C.label){case 0:return n=z(r,"predictions","inTopK"),a=z(t,"targets","inTopK"),G(n.rank>1,(function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+n.rank})),G(n.rank-1===a.rank,(function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+n.rank+" and targets rank "+a.rank})),Re(n.shape.slice(0,n.shape.length-1),a.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),i=n.shape[n.shape.length-1],G(e>0&&e<=i,(function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+i+"), but got "+e})),[4,n.data()];case 1:return o=C.sent(),[4,a.data()];case 2:for(u=C.sent(),l=[o.length/i,i],f=l[1],p=ll("bool",h=l[0]),v=0;v<h;v++){for(m=v*f,x=o.subarray(m,m+f),b=[],E=0;E<x.length;E++)b.push({value:x[E],index:E});for(b.sort((function(R,_){return _.value-R.value})),p[v]=0,E=0;E<e;E++)if(b[E].index===u[v]){p[v]=1;break}}return r!==n&&n.dispose(),t!==a&&a.dispose(),[2,Qn(p,a.shape,"bool")]}}))}))};(function(r){r[r.NONE=0]="NONE",r[r.MEAN=1]="MEAN",r[r.SUM=2]="SUM",r[r.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(ir||(ir={}));var L5=tt({absoluteDifference_:function(r,t,e,n){n===void 0&&(n=ir.SUM_BY_NONZERO_WEIGHTS);var a=z(r,"labels","absoluteDifference"),i=z(t,"predictions","absoluteDifference"),o=null;e!=null&&(o=z(e,"weights","absoluteDifference")),Re(a.shape,i.shape,"Error in absoluteDifference: ");var u=a.sub(i).abs();return uo(u,o,n)}}),uo=tt({computeWeightedLoss_:function(r,t,e){e===void 0&&(e=ir.SUM_BY_NONZERO_WEIGHTS);var n=z(r,"losses","computeWeightedLoss"),a=null;t!=null&&(a=z(t,"weights","computeWeightedLoss"));var i=a==null?n:n.mul(a);if(e===ir.NONE)return i;if(e===ir.SUM)return i.sum();if(e===ir.MEAN){if(a==null)return i.mean();var o=n.size/a.size,u=i.sum().div(a.sum());return o>1?u.div(Ut(o)):u}if(e===ir.SUM_BY_NONZERO_WEIGHTS){if(a==null)return i.sum().div(Ut(n.size));var l=a.mul(wl(n.shape)).notEqual(Ut(0)).sum().toFloat();return i.sum().div(l)}throw Error("Unknown reduction: "+e)}}),z5=tt({cosineDistance_:function(r,t,e,n,a){a===void 0&&(a=ir.SUM_BY_NONZERO_WEIGHTS);var i=z(r,"labels","cosineDistance"),o=z(t,"predictions","cosineDistance"),u=null;n!=null&&(u=z(n,"weights","cosineDistance")),Re(i.shape,o.shape,"Error in cosineDistance: ");var l=Ut(1).sub(i.mul(o).sum(e,!0));return uo(l,u,a)}}),U5=tt({hingeLoss_:function(r,t,e,n){n===void 0&&(n=ir.SUM_BY_NONZERO_WEIGHTS);var a=z(r,"labels","hingeLoss"),i=z(t,"predictions","hingeLoss"),o=null;e!=null&&(o=z(e,"weights","hingeLoss")),Re(a.shape,i.shape,"Error in hingeLoss: ");var u=Ut(1);a=Ut(2).mul(a).sub(u);var l=u.sub(a.mul(i)).relu();return uo(l,o,n)}}),W5=tt({huberLoss_:function(r,t,e,n,a){n===void 0&&(n=1),a===void 0&&(a=ir.SUM_BY_NONZERO_WEIGHTS);var i=z(r,"labels","huberLoss"),o=z(t,"predictions","huberLoss"),u=null;e!=null&&(u=z(e,"weights","huberLoss")),Re(i.shape,o.shape,"Error in huberLoss: ");var l=Ut(n),h=o.sub(i).abs(),f=qS(h,l),p=h.sub(f),v=Ut(.5).mul(f.square()).add(l.mul(p));return uo(v,u,a)}}),V5=tt({logLoss_:function(r,t,e,n,a){n===void 0&&(n=1e-7),a===void 0&&(a=ir.SUM_BY_NONZERO_WEIGHTS);var i=z(r,"labels","logLoss"),o=z(t,"predictions","logLoss"),u=null;e!=null&&(u=z(e,"weights","logLoss")),Re(i.shape,o.shape,"Error in logLoss: ");var l=Ut(1),h=Ut(n),f=i.mul(o.add(h).log()).neg().sub(l.sub(i).mul(l.sub(o).add(h).log()));return uo(f,u,a)}}),G5=tt({meanSquaredError_:function(r,t,e,n){n===void 0&&(n=ir.SUM_BY_NONZERO_WEIGHTS);var a=z(r,"labels","meanSquaredError"),i=z(t,"predictions","meanSquaredError"),o=null;e!=null&&(o=z(e,"weights","meanSquaredError")),Re(a.shape,i.shape,"Error in meanSquaredError: ");var u=a.squaredDifference(i);return uo(u,o,n)}}),H5=tt({sigmoidCrossEntropy_:function(r,t,e,n,a){n===void 0&&(n=0),a===void 0&&(a=ir.SUM_BY_NONZERO_WEIGHTS);var i=z(r,"multiClassLabels","sigmoidCrossEntropy"),o=z(t,"logits","sigmoidCrossEntropy"),u=null;if(e!=null&&(u=z(e,"weights","sigmoidCrossEntropy")),Re(i.shape,o.shape,"Error in sigmoidCrossEntropy: "),n>0){var l=Ut(n),h=Ut(1),f=Ut(.5);i=i.mul(h.sub(l)).add(f.mul(l))}var p=(function(v,m){var x=z(v,"labels","sigmoidCrossEntropyWithLogits"),b=z(m,"logits","sigmoidCrossEntropyWithLogits");Re(x.shape,b.shape,"Error in sigmoidCrossEntropyWithLogits: ");var E=b.relu(),C=b.mul(x),R=b.abs().neg().exp().log1p();return E.sub(C).add(R)})(i,o);return uo(p,u,a)}}),q5=tt({softmaxCrossEntropy_:function(r,t,e,n,a){n===void 0&&(n=0),a===void 0&&(a=ir.SUM_BY_NONZERO_WEIGHTS);var i=z(r,"onehotLabels","softmaxCrossEntropy"),o=z(t,"logits","softmaxCrossEntropy"),u=null;if(e!=null&&(u=z(e,"weights","softmaxCrossEntropy")),Re(i.shape,o.shape,"Error in softmaxCrossEntropy: "),n>0){var l=Ut(n),h=Ut(1),f=Ut(i.shape[1]);i=i.mul(h.sub(l)).add(l.div(f))}var p=(function(v,m,x){if(x===void 0&&(x=-1),x===-1&&(x=m.rank-1),x!==m.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+m.rank+" and dim was "+x);return Md((function(b,E,C){var R=E.logSumExp([x],!0),_=E.toFloat().sub(R);return C([b,_]),{value:_.mul(b).neg().sum([x]),gradFunc:function(A,k){var D=k[0],P=k[1],M=Ar(A.shape,[x]);return[A.reshape(M).mul(D.toFloat().sub(P.exp())),A.reshape(M).mul(P.exp().sub(D.toFloat()))]}}}))(v,m)})(i,o);return uo(p,u,a)}}),j5=Object.freeze({get Reduction(){return ir},absoluteDifference:L5,computeWeightedLoss:uo,cosineDistance:z5,hingeLoss:U5,huberLoss:W5,logLoss:V5,meanSquaredError:G5,sigmoidCrossEntropy:H5,softmaxCrossEntropy:q5});function tE(r,t){return t===void 0&&(t=!1),rt.tidy((function(){if(r.shape.length!==2)throw new Error("qr2d() requires a 2D Tensor, but got a "+r.shape.length+"D Tensor.");for(var e=r.shape[0],n=r.shape[1],a=RR(e),i=r.clone(),o=Mu([[1]],[1,1]),u=o.clone(),l=e>=n?n:e,h=function(p){var v,m=i,x=u,b=a;v=rt.tidy((function(){var E=i.slice([p,p],[e-p,1]),C=E.norm(),R=i.slice([p,p],[1,1]),_=Mu([[-1]]).where(R.greater(0),Mu([[1]])),A=R.sub(_.mul(C)),k=E.div(A);u=k.shape[0]===1?o.clone():o.concat(k.slice([1,0],[k.shape[0]-1,k.shape[1]]),0);var D=_.matMul(A).div(C).neg(),P=i.slice([p,0],[e-p,n]),M=D.mul(u),O=u.transpose();if(p===0)i=P.sub(M.matMul(O.matMul(P)));else{var F=P.sub(M.matMul(O.matMul(P)));i=i.slice([0,0],[p,n]).concat(F,0)}var W=M.transpose(),j=a.slice([0,p],[e,a.shape[1]-p]);if(p===0)a=j.sub(j.matMul(u).matMul(W));else{var ot=j.sub(j.matMul(u).matMul(W));a=a.slice([0,0],[e,p]).concat(ot,1)}return[u,i,a]})),u=v[0],i=v[1],a=v[2],_r([m,x,b])},f=0;f<l;++f)h(f);return!t&&e>n&&(a=a.slice([0,0],[e,n]),i=i.slice([0,0],[n,n])),[a,i]}))}var X5=tt({bandPart_:function(r,t,e){if(t%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+t+".");if(e%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+e+".");var n=z(r,"a","bandPart");if(n.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+n.rank+".");var a=n.shape,i=n.shape.slice(-2),o=i[0],u=i[1];if(!(t<=o))throw new Error("bandPart(): numLower ("+t+") must not be greater than the number of rows ("+o+").");if(!(e<=u))throw new Error("bandPart(): numUpper ("+e+") must not be greater than the number of columns ("+u+").");t<0&&(t=o),e<0&&(e=u);var l=cd(0,o,1,"int32").reshape([-1,1]),h=cd(0,u,1,"int32"),f=Fa(l,h),p=Ld(f.lessEqual(Ut(+t,"int32")),f.greaterEqual(Ut(-e,"int32"))),v=sn([o,u],n.dtype);return Yo(Id(n.reshape([-1,o,u])).map((function(m){return Wu(p,m,v)}))).reshape(a)}}),K5=tt({gramSchmidt_:function(r){var t;if(Array.isArray(r)){t=!1,G(r!=null&&r.length>0,(function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"}));for(var e=r[0].shape[0],n=function(l){G(r[l].shape[0]===e,(function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+r[l].shape[0]+" vs. "+e+")"}))},a=1;a<r.length;++a)n(a)}else t=!0,r=ry(r,r.shape[0],0).map((function(l){return MS(l,[0])}));G(r.length<=r[0].shape[0],(function(){return"Gram-Schmidt: Number of vectors ("+r.length+") exceeds number of dimensions ("+r[0].shape[0]+")."}));var i=[],o=r,u=function(l){i.push(rt.tidy((function(){var h=o[l];if(l>0)for(var f=0;f<l;++f){var p=Uo(i[f].mulStrict(h)).mul(i[f]);h=h.sub(p)}return h.div(qR(h,"euclidean"))})))};for(a=0;a<r.length;++a)u(a);return t?Yo(i,0):i}}),Y5=tt({qr_:function(r,t){if(t===void 0&&(t=!1),r.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+r.rank);if(r.rank===2)return tE(r,t);var e=r.shape.slice(0,r.shape.length-2).reduce((function(o,u){return o*u})),n=Id(r.reshape([e,r.shape[r.shape.length-2],r.shape[r.shape.length-1]]),0),a=[],i=[];return n.forEach((function(o){var u=tE(o,t),l=u[0],h=u[1];a.push(l),i.push(h)})),[Yo(a,0).reshape(r.shape),Yo(i,0).reshape(r.shape)]}}),Q5=Object.freeze({bandPart:X5,gramSchmidt:K5,qr:Y5});function Ud(r,t,e,n,a,i){n==null&&(n=.5),a==null&&(a=Number.NEGATIVE_INFINITY),i==null&&(i=0);var o=r.shape[0];return e=Math.min(e,o),G(0<=n&&n<=1,(function(){return"iouThreshold must be in [0, 1], but was '"+n+"'"})),G(r.rank===2,(function(){return"boxes must be a 2D tensor, but was of rank '"+r.rank+"'"})),G(r.shape[1]===4,(function(){return"boxes must have 4 columns, but 2nd dimension was "+r.shape[1]})),G(t.rank===1,(function(){return"scores must be a 1D tensor"})),G(t.shape[0]===o,(function(){return"scores has incompatible shape with boxes. Expected "+o+", but was "+t.shape[0]})),G(0<=i&&i<=1,(function(){return"softNmsSigma must be in [0, 1], but was '"+i+"'"})),{maxOutputSize:e,iouThreshold:n,scoreThreshold:a,softNmsSigma:i}}var Z5=tt({resizeBilinear_:function(r,t,e){e===void 0&&(e=!1);var n=z(r,"images","resizeBilinear");G(n.rank===3||n.rank===4,(function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+n.rank+"."})),G(t.length===2,(function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+t+"."}));var a=n,i=!1;n.rank===3&&(i=!0,a=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var o=t[0],u=t[1],l=rt.runKernelFunc((function(h,f){return f([a]),h.resizeBilinear(a,o,u,e)}),{x:a},(function(h,f){return{x:function(){return rt.runKernelFunc((function(p){return p.resizeBilinearBackprop(h,f[0],e)}),{})}}}),"ResizeBilinear",{alignCorners:e,newHeight:o,newWidth:u});return i?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l}}),$5=tt({resizeNearestNeighbor_:function(r,t,e){e===void 0&&(e=!1);var n=z(r,"images","resizeNearestNeighbor");G(n.rank===3||n.rank===4,(function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+n.rank+"."})),G(t.length===2,(function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+t+"."})),G(n.dtype==="float32"||n.dtype==="int32",(function(){return"`images` must have `int32` or `float32` as dtype"}));var a=n,i=!1;n.rank===3&&(i=!0,a=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var o=t[0],u=t[1],l=rt.runKernelFunc((function(h,f){return f([a]),h.resizeNearestNeighbor(a,o,u,e)}),{batchImages:a},(function(h,f){return{batchImages:function(){return rt.runKernelFunc((function(p){return p.resizeNearestNeighborBackprop(h,f[0],e)}),{})}}}));return i?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l}}),J5=tt({nonMaxSuppression_:function(r,t,e,n,a){n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY);var i=z(r,"boxes","nonMaxSuppression"),o=z(t,"scores","nonMaxSuppression"),u=Ud(i,o,e,n,a);e=u.maxOutputSize,n=u.iouThreshold,a=u.scoreThreshold;var l={maxOutputSize:e,iouThreshold:n,scoreThreshold:a};return rt.runKernelFunc((function(h){return h.nonMaxSuppression(i,o,e,n,a)}),{boxes:i,scores:o},null,"NonMaxSuppressionV3",l)}}),tH=function(r,t,e,n,a){return n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),Mt(this,void 0,void 0,(function(){var i,o,u,l,h,f,p;return Bt(this,(function(v){switch(v.label){case 0:return i=z(r,"boxes","nonMaxSuppressionAsync"),o=z(t,"scores","nonMaxSuppressionAsync"),u=Ud(i,o,e,n,a),e=u.maxOutputSize,n=u.iouThreshold,a=u.scoreThreshold,[4,Promise.all([i.data(),o.data()])];case 1:return l=v.sent(),h=l[0],f=l[1],p=sy(h,f,e,n,a),i!==r&&i.dispose(),o!==t&&o.dispose(),[2,p]}}))}))},eH=tt({nonMaxSuppressionWithScore_:function(r,t,e,n,a,i){n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=0);var o=z(r,"boxes","nonMaxSuppression"),u=z(t,"scores","nonMaxSuppression"),l=Ud(o,u,e,n,a,i),h={maxOutputSize:e=l.maxOutputSize,iouThreshold:n=l.iouThreshold,scoreThreshold:a=l.scoreThreshold,softNmsSigma:i=l.softNmsSigma},f=rt.runKernel("NonMaxSuppressionV5",{boxes:o,scores:u},h);return{selectedIndices:f[0],selectedScores:f[1]}}}),nH=function(r,t,e,n,a,i){return n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=0),Mt(this,void 0,void 0,(function(){var o,u,l,h,f,p,v;return Bt(this,(function(m){switch(m.label){case 0:return o=z(r,"boxes","nonMaxSuppressionAsync"),u=z(t,"scores","nonMaxSuppressionAsync"),l=Ud(o,u,e,n,a,i),e=l.maxOutputSize,n=l.iouThreshold,a=l.scoreThreshold,i=l.softNmsSigma,[4,Promise.all([o.data(),u.data()])];case 1:return h=m.sent(),f=h[0],p=h[1],v=ly(f,p,e,n,a,i),o!==r&&o.dispose(),u!==t&&u.dispose(),[2,v]}}))}))},rH=tt({cropAndResize_:function(r,t,e,n,a,i){var o=z(r,"image","cropAndResize"),u=z(t,"boxes","cropAndResize","float32"),l=z(e,"boxInd","cropAndResize","int32");a=a||"bilinear",i=i||0;var h=u.shape[0];return G(o.rank===4,(function(){return"Error in cropAndResize: image must be rank 4,but got rank "+o.rank+"."})),G(u.rank===2&&u.shape[1]===4,(function(){return"Error in cropAndResize: boxes must be have size ["+h+",4] but had shape "+u.shape+"."})),G(l.rank===1&&l.shape[0]===h,(function(){return"Error in cropAndResize: boxInd must be have size ["+h+"] but had shape "+u.shape+"."})),G(n.length===2,(function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+n.length+"."})),G(n[0]>=1&&n[1]>=1,(function(){return"cropSize must be atleast [1,1], but was "+n})),G(a==="bilinear"||a==="nearest",(function(){return"method must be bilinear or nearest, but was "+a})),rt.runKernelFunc((function(f,p){return f.cropAndResize(o,u,l,n,a,i)}),{images:o,boxes:u,boxInd:l},null,"CropAndResize",{method:a,extrapolationValue:i,cropSize:n})}}),QR=Object.freeze({resizeBilinear:Z5,resizeNearestNeighbor:$5,nonMaxSuppression:J5,nonMaxSuppressionAsync:tH,nonMaxSuppressionWithScore:eH,nonMaxSuppressionWithScoreAsync:nH,cropAndResize:rH}),Ey=function(r,t){return!(r>0)||t==="linear"},Cy=function(r,t,e){if(e==null||e==="linear")return r;if(e==="relu")return r.mul(t.step());throw new Error("Gradient for activation "+e+" has not been implemented yet.")},Sy=function(r,t){var e=t,n=Tn(r.shape,t.shape);return n.length>0&&(e=e.sum(n)),e.reshape(r.shape)},Ry=function(r,t,e){if(t==="linear")return r;if(t==="relu")return zd(r);if(t==="elu")return VR(r);if(t==="relu6")return HR(r);if(t==="prelu")return GR(r,e);throw new Error("Unknown fused activation "+t+".")},aH=tt({fusedMatMul_:function(r){var t,e=r.a,n=r.b,a=r.transposeA,i=a!==void 0&&a,o=r.transposeB,u=o!==void 0&&o,l=r.bias,h=r.activation,f=h===void 0?"linear":h,p=r.preluActivationWeights;if(Ey(rt.state.gradientDepth,f)===!1){var v=LR(e,n,i,u);return l!=null&&(v=Ea(v,l)),Ry(v,f,p)}var m=z(e,"a","fused matMul"),x=z(n,"b","fused matMul");t=Qe(m,x),m=t[0],x=t[1];var b=i?m.shape[m.rank-2]:m.shape[m.rank-1],E=u?x.shape[x.rank-1]:x.shape[x.rank-2],C=i?m.shape[m.rank-1]:m.shape[m.rank-2],R=u?x.shape[x.rank-2]:x.shape[x.rank-1],_=m.shape.slice(0,-2),A=x.shape.slice(0,-2),k=Ot(_),D=Ot(A);G(m.rank>=2&&x.rank>=2&&m.rank===x.rank,(function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+m.rank+" and "+x.rank+"."})),G(Wn(_,A),(function(){return"Error in fused matMul: outer dimensions ("+_+") and ("+A+") of Tensors with shapes "+m.shape+" and "+x.shape+" must match."})),G(b===E,(function(){return"Error in fused matMul: inner shapes ("+b+") and ("+E+") of Tensors with shapes "+m.shape+" and "+x.shape+" and transposeA="+i+" and transposeB="+u+" must match."}));var P,M,O=m.shape.slice(0,-2).concat([C,R]),F=i?m.as3D(k,b,C):m.as3D(k,C,b),W=u?x.as3D(D,R,E):x.as3D(D,E,R);l!=null&&he(O,(P=Qe(P=z(l,"bias","fused matMul"),m)[0]).shape),p!=null&&(M=z(p,"prelu weights","fused matMul"));var j={a:F,b:W};l!=null&&(j.bias=P),p!=null&&(j.preluActivationWeights=M);var ot=[F,W];return rt.runKernelFunc((function(nt,at){var V=nt.fusedBatchMatMul({a:F,b:W,transposeA:i,transposeB:u,bias:P,activation:f,preluActivationWeights:M});return at([F,W,V]),V}),j,(function(nt,at){var V=at[0],X=at[1],Q=at[2],ut=Cy(nt,Q,f),B={};return l!=null&&(B={bias:function(){return Sy(P,ut)}}),Object.assign(i||u?!i&&u?{a:function(){return ut.matMul(X,!1,!1)},b:function(){return ut.matMul(V,!0,!1)}}:i&&!u?{a:function(){return X.matMul(ut,!1,!0)},b:function(){return V.matMul(ut,!1,!1)}}:{a:function(){return X.matMul(ut,!0,!0)},b:function(){return ut.matMul(V,!0,!0)}}:{a:function(){return ut.matMul(X,!1,!0)},b:function(){return V.matMul(ut,!0,!1)}},B)}),"_FusedMatMul",{transposeA:i,transposeB:u,activation:f},ot,[!0]).reshape(O)}}),iH=tt({fusedConv2d_:function(r){var t=r.x,e=r.filter,n=r.strides,a=r.pad,i=r.dataFormat,o=i===void 0?"NHWC":i,u=r.dilations,l=u===void 0?[1,1]:u,h=r.dimRoundingMode,f=r.bias,p=r.activation,v=p===void 0?"linear":p,m=r.preluActivationWeights;if(v=v||"linear",Ey(rt.state.gradientDepth,v)===!1){var x=$u(t,e,n,a,o,l,h);return f!=null&&(x=Ea(x,f)),Ry(x,v,m)}var b=z(t,"x","conv2d"),E=z(e,"filter","conv2d"),C=b,R=!1;b.rank===3&&(R=!0,C=b.as4D(1,b.shape[0],b.shape[1],b.shape[2])),G(C.rank===4,(function(){return"Error in fused conv2d: input must be rank 4, but got rank "+C.rank+"."})),G(E.rank===4,(function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+E.rank+"."})),h!=null&&G(pn(a),(function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+h+" but got pad "+a+"."})),G(C.shape[3]===E.shape[2],(function(){return"Error in conv2d: depth of input ("+C.shape[3]+") must match input depth for filter "+E.shape[2]+"."})),G(vr(n,l),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+l+"'"})),G(o==="NHWC",(function(){return"Error in conv2d: got dataFormat of "+o+" but only NHWC is currently supported."}));var _,A,k=Qu(C.shape,E.shape,n,l,a,h);f!=null&&(_=Qe(_=z(f,"bias","fused conv2d"),b)[0],he(k.outShape,_.shape)),m!=null&&(A=z(m,"prelu weights","fused conv2d"));var D={x:C,filter:E};f!=null&&(D.bias=_),m!=null&&(D.preluActivationWeights=A);var P=[E,C],M=rt.runKernelFunc((function(O,F){var W=O.fusedConv2d({input:C,filter:E,convInfo:k,bias:_,activation:v,preluActivationWeights:A});return F([E,C,W]),W}),D,(function(O,F){var W=F,j=W[0],ot=W[1],nt=W[2],at=Cy(O,nt,v);G(fl(l),(function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+l+"'"}));var V={};return f!=null&&(V={bias:function(){return Sy(_,at)}}),Object.assign({x:function(){return MR(ot.shape,at,j,n,a)},filter:function(){return my(ot,at,j.shape,n,a)}},V)}),"FusedConv2D",{convInfo:k,activation:v},P,[!0]);return R?M.as3D(M.shape[1],M.shape[2],M.shape[3]):M}}),oH=tt({fusedDepthwiseConv2d_:function(r){var t=r.x,e=r.filter,n=r.strides,a=r.pad,i=r.dataFormat,o=i===void 0?"NHWC":i,u=r.dilations,l=u===void 0?[1,1]:u,h=r.dimRoundingMode,f=r.bias,p=r.activation,v=p===void 0?"linear":p,m=r.preluActivationWeights;if(Ey(rt.state.gradientDepth,v)===!1){var x=gy(t,e,n,a,o,l,h);return f!=null&&(x=Ea(x,f)),Ry(x,v,m)}var b=z(t,"x","depthwiseConv2d"),E=z(e,"filter","depthwiseConv2d"),C=b,R=!1;b.rank===3&&(R=!0,C=b.as4D(1,b.shape[0],b.shape[1],b.shape[2])),G(C.rank===4,(function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+C.rank+"."})),G(E.rank===4,(function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+E.rank+"."})),G(C.shape[3]===E.shape[2],(function(){return"Error in fused depthwiseConv2d: number of input channels ("+C.shape[3]+") must match the inChannels dimension in filter "+E.shape[2]+"."})),l==null&&(l=[1,1]),G(vr(n,l),(function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+l+"'"})),h!=null&&G(pn(a),(function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+h+" but got pad "+a+"."}));var _,A,k=Qu(C.shape,E.shape,n,l,a,h,!0);f!=null&&(_=Qe(_=z(f,"bias","fused conv2d"),b)[0],he(k.outShape,_.shape)),m!=null&&(A=z(m,"prelu weights","fused depthwiseConv2d"));var D={x:C,filter:E};f!=null&&(D.bias=_),m!=null&&(D.preluActivationWeights=A);var P=[E,C],M=rt.runKernelFunc((function(O,F){var W=O.fusedDepthwiseConv2D({input:C,filter:E,convInfo:k,bias:_,activation:v,preluActivationWeights:A});return F([E,C,W]),W}),D,(function(O,F){G(fl(l),(function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+l+"'"}));var W=F[0],j=F[1],ot=F[2],nt=Cy(O,ot,v),at={};return f!=null&&(at={bias:function(){return Sy(_,nt)}}),Object.assign({x:function(){return BR(j.shape,nt,W,k)},filter:function(){return PR(j,nt,W.shape,k)}},at)}),"FusedDepthwiseConv2D",{convInfo:k,activation:v},P,[!0]);return R?M.as3D(M.shape[1],M.shape[2],M.shape[3]):M}}),uH=Object.freeze({matMul:aH,conv2d:iH,depthwiseConv2d:oH}),sH=Object.freeze({image:QR,linalg:Q5,losses:j5,spectral:I5,fused:uH,signal:P5,add:Ea,addN:pG,batchNorm:ah,batchNormalization:vG,batchNorm2d:gG,batchNormalization2d:mG,batchNorm3d:xG,batchNormalization3d:yG,batchNorm4d:wG,batchNormalization4d:bG,broadcastTo:wR,clone:EG,div:Qo,divNoNan:SR,eye:RR,multinomial:RG,oneHot:xd,pad:oo,pad1d:_G,pad2d:AG,pad3d:TG,pad4d:kG,rand:DG,randomGamma:OG,randomNormal:MG,randomUniform:_R,square:AR,squaredDifference:TR,tile:Zs,truncatedNormal:BG,conv1d:XG,conv2d:$u,conv3d:KG,depthwiseConv2d:gy,separableConv2d:FR,conv2dTranspose:YG,conv3dTranspose:QG,op:tt,booleanMaskAsync:jG,complex:Kn,real:va,imag:ci,concat:wa,concat1d:rW,concat2d:aW,concat3d:iW,concat4d:oW,split:ry,matMul:LR,dot:ZG,outerProduct:$G,reverse:ih,reverse1d:JG,reverse2d:t5,reverse3d:e5,reverse4d:n5,maxPool:Vr,avgPool:r5,pool:a5,maxPool3d:i5,avgPool3d:o5,maxPoolWithArgmax:u5,slice:Zo,slice1d:s5,slice2d:l5,slice3d:c5,slice4d:h5,abs:fW,acos:dW,acosh:pW,asin:vW,asinh:mW,atan:gW,atanh:yW,ceil:xW,clipByValue:bW,cos:wW,cosh:EW,erf:CW,exp:SW,expm1:RW,floor:_W,log:AW,log1p:TW,logSigmoid:kW,neg:ay,reciprocal:DW,round:IW,rsqrt:GS,sigmoid:NW,sign:OW,isNaN:MW,isInf:BW,isFinite:PW,sin:FW,sinh:LW,softplus:zW,sqrt:UW,step:WW,tan:VW,tanh:GW,all:f5,any:d5,argMax:p5,argMin:v5,logSumExp:m5,max:g5,mean:y5,min:x5,moments:b5,sum:Uo,prod:w5,equal:kR,equalStrict:PG,greater:FG,greaterEqual:DR,greaterEqualStrict:LG,greaterStrict:zG,less:UG,lessEqual:WG,lessEqualStrict:VG,lessStrict:GG,notEqual:HG,notEqualStrict:qG,addStrict:HW,atan2:qW,divStrict:jW,floorDiv:HS,maximum:iy,maximumStrict:XW,minimum:qS,minimumStrict:KW,mod:YW,modStrict:QW,mul:un,mulStrict:ZW,pow:pd,powStrict:$W,squaredDifferenceStrict:JW,sub:Fa,subStrict:tV,elu:VR,leakyRelu:E5,prelu:GR,relu:zd,relu6:HR,selu:C5,logicalAnd:Ld,logicalNot:CG,logicalOr:ER,logicalXor:SG,where:Wu,whereAsync:CR,buffer:ee,print:uW,batchToSpaceND:NS,cast:sW,cumsum:lW,depthToSpace:cW,expandDims:zo,reshape:Xi,spaceToBatchND:OS,squeeze:MS,stack:Yo,unstack:Id,setdiff1dAsync:hW,fill:Bu,linspace:nW,ones:wl,range:cd,scalar:Ut,tensor:Qn,tensor1d:za,tensor2d:Mu,tensor3d:DS,tensor4d:si,tensor5d:J3,tensor6d:tW,variable:eW,zeros:sn,onesLike:IS,zerosLike:me,transpose:Ma,softmax:Bd,logSoftmax:uV,localResponseNormalization:S5,norm:qR,gather:vy,unsortedSegmentSum:IR,basicLSTMCell:R5,multiRNNCell:_5,movingAverage:A5,stridedSlice:T5,topk:k5,scatterND:D5,fft:yy,ifft:bd,rfft:xy,irfft:jR,sparseToDense:N5,gatherND:O5,diag:M5,dropout:B5,hannWindow:by,hammingWindow:KR,frame:wy,stft:YR,inTopKAsync:F5});function St(r,t){Array.isArray(r)||(r=[r]),r.forEach((function(e){e!=null&&G(e.dtype!=="complex64",(function(){return t+" does not support complex64 tensors."}))}))}function Ag(r,t,e,n,a,i){for(var o=a.strideHeight,u=a.strideWidth,l=a.dilationHeight,h=a.dilationWidth,f=a.effectiveFilterHeight,p=a.effectiveFilterWidth,v=a.padInfo.top,m=a.padInfo.left,x=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,b=ee(a.outShape,e),E=b.values,C=a.outShape[1]*a.outShape[2]*a.outShape[3],R=a.outShape[2]*a.outShape[3],_=a.outShape[3],A=0;A<a.batchSize;++A)for(var k=A*C,D=A*n[0],P=0;P<a.inChannels;++P)for(var M=0;M<a.outHeight;++M)for(var O=M*o-v,F=Math.max(0,O),W=Math.min(a.inHeight,f+O),j=k+M*R,ot=0;ot<a.outWidth;++ot){for(var nt=ot*u-m,at=Math.max(0,nt),V=Math.min(a.inWidth,p+nt),X=x,Q=0,ut=0,B=F;B<W;B+=l){for(var $=D+B*n[1],ht=at;ht<V;ht+=h){var ft=r[$+ht*n[2]+P];i==="max"&&ft>X?X=ft:i==="avg"&&(Q+=ft,ut++)}if(isNaN(X))break}E[j+ot*_+P]=i==="avg"?Q/ut:X}return b}function ZR(r,t,e,n,a,i){a===void 0&&(a=!1),i===void 0&&(i=!1);for(var o=ee(n.outShape,"int32"),u=n.strideHeight,l=n.strideWidth,h=n.dilationHeight,f=n.dilationWidth,p=n.effectiveFilterHeight,v=n.effectiveFilterWidth,m=n.padInfo.top,x=n.padInfo.left,b=ee(t,e,r),E=0;E<n.batchSize;++E)for(var C=0;C<n.inChannels;++C)for(var R=0;R<n.outHeight;++R){for(var _=R*u-m,A=_;A<0;)A+=h;for(var k=Math.min(n.inHeight,p+_),D=0;D<n.outWidth;++D){for(var P=D*l-x,M=P;M<0;)M+=f;for(var O=Math.min(n.inWidth,v+P),F=Number.NEGATIVE_INFINITY,W=-1,j=A;j<k;j+=h)for(var ot=j-_,nt=M;nt<O;nt+=f){var at=nt-P,V=b.get(E,j,nt,C);V>F&&(F=V,W=a?i?((E*n.inHeight+j)*n.inWidth+nt)*n.inChannels+C:(j*n.inWidth+nt)*n.inChannels+C:ot*v+at)}o.set(W,E,R,D,C)}}return o}function Bm(r,t,e,n){if(e==="linear")return r.linear(t);if(e==="relu")return r.relu(t);if(e==="elu")return r.elu(t);if(e==="relu6")return r.relu6(t);if(e==="prelu")return r.prelu(t,n);throw new Error("Activation "+e+" has not been implemented for the CPU backend.")}var lH=(function(r){function t(){var e=r.call(this)||this;return e.blockSize=48,e.firstUse=!0,e.data=new QS(e,rt),e}return Ua(t,r),t.prototype.write=function(e,n,a){this.firstUse&&(this.firstUse=!1,yt().get("IS_NODE")&&sd(`
============================
Hi there . Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.
============================`));var i={};return this.data.set(i,{values:e,dtype:a}),i},t.prototype.move=function(e,n,a,i){this.data.set(e,{values:n,dtype:i})},t.prototype.numDataIds=function(){return this.data.numDataIds()},t.prototype.read=function(e){return Mt(this,void 0,void 0,(function(){return Bt(this,(function(n){return[2,this.readSync(e)]}))}))},t.prototype.readSync=function(e){var n=this.data.get(e),a=n.dtype,i=n.complexTensors;return a==="complex64"?_g(this.readSync(i.real.dataId),this.readSync(i.imag.dataId)):this.data.get(e).values},t.prototype.bufferSync=function(e){var n=this.readSync(e.dataId),a=n;if(e.dtype==="string")try{a=n.map((function(i){return id(i)}))}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return ee(e.shape,e.dtype,a)},t.prototype.makeOutput=function(e,n,a){var i=this.write(e,n,a);return rt.makeTensorFromDataId(i,n,a,this)},t.prototype.disposeData=function(e){if(this.data.has(e)){var n=this.data.get(e).complexTensors;n!=null&&(n.real.dispose(),n.imag.dispose()),this.data.delete(e)}},t.prototype.time=function(e){return Mt(this,void 0,void 0,(function(){var n;return Bt(this,(function(a){return n=ui(),e(),[2,{kernelMs:ui()-n}]}))}))},t.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},t.prototype.complex=function(e,n){var a=this.makeOutput(null,e.shape,"complex64");return this.data.get(a.dataId).complexTensors={real:rt.keep(e.clone()),imag:rt.keep(n.clone())},a},t.prototype.real=function(e){return this.data.get(e.dataId).complexTensors.real.clone()},t.prototype.imag=function(e){return this.data.get(e.dataId).complexTensors.imag.clone()},t.prototype.slice=function(e,n,a){if(St(e,"slice"),KS(e.shape,n,a)){var i=YS(n,e.strides),o=Ot(a);return Qn(this.readSync(e.dataId).subarray(i,i+o),a,e.dtype)}for(var u=ee(a,e.dtype),l=this.bufferSync(e),h=0;h<u.size;++h){var f=u.indexToLoc(h).map((function(p,v){return p+n[v]}));u.values[h]=l.get.apply(l,f)}return u.toTensor()},t.prototype.stridedSlice=function(e,n,a,i){St(e,"stridedSlice");var o=oy(n,a,i);if(o.some((function(m){return m===0})))return Qn([],o);for(var u=ee(o,e.dtype),l=this.bufferSync(e),h=0;h<u.size;h++){for(var f=u.indexToLoc(h),p=new Array(f.length),v=0;v<p.length;v++)p[v]=f[v]*i[v]+n[v];u.set.apply(u,[l.get.apply(l,p)].concat(f))}return u.toTensor()},t.prototype.diag=function(e){for(var n=this.readSync(e.dataId),a=ee([e.size,e.size],e.dtype),i=a.values,o=0;o<n.length;o++)i[o*e.size+o]=n[o];return a.toTensor()},t.prototype.unstack=function(e,n){for(var a=e.shape[n],i=new Array(e.rank-1),o=0,u=0;u<e.rank;u++)u!==n&&(i[o++]=e.shape[u]);var l=new Array(e.rank).fill(0),h=e.shape.slice();h[n]=1;var f=new Array(a);for(u=0;u<f.length;u++)l[n]=u,f[u]=this.slice(e,l,h).reshape(i);return f},t.prototype.reverse=function(e,n){St(e,"reverse");for(var a=ee(e.shape,e.dtype),i=this.bufferSync(e),o=function(l){var h=a.indexToLoc(l),f=h.slice();n.forEach((function(p){return f[p]=e.shape[p]-1-f[p]})),a.set.apply(a,[i.get.apply(i,f)].concat(h))},u=0;u<a.size;u++)o(u);return a.toTensor()},t.prototype.concat=function(e,n){var a=this;if(e[0].dtype==="complex64"){var i=e.map((function(m){return va(m)})),o=e.map((function(m){return ci(m)}));return Kn(this.concat(i,n),this.concat(o,n))}var u=e.map((function(m){var x=Ot(m.shape.slice(n));return m.as2D(-1,x)})),l=hl(u.map((function(m){return m.shape})),1),h=ee(l,e[0].dtype).values;if(u[0].shape[0]===1){var f=0;u.forEach((function(m){h.set(a.readSync(m.dataId),f),f+=m.size}))}else{var p=0;u.forEach((function(m){for(var x=a.readSync(m.dataId),b=0,E=0;E<m.shape[0];++E)for(var C=E*l[1]+p,R=0;R<m.shape[1];++R)h[C+R]=x[b++];p+=m.shape[1]}))}var v=hl(e.map((function(m){return m.shape})),n);return Qn(h,v,e[0].dtype)},t.prototype.neg=function(e){return St(e,"neg"),this.multiply(Ut(-1),e)},t.prototype.add=function(e,n){return e.dtype==="complex64"||n.dtype==="complex64"?this.broadcastedBinaryComplexOp(e.cast("complex64"),n.cast("complex64"),(function(a,i,o,u){return{real:a+o,imag:i+u}})):this.broadcastedBinaryOp(e,n,Yn(e.dtype,n.dtype),(function(a,i){return a+i}))},t.prototype.addN=function(e){var n=this;St(e,"addN");for(var a=e.map((function(f){return n.readSync(f.dataId)})),i=ee(e[0].shape,e[0].dtype),o=i.values,u=0;u<e.length;u++)for(var l=a[u],h=0;h<o.length;h++)o[h]+=l[h];return i.toTensor()},t.prototype.softmax=function(e,n){var a=In([n],e.shape),i=this.max(e,a),o=Ar(i.shape,a),u=this.subtract(e,i.reshape(o)),l=this.exp(u),h=this.sum(l,a).reshape(o);return Qo(l,h)},t.prototype.subtract=function(e,n){return e.dtype==="complex64"||n.dtype==="complex64"?this.broadcastedBinaryComplexOp(e.cast("complex64"),n.cast("complex64"),(function(a,i,o,u){return{real:a-o,imag:i-u}})):this.broadcastedBinaryOp(e,n,Yn(e.dtype,n.dtype),(function(a,i){return a-i}))},t.prototype.pow=function(e,n){return St([e,n],"pow"),this.broadcastedBinaryOp(e,n,e.dtype,(function(a,i){return Math.pow(a,i)}))},t.prototype.batchMatMul=function(e,n,a,i){St([e,n],"matMul");for(var o=a?e.shape[1]:e.shape[2],u=a?e.shape[2]:e.shape[1],l=i?n.shape[1]:n.shape[2],h=e.shape[0],f=this.readSync(e.dataId),p=this.readSync(n.dataId),v=a?[e.strides[0],1,e.strides[1]]:[e.strides[0],e.strides[1],1],m=v[0],x=v[1],b=v[2],E=i?[1,n.strides[1],n.strides[0]]:[n.strides[1],1,n.strides[0]],C=E[0],R=E[1],_=E[2],A=u*l,k=ee([h,u,l],e.dtype),D=k.values,P=this.blockSize,M=0;M<h;M++)for(var O=0;O<u;O+=P)for(var F=0;F<l;F+=P)for(var W=0;W<o;W+=P)for(var j=Math.min(O+P,u),ot=Math.min(F+P,l),nt=Math.min(W+P,o),at=O;at<j;at++)for(var V=F;V<ot;V++){for(var X=0,Q=W;Q<nt;Q++)X+=f[M*m+at*x+Q*b]*p[Q*C+V*R+M*_];D[M*A+(at*l+V)]+=X}return k.toTensor()},t.prototype.fusedBatchMatMul=function(e){var n=e.a,a=e.b,i=e.transposeA,o=e.transposeB,u=e.bias,l=e.activation,h=e.preluActivationWeights,f=this.batchMatMul(n,a,i,o);return u&&(f=this.add(f,u)),l&&(f=Bm(this,f,l,h)),f},t.prototype.multiply=function(e,n){return e.dtype==="complex64"||n.dtype==="complex64"?this.broadcastedBinaryComplexOp(e.cast("complex64"),n.cast("complex64"),(function(a,i,o,u){return{real:a*o-i*u,imag:a*u+i*o}})):this.broadcastedBinaryOp(e,n,Yn(e.dtype,n.dtype),(function(a,i){return a*i}))},t.prototype.floorDiv=function(e,n){return St([e,n],"floorDiv"),this.broadcastedBinaryOp(e,n,"int32",(function(a,i){return Math.floor(a/i)}))},t.prototype.sum=function(e,n){St(e,"sum"),Hr("sum",n,e.rank);for(var a=nr(e.shape,n),i=a[0],o=a[1],u=sn(i,Yn(e.dtype,"int32")),l=Ot(o),h=this.readSync(u.dataId),f=this.readSync(e.dataId),p=0;p<h.length;++p){for(var v=p*l,m=0,x=0;x<l;++x)m+=f[v+x];h[p]=m}return u},t.prototype.prod=function(e,n){St(e,"sum");for(var a=nr(e.shape,n),i=a[0],o=a[1],u=sn(i,Yn(e.dtype,"int32")),l=Ot(o),h=this.readSync(u.dataId),f=this.readSync(e.dataId),p=0;p<h.length;++p){for(var v=p*l,m=1,x=0;x<l;++x)m*=f[v+x];h[p]=m}return u},t.prototype.unsortedSegmentSum=function(e,n,a){St(e,"unsortedSegmentSum");for(var i=[],o=e.rank-n.rank,u=0;u<o;++u)n=n.expandDims(u+1);for(u=0;u<a;++u){var l=Ut(u,"int32"),h=kR(l,n).asType("float32").mul(e).sum(0);i.push(h)}return Yo(i)},t.prototype.argMin=function(e,n){St(e,"argMin");var a=[n];Hr("argMin",a,e.rank);for(var i=nr(e.shape,a),o=i[0],u=i[1],l=sn(o,"int32"),h=Ot(u),f=this.readSync(l.dataId),p=this.readSync(e.dataId),v=0;v<f.length;++v){for(var m=v*h,x=p[m],b=0,E=0;E<h;++E){var C=p[m+E];C<x&&(x=C,b=E)}f[v]=b}return l},t.prototype.argMax=function(e,n){St(e,"argMax");var a=[n];Hr("argMax",a,e.rank);for(var i=nr(e.shape,a),o=i[0],u=i[1],l=sn(o,"int32"),h=Ot(u),f=this.readSync(l.dataId),p=this.readSync(e.dataId),v=0;v<f.length;++v){for(var m=v*h,x=p[m],b=0,E=0;E<h;++E){var C=p[m+E];C>x&&(x=C,b=E)}f[v]=b}return l},t.prototype.cumsum=function(e,n,a,i){if(St(e,"cumsum"),n!==e.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(e.rank-1)+" but got axis="+n);for(var o=Yn(e.dtype,"int32"),u=sn(e.shape,o),l=this.readSync(u.dataId),h=this.readSync(e.dataId),f=e.shape[e.rank-1],p=i?function(E,C){return E+f-C-1}:function(E,C){return E+C},v=0;v<h.length;v+=f)for(var m=0;m<f;m++){var x=p(v,m);if(m===0)l[x]=a?0:h[x];else{var b=p(v,m-1);l[x]=a?h[b]+l[b]:h[x]+l[b]}}return u},t.prototype.equal=function(e,n){return St([e,n],"equal"),this.broadcastedBinaryOp(e,n,"bool",(function(a,i){return a===i?1:0}))},t.prototype.notEqual=function(e,n){return St([e,n],"notEqual"),this.broadcastedBinaryOp(e,n,"bool",(function(a,i){return a!==i?1:0}))},t.prototype.less=function(e,n){return St([e,n],"less"),this.broadcastedBinaryOp(e,n,"bool",(function(a,i){return a<i?1:0}))},t.prototype.lessEqual=function(e,n){return St([e,n],"lessEqual"),this.broadcastedBinaryOp(e,n,"bool",(function(a,i){return a<=i?1:0}))},t.prototype.greater=function(e,n){return St([e,n],"greater"),this.broadcastedBinaryOp(e,n,"bool",(function(a,i){return a>i?1:0}))},t.prototype.greaterEqual=function(e,n){return St([e,n],"greaterEqual"),this.broadcastedBinaryOp(e,n,"bool",(function(a,i){return a>=i?1:0}))},t.prototype.logicalNot=function(e){St(e,"logicalNot");for(var n=this.readSync(e.dataId),a=new Uint8Array(n.length),i=0;i<n.length;++i)a[i]=n[i]?0:1;return this.makeOutput(a,e.shape,"bool")},t.prototype.logicalAnd=function(e,n){return St([e,n],"logicalAnd"),this.broadcastedBinaryOp(e,n,"bool",(function(a,i){return a&&i}))},t.prototype.logicalOr=function(e,n){return St([e,n],"logicalOr"),this.broadcastedBinaryOp(e,n,"bool",(function(a,i){return a||i}))},t.prototype.select=function(e,n,a){St([e,n,a],"select");for(var i=this.readSync(e.dataId),o=this.readSync(n.dataId),u=this.readSync(a.dataId),l=sn(n.shape,Yn(n.dtype,a.dtype)),h=this.readSync(l.dataId),f=0,p=e.rank===0||e.rank>1||n.rank===1?1:Ot(n.shape.slice(1)),v=0;v<i.length;v++)for(var m=0;m<p;m++)i[v]===1?h[f++]=o[v]:h[f++]=u[v];return l},t.prototype.where=function(e){St([e],"where");var n=this.readSync(e.dataId);return cy(e.shape,n)},t.prototype.topk=function(e,n,a){return St(e,"topk"),aR(this.readSync(e.dataId),e.shape,e.dtype,n)},t.prototype.min=function(e,n){St(e,"min"),Hr("min",n,e.rank);for(var a=nr(e.shape,n),i=a[0],o=a[1],u=sn(i,e.dtype),l=Ot(o),h=this.readSync(u.dataId),f=this.readSync(e.dataId),p=0;p<h.length;++p){for(var v=p*l,m=f[v],x=0;x<l;++x){var b=f[v+x];b<m&&(m=b)}h[p]=m}return u},t.prototype.minimum=function(e,n){return St([e,n],"minimum"),this.broadcastedBinaryOp(e,n,e.dtype,(function(a,i){return Math.min(a,i)}))},t.prototype.mod=function(e,n){return St([e,n],"mod"),this.broadcastedBinaryOp(e,n,e.dtype,(function(a,i){var o=a%i;return a<0&&i<0||a>=0&&i>=0?o:(o+i)%i}))},t.prototype.max=function(e,n){St(e,"max"),Hr("max",n,e.rank);for(var a=nr(e.shape,n),i=a[0],o=a[1],u=sn(i,e.dtype),l=Ot(o),h=this.readSync(u.dataId),f=this.readSync(e.dataId),p=0;p<h.length;++p){for(var v=p*l,m=f[v],x=0;x<l;++x){var b=f[v+x];b>m&&(m=b)}h[p]=m}return u},t.prototype.maximum=function(e,n){return St([e,n],"maximum"),this.broadcastedBinaryOp(e,n,e.dtype,(function(a,i){return Math.max(a,i)}))},t.prototype.all=function(e,n){St(e,"all"),Hr("all",n,e.rank);for(var a=nr(e.shape,n),i=a[0],o=a[1],u=sn(i,e.dtype),l=Ot(o),h=this.readSync(u.dataId),f=this.readSync(e.dataId),p=0;p<h.length;++p){for(var v=p*l,m=f[v],x=0;x<l;++x){var b=f[v+x];m=m&&b}h[p]=m}return u},t.prototype.any=function(e,n){St(e,"any"),Hr("any",n,e.rank);for(var a=nr(e.shape,n),i=a[0],o=a[1],u=sn(i,e.dtype),l=Ot(o),h=this.readSync(u.dataId),f=this.readSync(e.dataId),p=0;p<h.length;++p){for(var v=p*l,m=f[v],x=0;x<l;++x){var b=f[v+x];m=m||b}h[p]=m}return u},t.prototype.squaredDifference=function(e,n){return St([e,n],"squaredDifference"),this.broadcastedBinaryOp(e,n,e.dtype,(function(a,i){var o=a-i;return o*o}))},t.prototype.ceil=function(e){St(e,"ceil");for(var n=this.readSync(e.dataId),a=new Float32Array(n.length),i=0;i<n.length;++i)a[i]=Math.ceil(n[i]);return this.makeOutput(a,e.shape,"float32")},t.prototype.floor=function(e){St(e,"floor");for(var n=this.readSync(e.dataId),a=new Float32Array(n.length),i=0;i<n.length;++i)a[i]=Math.floor(n[i]);return this.makeOutput(a,e.shape,"float32")},t.prototype.sign=function(e){St(e,"x");for(var n=this.readSync(e.dataId),a=new Float32Array(n.length),i=0;i<n.length;++i)n[i]<0?a[i]=-1:n[i]>0?a[i]=1:a[i]=0;return this.makeOutput(a,e.shape,"float32")},t.prototype.isNaN=function(e){St(e,"x");for(var n=this.readSync(e.dataId),a=new Uint8Array(n.length),i=0;i<n.length;++i)Number.isNaN(n[i])&&(a[i]=1);return this.makeOutput(a,e.shape,"bool")},t.prototype.isInf=function(e){St(e,"x");for(var n=this.readSync(e.dataId),a=new Uint8Array(n.length),i=0;i<n.length;++i)Math.abs(n[i])===1/0&&(a[i]=1);return this.makeOutput(a,e.shape,"bool")},t.prototype.isFinite=function(e){St(e,"x");for(var n=this.readSync(e.dataId),a=new Uint8Array(n.length),i=0;i<n.length;++i)Number.isFinite(n[i])&&(a[i]=1);return this.makeOutput(a,e.shape,"bool")},t.prototype.round=function(e){St(e,"round");for(var n=this.readSync(e.dataId),a=new Float32Array(n.length),i=0;i<n.length;++i){var o=Math.floor(n[i]);n[i]-o<.5?a[i]=Math.floor(n[i]):n[i]-o>.5?a[i]=Math.ceil(n[i]):a[i]=o%2==0?o:o+1}return this.makeOutput(a,e.shape,"float32")},t.prototype.exp=function(e){St(e,"exp");for(var n=this.readSync(e.dataId),a=new Float32Array(n.length),i=0;i<n.length;++i)a[i]=Math.exp(n[i]);return this.makeOutput(a,e.shape,"float32")},t.prototype.expm1=function(e){St(e,"expm1");for(var n=this.readSync(e.dataId),a=new Float32Array(n.length),i=0;i<n.length;++i)a[i]=Math.expm1(n[i]);return this.makeOutput(a,e.shape,"float32")},t.prototype.log=function(e){St(e,"log");for(var n=this.readSync(e.dataId),a=new Float32Array(n.length),i=0;i<n.length;++i){var o=n[i];a[i]=Math.log(o)}return this.makeOutput(a,e.shape,"float32")},t.prototype.log1p=function(e){St(e,"log1p");for(var n=this.readSync(e.dataId),a=new Float32Array(n.length),i=0;i<n.length;++i){var o=n[i];a[i]=Math.log1p(o)}return this.makeOutput(a,e.shape,"float32")},t.prototype.sqrt=function(e){St(e,"sqrt");for(var n=this.readSync(e.dataId),a=new Float32Array(n.length),i=0;i<n.length;++i){var o=n[i];a[i]=Math.sqrt(o)}return this.makeOutput(a,e.shape,"float32")},t.prototype.rsqrt=function(e){St(e,"rsqrt");for(var n=this.readSync(e.dataId),a=new Float32Array(n.length),i=0;i<n.length;++i){var o=n[i];a[i]=1/Math.sqrt(o)}return this.makeOutput(a,e.shape,"float32")},t.prototype.reciprocal=function(e){St(e,"reciprocal");for(var n=this.readSync(e.dataId),a=new Float32Array(n.length),i=0;i<n.length;++i)a[i]=1/n[i];return this.makeOutput(a,e.shape,"float32")},t.prototype.linear=function(e){return e},t.prototype.relu=function(e){St(e,"relu");for(var n=sn(e.shape,e.dtype),a=this.readSync(n.dataId),i=this.readSync(e.dataId),o=0;o<i.length;++o)a[o]=Math.max(0,i[o]);return n},t.prototype.relu6=function(e){St(e,"relu");for(var n=sn(e.shape,e.dtype),a=this.readSync(n.dataId),i=this.readSync(e.dataId),o=0;o<i.length;++o)a[o]=Math.min(Math.max(0,i[o]),6);return n},t.prototype.prelu=function(e,n){return St([e,n],"prelu"),this.broadcastedBinaryOp(e,n,e.dtype,(function(a,i){return a<0?i*a:a}))},t.prototype.elu=function(e){St(e,"elu");for(var n=new Float32Array(e.size),a=this.readSync(e.dataId),i=0;i<a.length;++i){var o=a[i];n[i]=o>=0?o:Math.exp(o)-1}return this.makeOutput(n,e.shape,"float32")},t.prototype.eluDer=function(e,n){St([e,n],"eluDer");for(var a=new Float32Array(n.size),i=this.readSync(n.dataId),o=this.readSync(e.dataId),u=0;u<i.length;++u){var l=i[u];a[u]=l>=1?o[u]:o[u]*(l+1)}return this.makeOutput(a,n.shape,"float32")},t.prototype.selu=function(e){St(e,"selu");for(var n=fy,a=dy,i=new Float32Array(e.size),o=this.readSync(e.dataId),u=0;u<o.length;++u){var l=o[u];i[u]=l>=0?a*l:n*(Math.exp(l)-1)}return this.makeOutput(i,e.shape,"float32")},t.prototype.clip=function(e,n,a){St(e,"clip");for(var i=new Float32Array(e.size),o=this.readSync(e.dataId),u=0;u<o.length;++u){var l=o[u];i[u]=l>a?a:l<n?n:l}return this.makeOutput(i,e.shape,"float32")},t.prototype.abs=function(e){for(var n=new Float32Array(e.size),a=this.readSync(e.dataId),i=0;i<a.length;++i)n[i]=Math.abs(a[i]);return this.makeOutput(n,e.shape,"float32")},t.prototype.complexAbs=function(e){for(var n=new Float32Array(e.size),a=this.readSync(e.dataId),i=0;i<e.size;++i){var o=a[2*i],u=a[2*i+1];n[i]=Math.hypot(o,u)}return this.makeOutput(n,e.shape,"float32")},t.prototype.int=function(e){St(e,"int");for(var n=new Int32Array(e.size),a=this.readSync(e.dataId),i=0;i<a.length;++i)n[i]=a[i];return this.makeOutput(n,e.shape,"int32")},t.prototype.sigmoid=function(e){St(e,"sigmoid");for(var n=new Float32Array(e.size),a=this.readSync(e.dataId),i=0;i<a.length;++i)n[i]=1/(1+Math.exp(-a[i]));return this.makeOutput(n,e.shape,"float32")},t.prototype.softplus=function(e){St(e,"softplus");for(var n=Math.log(11920928955078125e-23)+2,a=new Float32Array(e.size),i=this.readSync(e.dataId),o=0;o<i.length;++o){var u=i[o]>-n,l=i[o]<n,h=Math.exp(i[o]),f=void 0;f=l?h:u?i[o]:Math.log(1+h),a[o]=f}return this.makeOutput(a,e.shape,"float32")},t.prototype.sin=function(e){St(e,"sin");for(var n=new Float32Array(e.size),a=this.readSync(e.dataId),i=0;i<a.length;++i)n[i]=Math.sin(a[i]);return this.makeOutput(n,e.shape,"float32")},t.prototype.cos=function(e){St(e,"cos");for(var n=new Float32Array(e.size),a=this.readSync(e.dataId),i=0;i<a.length;++i)n[i]=Math.cos(a[i]);return this.makeOutput(n,e.shape,"float32")},t.prototype.tan=function(e){St(e,"tan");for(var n=new Float32Array(e.size),a=this.readSync(e.dataId),i=0;i<a.length;++i)n[i]=Math.tan(a[i]);return this.makeOutput(n,e.shape,"float32")},t.prototype.asin=function(e){St(e,"asin");for(var n=new Float32Array(e.size),a=this.readSync(e.dataId),i=0;i<a.length;++i)n[i]=Math.asin(a[i]);return this.makeOutput(n,e.shape,"float32")},t.prototype.acos=function(e){St(e,"acos");for(var n=new Float32Array(e.size),a=this.readSync(e.dataId),i=0;i<a.length;++i)n[i]=Math.acos(a[i]);return this.makeOutput(n,e.shape,"float32")},t.prototype.atan=function(e){St(e,"atan");for(var n=new Float32Array(e.size),a=this.readSync(e.dataId),i=0;i<a.length;++i)n[i]=Math.atan(a[i]);return this.makeOutput(n,e.shape,"float32")},t.prototype.atan2=function(e,n){return St([e,n],"atan2"),this.broadcastedBinaryOp(e,n,e.dtype,(function(a,i){return Math.atan2(a,i)}))},t.prototype.sinh=function(e){St(e,"sinh");for(var n=new Float32Array(e.size),a=this.readSync(e.dataId),i=0;i<a.length;++i)n[i]=Math.sinh(a[i]);return this.makeOutput(n,e.shape,"float32")},t.prototype.cosh=function(e){St(e,"cosh");for(var n=new Float32Array(e.size),a=this.readSync(e.dataId),i=0;i<a.length;++i)n[i]=Math.cosh(a[i]);return this.makeOutput(n,e.shape,"float32")},t.prototype.tanh=function(e){St(e,"tanh");for(var n=new Float32Array(e.size),a=this.readSync(e.dataId),i=0;i<a.length;++i)n[i]=u3(a[i]);return this.makeOutput(n,e.shape,"float32")},t.prototype.asinh=function(e){St(e,"asinh");for(var n=new Float32Array(e.size),a=this.readSync(e.dataId),i=0;i<a.length;++i)n[i]=Math.asinh(a[i]);return this.makeOutput(n,e.shape,"float32")},t.prototype.acosh=function(e){St(e,"acosh");for(var n=new Float32Array(e.size),a=this.readSync(e.dataId),i=0;i<a.length;++i)n[i]=Math.acosh(a[i]);return this.makeOutput(n,e.shape,"float32")},t.prototype.atanh=function(e){St(e,"atanh");for(var n=new Float32Array(e.size),a=this.readSync(e.dataId),i=0;i<a.length;++i)n[i]=Math.atanh(a[i]);return this.makeOutput(n,e.shape,"float32")},t.prototype.erf=function(e){St(e,"erf");for(var n=new Float32Array(e.size),a=this.readSync(e.dataId),i=0;i<a.length;++i){var o=Math.sign(a[i]),u=Math.abs(a[i]),l=1/(1+.3275911*u);n[i]=o*(1-((((1.061405429*l-1.453152027)*l+1.421413741)*l-.284496736)*l+.254829592)*l*Math.exp(-u*u))}return this.makeOutput(n,e.shape,"float32")},t.prototype.step=function(e,n){n===void 0&&(n=0),St(e,"step");for(var a=new Float32Array(e.size),i=this.readSync(e.dataId),o=0;o<i.length;++o){var u=i[o];isNaN(u)?a[o]=NaN:a[o]=u>0?1:n}return this.makeOutput(a,e.shape,"float32")},t.prototype.fusedConv2d=function(e){var n=e.input,a=e.filter,i=e.convInfo,o=e.bias,u=e.activation,l=e.preluActivationWeights,h=this.conv2d(n,a,i);return o&&(h=this.add(h,o)),u&&(h=Bm(this,h,u,l)),h},t.prototype.conv2d=function(e,n,a){St([e,n],"conv2d");for(var i=a.filterHeight,o=a.filterWidth,u=a.dilationHeight,l=a.dilationWidth,h=a.padInfo.left,f=a.padInfo.top,p=a.dataFormat==="channelsLast",v=ee(a.outShape,e.dtype),m=e.strides[0],x=p?e.strides[1]:e.strides[2],b=p?e.strides[2]:1,E=p?1:e.strides[1],C=v.strides[0],R=p?v.strides[1]:v.strides[2],_=p?v.strides[2]:1,A=p?1:v.strides[1],k=this.readSync(e.dataId),D=this.readSync(n.dataId),P=v.values,M=0;M<a.batchSize;++M)for(var O=M*m,F=M*C,W=0;W<a.outHeight;++W)for(var j=F+W*R,ot=W*a.strideHeight-f,nt=0;nt<i;nt++){var at=ot+nt*u;if(!(at<0||at>=a.inHeight))for(var V=nt*n.strides[0],X=O+at*x,Q=0;Q<a.outWidth;++Q)for(var ut=j+Q*_,B=Q*a.strideWidth-h,$=0;$<o;$++){var ht=B+$*l;if(!(ht<0||ht>=a.inWidth))for(var ft=X+ht*b,xt=V+$*n.strides[1],wt=0;wt<a.inChannels;++wt){for(var Rt=k[ft+wt*E],Dt=0;Dt<a.outChannels;++Dt)P[ut+Dt*A]+=Rt*D[xt+Dt];xt+=a.outChannels}}}return v.toTensor()},t.prototype.conv3d=function(e,n,a){for(var i=a.filterDepth,o=a.filterHeight,u=a.filterWidth,l=a.dilationDepth,h=a.dilationHeight,f=a.dilationWidth,p=a.padInfo.front,v=a.padInfo.left,m=a.padInfo.top,x=ee(a.outShape,e.dtype),b=this.readSync(e.dataId),E=this.readSync(n.dataId),C=x.values,R=0;R<a.batchSize;++R)for(var _=R*e.strides[0],A=R*x.strides[0],k=0;k<a.outDepth;++k)for(var D=A+k*x.strides[1],P=k*a.strideDepth-p,M=0;M<i;M++){var O=P+M*l;if(!(O<0||O>=a.inDepth))for(var F=M*n.strides[0],W=_+O*e.strides[1],j=0;j<a.outHeight;++j)for(var ot=D+j*x.strides[2],nt=j*a.strideHeight-m,at=0;at<o;at++){var V=nt+at*h;if(!(V<0||V>=a.inHeight))for(var X=F+at*n.strides[1],Q=W+V*e.strides[2],ut=0;ut<a.outWidth;++ut)for(var B=ot+ut*a.outChannels,$=ut*a.strideWidth-v,ht=0;ht<u;ht++){var ft=$+ht*f;if(!(ft<0||ft>=a.inWidth))for(var xt=X+ht*n.strides[2],wt=Q+ft*a.inChannels,Rt=xt,Dt=0;Dt<a.inChannels;++Dt){for(var _t=b[wt+Dt],Pt=0;Pt<a.outChannels;++Pt)C[B+Pt]+=_t*E[Rt+Pt];Rt+=a.outChannels}}}}return x.toTensor()},t.prototype.conv2dDerInput=function(e,n,a){St([e,n],"conv2dDerInput");for(var i=ee(a.inShape,"float32"),o=i.values,u=this.readSync(e.dataId),l=this.readSync(n.dataId),h=n.strides,f=h[0],p=h[1],v=h[2],m=a.batchSize,x=a.filterHeight,b=a.filterWidth,E=a.inChannels,C=a.inHeight,R=a.inWidth,_=a.outChannels,A=a.outHeight,k=a.outWidth,D=a.strideHeight,P=a.strideWidth,M=a.dataFormat,O=x-1-a.padInfo.top,F=b-1-a.padInfo.left,W=M==="channelsLast",j=i.strides[0],ot=W?i.strides[1]:i.strides[2],nt=W?i.strides[2]:1,at=W?1:i.strides[1],V=e.strides[0],X=W?e.strides[1]:e.strides[2],Q=W?e.strides[2]:1,ut=W?1:e.strides[1],B=0;B<m;++B)for(var $=0;$<E;++$)for(var ht=0;ht<C;++ht)for(var ft=ht-O,xt=Math.max(0,Math.ceil(ft/D)),wt=Math.min(A,(x+ft)/D),Rt=0;Rt<R;++Rt){for(var Dt=Rt-F,_t=Math.max(0,Math.ceil(Dt/P)),Pt=Math.min(k,(b+Dt)/P),jt=0,Ft=xt;Ft<wt;++Ft)for(var Wt=Ft*D-ft,Gt=_t;Gt<Pt;++Gt)for(var $t=V*B+X*Ft+Q*Gt,ue=f*(x-1-Wt)+p*(b-1-(Gt*P-Dt))+v*$,de=0;de<_;++de)jt+=u[$t+ut*de]*l[ue+de];o[j*B+ot*ht+nt*Rt+at*$]=jt}return i.toTensor()},t.prototype.conv3dDerInput=function(e,n,a){for(var i=ee(a.inShape,"float32"),o=i.values,u=i.strides,l=u[0],h=u[1],f=u[2],p=u[3],v=this.readSync(e.dataId),m=e.strides,x=m[0],b=m[1],E=m[2],C=m[3],R=this.readSync(n.dataId),_=n.strides,A=_[0],k=_[1],D=_[2],P=_[3],M=a.batchSize,O=a.filterDepth,F=a.filterHeight,W=a.filterWidth,j=a.inChannels,ot=a.inDepth,nt=a.inHeight,at=a.inWidth,V=a.outChannels,X=a.outDepth,Q=a.outHeight,ut=a.outWidth,B=a.strideDepth,$=a.strideHeight,ht=a.strideWidth,ft=O-1-a.padInfo.front,xt=F-1-a.padInfo.top,wt=W-1-a.padInfo.left,Rt=0;Rt<M;++Rt)for(var Dt=0;Dt<j;++Dt)for(var _t=0;_t<ot;++_t)for(var Pt=_t-ft,jt=Math.max(0,Math.ceil(Pt/B)),Ft=Math.min(X,(O+Pt)/B),Wt=0;Wt<nt;++Wt)for(var Gt=Wt-xt,$t=Math.max(0,Math.ceil(Gt/$)),ue=Math.min(Q,(F+Gt)/$),de=0;de<at;++de){for(var Te=de-wt,je=Math.max(0,Math.ceil(Te/ht)),Se=Math.min(ut,(W+Te)/ht),vn=0,Xe=jt;Xe<Ft;++Xe)for(var Ge=Xe*B-Pt,ln=$t;ln<ue;++ln)for(var Gn=ln*$-Gt,Nn=je;Nn<Se;++Nn)for(var On=x*Rt+b*Xe+E*ln+C*Nn,Be=A*(O-1-Ge)+k*(F-1-Gn)+D*(W-1-(Nn*ht-Te))+P*Dt,Fe=0;Fe<V;++Fe)vn+=v[On+Fe]*R[Be+Fe];o[l*Rt+h*_t+f*Wt+p*de+Dt]=vn}return i.toTensor()},t.prototype.conv2dDerFilter=function(e,n,a){St([e,n],"conv2dDerFilter");for(var i=a.strideHeight,o=a.strideWidth,u=a.filterHeight,l=a.filterWidth,h=a.dataFormat==="channelsLast",f=ee(a.filterShape,"float32"),p=a.padInfo.left,v=a.padInfo.top,m=this.bufferSync(e),x=this.bufferSync(n),b=0;b<u;++b)for(var E=Math.max(0,Math.ceil((v-b)/i)),C=Math.min(a.outHeight,(a.inHeight+v-b)/i),R=0;R<l;++R)for(var _=Math.max(0,Math.ceil((p-R)/o)),A=Math.min(a.outWidth,(a.inWidth+p-R)/o),k=0;k<a.inChannels;++k)for(var D=0;D<a.outChannels;++D){for(var P=0,M=0;M<a.batchSize;++M)for(var O=E;O<C;++O)for(var F=b+O*i-v,W=_;W<A;++W){var j=R+W*o-p;P+=h?m.get(M,F,j,k)*x.get(M,O,W,D):m.get(M,k,F,j)*x.get(M,D,O,W)}f.set(P,b,R,k,D)}return f.toTensor()},t.prototype.conv3dDerFilter=function(e,n,a){for(var i=a.strideDepth,o=a.strideHeight,u=a.strideWidth,l=a.filterDepth,h=a.filterHeight,f=a.filterWidth,p=ee(a.filterShape,"float32"),v=p.values,m=p.strides,x=m[0],b=m[1],E=m[2],C=m[3],R=this.readSync(n.dataId),_=n.strides,A=_[0],k=_[1],D=_[2],P=_[3],M=this.readSync(e.dataId),O=e.strides,F=O[0],W=O[1],j=O[2],ot=O[3],nt=a.padInfo.front,at=a.padInfo.left,V=a.padInfo.top,X=0;X<l;++X)for(var Q=Math.max(0,Math.ceil((nt-X)/i)),ut=Math.min(a.outDepth,(a.inDepth+nt-X)/i),B=X*x,$=0;$<h;++$)for(var ht=Math.max(0,Math.ceil((V-$)/o)),ft=Math.min(a.outHeight,(a.inHeight+V-$)/o),xt=$*b+B,wt=0;wt<f;++wt)for(var Rt=Math.max(0,Math.ceil((at-wt)/u)),Dt=Math.min(a.outWidth,(a.inWidth+at-wt)/u),_t=wt*E+xt,Pt=0;Pt<a.inChannels;++Pt)for(var jt=Pt*C+_t,Ft=0;Ft<a.outChannels;++Ft){for(var Wt=0,Gt=0;Gt<a.batchSize;++Gt)for(var $t=Gt*F,ue=Gt*A,de=Q;de<ut;++de)for(var Te=(X+de*i-nt)*W+$t,je=de*k+ue,Se=ht;Se<ft;++Se)for(var vn=($+Se*o-V)*j+Te,Xe=Se*D+je,Ge=Rt;Ge<Dt;++Ge){var ln=Ge*P+Xe;Wt+=M[(wt+Ge*u-at)*ot+vn+Pt]*R[ln+Ft]}v[jt+Ft]=Wt}return p.toTensor()},t.prototype.fusedDepthwiseConv2D=function(e){var n=e.input,a=e.filter,i=e.convInfo,o=e.bias,u=e.activation,l=e.preluActivationWeights,h=this.depthwiseConv2D(n,a,i);return o&&(h=this.add(h,o)),u&&(h=Bm(this,h,u,l)),h},t.prototype.depthwiseConv2D=function(e,n,a){St([e,n],"depthwiseConv2D");for(var i=a.filterHeight,o=a.filterWidth,u=a.dilationHeight,l=a.dilationWidth,h=a.padInfo.left,f=a.padInfo.top,p=a.outChannels/a.inChannels,v=ee(a.outShape,e.dtype),m=this.readSync(e.dataId),x=this.readSync(n.dataId),b=v.values,E=0;E<a.batchSize;++E)for(var C=E*e.strides[0],R=E*v.strides[0],_=0;_<a.outHeight;++_)for(var A=R+_*v.strides[1],k=_*a.strideHeight-h,D=0;D<i;++D){var P=k+D*u;if(!(P<0||P>=a.inHeight))for(var M=D*n.strides[0],O=C+P*e.strides[1],F=0;F<a.outWidth;++F)for(var W=A+F*v.strides[2],j=F*a.strideWidth-f,ot=0;ot<o;++ot){var nt=j+ot*l;if(!(nt<0||nt>=a.inWidth))for(var at=M+ot*n.strides[1],V=O+nt*a.inChannels,X=W,Q=at,ut=0;ut<a.inChannels;++ut){for(var B=m[V+ut],$=0;$<p;++$)b[X+$]+=B*x[Q+$];X+=p,Q+=p}}}return v.toTensor()},t.prototype.depthwiseConv2DDerInput=function(e,n,a){St([e,n],"depthwiseConv2DDerInput");for(var i=ee(a.inShape,"float32"),o=i.values,u=i.strides,l=u[0],h=u[1],f=u[2],p=this.readSync(e.dataId),v=e.strides,m=v[0],x=v[1],b=v[2],E=this.readSync(n.dataId),C=n.strides,R=C[0],_=C[1],A=C[2],k=a.batchSize,D=a.filterHeight,P=a.filterWidth,M=a.inChannels,O=a.inHeight,F=a.inWidth,W=a.outChannels,j=a.outHeight,ot=a.outWidth,nt=a.strideHeight,at=a.strideWidth,V=D-1-a.padInfo.top,X=P-1-a.padInfo.left,Q=W/M,ut=0;ut<k;++ut)for(var B=0;B<M;++B)for(var $=0;$<O;++$)for(var ht=$-V,ft=Math.max(0,Math.ceil(ht/nt)),xt=Math.min(j,(D+ht)/nt),wt=0;wt<F;++wt){for(var Rt=wt-X,Dt=Math.max(0,Math.ceil(Rt/at)),_t=Math.min(ot,(P+Rt)/at),Pt=0,jt=ft;jt<xt;++jt)for(var Ft=jt*nt-ht,Wt=Dt;Wt<_t;++Wt)for(var Gt=m*ut+x*jt+b*Wt,$t=R*(D-1-Ft)+_*(P-1-(Wt*at-Rt))+A*B,ue=0;ue<Q;++ue)Pt+=p[Gt+(B*Q+ue)]*E[$t+ue];o[l*ut+h*$+f*wt+B]=Pt}return i.toTensor()},t.prototype.depthwiseConv2DDerFilter=function(e,n,a){St([e,n],"depthwiseConv2DDerFilter");for(var i=a.strideHeight,o=a.strideWidth,u=a.filterHeight,l=a.filterWidth,h=ee(a.filterShape,"float32"),f=a.padInfo.left,p=a.padInfo.top,v=a.outChannels/a.inChannels,m=this.bufferSync(e),x=this.bufferSync(n),b=0;b<u;++b)for(var E=Math.max(0,Math.ceil((p-b)/i)),C=Math.min(a.outHeight,(a.inHeight+p-b)/i),R=0;R<l;++R)for(var _=Math.max(0,Math.ceil((f-R)/o)),A=Math.min(a.outWidth,(a.inWidth+f-R)/o),k=0;k<a.outChannels;++k){for(var D=Math.trunc(k/v),P=k%v,M=0,O=0;O<a.batchSize;++O)for(var F=E;F<C;++F)for(var W=b+F*i-p,j=_;j<A;++j){var ot=R+j*o-f;M+=m.get(O,W,ot,D)*x.get(O,F,j,k)}h.set(M,b,R,D,P)}return h.toTensor()},t.prototype.tile=function(e,n){return St(e,"tile"),rR(this.bufferSync(e),n)},t.prototype.pad=function(e,n,a){St(e,"pad");var i=n.map((function(v,m){return v[0]+e.shape[m]+v[1]})),o=n.map((function(v){return v[0]})),u=this.bufferSync(e),l=ee(i,e.dtype);a!==0&&l.values.fill(a);for(var h=0;h<e.size;h++){var f=u.indexToLoc(h),p=f.map((function(v,m){return v+o[m]}));l.set.apply(l,[u.get.apply(u,f)].concat(p))}return l.toTensor()},t.prototype.gather=function(e,n,a){St([e,n],"gather");var i=e.shape.slice(),o=this.readSync(n.dataId);i[a]=o.length;for(var u=ee(i,e.dtype),l=this.bufferSync(e),h=0;h<u.size;++h){var f=u.indexToLoc(h),p=f.slice();p[a]=o[f[a]];var v=l.locToIndex(p);u.values[h]=l.values[v]}return u.toTensor()},t.prototype.batchToSpaceND=function(e,n,a){St([e],"batchToSpaceND");var i=n.reduce((function(p,v){return p*v})),o=hd(e.shape,n,i),u=fd(o.length,n.length),l=dd(e.shape,n,i),h=BS(a,n.length),f=PS(l,a,n.length);return Ma(e.reshape(o),u).reshape(l).slice(h,f)},t.prototype.spaceToBatchND=function(e,n,a){St([e],"spaceToBatchND");var i=n.reduce((function(v,m){return v*m})),o=[[0,0]];o.push.apply(o,a);for(var u=1+n.length;u<e.shape.length;++u)o.push([0,0]);var l=e.pad(o),h=hd(l.shape,n,i,!1),f=fd(h.length,n.length,!1),p=dd(l.shape,n,i,!1);return Ma(l.reshape(h),f).reshape(p)},t.prototype.maxPool=function(e,n){return St(e,"maxPool"),Ag(this.readSync(e.dataId),e.shape,e.dtype,e.strides,n,"max").toTensor()},t.prototype.maxPoolBackprop=function(e,n,a,i){St([n,a],"maxPoolBackprop");for(var o=this.readSync(n.dataId),u=ee(i.outShape,n.dtype,ZR(o,n.shape,n.dtype,i).values),l=i.strideHeight,h=i.strideWidth,f=i.dilationHeight,p=i.dilationWidth,v=i.effectiveFilterHeight,m=i.effectiveFilterWidth,x=m-1-i.padInfo.left,b=v-1-i.padInfo.top,E=ee(n.shape,"float32"),C=this.bufferSync(e),R=0;R<i.batchSize;++R)for(var _=0;_<i.inChannels;++_)for(var A=0;A<i.inHeight;++A)for(var k=0;k<i.inWidth;++k){for(var D=A-b,P=k-x,M=0,O=0;O<v;O+=f){var F=(D+O)/l;if(!(F<0||F>=i.outHeight||Math.floor(F)!==F))for(var W=0;W<m;W+=p){var j=(P+W)/h;if(!(j<0||j>=i.outWidth||Math.floor(j)!==j)){var ot=v*m-1-u.get(R,F,j,_)===O*m+W?1:0;ot!==0&&(M+=C.get(R,F,j,_)*ot)}}}E.set(M,R,A,k,_)}return E.toTensor()},t.prototype.avgPoolBackprop=function(e,n,a){St([e,n],"avgPoolBackprop");for(var i=a.strideHeight,o=a.strideWidth,u=a.filterHeight,l=a.filterWidth,h=a.dilationHeight,f=a.dilationWidth,p=a.effectiveFilterHeight,v=a.effectiveFilterWidth,m=v-1-a.padInfo.left,x=p-1-a.padInfo.top,b=ee(n.shape,"float32"),E=1/(u*l),C=this.bufferSync(e),R=0;R<a.batchSize;++R)for(var _=0;_<a.inChannels;++_)for(var A=0;A<a.inHeight;++A)for(var k=0;k<a.inWidth;++k){for(var D=A-x,P=k-m,M=0,O=0;O<p;O+=h){var F=(D+O)/i;if(!(F<0||F>=a.outHeight||Math.floor(F)!==F))for(var W=0;W<v;W+=f){var j=(P+W)/o;j<0||j>=a.outWidth||Math.floor(j)!==j||(M+=C.get(R,F,j,_))}}b.set(M*E,R,A,k,_)}return b.toTensor()},t.prototype.pool3d=function(e,n,a){St(e,"pool3d");for(var i=n.strideDepth,o=n.strideHeight,u=n.strideWidth,l=n.dilationDepth,h=n.dilationHeight,f=n.dilationWidth,p=n.effectiveFilterDepth,v=n.effectiveFilterHeight,m=n.effectiveFilterWidth,x=n.padInfo.front,b=n.padInfo.top,E=n.padInfo.left,C=a==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,R=this.readSync(e.dataId),_=ee(n.outShape,e.dtype),A=_.values,k=n.outShape[1]*n.outShape[2]*n.outShape[3]*n.outShape[4],D=n.outShape[2]*n.outShape[3]*n.outShape[4],P=n.outShape[3]*n.outShape[4],M=n.outShape[4],O=0;O<n.batchSize;++O)for(var F=O*k,W=O*e.strides[0],j=0;j<n.inChannels;++j)for(var ot=0;ot<n.outDepth;++ot){for(var nt=ot*i-x,at=nt;at<0;)at+=l;for(var V=Math.min(n.inDepth,p+nt),X=F+ot*D,Q=0;Q<n.outHeight;++Q){for(var ut=Q*o-b,B=ut;B<0;)B+=h;for(var $=Math.min(n.inHeight,v+ut),ht=X+Q*P,ft=0;ft<n.outWidth;++ft){for(var xt=ft*u-E,wt=xt;wt<0;)wt+=f;for(var Rt=Math.min(n.inWidth,m+xt),Dt=ht+ft*M,_t=C,Pt=0,jt=0,Ft=at;Ft<V;Ft+=l){for(var Wt=W+Ft*e.strides[1],Gt=B;Gt<$;Gt+=h){for(var $t=Wt+Gt*e.strides[2],ue=wt;ue<Rt;ue+=f){var de=R[$t+ue*e.strides[3]+j];if(a==="max"&&de>_t?_t=de:a==="avg"&&(Pt+=de,jt++),isNaN(_t))break}if(isNaN(_t))break}if(isNaN(_t))break}A[Dt+j]=a==="avg"?Pt/jt:_t}}}return _.toTensor()},t.prototype.avgPool3d=function(e,n){return St(e,"avgPool3d"),this.pool3d(e,n,"avg").toFloat()},t.prototype.avgPool3dBackprop=function(e,n,a){St([e,n],"avgPool3dBackprop");for(var i=a.strideDepth,o=a.strideHeight,u=a.strideWidth,l=a.filterDepth,h=a.filterHeight,f=a.filterWidth,p=a.dilationDepth,v=a.dilationHeight,m=a.dilationWidth,x=a.effectiveFilterDepth,b=a.effectiveFilterHeight,E=a.effectiveFilterWidth,C=x-1-a.padInfo.front,R=E-1-a.padInfo.left,_=b-1-a.padInfo.top,A=ee(n.shape,"float32"),k=1/(l*h*f),D=this.bufferSync(e),P=0;P<a.batchSize;++P)for(var M=0;M<a.inChannels;++M)for(var O=0;O<a.inDepth;++O)for(var F=0;F<a.inHeight;++F)for(var W=0;W<a.inWidth;++W){for(var j=O-C,ot=F-_,nt=W-R,at=0,V=0;V<x;V+=p){var X=(j+V)/i;if(!(X<0||X>=a.outDepth||Math.floor(X)!==X))for(var Q=0;Q<b;Q+=v){var ut=(ot+Q)/o;if(!(ut<0||ut>=a.outHeight||Math.floor(ut)!==ut))for(var B=0;B<E;B+=m){var $=(nt+B)/u;$<0||$>=a.outWidth||Math.floor($)!==$||(at+=D.get(P,X,ut,$,M))}}}A.set(at*k,P,O,F,W,M)}return A.toTensor()},t.prototype.maxPool3d=function(e,n){return St(e,"maxPool3d"),this.pool3d(e,n,"max").toFloat()},t.prototype.maxPool3dPositions=function(e,n){for(var a=ee(n.outShape,"int32"),i=n.strideDepth,o=n.strideHeight,u=n.strideWidth,l=n.dilationDepth,h=n.dilationHeight,f=n.dilationWidth,p=n.effectiveFilterDepth,v=n.effectiveFilterHeight,m=n.effectiveFilterWidth,x=n.padInfo.front,b=n.padInfo.top,E=n.padInfo.left,C=this.bufferSync(e),R=0;R<n.batchSize;++R)for(var _=0;_<n.inChannels;++_)for(var A=0;A<n.outDepth;++A){for(var k=A*i-x,D=k;D<0;)D+=l;for(var P=Math.min(n.inDepth,p+k),M=0;M<n.outHeight;++M){for(var O=M*o-b,F=O;F<0;)F+=h;for(var W=Math.min(n.inHeight,v+O),j=0;j<n.outWidth;++j){for(var ot=j*u-E,nt=ot;nt<0;)nt+=f;for(var at=Math.min(n.inWidth,m+ot),V=Number.NEGATIVE_INFINITY,X=-1,Q=D;Q<P;Q+=l)for(var ut=Q-k,B=F;B<W;B+=h)for(var $=B-O,ht=nt;ht<at;ht+=f){var ft=ht-ot,xt=C.get(R,Q,B,ht,_);xt>=V&&(V=xt,X=ut*v*m+$*v+ft)}a.set(X,R,A,M,j,_)}}}return a.toTensor()},t.prototype.maxPool3dBackprop=function(e,n,a,i){St([n,a],"maxPool3dBackprop");for(var o=this.maxPool3dPositions(n,i),u=i.strideDepth,l=i.strideHeight,h=i.strideWidth,f=i.dilationDepth,p=i.dilationHeight,v=i.dilationWidth,m=i.effectiveFilterDepth,x=i.effectiveFilterHeight,b=i.effectiveFilterWidth,E=m-1-i.padInfo.front,C=b-1-i.padInfo.left,R=x-1-i.padInfo.top,_=ee(n.shape,"float32"),A=this.bufferSync(o),k=this.bufferSync(e),D=0;D<i.batchSize;++D)for(var P=0;P<i.inChannels;++P)for(var M=0;M<i.inDepth;++M)for(var O=0;O<i.inHeight;++O)for(var F=0;F<i.inWidth;++F){for(var W=M-E,j=O-R,ot=F-C,nt=0,at=0;at<m;at+=f){var V=(W+at)/u;if(!(V<0||V>=i.outDepth||Math.floor(V)!==V))for(var X=0;X<x;X+=p){var Q=(j+X)/l;if(!(Q<0||Q>=i.outHeight||Math.floor(Q)!==Q))for(var ut=0;ut<b;ut+=v){var B=(ot+ut)/h;if(!(B<0||B>=i.outWidth||Math.floor(B)!==B)){var $=m*x*b-1-A.get(D,V,Q,B,P)===at*x*b+X*b+ut?1:0;$!==0&&(nt+=k.get(D,V,Q,B,P)*$)}}}}_.set(nt,D,M,O,F,P)}return _.toTensor()},t.prototype.cast=function(e,n){return JS(e,n,this)},t.prototype.reshape=function(e,n){return Rg(e,n)},t.prototype.avgPool=function(e,n){return St(e,"avgPool"),St(e,"maxPool"),Ag(this.readSync(e.dataId),e.shape,e.dtype,e.strides,n,"avg").toTensor().toFloat()},t.prototype.resizeBilinear=function(e,n,a,i){St(e,"resizeBilinear");for(var o=e.shape,u=o[0],l=o[1],h=o[2],f=o[3],p=this.readSync(e.dataId),v=new Float32Array(Ot([u,n,a,f])),m=[i&&n>1?l-1:l,i&&a>1?h-1:h],x=[i&&n>1?n-1:n,i&&a>1?a-1:a],b=0,E=m[0]/x[0],C=m[1]/x[1],R=0;R<u;R++)for(var _=0;_<n;_++)for(var A=E*_,k=Math.floor(A),D=A-k,P=Math.min(l-1,Math.ceil(A)),M=R*e.strides[0]+k*e.strides[1],O=R*e.strides[0]+P*e.strides[1],F=0;F<a;F++)for(var W=C*F,j=Math.floor(W),ot=W-j,nt=Math.min(h-1,Math.ceil(W)),at=M+j*e.strides[2],V=O+j*e.strides[2],X=M+nt*e.strides[2],Q=O+nt*e.strides[2],ut=0;ut<f;ut++){var B=p[at+ut],$=p[V+ut],ht=B+(p[X+ut]-B)*ot,ft=ht+($+(p[Q+ut]-$)*ot-ht)*D;v[b++]=ft}return Qn(v,[u,n,a,f])},t.prototype.resizeBilinearBackprop=function(e,n,a){St([e,n],"resizeBilinearBackprop");for(var i=n.shape,o=i[0],u=i[1],l=i[2],h=i[3],f=e.shape,p=f[1],v=f[2],m=new Float32Array(o*u*l*h),x=[a&&p>1?u-1:u,a&&v>1?l-1:l],b=[a&&p>1?p-1:p,a&&v>1?v-1:v],E=x[0]/b[0],C=x[1]/b[1],R=this.readSync(e.dataId),_=0,A=0;A<o;A++)for(var k=A*n.strides[0],D=0;D<p;D++)for(var P=D*E,M=Math.floor(P),O=Math.min(Math.ceil(P),u-1),F=k+M*n.strides[1],W=k+O*n.strides[1],j=P-M,ot=1-j,nt=0;nt<v;nt++)for(var at=nt*C,V=Math.floor(at),X=Math.min(Math.ceil(at),l-1),Q=at-V,ut=1-Q,B=F+V*n.strides[2],$=F+X*n.strides[2],ht=W+V*n.strides[2],ft=W+X*n.strides[2],xt=ot*ut,wt=ot*Q,Rt=j*ut,Dt=j*Q,_t=0;_t<h;_t++){var Pt=R[_++];m[B+_t]+=Pt*xt,m[$+_t]+=Pt*wt,m[ht+_t]+=Pt*Rt,m[ft+_t]+=Pt*Dt}return si(m,[o,l,u,h],n.dtype)},t.prototype.resizeNearestNeighbor=function(e,n,a,i){St(e,"resizeNearestNeighbor");for(var o=e.shape,u=o[0],l=o[1],h=o[2],f=o[3],p=this.readSync(e.dataId),v=new Float32Array(u*n*a*f),m=[i&&n>1?l-1:l,i&&a>1?h-1:h],x=[i&&n>1?n-1:n,i&&a>1?a-1:a],b=m[0]/x[0],E=m[1]/x[1],C=0,R=0;R<u;R++)for(var _=R*e.strides[0],A=0;A<n;A++)for(var k=b*A,D=_+Math.min(l-1,i?Math.round(k):Math.floor(k))*e.strides[1],P=0;P<a;P++)for(var M=E*P,O=D+Math.min(h-1,i?Math.round(M):Math.floor(M))*e.strides[2],F=0;F<f;F++){var W=p[O+F];v[C++]=W}return Qn(v,[u,n,a,f],e.dtype)},t.prototype.resizeNearestNeighborBackprop=function(e,n,a){St([e,n],"resizeNearestNeighborBackprop");for(var i=n.shape,o=i[0],u=i[1],l=i[2],h=i[3],f=e.shape,p=f[1],v=f[2],m=new Float32Array(o*u*l*h),x=this.readSync(e.dataId),b=[a&&p>1?u-1:u,a&&v>1?l-1:l],E=[a&&p>1?p-1:p,a&&v>1?v-1:v],C=b[0]/E[0],R=b[1]/E[1],_=1/C,A=1/R,k=2*Math.ceil(_)+2,D=2*Math.ceil(A)+2,P=0;P<o;P++)for(var M=P*n.strides[0],O=0;O<u;O++)for(var F=M+O*n.strides[1],W=Math.floor(O*_),j=Math.floor(W-k/2),ot=0;ot<l;ot++)for(var nt=F+ot*n.strides[2],at=Math.floor(ot*A),V=Math.floor(at-D/2),X=0;X<h;X++){for(var Q=0,ut=0;ut<k;ut++){var B=ut+j;if(!(B<0||B>=p)){var $=M+B*e.strides[1],ht=B*C;if(O===Math.min(u-1,a?Math.round(ht):Math.floor(ht)))for(var ft=0;ft<D;ft++){var xt=ft+V;if(!(xt<0||xt>=v)){var wt=$+xt*e.strides[2],Rt=xt*R;ot===Math.min(l-1,a?Math.round(Rt):Math.floor(Rt))&&(Q+=x[wt+X])}}}}m[nt+X]=Q}return si(m,n.shape,n.dtype)},t.prototype.batchNormalization=function(e,n,a,i,o,u){St([e,n,a,o,u],"batchNorm");for(var l=this.readSync(e.dataId),h=this.readSync(n.dataId),f=this.readSync(a.dataId),p=o?this.readSync(o.dataId):new Float32Array([1]),v=u?this.readSync(u.dataId):new Float32Array([0]),m=new Float32Array(l.length),x=v.length,b=p.length,E=f.length,C=h.length,R=0,_=0,A=0,k=0,D=0;D<l.length;++D)m[D]=v[R++]+(l[D]-h[_++])*p[A++]/Math.sqrt(f[k++]+i),R>=x&&(R=0),_>=C&&(_=0),A>=b&&(A=0),k>=E&&(k=0);return si(m,e.shape)},t.prototype.localResponseNormalization4D=function(e,n,a,i,o){St(e,"localResponseNormalization4D");var u=e.shape[3],l=u-1,h=this.readSync(e.dataId),f=e.size,p=new Float32Array(f);function v(E){for(var C=E%u,R=E-C+Math.max(0,C-n),_=E-C+Math.min(C+n,l),A=0;R<=_;R++){var k=h[R];A+=k*k}return A}for(var m=0;m<f;m++){var x=v(m),b=h[m]*Math.pow(a+i*x,-o);p[m]=b}return si(p,e.shape)},t.prototype.LRNGrad=function(e,n,a,i,o,u,l){St(e,"LRNGrad");for(var h=e.shape[3],f=this.readSync(e.dataId),p=this.readSync(n.dataId),v=this.readSync(a.dataId),m=new Float32Array(e.size),x=e.size,b=0;b<x;b++){for(var E=b%h,C=b-E+Math.max(0,E-i),R=b-E+Math.min(h,E+i+1),_=0,A=C;A<R;A++)_+=Math.pow(p[A],2);for(_=u*_+o,A=C;A<R;A++){var k=-2*u*l*p[A]*v[b]/_;b===A&&(k+=Math.pow(_,-l)),k*=f[b],m[A]+=k}}return si(m,e.shape)},t.prototype.multinomial=function(e,n,a,i){St(e,"multinomial");for(var o=n?e:Bd(e),u=o.shape[0],l=o.shape[1],h=sn([u,a],"int32"),f=this.readSync(h.dataId),p=this.readSync(o.dataId),v=0;v<u;++v){var m=v*l,x=new Float32Array(l-1);x[0]=p[m];for(var b=1;b<x.length;++b)x[b]=x[b-1]+p[m+b];for(var E=Pd(i.toString()),C=v*a,R=0;R<a;++R){var _=E();f[C+R]=x.length;for(var A=0;A<x.length;A++)if(_<x[A]){f[C+R]=A;break}}}return h},t.prototype.oneHot=function(e,n,a,i){St(e,"oneHot");var o=new Float32Array(e.size*n);o.fill(i);for(var u=this.readSync(e.dataId),l=0;l<e.size;++l)u[l]>=0&&u[l]<n&&(o[l*n+u[l]]=a);return Mu(o,[e.size,n],"int32")},t.prototype.nonMaxSuppression=function(e,n,a,i,o){return St(e,"nonMaxSuppression"),sy(this.readSync(e.dataId),this.readSync(n.dataId),a,i,o)},t.prototype.fft=function(e){return this.fftBatch(e,!1)},t.prototype.ifft=function(e){return this.fftBatch(e,!0)},t.prototype.fftBatch=function(e,n){for(var a=e.shape[0],i=e.shape[1],o=ee(e.shape,"float32"),u=ee(e.shape,"float32"),l=va(e).as2D(a,i),h=ci(e).as2D(a,i),f=0;f<a;f++)for(var p=l.slice([f,0],[1,i]),v=h.slice([f,0],[1,i]),m=Kn(p,v),x=this.readSync(this.fftImpl(m,n).dataId),b=0;b<i;b++){var E=Ow(x,b);o.values[f*i+b]=E.real,u.values[f*i+b]=E.imag}return Kn(o.toTensor(),u.toTensor()).as2D(a,i)},t.prototype.fftImpl=function(e,n){var a=e.as1D(),i=a.size;if(this.isExponentOf2(i)){var o=this.fftRadix2(a,i,n).as2D(e.shape[0],e.shape[1]);return n&&(o=Kn(va(o).div(Ut(i)),ci(o).div(Ut(i)))),o}var u=this.readSync(e.dataId),l=(function(h){for(var f=new Float32Array(h.length/2),p=new Float32Array(h.length/2),v=0;v<h.length;v+=2)f[v/2]=h[v],p[v/2]=h[v+1];return{real:f,imag:p}})(this.fourierTransformByMatmul(u,i,n));return Kn(l.real,l.imag).as2D(e.shape[0],e.shape[1])},t.prototype.isExponentOf2=function(e){return(e&e-1)==0},t.prototype.fftRadix2=function(e,n,a){if(n===1)return e;var i=this.readSync(e.dataId),o=n/2,u=(function(C){for(var R=Math.ceil(C.length/4),_=new Float32Array(R),A=new Float32Array(R),k=0;k<C.length;k+=4)_[Math.floor(k/4)]=C[k],A[Math.floor(k/4)]=C[k+1];return{real:_,imag:A}})(i),l=Kn(u.real,u.imag).as1D(),h=(function(C){for(var R=Math.floor(C.length/4),_=new Float32Array(R),A=new Float32Array(R),k=2;k<C.length;k+=4)_[Math.floor(k/4)]=C[k],A[Math.floor(k/4)]=C[k+1];return{real:_,imag:A}})(i),f=Kn(h.real,h.imag).as1D();l=this.fftRadix2(l,o,a),f=this.fftRadix2(f,o,a);var p=(function(C,R){for(var _=new Float32Array(C/2),A=new Float32Array(C/2),k=0;k<Math.ceil(C/2);k++){var D=(R?2:-2)*Math.PI*(k/C);_[k]=Math.cos(D),A[k]=Math.sin(D)}return{real:_,imag:A}})(n,a),v=Kn(p.real,p.imag).mul(f),m=l.add(v),x=l.sub(v),b=va(m).concat(va(x)),E=ci(m).concat(ci(x));return Kn(b,E).as1D()},t.prototype.fourierTransformByMatmul=function(e,n,a){for(var i=new Float32Array(2*n),o=0;o<n;o++){for(var u=0,l=0,h=0;h<n;h++){var f=lV(o*h,n,a),p=Ow(e,h);u+=p.real*f.real-p.imag*f.imag,l+=p.real*f.imag+p.imag*f.real}a&&(u/=n,l/=n),sV(i,u,l,o)}return i},t.prototype.depthToSpace=function(e,n,a){G(a==="NHWC",(function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+a})),G(n>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: "+n}));for(var i=e.shape[0],o=e.shape[1],u=e.shape[2],l=e.shape[3],h=o*n,f=u*n,p=l/(n*n),v=this.readSync(e.dataId),m=new Float32Array(i*h*f*p),x=0,b=0;b<i;++b)for(var E=0;E<h;++E)for(var C=Math.floor(E/n),R=E%n,_=0;_<f;++_)for(var A=Math.floor(_/n),k=(R*n+_%n)*p,D=0;D<p;++D){var P=D+k+l*(A+u*(C+o*b));m[x++]=v[P]}return si(m,[i,h,f,p])},t.prototype.broadcastedBinaryOp=function(e,n,a,i){var o=he(e.shape,n.shape),u=ee(o,a),l=this.readSync(e.dataId),h=this.readSync(n.dataId),f=Go(e.shape,o),p=Go(n.shape,o),v=u.values;if(f.length+p.length===0)for(var m=0;m<v.length;++m)v[m]=i(l[m%l.length],h[m%h.length]);else{var x=this.bufferSync(e),b=this.bufferSync(n),E=function(C){var R=u.indexToLoc(C),_=R.slice(-e.rank);f.forEach((function(P){return _[P]=0}));var A=x.locToIndex(_),k=R.slice(-n.rank);p.forEach((function(P){return k[P]=0}));var D=b.locToIndex(k);v[C]=i(l[A],h[D])};for(m=0;m<v.length;++m)E(m)}return u.toTensor()},t.prototype.broadcastedBinaryComplexOp=function(e,n,a){var i=he(e.shape,n.shape),o=ee(i,"float32"),u=ee(i,"float32"),l=this.readSync(e.dataId),h=this.readSync(n.dataId),f=Go(e.shape,i),p=Go(n.shape,i),v=o.values,m=u.values;if(f.length+p.length===0)for(var x=0;x<v.length;x++){var b=x%l.length,E=x%h.length,C=a(l[2*b],l[2*b+1],h[2*E],h[2*E+1]);v[x]=C.real,m[x]=C.imag}else{var R=this.bufferSync(this.data.get(e.dataId).complexTensors.real),_=this.bufferSync(this.data.get(n.dataId).complexTensors.real),A=function(k){var D=o.indexToLoc(k),P=D.slice(-e.rank);f.forEach((function(j){return P[j]=0}));var M=R.locToIndex(P),O=D.slice(-n.rank);p.forEach((function(j){return O[j]=0}));var F=_.locToIndex(O),W=a(l[2*M],l[2*M+1],h[2*F],h[2*F+1]);v[k]=W.real,m[k]=W.imag};for(x=0;x<v.length;x++)A(x)}return this.complex(o.toTensor(),u.toTensor())},t.prototype.split=function(e,n,a){return nR(e,n,a)},t.prototype.dispose=function(){},t.prototype.floatPrecision=function(){return 32},t.prototype.epsilon=function(){return 1e-7},t.prototype.cropAndResize=function(e,n,a,i,o,u){for(var l=e.shape,h=l[0],f=l[1],p=l[2],v=l[3],m=n.shape[0],x=i[0],b=i[1],E=ee([m,x,b,v],"float32"),C=this.readSync(n.dataId),R=this.readSync(a.dataId),_=this.readSync(e.dataId),A=e.strides,k=E.strides,D=0;D<m;D++){var P=4*D,M=C[P],O=C[P+1],F=C[P+2],W=C[P+3],j=R[D];if(!(j>=h))for(var ot=x>1?(F-M)*(f-1)/(x-1):0,nt=b>1?(W-O)*(p-1)/(b-1):0,at=0;at<x;at++){var V=x>1?M*(f-1)+at*ot:.5*(M+F)*(f-1);if(V<0||V>f-1)for(var X=0;X<b;X++)for(var Q=0;Q<v;Q++){var ut=Q+X*k[2]+at*k[1]+D*k[0];E.values[ut]=u}else if(o==="bilinear"){var B=Math.floor(V),$=Math.ceil(V),ht=V-B;for(X=0;X<b;X++)if((Ft=b>1?O*(p-1)+X*nt:.5*(O+W)*(p-1))<0||Ft>p-1)for(Q=0;Q<v;Q++)ut=Q+X*k[2]+at*k[1]+D*k[0],E.values[ut]=u;else{var ft=Math.floor(Ft),xt=Math.ceil(Ft),wt=Ft-ft;for(Q=0;Q<v;Q++){var Rt=_[ut=Q+ft*A[2]+B*A[1]+j*A[0]],Dt=_[ut=Q+xt*A[2]+B*A[1]+j*A[0]],_t=_[ut=Q+ft*A[2]+$*A[1]+j*A[0]],Pt=Rt+(Dt-Rt)*wt,jt=_t+(_[ut=Q+xt*A[2]+$*A[1]+j*A[0]]-_t)*wt;ut=Q+X*k[2]+at*k[1]+D*k[0],E.values[ut]=Pt+(jt-Pt)*ht}}}else for(X=0;X<b;++X){var Ft;if((Ft=b>1?O*(p-1)+X*nt:.5*(O+W)*(p-1))<0||Ft>p-1)for(Q=0;Q<v;Q++)ut=Q+X*k[2]+at*k[1]+D*k[0],E.values[ut]=u;else{var Wt=Math.round(Ft),Gt=Math.round(V);for(Q=0;Q<v;Q++){var $t=Q+Wt*A[2]+Gt*A[1]+j*A[0],ue=Q+X*k[2]+at*k[1]+D*k[0];E.values[ue]=_[$t]}}}}}return E.toTensor()},t.prototype.sparseToDense=function(e,n,a,i){var o=vd(0,e,a),u=o.sliceRank,l=o.numUpdates,h=o.sliceSize,f=o.strides,p=o.outputSize;return this.scatter(e,n,a,p,h,l,u,f,i,!1)},t.prototype.gatherND=function(e,n){var a=n.shape,i=a[a.length-1],o=jS(e,n),u=o[0],l=o[1],h=o[2],f=o[3];if(l===0)return Qn([],u,e.dtype);for(var p=new Nc([l,h],e.dtype),v=this.readSync(n.dataId),m=this.readSync(e.dataId),x=0;x<l;x++){for(var b=[],E=0,C=0;C<i;C++){var R=v[x*i+C];E+=R*f[C],b.push(R)}if(E<0||E>=e.size/h)throw new Error("Invalid indices: "+b+" does not index into "+e.shape);for(var _=0;_<h;_++)p.values[x*h+_]=m[E*h+_]}return p.toTensor().reshape(u)},t.prototype.scatterND=function(e,n,a){var i=vd(0,e,a),o=i.sliceRank,u=i.numUpdates,l=i.sliceSize,h=i.strides,f=i.outputSize,p=Ut(0);return this.scatter(e,n,a,f,l,u,o,h,p,!0)},t.prototype.fill=function(e,n,a){var i=ad(a=a||th(n),Ot(e));return i.fill(n),rt.makeTensor(i,e,a,this)},t.prototype.onesLike=function(e){if(e.dtype==="string")throw new Error("onesLike is not supported for string tensors");return this.fill(e.shape,1,e.dtype)},t.prototype.zerosLike=function(e){var n=ad(e.dtype,Ot(e.shape));return this.makeOutput(n,e.shape,e.dtype)},t.prototype.linspace=function(e,n,a){return tR(e,n,a)},t.prototype.scatter=function(e,n,a,i,o,u,l,h,f,p){var v=[i/o,o],m=this.readSync(e.dataId),x=this.readSync(n.dataId);if(i===0)return Qn([],a,n.dtype);var b=new Nc(v,n.dtype);b.values.fill(this.readSync(f.dataId)[0]);for(var E=0;E<u;E++){for(var C=[],R=0,_=0;_<l;_++){var A=m[E*l+_];C.push(A),R+=A*h[_]}if(R<0||R>=i/o)throw new Error("Invalid indices: "+C+" does not index into "+a);for(var k=0;k<o;k++)p?b.values[R*o+k]+=x[E*o+k]:b.values[R*o+k]=n.rank===0?x[0]:x[E*o+k]}return b.toTensor().reshape(a)},t})(ZS);function $R(r,t){return{kernelName:r,backendName:"cpu",kernelFunc:function(e){var n=e.inputs,a=e.backend,i=n,o=i.a,u=i.b,l=a;St([o,u],r);var h=l.data.get(o.dataId).values,f=l.data.get(u.dataId).values,p=t(o.shape,u.shape,h,f,o.dtype),v=p[0],m=p[1];return{dataId:l.write(v,m,o.dtype),shape:m,dtype:o.dtype}}}}function JR(r){return function(t,e,n,a,i){var o=he(t,e),u=o.length,l=$r(o),h=ll(i,Ot(o)),f=t.length,p=e.length,v=$r(t),m=$r(e),x=Go(t,o),b=Go(e,o);if(x.length+b.length===0)for(var E=0;E<h.length;++E)h[E]=r(n[E%n.length],a[E%a.length]);else{var C=function(R){var _=CS(R,u,l),A=_.slice(-f);x.forEach((function(M){return A[M]=0}));var k=yg(A,f,v),D=_.slice(-p);b.forEach((function(M){return D[M]=0}));var P=yg(D,p,m);h[R]=r(n[k],a[P])};for(E=0;E<h.length;++E)C(E)}return[h,o]}}rt.registerBackend("cpu",(function(){return new lH}),1);var cH=JR((function(r,t){return r/t})),hH=$R(Nd,cH),fH={kernelName:"MaxPoolWithArgmax",backendName:"cpu",kernelFunc:function(r){var t=r.inputs,e=r.attrs,n=r.backend,a=t.x,i=e,o=i.filterSize,u=i.strides,l=i.pad,h=i.includeBatchInIndex,f=n;St(a,"MaxPoolWithArgmax");var p=f.data.get(a.dataId).values,v=Uu(a.shape,o,u,[1,1],l),m=(function(R,_,A,k,D){var P=Ag(R,0,A,$r(_),D,"max"),M=ZR(R,_,A,D,!0,k);return[P.values,M.values]})(p,a.shape,a.dtype,h,v),x=m[0],b=m[1],E=f.write(x,v.outShape,a.dtype),C=f.write(b,v.outShape,a.dtype);return[{dataId:E,shape:v.outShape,dtype:a.dtype},{dataId:C,shape:v.outShape,dtype:"int32"}]}},dH={kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(r){var t=r.inputs,e=r.backend,n=r.attrs,a=t,i=a.boxes,o=a.scores,u=n,l=u.maxOutputSize,h=u.iouThreshold,f=u.scoreThreshold,p=u.softNmsSigma,v=e;St(i,"NonMaxSuppressionWithScore");var m=ly(v.data.get(i.dataId).values,v.data.get(o.dataId).values,l,h,f,p);return[m.selectedIndices,m.selectedScores]}},pH={kernelName:"Square",backendName:"cpu",kernelFunc:function(r){var t=r.inputs,e=r.backend,n=t.x,a=e;St(n,"square");for(var i=a.data.get(n.dataId).values,o=new Float32Array(i.length),u=0;u<i.length;++u){var l=i[u];o[u]=l*l}return{dataId:a.write(o,n.shape,n.dtype),shape:n.shape,dtype:n.dtype}}},vH=JR((function(r,t){var e=r-t;return e*e}));function t_(r,t,e,n,a){for(var i=Ot(t),o=t.length,u=$r(t),l=$r(a),h=ll(e,Ot(a)),f=0;f<i;++f){for(var p=CS(f,o,u),v=new Array(p.length),m=0;m<v.length;m++)v[m]=p[n[m]];h[yg(v,o,l)]=r[f]}return h}for(var Pm=0,eE=[dH,pH,$R(Od,vH),hH,{kernelName:"Transpose",backendName:"cpu",kernelFunc:function(r){var t=r.inputs,e=r.attrs,n=r.backend,a=t.x,i=e.perm,o=n;St(a,"transpose");for(var u=a.shape.length,l=new Array(u),h=0;h<l.length;h++)l[h]=a.shape[i[h]];var f=t_(o.data.get(a.dataId).values,a.shape,a.dtype,i,l);return{dataId:o.write(f,l,a.dtype),shape:l,dtype:a.dtype}}},fH];Pm<eE.length;Pm++)mS(eE[Pm]);var Bs,mH=function(r){this.variableNames=["A"];var t=ar(),e=r[0],n=r[1];this.outputShape=r,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+n+".0, "+e+`.0);

        vec4 values = `+t.texture2D+`(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `},gH=function(r){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var t=ar(),e=r[0],n=r[1];this.outputShape=r,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(`+n+".0, "+e+`.0);
            vec4 values = `+t.texture2D+`(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        `+t.output+` = result;
      }
    `},yH=function(r,t){this.variableNames=["A"];for(var e=new Array(r.length),n=0;n<e.length;n++)e[n]=r[t[n]];this.outputShape=e,this.rank=e.length;var a=We(this.rank),i=(function(o){var u=o.length;if(u>6)throw Error("Transpose for rank "+u+" is not yet supported");for(var l=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],h=new Array(u),f=0;f<o.length;f++)h[o[f]]=l[f];return h.join()})(t);this.userCode=`
    void main() {
      `+a+` resRC = getOutputCoords();
      setOutput(getA(`+i+`));
    }
    `},xH=function(r,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var e=new Array(r.length),n=0;n<e.length;n++)e[n]=r[t[n]];if(this.outputShape=e,this.rank=e.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var a=We(this.rank),i=iR("rc",this.rank),o=new Array(this.rank);for(n=0;n<t.length;n++)o[t[n]]=i[n];var u="vec2("+o.slice(-2).join()+")",l="++"+i[this.rank-1]+" < "+e[this.rank-1],h="getChannel(getA("+o.join()+"), "+u+")";this.userCode=`
    void main() {
      `+a+` rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = `+h+`;
      if(`+l+`) {
        result[1] = `+h+`;
      }
      --`+i[this.rank-1]+`;
      if(++`+i[this.rank-2]+" < "+e[this.rank-2]+`) {
        result[2] = `+h+`;
        if(`+l+`) {
          result[3] = `+h+`;
        }
      }
      setOutput(result);
    }
    `};for(var Fm=0,nE=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(r){var t=r.inputs,e=r.backend,n=r.attrs,a=t.pixels,i=n.numChannels,o=typeof HTMLVideoElement<"u"&&a instanceof HTMLVideoElement,u=typeof HTMLImageElement<"u"&&a instanceof HTMLImageElement,l=o?[a.videoWidth,a.videoHeight]:[a.width,a.height],h=l[0],f=l[1],p=[f,h],v=[f,h,i];(u||o)&&(Bs==null&&(Bs=document.createElement("canvas").getContext("2d")),Bs.canvas.width=h,Bs.canvas.height=f,Bs.drawImage(a,0,0,h,f),a=Bs.canvas);var m=e.makeTensorInfo(p,"int32");e.texData.get(m.dataId).usage=Kr.PIXELS,e.gpgpu.uploadPixelDataToTexture(e.getTexture(m.dataId),a);var x=yt().getBool("WEBGL_PACK")?new gH(v):new mH(v),b=e.runWebGLProgram(x,[m],"int32");return e.disposeData(m.dataId),b}},{kernelName:Nd,backendName:"webgl",kernelFunc:function(r){var t=r.inputs,e=r.backend,n=t;return(function(a,i,o){var u=new on(kV,a.shape,i.shape);return yt().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&(u=new ii(DV,a.shape,i.shape,!0)),o.runWebGLProgram(u,[a,i],"float32")})(n.a,n.b,e)}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(r){var t=r.inputs,e=r.backend,n=r.attrs;sd("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var a=t,i=a.boxes,o=a.scores,u=n,l=u.maxOutputSize,h=u.iouThreshold,f=u.scoreThreshold,p=u.softNmsSigma,v=e,m=ly(v.readSync(i.dataId),v.readSync(o.dataId),l,h,f,p);return[m.selectedIndices,m.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(r){var t=r.inputs,e=r.backend,n=t.x,a=e,i=new re(n.shape,"return x * x;");return a.runWebGLProgram(i,[n],n.dtype)}},{kernelName:Od,backendName:"webgl",kernelFunc:function(r){var t=r.inputs,e=r.backend,n=t,a=n.a,i=n.b,o=e,u=yt().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ii("return (a - b) * (a - b);",a.shape,i.shape):new on("return (a - b) * (a - b);",a.shape,i.shape);return o.compileAndRun(u,[a,i])}},{kernelName:"Transpose",backendName:"webgl",kernelFunc:function(r){for(var t,e=r.inputs,n=r.attrs,a=r.backend,i=e.x,o=n.perm,u=a,l=i.shape.length,h=new Array(l),f=0;f<h.length;f++)h[f]=i.shape[o[f]];if(u.shouldExecuteOnCPU([i])){var p=t_(u.texData.get(i.dataId).values,i.shape,i.dtype,o,h);t=u.makeTensorInfo(h,i.dtype),u.texData.get(t.dataId).values=p}else t=(function(v,m,x){var b=yt().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new xH(v.shape,m):new yH(v.shape,m);return x.runWebGLProgram(b,[v],v.dtype)})(i,o,u);return t}},{kernelName:"MaxPoolWithArgmax",backendName:"webgl",kernelFunc:function(r){var t=r.inputs,e=r.attrs,n=r.backend,a=t.x,i=e,o=i.filterSize,u=i.strides,l=i.pad,h=i.includeBatchInIndex,f=n;G(a.shape.length===4,(function(){return"Error in maxPool: input must be rank 4 but got rank "+a.shape.length+"."}));var p=[1,1];G(vr(u,p),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+u+" and dilations '"+p+"'"}));var v=Uu(a.shape,o,u,p,l),m=(function(x,b,E,C){var R=new kc(E,"max",!1),_=C.runWebGLProgram(R,[x],"float32");return R=new kc(E,"max",!0,!0,b),[_,C.runWebGLProgram(R,[x],"float32")]})(a,h,v,f);return[m[0],m[1]]}}];Fm<nE.length;Fm++)mS(nE[Fm]);for(var Lm=0,rE=[{kernelName:FS,inputsToSave:["a","b"],gradFunc:function(r,t){var e=t[0],n=t[1],a=he(e.shape,n.shape);return{a:function(){var i=r,o=Tn(e.shape,a);return o.length>0&&(i=i.sum(o)),i.reshape(e.shape)},b:function(){var i=r,o=Tn(n.shape,a);return o.length>0&&(i=i.sum(o)),i.reshape(n.shape)}}}},{kernelName:"AddN",saveAllInputs:!0,gradFunc:function(r,t){var e={};return t.forEach((function(n,a){e[a]=function(){return r.clone()}})),e}},{kernelName:LS,gradFunc:function(r,t,e){for(var n=e,a=n.inputShape,i=n.shape,o=Array.from(i),u=a.length-1;u>=0;u--)if(a[u]===i[u])o[u]=1;else if(a[u]!==1)throw new Error("broadcastTo(): ["+a+"] cannot be broadcast to ["+i+"].");var l=[];for(u=0;u<o.length;u++)o[u]>1&&l.push(u);return{x:function(){return r.sum(l,!0)}}}},{kernelName:Nd,inputsToSave:["a","b"],gradFunc:function(r,t){var e=t[0],n=t[1],a=he(e.shape,n.shape);return{a:function(){var i=Qo(r,n.toFloat()),o=Tn(e.shape,a);return o.length>0?Uo(i,o).reshape(e.shape):i},b:function(){var i=r.mul(e.toFloat()),o=Tn(n.shape,a);o.length>0&&(i=Uo(i,o).reshape(n.shape));var u=AR(n);return ay(Qo(i,u.toFloat()))}}}},{kernelName:"FusedBatchNorm",inputsToSave:["x","mean","variance","scale"],gradFunc:function(r,t,e){var n=e.varianceEpsilon,a=t[0],i=t[1],o=t[2],u=t[3],l=mR(a),h=u??Ut(1),f=Tn(i.shape,l.shape),p=[];if(i.rank===1){for(var v=0;v<l.shape.length-1;++v)p.push(l.shape[v]);p.push(1)}var m=Fa(a,i),x=un(r,h),b=GS(Ea(o,Ut(n))),E=un(un(un(b,b),b),Ut(-.5));return{x:function(){return i.rank===1?Xi(un(un(r,Zs(b.as4D(1,1,1,i.shape[0]),p)),h),a.shape):Xi(un(un(r,b),h),a.shape)},mean:function(){var C=un(un(b,Ut(-1)),x);return i.rank===1&&(C=Uo(C,f)),Xi(C,i.shape)},variance:function(){var C=un(un(E,m),x);return i.rank===1&&(C=Uo(C,f)),Xi(C,i.shape)},scale:function(){var C=un(m,b),R=un(r,C);return i.rank===1&&(R=Uo(R,f)),Xi(R,i.shape)},offset:function(){var C=r;return i.rank===1&&(C=Uo(C,f)),Xi(C,i.shape)}}}},{kernelName:US,gradFunc:function(r){return{x:function(){return r.toFloat()}}}},{kernelName:zS,inputsToSave:["indices"],gradFunc:function(r,t){var e=t[0];return{indices:function(){return sn(e.shape,"float32")}}}},{kernelName:VS,inputsToSave:["x"],gradFunc:function(r,t,e){var n=t[0],a=e.paddings.map((function(i){return i[0]}));return{x:function(){return r.slice(a,n.shape)}}}},{kernelName:"Square",inputsToSave:["x"],gradFunc:function(r,t){var e=t[0];return{x:function(){return r.mul(e.toFloat().mul(2))}}}},{kernelName:Od,inputsToSave:["a","b"],gradFunc:function(r,t){var e=t[0],n=t[1],a=Ut(2);return{a:function(){return un(r,un(a,Fa(e,n)))},b:function(){return un(r,un(a,Fa(n,e)))}}}},{kernelName:WS,inputsToSave:["x"],gradFunc:function(r,t,e){var n=t[0],a=e.reps;return{x:function(){var i=me(n);if(n.rank===1)for(var o=0;o<a[0];++o)i=i.add(r.slice([o*n.shape[0]],[n.shape[0]]));else if(n.rank===2)for(o=0;o<a[0];++o)for(var u=0;u<a[1];++u)i=i.add(r.slice([o*n.shape[0],u*n.shape[1]],[n.shape[0],n.shape[1]]));else if(n.rank===3)for(o=0;o<a[0];++o)for(u=0;u<a[1];++u)for(var l=0;l<a[2];++l)i=i.add(r.slice([o*n.shape[0],u*n.shape[1],l*n.shape[2]],[n.shape[0],n.shape[1],n.shape[2]]));else{if(n.rank!==4)throw new Error("Gradient for tile operation is not implemented for rank-"+n.rank+" tensors yet.");for(o=0;o<a[0];++o)for(u=0;u<a[1];++u)for(l=0;l<a[2];++l)for(var h=0;h<a[3];++h)i=i.add(r.slice([o*n.shape[0],u*n.shape[1],l*n.shape[2],h*n.shape[3]],[n.shape[0],n.shape[1],n.shape[2],n.shape[3]]))}return i}}}},{kernelName:"Transpose",gradFunc:function(r,t,e){var n=ny(e.perm);return{x:function(){return Ma(r,n)}}}}];Lm<rE.length;Lm++)i3(rE[Lm]);var bH=(function(){function r(){}return r.prototype.fetch=function(t,e){return fetch(t,e)},r.prototype.now=function(){return performance.now()},r.prototype.encode=function(t,e){if(e!=="utf-8"&&e!=="utf8")throw new Error("Browser's encoder only supports utf-8, but got "+e);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(t)},r.prototype.decode=function(t,e){return new TextDecoder(e).decode(t)},r})();yt().get("IS_BROWSER")&&yt().setPlatform("browser",new bH);var zm,wH=function(){return require("node-fetch")},EH=(function(){function r(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}return r.prototype.fetch=function(t,e){return yt().global.fetch!=null?yt().global.fetch(t,e):(zm==null&&(zm=wH()),zm(t,e))},r.prototype.now=function(){var t=process.hrtime();return 1e3*t[0]+t[1]/1e6},r.prototype.encode=function(t,e){if(e!=="utf-8"&&e!=="utf8")throw new Error("Node built-in encoder only supports utf-8, but got "+e);return this.textEncoder.encode(t)},r.prototype.decode=function(t,e){return t.length===0?"":new this.util.TextDecoder(e).decode(t)},r})();yt().get("IS_NODE")&&yt().setPlatform("node",new EH);var Tg={float32:4,int32:4,uint16:2,uint8:1,bool:1},wd=4;function e_(r,t){for(var e={},n=0,a=function(u){var l=u.name,h=u.dtype,f=u.shape,p=Ot(f),v=void 0;if("quantization"in u){var m=u.quantization;if(m.dtype!=="uint8"&&m.dtype!=="uint16")throw new Error("Weight "+u.name+" has unknown quantization dtype "+m.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var x=Tg[m.dtype],b=r.slice(n,n+p*x),E=m.dtype==="uint8"?new Uint8Array(b):new Uint16Array(b);if(h==="float32")v=Float32Array.from(E,(function(D){return D*m.scale+m.min}));else{if(h!=="int32")throw new Error("Unsupported dtype in weight '"+l+"': "+h);v=Int32Array.from(E,(function(D){return Math.round(D*m.scale+m.min)}))}n+=p*x}else if(h==="string"){var C=Ot(u.shape);v=[];for(var R=0;R<C;R++){var _=new Uint32Array(r.slice(n,n+wd))[0];n+=wd;var A=new Uint8Array(r.slice(n,n+_));v.push(A),n+=_}}else{var k=Tg[h];if(b=r.slice(n,n+p*k),h==="float32")v=new Float32Array(b);else if(h==="int32")v=new Int32Array(b);else{if(h!=="bool")throw new Error("Unsupported dtype in weight '"+l+"': "+h);v=new Uint8Array(b)}n+=p*k}e[l]=Qn(v,f,h)},i=0,o=t;i<o.length;i++)a(o[i]);return e}function CH(r){if(r===null)throw new Error("Invalid input value: "+JSON.stringify(r));var t=0,e=[];r.forEach((function(i){if(t+=i.byteLength,e.push(i.byteLength===i.buffer.byteLength?i:new i.constructor(i)),!(i instanceof Float32Array||i instanceof Int32Array||i instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+i.constructor.name)}));var n=new Uint8Array(t),a=0;return e.forEach((function(i){n.set(new Uint8Array(i.buffer),a),a+=i.byteLength})),n.buffer}var kg=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function aE(r){return kg?Buffer.byteLength(r):new Blob([r]).size}function _y(r){var t=0;r.forEach((function(a){t+=a.byteLength}));var e=new Uint8Array(t),n=0;return r.forEach((function(a){e.set(new Uint8Array(a),n),n+=a.byteLength})),e.buffer}function iE(r){for(r=r.trim();r.endsWith("/");)r=r.slice(0,r.length-1);var t=r.split("/");return t[t.length-1]}function oh(r){if(r.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:r.modelTopology==null?0:aE(JSON.stringify(r.modelTopology)),weightSpecsBytes:r.weightSpecs==null?0:aE(JSON.stringify(r.weightSpecs)),weightDataBytes:r.weightData==null?0:r.weightData.byteLength}}var Yr=(function(){function r(){this.saveRouters=[],this.loadRouters=[]}return r.getInstance=function(){return r.instance==null&&(r.instance=new r),r.instance},r.registerSaveRouter=function(t){r.getInstance().saveRouters.push(t)},r.registerLoadRouter=function(t){r.getInstance().loadRouters.push(t)},r.getSaveHandlers=function(t){return r.getHandlers(t,"save")},r.getLoadHandlers=function(t,e){return r.getHandlers(t,"load",e)},r.getHandlers=function(t,e,n){var a=[];return(e==="load"?r.getInstance().loadRouters:r.getInstance().saveRouters).forEach((function(i){var o=i(t,n);o!==null&&a.push(o)})),a},r})(),$s="://",qo=(function(){function r(){this.managers={}}return r.getInstance=function(){return r.instance==null&&(r.instance=new r),r.instance},r.registerManager=function(t,e){G(t!=null,(function(){return"scheme must not be undefined or null."})),t.endsWith($s)&&(t=t.slice(0,t.indexOf($s))),G(t.length>0,(function(){return"scheme must not be an empty string."}));var n=r.getInstance();G(n.managers[t]==null,(function(){return"A model store manager is already registered for scheme '"+t+"'."})),n.managers[t]=e},r.getManager=function(t){var e=this.getInstance().managers[t];if(e==null)throw new Error("Cannot find model manager for scheme '"+t+"'");return e},r.getSchemes=function(){return Object.keys(this.getInstance().managers)},r})();function Vf(r){if(r.indexOf($s)===-1)throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+qo.getSchemes().join(","));return{scheme:r.split($s)[0],path:r.split($s)[1]}}function oE(r,t,e){return e===void 0&&(e=!1),Mt(this,void 0,void 0,(function(){var n,a,i,o,u,l,h,f,p;return Bt(this,(function(v){switch(v.label){case 0:return G(r!==t,(function(){return"Old path and new path are the same: '"+r+"'"})),G((n=Yr.getLoadHandlers(r)).length>0,(function(){return"Copying failed because no load handler is found for source URL "+r+"."})),G(n.length<2,(function(){return"Copying failed because more than one ("+n.length+") load handlers for source URL "+r+"."})),a=n[0],G((i=Yr.getSaveHandlers(t)).length>0,(function(){return"Copying failed because no save handler is found for destination URL "+t+"."})),G(i.length<2,(function(){return"Copying failed because more than one ("+n.length+") save handlers for destination URL "+t+"."})),o=i[0],u=Vf(r).scheme,l=Vf(r).path,h=u===Vf(r).scheme,[4,a.load()];case 1:return f=v.sent(),e&&h?[4,qo.getManager(u).removeModel(l)]:[3,3];case 2:v.sent(),v.label=3;case 3:return[4,o.save(f)];case 4:return p=v.sent(),!e||h?[3,6]:[4,qo.getManager(u).removeModel(l)];case 5:v.sent(),v.label=6;case 6:return[2,p.modelArtifactsInfo]}}))}))}var Nu="models_store",Ho="model_info_store";function n_(){if(!yt().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var r=window||self,t=r.indexedDB||r.mozIndexedDB||r.webkitIndexedDB||r.msIndexedDB||r.shimIndexedDB;if(t==null)throw new Error("The current browser does not appear to support IndexedDB.");return t}function Dg(r){var t=r.result;t.createObjectStore(Nu,{keyPath:"modelPath"}),t.createObjectStore(Ho,{keyPath:"modelPath"})}var Js=(function(){function r(t){if(this.indexedDB=n_(),t==null||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}return r.prototype.save=function(t){return Mt(this,void 0,void 0,(function(){return Bt(this,(function(e){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,t)]}))}))},r.prototype.load=function(){return Mt(this,void 0,void 0,(function(){return Bt(this,(function(t){return[2,this.databaseAction(this.modelPath)]}))}))},r.prototype.databaseAction=function(t,e){var n=this;return new Promise((function(a,i){var o=n.indexedDB.open("tensorflowjs",1);o.onupgradeneeded=function(){return Dg(o)},o.onsuccess=function(){var u=o.result;if(e==null){var l=u.transaction(Nu,"readonly"),h=l.objectStore(Nu).get(n.modelPath);h.onsuccess=function(){if(h.result==null)return u.close(),i(new Error("Cannot find model with path '"+n.modelPath+"' in IndexedDB."));a(h.result.modelArtifacts)},h.onerror=function(b){return u.close(),i(h.error)},l.oncomplete=function(){return u.close()}}else{var f,p=oh(e),v=u.transaction(Ho,"readwrite"),m=v.objectStore(Ho),x=m.put({modelPath:n.modelPath,modelArtifactsInfo:p});x.onsuccess=function(){var b=(f=u.transaction(Nu,"readwrite")).objectStore(Nu).put({modelPath:n.modelPath,modelArtifacts:e,modelArtifactsInfo:p});b.onsuccess=function(){return a({modelArtifactsInfo:p})},b.onerror=function(E){var C=(m=v.objectStore(Ho)).delete(n.modelPath);C.onsuccess=function(){return u.close(),i(b.error)},C.onerror=function(R){return u.close(),i(b.error)}}},x.onerror=function(b){return u.close(),i(x.error)},v.oncomplete=function(){f==null?u.close():f.oncomplete=function(){return u.close()}}}},o.onerror=function(u){return i(o.error)}}))},r.URL_SCHEME="indexeddb://",r})(),uE=function(r){return yt().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(Js.URL_SCHEME)?(t=r.slice(Js.URL_SCHEME.length),new Js(t)):null;var t};Yr.registerSaveRouter(uE),Yr.registerLoadRouter(uE);var SH=(function(){function r(){this.indexedDB=n_()}return r.prototype.listModels=function(){return Mt(this,void 0,void 0,(function(){var t=this;return Bt(this,(function(e){return[2,new Promise((function(n,a){var i=t.indexedDB.open("tensorflowjs",1);i.onupgradeneeded=function(){return Dg(i)},i.onsuccess=function(){var o=i.result,u=o.transaction(Ho,"readonly"),l=u.objectStore(Ho).getAll();l.onsuccess=function(){for(var h={},f=0,p=l.result;f<p.length;f++){var v=p[f];h[v.modelPath]=v.modelArtifactsInfo}n(h)},l.onerror=function(h){return o.close(),a(l.error)},u.oncomplete=function(){return o.close()}},i.onerror=function(o){return a(i.error)}}))]}))}))},r.prototype.removeModel=function(t){return Mt(this,void 0,void 0,(function(){var e=this;return Bt(this,(function(n){var a;return t=(a=t).startsWith(Js.URL_SCHEME)?a.slice(Js.URL_SCHEME.length):a,[2,new Promise((function(i,o){var u=e.indexedDB.open("tensorflowjs",1);u.onupgradeneeded=function(){return Dg(u)},u.onsuccess=function(){var l,h=u.result,f=h.transaction(Ho,"readwrite"),p=f.objectStore(Ho),v=p.get(t);v.onsuccess=function(){if(v.result==null)return h.close(),o(new Error("Cannot find model with path '"+t+"' in IndexedDB."));var m=p.delete(t),x=function(){var b=(l=h.transaction(Nu,"readwrite")).objectStore(Nu).delete(t);b.onsuccess=function(){return i(v.result.modelArtifactsInfo)},b.onerror=function(E){return o(v.error)}};m.onsuccess=x,m.onerror=function(b){return x(),h.close(),o(v.error)}},v.onerror=function(m){return h.close(),o(v.error)},f.oncomplete=function(){l==null?h.close():l.oncomplete=function(){return h.close()}}},u.onerror=function(l){return o(u.error)}}))]}))}))},r})();if(yt().getBool("IS_BROWSER"))try{qo.registerManager(Js.URL_SCHEME,new SH)}catch{}var Qi="/",Hs="tensorflowjs_models",r_="info",RH="model_topology",_H="weight_specs",AH="weight_data",TH="model_metadata";function a_(r){return{info:[Hs,r,r_].join(Qi),topology:[Hs,r,RH].join(Qi),weightSpecs:[Hs,r,_H].join(Qi),weightData:[Hs,r,AH].join(Qi),modelMetadata:[Hs,r,TH].join(Qi)}}function kH(r){var t=r.split(Qi);if(t.length<3)throw new Error("Invalid key format: "+r);return t.slice(1,t.length-1).join(Qi)}var tl=(function(){function r(t){if(!yt().getBool("IS_BROWSER")||typeof window>"u"||window.localStorage===void 0)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,t==null||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=a_(this.modelPath)}return r.prototype.save=function(t){return Mt(this,void 0,void 0,(function(){var e,n,a;return Bt(this,(function(i){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");e=JSON.stringify(t.modelTopology),n=JSON.stringify(t.weightSpecs),a=oh(t);try{return this.LS.setItem(this.keys.info,JSON.stringify(a)),this.LS.setItem(this.keys.topology,e),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,(function(o){if(kg)return Buffer.from(o).toString("base64");for(var u=new Uint8Array(o),l="",h=0,f=u.length;h<f;h++)l+=String.fromCharCode(u[h]);return btoa(l)})(t.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,userDefinedMetadata:t.userDefinedMetadata})),[2,{modelArtifactsInfo:a}]}catch{throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+a.modelTopologyBytes+", weightSpecsBytes="+a.weightSpecsBytes+", weightDataBytes="+a.weightDataBytes+".")}return[2]}))}))},r.prototype.load=function(){return Mt(this,void 0,void 0,(function(){var t,e,n,a,i,o,u;return Bt(this,(function(l){if((t=JSON.parse(this.LS.getItem(this.keys.info)))==null)throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if(t.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(e={},(n=JSON.parse(this.LS.getItem(this.keys.topology)))==null)throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(e.modelTopology=n,(a=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))==null)throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(e.weightSpecs=a,(i=this.LS.getItem(this.keys.modelMetadata))!=null&&(o=JSON.parse(i),e.format=o.format,e.generatedBy=o.generatedBy,e.convertedBy=o.convertedBy,e.userDefinedMetadata=o.userDefinedMetadata),(u=this.LS.getItem(this.keys.weightData))==null)throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return e.weightData=(function(h){if(kg){var f=Buffer.from(h,"base64");return f.buffer.slice(f.byteOffset,f.byteOffset+f.byteLength)}for(var p=atob(h),v=new Uint8Array(p.length),m=0;m<p.length;++m)v.set([p.charCodeAt(m)],m);return v.buffer})(u),[2,e]}))}))},r.URL_SCHEME="localstorage://",r})(),sE=function(r){return yt().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(tl.URL_SCHEME)?(t=r.slice(tl.URL_SCHEME.length),new tl(t)):null;var t};Yr.registerSaveRouter(sE),Yr.registerLoadRouter(sE);var DH=(function(){function r(){G(yt().getBool("IS_BROWSER"),(function(){return"Current environment is not a web browser"})),G(typeof window>"u"||window.localStorage!==void 0,(function(){return"Current browser does not appear to support localStorage"})),this.LS=window.localStorage}return r.prototype.listModels=function(){return Mt(this,void 0,void 0,(function(){var t,e,n,a,i,o;return Bt(this,(function(u){for(t={},e=Hs+Qi,n=Qi+r_,a=0;a<this.LS.length;++a)(i=this.LS.key(a)).startsWith(e)&&i.endsWith(n)&&(o=kH(i),t[o]=JSON.parse(this.LS.getItem(i)));return[2,t]}))}))},r.prototype.removeModel=function(t){return Mt(this,void 0,void 0,(function(){var e,n;return Bt(this,(function(a){var i;if(t=(i=t).startsWith(tl.URL_SCHEME)?i.slice(tl.URL_SCHEME.length):i,e=a_(t),this.LS.getItem(e.info)==null)throw new Error("Cannot find model at path '"+t+"'");return n=JSON.parse(this.LS.getItem(e.info)),this.LS.removeItem(e.info),this.LS.removeItem(e.topology),this.LS.removeItem(e.weightSpecs),this.LS.removeItem(e.weightData),[2,n]}))}))},r})();if(yt().getBool("IS_BROWSER"))try{qo.registerManager(tl.URL_SCHEME,new DH)}catch{}var IH="model",NH=".json",OH=".weights.bin";function lE(r){return new Promise((function(t){return setTimeout(t)})).then(r)}var Um=(function(){function r(t){if(!yt().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(r.URL_SCHEME)&&(t=t.slice(r.URL_SCHEME.length)),t!=null&&t.length!==0||(t=IH),this.modelTopologyFileName=t+NH,this.weightDataFileName=t+OH}return r.prototype.save=function(t){return Mt(this,void 0,void 0,(function(){var e,n,a,i,o,u;return Bt(this,(function(l){switch(l.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(e=window.URL.createObjectURL(new Blob([t.weightData],{type:"application/octet-stream"})),!(t.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return n=[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}],a={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:n},i=window.URL.createObjectURL(new Blob([JSON.stringify(a)],{type:"application/json"})),(o=this.jsonAnchor==null?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,o.href=i,[4,lE((function(){return o.dispatchEvent(new MouseEvent("click"))}))];case 2:return l.sent(),t.weightData==null?[3,4]:((u=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,u.href=e,[4,lE((function(){return u.dispatchEvent(new MouseEvent("click"))}))]);case 3:l.sent(),l.label=4;case 4:return[2,{modelArtifactsInfo:oh(t)}]}}))}))},r.URL_SCHEME="downloads://",r})(),MH=(function(){function r(t){if(t==null||t.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+t);this.files=t}return r.prototype.load=function(){return Mt(this,void 0,void 0,(function(){var t,e,n=this;return Bt(this,(function(a){return t=this.files[0],e=this.files.slice(1),[2,new Promise((function(i,o){var u=new FileReader;u.onload=function(l){var h=JSON.parse(l.target.result),f=h.modelTopology;if(f!=null){e.length===0&&i({modelTopology:f});var p=h.weightsManifest;if(p!=null){var v;try{v=n.checkManifestAndWeightFiles(p,e)}catch(E){return void o(E)}var m=[],x=[],b=[];p.forEach((function(E){E.paths.forEach((function(C){x.push(C),b.push(null)})),m.push.apply(m,E.weights)})),p.forEach((function(E){E.paths.forEach((function(C){var R=new FileReader;R.onload=function(_){var A=_.target.result,k=x.indexOf(C);b[k]=A,b.indexOf(null)===-1&&i({modelTopology:f,weightSpecs:m,weightData:_y(b),format:h.format,generatedBy:h.generatedBy,convertedBy:h.convertedBy,userDefinedMetadata:h.userDefinedMetadata})},R.onerror=function(_){return o("Failed to weights data from file of path '"+C+"'.")},R.readAsArrayBuffer(v[C])}))}))}else o(new Error("weightManifest field is missing from file "+t.name))}else o(new Error("modelTopology field is missing from file "+t.name))},u.onerror=function(l){return o("Failed to read model topology and weights manifest JSON from file '"+t.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},u.readAsText(t)}))]}))}))},r.prototype.checkManifestAndWeightFiles=function(t,e){for(var n=[],a=e.map((function(l){return iE(l.name)})),i={},o=0,u=t;o<u.length;o++)u[o].paths.forEach((function(l){var h=iE(l);if(n.indexOf(h)!==-1)throw new Error("Duplicate file basename found in weights manifest: '"+h+"'");if(n.push(h),a.indexOf(h)===-1)throw new Error("Weight file with basename '"+h+"' is not provided.");i[l]=e[a.indexOf(h)]}));if(n.length!==e.length)throw new Error("Mismatch in the number of files in weights manifest ("+n.length+") and the number of weight files provided ("+e.length+").");return i},r})();function cE(r,t,e,n){(function(i){G(i!=null&&Array.isArray(i)&&i.length>0,(function(){return"promises must be a none empty array"}))})(r),(function(i,o){G(i>=0&&i<=1,(function(){return"Progress fraction must be in range [0, 1], but got startFraction "+i})),G(o>=0&&o<=1,(function(){return"Progress fraction must be in range [0, 1], but got endFraction "+o})),G(o>=i,(function(){return"startFraction must be no more than endFraction, but got startFraction "+i+" and endFraction "+o}))})(e=e??0,n=n??1);var a=0;return Promise.all(r.map((function(i){return i.then((function(o){var u=e+ ++a/r.length*(n-e);return t(u),o})),i})))}function i_(r,t){return Mt(this,void 0,void 0,(function(){var e,n,a,i,o,u,l,h,f;return Bt(this,(function(p){switch(p.label){case 0:return t==null&&(t={}),e=t.fetchFunc==null?yt().platform.fetch:t.fetchFunc,n=r.map((function(v){return e(v,t.requestInit,{isBinary:!0})})),a=0,i=.5,t.onProgress!=null?[3,2]:[4,Promise.all(n)];case 1:return o=p.sent(),[3,4];case 2:return[4,cE(n,t.onProgress,a,i)];case 3:o=p.sent(),p.label=4;case 4:return u=o.map((function(v){return v.arrayBuffer()})),l=.5,h=1,t.onProgress!=null?[3,6]:[4,Promise.all(u)];case 5:return f=p.sent(),[3,8];case 6:return[4,cE(u,t.onProgress,l,h)];case 7:f=p.sent(),p.label=8;case 8:return[2,f]}}))}))}function hE(r){var t=this;return function(e,n,a){return n===void 0&&(n=""),Mt(t,void 0,void 0,(function(){var i,o,u,l,h,f,p,v,m,x;return Bt(this,(function(b){switch(b.label){case 0:if(i=e.map((function(){return!1})),o={},u=a!=null?a.map((function(){return!1})):[],l=[],e.forEach((function(E,C){var R=0;E.weights.forEach((function(_){var A="quantization"in _?_.quantization.dtype:_.dtype,k=Tg[A]*Ot(_.shape),D=function(){i[C]=!0,o[C]==null&&(o[C]=[]),o[C].push({manifestEntry:_,groupOffset:R,sizeBytes:k})};a!=null?a.forEach((function(P,M){P===_.name&&(D(),u[M]=!0)})):D(),l.push(_.name),R+=k}))})),!u.every((function(E){return E})))throw h=a.filter((function(E,C){return!u[C]})),new Error("Could not find weights in manifest with names: "+h.join(", ")+`. 
Manifest JSON has weights with names: `+l.join(", ")+".");return f=i.reduce((function(E,C,R){return C&&E.push(R),E}),[]),p=[],f.forEach((function(E){e[E].paths.forEach((function(C){var R=n+(n.endsWith("/")?"":"/")+C;p.push(R)}))})),[4,r(p)];case 1:return v=b.sent(),m={},x=0,f.forEach((function(E){for(var C=e[E].paths.length,R=0,_=0;_<C;_++)R+=v[x+_].byteLength;for(var A=new ArrayBuffer(R),k=new Uint8Array(A),D=0,P=0;P<C;P++){var M=new Uint8Array(v[x+P]);k.set(M,D),D+=M.byteLength}o[E].forEach((function(O){var F=e_(A.slice(O.groupOffset,O.groupOffset+O.sizeBytes),[O.manifestEntry]);for(var W in F)m[W]=F[W]})),x+=C})),[2,m]}}))}))}}Yr.registerSaveRouter((function(r){return yt().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(Um.URL_SCHEME)?(function(t){return t===void 0&&(t="model"),new Um(t)})(r.slice(Um.URL_SCHEME.length)):null}));var o_=(function(){function r(t,e){if(this.DEFAULT_METHOD="POST",e==null&&(e={}),this.weightPathPrefix=e.weightPathPrefix,this.onProgress=e.onProgress,e.fetchFunc!=null?(G(typeof e.fetchFunc=="function",(function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"})),this.fetch=e.fetchFunc):this.fetch=yt().platform.fetch,G(t!=null&&t.length>0,(function(){return"URL path for http must not be null, undefined or empty."})),Array.isArray(t)&&G(t.length===2,(function(){return"URL paths for http must have a length of 2, (actual length is "+t.length+")."})),this.path=t,e.requestInit!=null&&e.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=e.requestInit||{}}return r.prototype.save=function(t){return Mt(this,void 0,void 0,(function(){var e,n,a,i;return Bt(this,(function(o){switch(o.label){case 0:if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(e=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,n=[{paths:["./model.weights.bin"],weights:t.weightSpecs}],a={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,userDefinedMetadata:t.userDefinedMetadata,weightsManifest:n},e.body.append("model.json",new Blob([JSON.stringify(a)],{type:"application/json"}),"model.json"),t.weightData!=null&&e.body.append("model.weights.bin",new Blob([t.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,e)];case 1:if((i=o.sent()).ok)return[2,{modelArtifactsInfo:oh(t),responses:[i]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+i.status+".")}}))}))},r.prototype.load=function(){return Mt(this,void 0,void 0,(function(){var t,e,n,a,i,o,u,l,h,f,p,v;return Bt(this,(function(m){switch(m.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(t=m.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+t.status+". Please verify this URL points to the model JSON of the model to load.");m.label=2;case 2:return m.trys.push([2,4,,5]),[4,t.json()];case 3:return e=m.sent(),[3,5];case 4:throw m.sent(),n="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?n+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":n+=" Please make sure the server is serving valid JSON for this request.",new Error(n);case 5:if(a=e.modelTopology,i=e.weightsManifest,o=e.generatedBy,u=e.convertedBy,l=e.format,h=e.userDefinedMetadata,a==null&&i==null)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return i==null?[3,7]:[4,this.loadWeights(i)];case 6:v=m.sent(),f=v[0],p=v[1],m.label=7;case 7:return[2,{modelTopology:a,weightSpecs:f,weightData:p,userDefinedMetadata:h,generatedBy:o,convertedBy:u,format:l}]}}))}))},r.prototype.loadWeights=function(t){return Mt(this,void 0,void 0,(function(){var e,n,a,i,o,u,l,h,f,p,v;return Bt(this,(function(m){switch(m.label){case 0:for(e=Array.isArray(this.path)?this.path[1]:this.path,n=(function(x){var b=x.lastIndexOf("/"),E=x.lastIndexOf("?"),C=x.substring(0,b),R=E>b?x.substring(E):"";return[C+"/",R]})(e),a=n[0],i=n[1],o=this.weightPathPrefix||a,u=[],l=0,h=t;l<h.length;l++)f=h[l],u.push.apply(u,f.weights);return p=[],t.forEach((function(x){x.paths.forEach((function(b){p.push(o+b+i)}))})),[4,i_(p,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return v=m.sent(),[2,[u,_y(v)]]}}))}))},r.URL_SCHEME_REGEX=/^https?:\/\//,r})();function Ig(r){return r.match(o_.URL_SCHEME_REGEX)!=null}var fE=function(r,t){return typeof fetch>"u"?null:(Array.isArray(r)?r.every((function(e){return Ig(e)})):Ig(r))?Ng(r,{onProgress:t}):null};function Ng(r,t){return new o_(r,t)}Yr.registerSaveRouter(fE),Yr.registerLoadRouter(fE);var Wm=(function(){function r(t){this.modelArtifacts=t}return r.prototype.load=function(){return Mt(this,void 0,void 0,(function(){return Bt(this,(function(t){return[2,this.modelArtifacts]}))}))},r})(),BH=(function(){function r(t){this.saveHandler=t}return r.prototype.save=function(t){return Mt(this,void 0,void 0,(function(){return Bt(this,(function(e){return[2,this.saveHandler(t)]}))}))},r})(),u_=Object.freeze({browserFiles:function(r){return new MH(r)},browserHTTPRequest:function(r,t){return Ng(r,t)},concatenateArrayBuffers:_y,decodeWeights:e_,encodeWeights:function(r,t){return Mt(this,void 0,void 0,(function(){var e,n,a,i,o,u=this;return Bt(this,(function(l){switch(l.label){case 0:for(e=[],n=[],a=Array.isArray(r)?r.map((function(h){return h.name})):Object.keys(r),i=function(h){var f=a[h],p=Array.isArray(r)?r[h].tensor:r[f];if(p.dtype!=="float32"&&p.dtype!=="int32"&&p.dtype!=="bool"&&p.dtype!=="string")throw new Error("Unsupported dtype in weight '"+f+"': "+p.dtype);var v={name:f,shape:p.shape,dtype:p.dtype};if(p.dtype==="string"){var m=new Promise((function(x){return Mt(u,void 0,void 0,(function(){var b,E,C,R,_,A,k;return Bt(this,(function(D){switch(D.label){case 0:return[4,p.bytes()];case 1:for(b=D.sent(),E=b.reduce((function(P,M){return P+M.length}),0)+wd*b.length,C=new Uint8Array(E),R=0,_=0;_<b.length;_++)A=b[_],k=new Uint8Array(new Uint32Array([A.length]).buffer),C.set(k,R),R+=wd,C.set(A,R),R+=A.length;return x(C),[2]}}))}))}));n.push(m)}else n.push(p.data());t!=null&&(v.group=t),e.push(v)},o=0;o<a.length;++o)i(o);return[4,Promise.all(n)];case 1:return[2,{data:CH(l.sent()),specs:e}]}}))}))},fromMemory:function(r,t,e,n){return arguments.length===1?r.modelTopology!=null||r.weightSpecs!=null?new Wm(r):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Wm({modelTopology:r})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Wm({modelTopology:r,weightSpecs:t,weightData:e,trainingConfig:n}))},getLoadHandlers:function(r,t){return Yr.getLoadHandlers(r,t)},getModelArtifactsInfoForJSON:oh,getSaveHandlers:function(r){return Yr.getSaveHandlers(r)},http:Ng,isHTTPScheme:Ig,loadWeights:function(r,t,e,n){return t===void 0&&(t=""),Mt(this,void 0,void 0,(function(){return Bt(this,(function(a){return[2,hE((function(i){return i_(i,{requestInit:n})}))(r,t,e)]}))}))},registerLoadRouter:function(r){return Yr.registerLoadRouter(r)},registerSaveRouter:function(r){return Yr.registerSaveRouter(r)},weightsLoaderFactory:hE,withSaveHandler:function(r){return new BH(r)},copyModel:function(r,t){return Mt(this,void 0,void 0,(function(){return Bt(this,(function(e){return[2,oE(r,t,!1)]}))}))},listModels:function(){return Mt(this,void 0,void 0,(function(){var r,t,e,n,a,i,o;return Bt(this,(function(u){switch(u.label){case 0:r=qo.getSchemes(),t={},e=0,n=r,u.label=1;case 1:return e<n.length?(a=n[e],[4,qo.getManager(a).listModels()]):[3,4];case 2:for(o in i=u.sent())t[a+$s+o]=i[o];u.label=3;case 3:return e++,[3,1];case 4:return[2,t]}}))}))},moveModel:function(r,t){return Mt(this,void 0,void 0,(function(){return Bt(this,(function(e){return[2,oE(r,t,!0)]}))}))},removeModel:function(r){return Mt(this,void 0,void 0,(function(){var t;return Bt(this,(function(e){return t=Vf(r),[2,qo.getManager(t.scheme).removeModel(t.path)]}))}))}}),Ps;tt({confusionMatrix_:function(r,t,e){var n=z(r,"labels","confusionMatrix"),a=z(t,"predictions","confusionMatrix");G(e==null||e>0&&Number.isInteger(e),(function(){return"If provided, numClasses must be a positive integer, but got "+e})),G(n.rank===1,(function(){return"Expected the rank of labels to be 1, but got "+n.rank})),G(a.rank===1,(function(){return"Expected the rank of predictions to be 1, but got "+a.rank})),G(n.shape[0]===a.shape[0],(function(){return"Mismatch in the number of examples: "+n.shape[0]+" vs. "+a.shape[0]+". Labels and predictions should have the same number of elements."})),G(e>0&&Number.isInteger(e),(function(){return"numClasses is required to be a positive integer, but got "+e}));var i=xd(n.asType("int32"),e),o=xd(a.asType("int32"),e);return i.transpose().matMul(o).asType("int32")}});var PH=tt({fromPixels_:function(r,t){if(t===void 0&&(t=3),t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(r==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var e=!1,n=!1,a=!1,i=!1,o=!1;if(r.data instanceof Uint8Array)e=!0;else if(typeof ImageData<"u"&&r instanceof ImageData)n=!0;else if(typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement)a=!0;else if(typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement)i=!0;else{if(r.getContext==null)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+r.constructor.name);o=!0}if(a&&a&&r.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(vS("FromPixels",rt.backendName)!=null)return rt.runKernel("FromPixels",{pixels:r},{numChannels:t});var u,l,h=a?[r.videoWidth,r.videoHeight]:[r.width,r.height],f=h[0],p=h[1];if(o?u=r.getContext("2d").getImageData(0,0,f,p).data:n||e?u=r.data:(i||a)&&(Ps==null&&(Ps=document.createElement("canvas").getContext("2d")),Ps.canvas.width=f,Ps.canvas.height=p,Ps.drawImage(r,0,0,f,p),u=Ps.getImageData(0,0,f,p).data),t===4)l=new Int32Array(u);else{var v=f*p;l=new Int32Array(v*t);for(var m=0;m<v;m++)for(var x=0;x<t;++x)l[m*t+x]=u[4*m+x]}return DS(l,[p,f,t],"int32")}}),s_=Object.freeze({toPixels:function(r,t){return Mt(this,void 0,void 0,(function(){var e,n,a,i,o,u,l,h,f,p,v,m,x,b,E,C,R,_,A,k,D,P,M;return Bt(this,(function(O){switch(O.label){case 0:if(e=z(r,"img","toPixels"),r instanceof ze||(e=e.toInt()),e.rank!==2&&e.rank!==3)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+e.rank+".");if(n=e.shape.slice(0,2),a=n[0],i=n[1],(o=e.rank===2?1:e.shape[2])>4||o===2)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+o);return[4,e.data()];case 1:return u=O.sent(),l=e.min(),h=e.max(),[4,Promise.all([l.data(),h.data()])];case 2:if(f=O.sent(),p=f[0],v=f[1],m=p[0],x=v[0],l.dispose(),h.dispose(),e.dtype==="float32"){if(m<0||x>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+m+" - "+x+"].")}else{if(e.dtype!=="int32")throw new Error("Unsupported type for toPixels: "+e.dtype+". Please use float32 or int32 tensors.");if(m<0||x>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+m+" - "+x+"].")}for(b=e.dtype==="float32"?255:1,E=new Uint8ClampedArray(i*a*4),C=0;C<a*i;++C)R=void 0,_=void 0,A=void 0,k=void 0,o===1?(R=u[C]*b,_=u[C]*b,A=u[C]*b,k=255):o===3?(R=u[3*C]*b,_=u[3*C+1]*b,A=u[3*C+2]*b,k=255):o===4&&(R=u[4*C]*b,_=u[4*C+1]*b,A=u[4*C+2]*b,k=u[4*C+3]*b),E[(D=4*C)+0]=Math.round(R),E[D+1]=Math.round(_),E[D+2]=Math.round(A),E[D+3]=Math.round(k);return t!=null&&(t.width=i,t.height=a,P=t.getContext("2d"),M=new ImageData(E,i,a),P.putImageData(M,0,0)),e!==r&&e.dispose(),[2,E]}}))}))},fromPixels:PH}),FH=(function(){function r(){}return r.prototype.getClassName=function(){return this.constructor.className},r.fromConfig=function(t,e){return new t(e)},r})(),LH=(function(){function r(){this.classNameMap={}}return r.getMap=function(){return r.instance==null&&(r.instance=new r),r.instance},r.register=function(t){r.getMap().classNameMap[t.className]=[t,t.fromConfig]},r})();function Ju(r){G(r.className!=null,(function(){return"Class being registered does not have the static className property defined."})),G(typeof r.className=="string",(function(){return"className is required to be a string, but got type "+typeof r.className})),G(r.className.length>0,(function(){return"Class being registered has an empty-string as its className, which is disallowed."})),LH.register(r)}var ts=(function(r){function t(){return r!==null&&r.apply(this,arguments)||this}return Ua(t,r),t.prototype.minimize=function(e,n,a){n===void 0&&(n=!1);var i=this.computeGradients(e,a),o=i.value,u=i.grads;if(a!=null){var l=a.map((function(h){return{name:h.name,tensor:u[h.name]}}));this.applyGradients(l)}else this.applyGradients(u);return _r(u),n?o:(o.dispose(),null)},Object.defineProperty(t.prototype,"iterations",{get:function(){return this.iterations_==null&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),t.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},t.prototype.computeGradients=function(e,n){return oV(e,n)},t.prototype.dispose=function(){this.iterations_!=null&&_r(this.iterations_)},t.prototype.saveIterations=function(){return Mt(this,void 0,void 0,(function(){return Bt(this,(function(e){return this.iterations_==null&&(this.iterations_=0),[2,{name:"iter",tensor:Ut(this.iterations_,"int32")}]}))}))},t.prototype.getWeights=function(){return Mt(this,void 0,void 0,(function(){return Bt(this,(function(e){throw new Error("getWeights() is not implemented for this optimizer yet.")}))}))},t.prototype.setWeights=function(e){return Mt(this,void 0,void 0,(function(){return Bt(this,(function(n){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())}))}))},t.prototype.extractIterations=function(e){return Mt(this,void 0,void 0,(function(){var n;return Bt(this,(function(a){switch(a.label){case 0:return n=this,[4,e[0].tensor.data()];case 1:return n.iterations_=a.sent()[0],[2,e.slice(1)]}}))}))},t})(FH);Object.defineProperty(ts,Symbol.hasInstance,{value:function(r){return r.minimize!=null&&r.computeGradients!=null&&r.applyGradients!=null}});var zH=(function(r){function t(e,n,a){a===void 0&&(a=null);var i=r.call(this)||this;return i.learningRate=e,i.rho=n,i.epsilon=a,i.accumulatedGrads=[],i.accumulatedUpdates=[],a==null&&(i.epsilon=rt.backend.epsilon()),i}return Ua(t,r),t.prototype.applyGradients=function(e){var n=this;(Array.isArray(e)?e.map((function(a){return a.name})):Object.keys(e)).forEach((function(a,i){var o=rt.registeredVariables[a];n.accumulatedGrads[i]==null&&(n.accumulatedGrads[i]={originalName:a+"/accum_grad",variable:Ee((function(){return me(o).variable(!1)}))}),n.accumulatedUpdates[i]==null&&(n.accumulatedUpdates[i]={originalName:a+"/accum_var",variable:Ee((function(){return me(o).variable(!1)}))});var u=Array.isArray(e)?e[i].tensor:e[a];if(u!=null){var l=n.accumulatedGrads[i].variable,h=n.accumulatedUpdates[i].variable;Ee((function(){var f=l.mul(n.rho).add(u.square().mul(1-n.rho)),p=h.add(n.epsilon).sqrt().div(l.add(n.epsilon).sqrt()).mul(u),v=h.mul(n.rho).add(p.square().mul(1-n.rho));l.assign(f),h.assign(v);var m=p.mul(-n.learningRate).add(o);o.assign(m)}))}})),this.incrementIterations()},t.prototype.dispose=function(){this.accumulatedUpdates!=null&&(_r(this.accumulatedGrads.map((function(e){return e.variable}))),_r(this.accumulatedUpdates.map((function(e){return e.variable}))))},t.prototype.getWeights=function(){return Mt(this,void 0,void 0,(function(){var e;return Bt(this,(function(n){switch(n.label){case 0:return e=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(e.map((function(a){return{name:a.originalName,tensor:a.variable}})))]}}))}))},t.prototype.setWeights=function(e){return Mt(this,void 0,void 0,(function(){var n;return Bt(this,(function(a){switch(a.label){case 0:return[4,this.extractIterations(e)];case 1:return e=a.sent(),n=e.length/2,this.accumulatedGrads=e.slice(0,n).map((function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}})),this.accumulatedUpdates=e.slice(n,2*n).map((function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}})),[2]}}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},t.fromConfig=function(e,n){return new e(n.learningRate,n.rho,n.epsilon)},t.className="Adadelta",t})(ts);Ju(zH);var UH=(function(r){function t(e,n){n===void 0&&(n=.1);var a=r.call(this)||this;return a.learningRate=e,a.initialAccumulatorValue=n,a.accumulatedGrads=[],a}return Ua(t,r),t.prototype.applyGradients=function(e){var n=this;(Array.isArray(e)?e.map((function(a){return a.name})):Object.keys(e)).forEach((function(a,i){var o=rt.registeredVariables[a];n.accumulatedGrads[i]==null&&(n.accumulatedGrads[i]={originalName:a+"/accumulator",variable:Ee((function(){return Bu(o.shape,n.initialAccumulatorValue).variable(!1)}))});var u=Array.isArray(e)?e[i].tensor:e[a];if(u!=null){var l=n.accumulatedGrads[i].variable;Ee((function(){var h=l.add(u.square());l.assign(h);var f=u.div(h.add(rt.backend.epsilon()).sqrt()).mul(-n.learningRate).add(o);o.assign(f)}))}})),this.incrementIterations()},t.prototype.dispose=function(){this.accumulatedGrads!=null&&_r(this.accumulatedGrads.map((function(e){return e.variable})))},t.prototype.getWeights=function(){return Mt(this,void 0,void 0,(function(){return Bt(this,(function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(this.accumulatedGrads.map((function(n){return{name:n.originalName,tensor:n.variable}})))]}}))}))},t.prototype.setWeights=function(e){return Mt(this,void 0,void 0,(function(){return Bt(this,(function(n){switch(n.label){case 0:return[4,this.extractIterations(e)];case 1:return e=n.sent(),this.accumulatedGrads=e.map((function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}})),[2]}}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},t.fromConfig=function(e,n){return new e(n.learningRate,n.initialAccumulatorValue)},t.className="Adagrad",t})(ts);Ju(UH);var WH=(function(r){function t(e,n,a,i){i===void 0&&(i=null);var o=r.call(this)||this;return o.learningRate=e,o.beta1=n,o.beta2=a,o.epsilon=i,o.accumulatedFirstMoment=[],o.accumulatedSecondMoment=[],Ee((function(){o.accBeta1=Ut(n).variable(),o.accBeta2=Ut(a).variable()})),i==null&&(o.epsilon=rt.backend.epsilon()),o}return Ua(t,r),t.prototype.applyGradients=function(e){var n=this,a=Array.isArray(e)?e.map((function(i){return i.name})):Object.keys(e);Ee((function(){var i=Fa(1,n.accBeta1),o=Fa(1,n.accBeta2);a.forEach((function(u,l){var h=rt.registeredVariables[u];n.accumulatedFirstMoment[l]==null&&(n.accumulatedFirstMoment[l]={originalName:u+"/m",variable:Ee((function(){return me(h).variable(!1)}))}),n.accumulatedSecondMoment[l]==null&&(n.accumulatedSecondMoment[l]={originalName:u+"/v",variable:Ee((function(){return me(h).variable(!1)}))});var f=Array.isArray(e)?e[l].tensor:e[u];if(f!=null){var p=n.accumulatedFirstMoment[l].variable,v=n.accumulatedSecondMoment[l].variable,m=p.mul(n.beta1).add(f.mul(1-n.beta1)),x=v.mul(n.beta2).add(f.square().mul(1-n.beta2)),b=m.div(i),E=x.div(o);p.assign(m),v.assign(x);var C=b.div(E.sqrt().add(n.epsilon)).mul(-n.learningRate).add(h);h.assign(C)}})),n.accBeta1.assign(n.accBeta1.mul(n.beta1)),n.accBeta2.assign(n.accBeta2.mul(n.beta2))})),this.incrementIterations()},t.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&_r(this.accumulatedFirstMoment.map((function(e){return e.variable}))),this.accumulatedSecondMoment!=null&&_r(this.accumulatedSecondMoment.map((function(e){return e.variable})))},t.prototype.getWeights=function(){return Mt(this,void 0,void 0,(function(){var e;return Bt(this,(function(n){switch(n.label){case 0:return e=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(e.map((function(a){return{name:a.originalName,tensor:a.variable}})))]}}))}))},t.prototype.setWeights=function(e){return Mt(this,void 0,void 0,(function(){var n,a=this;return Bt(this,(function(i){switch(i.label){case 0:return[4,this.extractIterations(e)];case 1:return e=i.sent(),Ee((function(){a.accBeta1.assign(pd(a.beta1,a.iterations_+1)),a.accBeta2.assign(pd(a.beta2,a.iterations_+1))})),n=e.length/2,this.accumulatedFirstMoment=e.slice(0,n).map((function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}})),this.accumulatedSecondMoment=e.slice(n,2*n).map((function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}})),[2]}}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},t.fromConfig=function(e,n){return new e(n.learningRate,n.beta1,n.beta2,n.epsilon)},t.className="Adam",t})(ts);Ju(WH);var VH=(function(r){function t(e,n,a,i,o){i===void 0&&(i=null),o===void 0&&(o=0);var u=r.call(this)||this;return u.learningRate=e,u.beta1=n,u.beta2=a,u.epsilon=i,u.decay=o,u.accumulatedFirstMoment=[],u.accumulatedWeightedInfNorm=[],Ee((function(){u.iteration=Ut(0).variable(),u.accBeta1=Ut(n).variable()})),i==null&&(u.epsilon=rt.backend.epsilon()),u}return Ua(t,r),t.prototype.applyGradients=function(e){var n=this,a=Array.isArray(e)?e.map((function(i){return i.name})):Object.keys(e);Ee((function(){var i=Fa(1,n.accBeta1),o=Qo(-n.learningRate,n.iteration.mul(n.decay).add(1));a.forEach((function(u,l){var h=rt.registeredVariables[u];n.accumulatedFirstMoment[l]==null&&(n.accumulatedFirstMoment[l]={originalName:u+"/m",variable:me(h).variable(!1)}),n.accumulatedWeightedInfNorm[l]==null&&(n.accumulatedWeightedInfNorm[l]={originalName:u+"/v",variable:me(h).variable(!1)});var f=Array.isArray(e)?e[l].tensor:e[u];if(f!=null){var p=n.accumulatedFirstMoment[l].variable,v=n.accumulatedWeightedInfNorm[l].variable,m=p.mul(n.beta1).add(f.mul(1-n.beta1)),x=v.mul(n.beta2),b=f.abs(),E=x.maximum(b);p.assign(m),v.assign(E);var C=o.div(i).mul(m.div(E.add(n.epsilon))).add(h);h.assign(C)}})),n.iteration.assign(n.iteration.add(1)),n.accBeta1.assign(n.accBeta1.mul(n.beta1))})),this.incrementIterations()},t.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&_r(this.accumulatedFirstMoment.map((function(e){return e.variable}))),this.accumulatedWeightedInfNorm!=null&&_r(this.accumulatedWeightedInfNorm.map((function(e){return e.variable})))},t.prototype.getWeights=function(){return Mt(this,void 0,void 0,(function(){return Bt(this,(function(e){throw new Error("getWeights() is not implemented for Adamax yet.")}))}))},t.prototype.setWeights=function(e){return Mt(this,void 0,void 0,(function(){return Bt(this,(function(n){throw new Error("setWeights() is not implemented for Adamax yet.")}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},t.fromConfig=function(e,n){return new e(n.learningRate,n.beta1,n.beta2,n.epsilon,n.decay)},t.className="Adamax",t})(ts);Ju(VH);var l_=(function(r){function t(e){var n=r.call(this)||this;return n.learningRate=e,n.setLearningRate(e),n}return Ua(t,r),t.prototype.applyGradients=function(e){var n=this;(Array.isArray(e)?e.map((function(a){return a.name})):Object.keys(e)).forEach((function(a,i){var o=Array.isArray(e)?e[i].tensor:e[a];if(o!=null){var u=rt.registeredVariables[a];Ee((function(){var l=n.c.mul(o).add(u);u.assign(l)}))}})),this.incrementIterations()},t.prototype.setLearningRate=function(e){this.learningRate=e,this.c!=null&&this.c.dispose(),this.c=Q3(Ut(-e))},t.prototype.dispose=function(){this.c.dispose()},t.prototype.getWeights=function(){return Mt(this,void 0,void 0,(function(){return Bt(this,(function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()]]}}))}))},t.prototype.setWeights=function(e){return Mt(this,void 0,void 0,(function(){return Bt(this,(function(n){switch(n.label){case 0:return[4,this.extractIterations(e)];case 1:if((e=n.sent()).length!==0)throw new Error("SGD optimizer does not have settable weights.");return[2]}}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate}},t.fromConfig=function(e,n){return new e(n.learningRate)},t.className="SGD",t})(ts);Ju(l_);var GH=(function(r){function t(e,n,a){a===void 0&&(a=!1);var i=r.call(this,e)||this;return i.learningRate=e,i.momentum=n,i.useNesterov=a,i.accumulations=[],i.m=Ut(i.momentum),i}return Ua(t,r),t.prototype.applyGradients=function(e){var n=this;(Array.isArray(e)?e.map((function(a){return a.name})):Object.keys(e)).forEach((function(a,i){var o=rt.registeredVariables[a];n.accumulations[i]==null&&(n.accumulations[i]={originalName:a+"/momentum",variable:Ee((function(){return me(o).variable(!1)}))});var u=n.accumulations[i].variable,l=Array.isArray(e)?e[i].tensor:e[a];l!=null&&Ee((function(){var h,f=n.m.mul(u).add(l);h=n.useNesterov?n.c.mul(l.add(f.mul(n.m))).add(o):n.c.mul(f).add(o),u.assign(f),o.assign(h)}))})),this.incrementIterations()},t.prototype.dispose=function(){this.m.dispose(),this.accumulations!=null&&_r(this.accumulations.map((function(e){return e.variable})))},t.prototype.setMomentum=function(e){this.momentum=e},t.prototype.getWeights=function(){return Mt(this,void 0,void 0,(function(){return Bt(this,(function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(this.accumulations.map((function(n){return{name:n.originalName,tensor:n.variable}})))]}}))}))},t.prototype.setWeights=function(e){return Mt(this,void 0,void 0,(function(){return Bt(this,(function(n){switch(n.label){case 0:return[4,this.extractIterations(e)];case 1:return e=n.sent(),this.accumulations=e.map((function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}})),[2]}}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},t.fromConfig=function(e,n){return new e(n.learningRate,n.momentum,n.useNesterov)},t.className="Momentum",t})(l_);Ju(GH);var HH=(function(r){function t(e,n,a,i,o){n===void 0&&(n=.9),a===void 0&&(a=0),i===void 0&&(i=null),o===void 0&&(o=!1);var u=r.call(this)||this;if(u.learningRate=e,u.decay=n,u.momentum=a,u.epsilon=i,u.accumulatedMeanSquares=[],u.accumulatedMoments=[],u.accumulatedMeanGrads=[],u.centered=o,i==null&&(u.epsilon=rt.backend.epsilon()),e==null)throw new Error("learningRate for RMSPropOptimizer must be defined.");return u}return Ua(t,r),t.prototype.applyGradients=function(e){var n=this;(Array.isArray(e)?e.map((function(a){return a.name})):Object.keys(e)).forEach((function(a,i){var o=rt.registeredVariables[a];n.accumulatedMeanSquares[i]==null&&(n.accumulatedMeanSquares[i]={originalName:a+"/rms",variable:Ee((function(){return me(o).variable(!1)}))}),n.accumulatedMoments[i]==null&&(n.accumulatedMoments[i]={originalName:a+"/momentum",variable:Ee((function(){return me(o).variable(!1)}))}),n.accumulatedMeanGrads[i]==null&&n.centered&&(n.accumulatedMeanGrads[i]={originalName:a+"/mg",variable:Ee((function(){return me(o).variable(!1)}))});var u=Array.isArray(e)?e[i].tensor:e[a];if(u!=null){var l=n.accumulatedMeanSquares[i].variable,h=n.accumulatedMoments[i].variable;Ee((function(){var f=l.mul(n.decay).add(u.square().mul(1-n.decay));if(n.centered){var p=n.accumulatedMeanGrads[i].variable,v=p.mul(n.decay).add(u.mul(1-n.decay)),m=h.mul(n.momentum).add(u.mul(n.learningRate).div(f.sub(v.square().add(n.epsilon)).sqrt()));l.assign(f),p.assign(v),h.assign(m);var x=o.sub(m);o.assign(x)}else{var b=l.mul(n.decay).add(u.square().mul(1-n.decay));m=h.mul(n.momentum).add(u.mul(n.learningRate).div(b.add(n.epsilon).sqrt())),l.assign(b),h.assign(m),x=o.sub(m),o.assign(x)}}))}})),this.incrementIterations()},t.prototype.dispose=function(){this.accumulatedMeanSquares!=null&&_r(this.accumulatedMeanSquares.map((function(e){return e.variable}))),this.accumulatedMeanGrads!=null&&this.centered&&_r(this.accumulatedMeanGrads.map((function(e){return e.variable}))),this.accumulatedMoments!=null&&_r(this.accumulatedMoments.map((function(e){return e.variable})))},t.prototype.getWeights=function(){return Mt(this,void 0,void 0,(function(){var e;return Bt(this,(function(n){switch(n.label){case 0:return e=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&e.push.apply(e,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(e.map((function(a){return{name:a.originalName,tensor:a.variable}})))]}}))}))},t.prototype.setWeights=function(e){return Mt(this,void 0,void 0,(function(){var n;return Bt(this,(function(a){switch(a.label){case 0:return[4,this.extractIterations(e)];case 1:return e=a.sent(),n=this.centered?e.length/3:e.length/2,this.accumulatedMeanSquares=e.slice(0,n).map((function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}})),this.accumulatedMoments=e.slice(n,2*n).map((function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}})),this.centered&&(this.accumulatedMeanGrads=e.slice(2*n,3*n).map((function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}))),[2]}}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},t.fromConfig=function(e,n){return new e(n.learningRate,n.decay,n.momentum,n.epsilon,n.centered)},t.className="RMSProp",t})(ts);Ju(HH);ze.prototype.add=function(r){return Ea(this,r)},ze.prototype.broadcastTo=function(r){return wR(this,r)},ze.prototype.div=function(r){return Qo(this,r)},ze.prototype.divNoNan=function(r){return SR(this,r)},ze.prototype.squaredDifference=function(r){return TR(this,r)},ze.prototype.tile=function(r){return Zs(this,r)},ze.prototype.oneHot=function(r,t,e){return t===void 0&&(t=1),e===void 0&&(e=0),xd(this,r,t,e)},ze.prototype.transpose=function(r){return Ma(this,r)},ze.prototype.pad=function(r,t){return oo(this,r,t)},ze.prototype.batchNorm=function(r,t,e,n,a){return ah(this,r,t,e,n,a)},gt=sH;var Pu=(function(){function r(t,e){if(!Fu(t)||!Fu(e))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:t,height:e}));this._width=t,this._height=e}return Object.defineProperty(r.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),r.prototype.reverse=function(){return new r(1/this.width,1/this.height)},r})(),xe=(function(){function r(t,e){this._x=t,this._y=e}return Object.defineProperty(r.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),r.prototype.add=function(t){return new r(this.x+t.x,this.y+t.y)},r.prototype.sub=function(t){return new r(this.x-t.x,this.y-t.y)},r.prototype.mul=function(t){return new r(this.x*t.x,this.y*t.y)},r.prototype.div=function(t){return new r(this.x/t.x,this.y/t.y)},r.prototype.abs=function(){return new r(Math.abs(this.x),Math.abs(this.y))},r.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},r.prototype.floor=function(){return new r(Math.floor(this.x),Math.floor(this.y))},r})();function Wd(r,t){return r instanceof ze&&r.shape.length===t}function qH(r){return Wd(r,2)}function Vd(r){return Wd(r,3)}function jo(r){return Wd(r,4)}function jH(r){return r%1!==0}function dE(r){return r%2===0}function Ay(r,t){t===void 0&&(t=2);var e=Math.pow(10,t);return Math.floor(r*e)/e}function pE(r){return r&&r.width&&r.height}function XH(r,t){var e=r.width,n=r.height,a=t/Math.max(n,e);return new Pu(Math.round(e*a),Math.round(n*a))}function Ty(r){return r.reduce(function(t,e){return t.add(e)},new xe(0,0)).div(new xe(r.length,r.length))}function Mc(r,t,e){return Array(r).fill(0).map(function(n,a){return t+a*e})}function Fu(r){return!!r&&r!==1/0&&r!==-1/0&&!isNaN(r)||r===0}function vE(r){return Fu(r)&&0<=r&&r<=1}var mi=(function(){function r(t,e){e===void 0&&(e=!0);var n=t||{},a=[n.left,n.top,n.right,n.bottom].every(Fu),i=[n.x,n.y,n.width,n.height].every(Fu);if(!i&&!a)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(n));var o=i?[n.x,n.y,n.width,n.height]:[n.left,n.top,n.right-n.left,n.bottom-n.top],u=o[0],l=o[1],h=o[2],f=o[3];r.assertIsValidBox({x:u,y:l,width:h,height:f},"Box.constructor",e),this._x=u,this._y=l,this._width=h,this._height=f}return r.isRect=function(t){return!!t&&[t.x,t.y,t.width,t.height].every(Fu)},r.assertIsValidBox=function(t,e,n){if(n===void 0&&(n=!1),!r.isRect(t))throw new Error(e+" - invalid box: "+JSON.stringify(t)+", expected object with properties x, y, width, height");if(!n&&(t.width<0||t.height<0))throw new Error(e+" - width ("+t.width+") and height ("+t.height+") must be positive numbers")},Object.defineProperty(r.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"topLeft",{get:function(){return new xe(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"topRight",{get:function(){return new xe(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"bottomLeft",{get:function(){return new xe(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"bottomRight",{get:function(){return new xe(this.right,this.bottom)},enumerable:!0,configurable:!0}),r.prototype.round=function(){var t=[this.x,this.y,this.width,this.height].map(function(o){return Math.round(o)}),e=t[0],n=t[1],a=t[2],i=t[3];return new r({x:e,y:n,width:a,height:i})},r.prototype.floor=function(){var t=[this.x,this.y,this.width,this.height].map(function(o){return Math.floor(o)}),e=t[0],n=t[1],a=t[2],i=t[3];return new r({x:e,y:n,width:a,height:i})},r.prototype.toSquare=function(){var t=this,e=t.x,n=t.y,a=t.width,i=t.height,o=Math.abs(a-i);return a<i&&(e-=o/2,a+=o),i<a&&(n-=o/2,i+=o),new r({x:e,y:n,width:a,height:i})},r.prototype.rescale=function(t){var e=pE(t)?t.width:t,n=pE(t)?t.height:t;return new r({x:this.x*e,y:this.y*n,width:this.width*e,height:this.height*n})},r.prototype.pad=function(t,e){var n=[this.x-t/2,this.y-e/2,this.width+t,this.height+e],a=n[0],i=n[1],o=n[2],u=n[3];return new r({x:a,y:i,width:o,height:u})},r.prototype.clipAtImageBorders=function(t,e){var n=this,a=n.x,i=n.y,o=n.right,u=n.bottom,l=Math.max(a,0),h=Math.max(i,0),f=o-l,p=u-h,v=Math.min(f,t-l),m=Math.min(p,e-h);return new r({x:l,y:h,width:v,height:m}).floor()},r.prototype.shift=function(t,e){var n=this,a=n.width,i=n.height,o=this.x+t,u=this.y+e;return new r({x:o,y:u,width:a,height:i})},r.prototype.padAtBorders=function(t,e){var n=this.width+1,a=this.height+1,i=1,o=1,u=n,l=a,h=this.left,f=this.top,p=this.right,v=this.bottom;return p>e&&(u=-p+e+n,p=e),v>t&&(l=-v+t+a,v=t),h<1&&(l=2-h,h=1),f<1&&(l=2-f,f=1),{dy:o,edy:l,dx:i,edx:u,y:f,ey:v,x:h,ex:p,w:n,h:a}},r.prototype.calibrate=function(t){return new r({left:this.left+t.left*this.width,top:this.top+t.top*this.height,right:this.right+t.right*this.width,bottom:this.bottom+t.bottom*this.height}).toSquare().round()},r})(),Gd=(function(r){Jc(t,r);function t(e,n,a,i,o){return o===void 0&&(o=!1),r.call(this,{left:e,top:n,right:a,bottom:i},o)||this}return t})(mi),mE=(function(r){Jc(t,r);function t(e,n){var a=r.call(this,e)||this;return a._label=n,a}return t.assertIsValidLabeledBox=function(e,n){if(mi.assertIsValidBox(e,n),!Fu(e.label))throw new Error(n+" - expected property label ("+e.label+") to be a number")},Object.defineProperty(t.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),t})(mi),c_=(function(){function r(t,e,n,a,i){this._imageDims=new Pu(i.width,i.height),this._score=t,this._classScore=e,this._className=n,this._box=new mi(a).rescale(this._imageDims)}return Object.defineProperty(r.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"relativeBox",{get:function(){return new mi(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),r.prototype.forSize=function(t,e){return new r(this.score,this.classScore,this.className,this.relativeBox,{width:t,height:e})},r})();(function(r){Jc(t,r);function t(e,n,a,i){var o=r.call(this,e,n)||this;return o._score=a,o._classScore=i,o}return t.assertIsValidPredictedBox=function(e,n){if(mE.assertIsValidLabeledBox(e,n),!vE(e.score)||!vE(e.classScore))throw new Error(n+" - expected properties score ("+e.score+") and ("+e.classScore+") to be a number between [0, 1]")},Object.defineProperty(t.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),t})(mE);var ky=(function(r){Jc(t,r);function t(e,n,a,i,o){return o===void 0&&(o=!1),r.call(this,{x:e,y:n,width:a,height:i},o)||this}return t})(mi);function h_(){var r=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")},t=function(){throw new Error("readFile - filesystem not available for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D,Image:HTMLImageElement,ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:r,readFile:t}}function f_(r){var t="";if(!r)try{r=require("fs")}catch(n){t=n.toString()}var e=r?function(n){return new Promise(function(a,i){r.readFile(n,function(o,u){return o?i(o):a(u)})})}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+t)};return{readFile:e}}function d_(){var r=window.Canvas||window.HTMLCanvasElement,t=window.Image||window.HTMLImageElement,e=function(){if(r)return new r;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},n=function(){if(t)return new t;throw new Error("createImageElement - missing Image implementation for nodejs environment")},a=window.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},i=f_();return nd({Canvas:r||(function(){function o(){}return o})(),CanvasRenderingContext2D:window.CanvasRenderingContext2D||(function(){function o(){}return o})(),Image:t||(function(){function o(){}return o})(),ImageData:window.ImageData||(function(){function o(){}return o})(),Video:window.HTMLVideoElement||(function(){function o(){}return o})(),createCanvasElement:e,createImageElement:n,fetch:a},i)}function p_(){return typeof window=="object"&&typeof document<"u"&&typeof HTMLImageElement<"u"&&typeof HTMLCanvasElement<"u"&&typeof HTMLVideoElement<"u"&&typeof ImageData<"u"&&typeof CanvasRenderingContext2D<"u"}function v_(){return typeof window=="object"&&typeof require=="function"&&typeof eA<"u"&&typeof process<"u"&&!!process.version}var An;function KH(){if(!An)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return An}function Og(r){An=r}function Dy(){p_()&&Og(h_()),v_()&&Og(d_())}function YH(r){if(An||Dy(),!An)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var t=r.Canvas,e=t===void 0?An.Canvas:t,n=r.Image,a=n===void 0?An.Image:n;An.Canvas=e,An.Image=a,An.createCanvasElement=r.createCanvasElement||(function(){return new e}),An.createImageElement=r.createImageElement||(function(){return new a}),An.ImageData=r.ImageData||An.ImageData,An.Video=r.Video||An.Video,An.fetch=r.fetch||An.fetch,An.readFile=r.readFile||An.readFile}var or={getEnv:KH,setEnv:Og,initialize:Dy,createBrowserEnv:h_,createFileSystem:f_,createNodejsEnv:d_,monkeyPatch:YH,isBrowser:p_,isNodejs:v_};Dy();function Iy(r){return!or.isNodejs()&&typeof r=="string"?document.getElementById(r):r}function gi(r){var t=or.getEnv(),e=t.Canvas,n=t.CanvasRenderingContext2D;if(r instanceof n)return r;var a=Iy(r);if(!(a instanceof e))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var i=a.getContext("2d");if(!i)throw new Error("resolveContext2d - canvas 2d context is null");return i}var $i;(function(r){r.TOP_LEFT="TOP_LEFT",r.TOP_RIGHT="TOP_RIGHT",r.BOTTOM_LEFT="BOTTOM_LEFT",r.BOTTOM_RIGHT="BOTTOM_RIGHT"})($i||($i={}));var Ny=(function(){function r(t){t===void 0&&(t={});var e=t.anchorPosition,n=t.backgroundColor,a=t.fontColor,i=t.fontSize,o=t.fontStyle,u=t.padding;this.anchorPosition=e||$i.TOP_LEFT,this.backgroundColor=n||"rgba(0, 0, 0, 0.5)",this.fontColor=a||"rgba(255, 255, 255, 1)",this.fontSize=i||14,this.fontStyle=o||"Georgia",this.padding=u||4}return r})(),Oy=(function(){function r(t,e,n){n===void 0&&(n={}),this.text=typeof t=="string"?[t]:t instanceof r?t.text:t,this.anchor=e,this.options=new Ny(n)}return r.prototype.measureWidth=function(t){var e=this.options.padding;return this.text.map(function(n){return t.measureText(n).width}).reduce(function(n,a){return n<a?a:n},0)+2*e},r.prototype.measureHeight=function(){var t=this.options,e=t.fontSize,n=t.padding;return this.text.length*e+2*n},r.prototype.getUpperLeft=function(t,e){var n=this.options.anchorPosition,a=n===$i.BOTTOM_RIGHT||n===$i.TOP_RIGHT,i=n===$i.BOTTOM_LEFT||n===$i.BOTTOM_RIGHT,o=this.measureWidth(t),u=this.measureHeight(),l=a?this.anchor.x-o:this.anchor.x,h=i?this.anchor.y-u:this.anchor.y;if(e){var f=e.width,p=e.height,v=Math.max(Math.min(l,f-o),0),m=Math.max(Math.min(h,p-u),0);return{x:v,y:m}}return{x:l,y:h}},r.prototype.draw=function(t){var e=Iy(t),n=gi(e),a=this.options,i=a.backgroundColor,o=a.fontColor,u=a.fontSize,l=a.fontStyle,h=a.padding;n.font=u+"px "+l;var f=this.measureWidth(n),p=this.measureHeight();n.fillStyle=i;var v=this.getUpperLeft(n,e);n.fillRect(v.x,v.y,f,p),n.fillStyle=o,this.text.forEach(function(m,x){var b=h+v.x,E=h+v.y+(x+1)*u;n.fillText(m,b,E)})},r})(),m_=(function(){function r(t){t===void 0&&(t={});var e=t.boxColor,n=t.lineWidth,a=t.label,i=t.drawLabelOptions;this.boxColor=e||"rgba(0, 0, 255, 1)",this.lineWidth=n||2,this.label=a;var o={anchorPosition:$i.BOTTOM_LEFT,backgroundColor:this.boxColor};this.drawLabelOptions=new Ny(Object.assign({},o,i))}return r})(),g_=(function(){function r(t,e){e===void 0&&(e={}),this.box=new mi(t),this.options=new m_(e)}return r.prototype.draw=function(t){var e=gi(t),n=this.options,a=n.boxColor,i=n.lineWidth,o=this.box,u=o.x,l=o.y,h=o.width,f=o.height;e.strokeStyle=a,e.lineWidth=i,e.strokeRect(u,l,h,f);var p=this.options.label;p&&new Oy([p],{x:u-i/2,y:l},this.options.drawLabelOptions).draw(t)},r})();const QH=Object.freeze(Object.defineProperty({__proto__:null,get AnchorPosition(){return $i},DrawBox:g_,DrawBoxOptions:m_,DrawTextField:Oy,DrawTextFieldOptions:Ny},Symbol.toStringTag,{value:"Module"}));function La(r,t,e,n){return e===void 0&&(e="same"),n===void 0&&(n=!1),Ee(function(){var a=Ea($u(r,t.filters,[1,1],e),t.bias);return n?zd(a):a})}function so(r,t){Object.keys(r).forEach(function(e){t.some(function(n){return n.originalPath===e})||r[e].dispose()})}function Hd(r,t){return function(e,n,a,i){var o=si(r(e*n*a*a),[a,a,e,n]),u=za(r(n));return t.push({paramPath:i+"/filters"},{paramPath:i+"/bias"}),{filters:o,bias:u}}}function My(r,t){return function(e,n,a){var i=Mu(r(e*n),[e,n]),o=za(r(n));return t.push({paramPath:a+"/weights"},{paramPath:a+"/bias"}),{weights:i,bias:o}}}var y_=(function(){function r(t,e,n){this.depthwise_filter=t,this.pointwise_filter=e,this.bias=n}return r})();function By(r,t){return function(e,n,a){var i=si(r(9*e),[3,3,e,1]),o=si(r(e*n),[1,1,e,n]),u=za(r(n));return t.push({paramPath:a+"/depthwise_filter"},{paramPath:a+"/pointwise_filter"},{paramPath:a+"/bias"}),new y_(i,o,u)}}function Py(r){return function(t){var e=r(t+"/depthwise_filter",4),n=r(t+"/pointwise_filter",4),a=r(t+"/bias",1);return new y_(e,n,a)}}function ru(r,t){return function(e,n,a){var i=r[e];if(!Wd(i,n))throw new Error("expected weightMap["+e+"] to be a Tensor"+n+"D, instead have "+i);return t.push({originalPath:e,paramPath:a||e}),i}}function lo(r){var t=r;function e(a){var i=t.slice(0,a);return t=t.slice(a),i}function n(){return t}return{extractWeights:e,getRemainingWeights:n}}function x_(r,t){var e=t+"-weights_manifest.json";if(!r)return{modelBaseUri:"",manifestUri:e};if(r==="/")return{modelBaseUri:"/",manifestUri:"/"+e};var n=r.startsWith("http://")?"http://":r.startsWith("https://")?"https://":"";r=r.replace(n,"");var a=r.split("/").filter(function(u){return u}),i=r.endsWith(".json")?a[a.length-1]:e,o=n+(r.endsWith(".json")?a.slice(0,a.length-1):a).join("/");return o=r.startsWith("/")?"/"+o:o,{modelBaseUri:o,manifestUri:o==="/"?"/"+i:o+"/"+i}}function b_(r){var t=or.getEnv(),e=t.Image,n=t.Video;return r instanceof e&&r.complete||r instanceof n&&r.readyState>=3}function ZH(r){return new Promise(function(t,e){if(r instanceof or.getEnv().Canvas||b_(r))return t();function n(i){i.currentTarget&&(i.currentTarget.removeEventListener("load",n),i.currentTarget.removeEventListener("error",a),t(i))}function a(i){i.currentTarget&&(i.currentTarget.removeEventListener("load",n),i.currentTarget.removeEventListener("error",a),e(i))}r.addEventListener("load",n),r.addEventListener("error",a)})}function w_(r){var t=or.getEnv(),e=t.Image,n=t.Video;return r instanceof e?new Pu(r.naturalWidth,r.naturalHeight):r instanceof n?new Pu(r.videoWidth,r.videoHeight):new Pu(r.width,r.height)}function qd(r){var t=r.width,e=r.height,n=or.getEnv().createCanvasElement,a=n();return a.width=t,a.height=e,a}function Fy(r,t){var e=or.getEnv().ImageData;if(!(r instanceof e)&&!b_(r))throw new Error("createCanvasFromMedia - media has not finished loading yet");var n=w_(r),a=n.width,i=n.height,o=qd({width:a,height:i});return r instanceof e?gi(o).putImageData(r,0,0):gi(o).drawImage(r,0,0,a,i),o}function $H(r,t){return ma(this,void 0,void 0,function(){var e,n;return ga(this,function(a){switch(a.label){case 0:return e=or.getEnv().fetch,[4,e(r,t)];case 1:if(n=a.sent(),!(n.status<400))throw new Error("failed to fetch: ("+n.status+") "+n.statusText+", from url: "+n.url);return[2,n]}})})}function JH(r){return ma(this,void 0,void 0,function(){return ga(this,function(t){switch(t.label){case 0:return[4,$H(r)];case 1:return[2,t.sent().json()]}})})}function tq(r,t){return ma(this,void 0,void 0,function(){var e,n,a,i,o,u;return ga(this,function(l){switch(l.label){case 0:return e=or.getEnv().createCanvasElement(),n=r.shape.slice(jo(r)?1:0),a=n[0],i=n[1],o=n[2],u=Ee(function(){return r.as3D(a,i,o).toInt()}),[4,s_.toPixels(u,e)];case 1:return l.sent(),u.dispose(),[2,e]}})})}function eq(r,t,e){e===void 0&&(e=!1);var n=or.getEnv(),a=n.Image,i=n.Canvas;if(!(r instanceof a||r instanceof i))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var o=w_(r),u=t/Math.max(o.height,o.width),l=u*o.width,h=u*o.height,f=qd({width:t,height:t}),p=r instanceof i?r:Fy(r),v=Math.abs(l-h)/2,m=e&&l<h?v:0,x=e&&h<l?v:0;return gi(f).drawImage(p,m,x,l,h),f}function gE(r){var t=or.getEnv(),e=t.Image,n=t.Canvas,a=t.Video;return r instanceof e||r instanceof n||r instanceof a}function nq(r,t){return ma(this,void 0,void 0,function(){var e,n,a,i;return ga(this,function(o){switch(o.label){case 0:return e=x_(r,t),n=e.manifestUri,a=e.modelBaseUri,[4,JH(n)];case 1:return i=o.sent(),[2,u_.loadWeights(i,a)]}})})}function rq(r,t){return t===void 0&&(t=!1),Ee(function(){var e=r.shape.slice(1),n=e[0],a=e[1];if(n===a)return r;var i=Math.abs(n-a),o=Math.round(i*(t?.5:1)),u=n>a?2:1,l=function(m){var x=r.shape.slice();return x[u]=m,Bu(x,0)},h=l(o),f=i-h.shape[u],p=t&&f?l(f):null,v=[p,r,h].filter(function(m){return!!m}).map(function(m){return m.toFloat()});return wa(v,u)})}var Ed=(function(){function r(t,e){var n=this;if(e===void 0&&(e=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(t))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+t);this._treatAsBatchInput=e,this._batchSize=t.length,t.forEach(function(a,i){if(Vd(a)){n._imageTensors[i]=a,n._inputDimensions[i]=a.shape;return}if(jo(a)){var o=a.shape[0];if(o!==1)throw new Error("NetInput - tf.Tensor4D with batchSize "+o+" passed, but not supported in input array");n._imageTensors[i]=a,n._inputDimensions[i]=a.shape.slice(1);return}var u=a instanceof or.getEnv().Canvas?a:Fy(a);n._canvases[i]=u,n._inputDimensions[i]=[u.height,u.width,3]})}return Object.defineProperty(r.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"reshapedInputDimensions",{get:function(){var t=this;return Mc(this.batchSize,0,1).map(function(e,n){return t.getReshapedInputDimensions(n)})},enumerable:!0,configurable:!0}),r.prototype.getInput=function(t){return this.canvases[t]||this.imageTensors[t]},r.prototype.getInputDimensions=function(t){return this._inputDimensions[t]},r.prototype.getInputHeight=function(t){return this._inputDimensions[t][0]},r.prototype.getInputWidth=function(t){return this._inputDimensions[t][1]},r.prototype.getReshapedInputDimensions=function(t){if(typeof this.inputSize!="number")throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");var e=this.getInputWidth(t),n=this.getInputHeight(t);return XH({width:e,height:n},this.inputSize)},r.prototype.toBatchTensor=function(t,e){var n=this;return e===void 0&&(e=!0),this._inputSize=t,Ee(function(){var a=Mc(n.batchSize,0,1).map(function(o){var u=n.getInput(o);if(u instanceof ze){var l=jo(u)?u:u.expandDims();return l=rq(l,e),(l.shape[1]!==t||l.shape[2]!==t)&&(l=QR.resizeBilinear(l,[t,t])),l.as3D(t,t,3)}if(u instanceof or.getEnv().Canvas)return s_.fromPixels(eq(u,t,e));throw new Error("toBatchTensor - at batchIdx "+o+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+u)}),i=Yo(a.map(function(o){return o.toFloat()})).as4D(n.batchSize,t,t,3);return i})},r})();function Vn(r){return ma(this,void 0,void 0,function(){var t,e,n;return ga(this,function(a){switch(a.label){case 0:if(r instanceof Ed)return[2,r];if(t=Array.isArray(r)?r:[r],!t.length)throw new Error("toNetInput - empty array passed as input");return e=function(i){return Array.isArray(r)?" at input index "+i+":":""},n=t.map(Iy),n.forEach(function(i,o){if(!gE(i)&&!Vd(i)&&!jo(i))throw typeof t[o]=="string"?new Error("toNetInput -"+e(o)+" string passed, but could not resolve HTMLElement for element id "+t[o]):new Error("toNetInput -"+e(o)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id");if(jo(i)){var u=i.shape[0];if(u!==1)throw new Error("toNetInput -"+e(o)+" tf.Tensor4D with batchSize "+u+" passed, but not supported in input array")}}),[4,Promise.all(n.map(function(i){return gE(i)&&ZH(i)}))];case 1:return a.sent(),[2,new Ed(n,Array.isArray(r))]}})})}var co=(function(){function r(t){this._name=t,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(r.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),r.prototype.getParamFromPath=function(t){var e=this.traversePropertyPath(t),n=e.obj,a=e.objProp;return n[a]},r.prototype.reassignParamFromPath=function(t,e){var n=this.traversePropertyPath(t),a=n.obj,i=n.objProp;a[i].dispose(),a[i]=e},r.prototype.getParamList=function(){var t=this;return this._paramMappings.map(function(e){var n=e.paramPath;return{path:n,tensor:t.getParamFromPath(n)}})},r.prototype.getTrainableParams=function(){return this.getParamList().filter(function(t){return t.tensor instanceof cl})},r.prototype.getFrozenParams=function(){return this.getParamList().filter(function(t){return!(t.tensor instanceof cl)})},r.prototype.variable=function(){var t=this;this.getFrozenParams().forEach(function(e){var n=e.path,a=e.tensor;t.reassignParamFromPath(n,a.variable())})},r.prototype.freeze=function(){var t=this;this.getTrainableParams().forEach(function(e){var n=e.path,a=e.tensor,i=Qn(a.dataSync());a.dispose(),t.reassignParamFromPath(n,i)})},r.prototype.dispose=function(t){t===void 0&&(t=!0),this.getParamList().forEach(function(e){if(t&&e.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+e.path);e.tensor.dispose()}),this._params=void 0},r.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map(function(t){var e=t.tensor;return Array.from(e.dataSync())}).reduce(function(t,e){return t.concat(e)}))},r.prototype.load=function(t){return ma(this,void 0,void 0,function(){return ga(this,function(e){switch(e.label){case 0:return t instanceof Float32Array?(this.extractWeights(t),[2]):[4,this.loadFromUri(t)];case 1:return e.sent(),[2]}})})},r.prototype.loadFromUri=function(t){return ma(this,void 0,void 0,function(){var e;return ga(this,function(n){switch(n.label){case 0:if(t&&typeof t!="string")throw new Error(this._name+".loadFromUri - expected model uri");return[4,nq(t,this.getDefaultModelName())];case 1:return e=n.sent(),this.loadFromWeightMap(e),[2]}})})},r.prototype.loadFromDisk=function(t){return ma(this,void 0,void 0,function(){var e,n,a,i,o,u,l,h,f,p;return ga(this,function(v){switch(v.label){case 0:if(t&&typeof t!="string")throw new Error(this._name+".loadFromDisk - expected model file path");return e=or.getEnv().readFile,n=x_(t,this.getDefaultModelName()),a=n.manifestUri,i=n.modelBaseUri,o=function(m){return Promise.all(m.map(function(x){return e(x).then(function(b){return b.buffer})}))},u=u_.weightsLoaderFactory(o),f=(h=JSON).parse,[4,e(a)];case 1:return l=f.apply(h,[v.sent().toString()]),[4,u(l,i)];case 2:return p=v.sent(),this.loadFromWeightMap(p),[2]}})})},r.prototype.loadFromWeightMap=function(t){var e=this.extractParamsFromWeigthMap(t),n=e.paramMappings,a=e.params;this._paramMappings=n,this._params=a},r.prototype.extractWeights=function(t){var e=this.extractParams(t),n=e.paramMappings,a=e.params;this._paramMappings=n,this._params=a},r.prototype.traversePropertyPath=function(t){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var e=t.split("/").reduce(function(i,o){if(!i.nextObj.hasOwnProperty(o))throw new Error("traversePropertyPath - object does not have property "+o+", for path "+t);return{obj:i.nextObj,objProp:o,nextObj:i.nextObj[o]}},{nextObj:this.params}),n=e.obj,a=e.objProp;if(!n||!a||!(n[a]instanceof ze))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+t);return{obj:n,objProp:a}},r})();function aq(r,t,e){e===void 0&&(e=!0);var n=Math.max(0,Math.min(r.right,t.right)-Math.max(r.left,t.left)),a=Math.max(0,Math.min(r.bottom,t.bottom)-Math.max(r.top,t.top)),i=n*a;return e?i/(r.area+t.area-i):i/Math.min(r.area,t.area)}function Bc(r,t,e,n){n===void 0&&(n=!0);for(var a=t.map(function(u,l){return{score:u,boxIndex:l}}).sort(function(u,l){return u.score-l.score}).map(function(u){return u.boxIndex}),i=[],o=function(){var u=a.pop();i.push(u);for(var l=a,h=[],f=0;f<l.length;f++){var p=l[f],v=r[u],m=r[p];h.push(aq(v,m,n))}a=a.filter(function(x,b){return h[b]<=e})};a.length>0;)o();return i}function uh(r,t){return Ee(function(){var e=t[0],n=t[1],a=t[2],i=Bu(ym(r.shape.slice(0,3),[1]),e),o=Bu(ym(r.shape.slice(0,3),[1]),n),u=Bu(ym(r.shape.slice(0,3),[1]),a),l=wa([i,o,u],3);return Fa(r,l)})}function Vm(r){return 1/(1+Math.exp(-r))}var Ff=function(r){return typeof r=="number"};function iq(r){if(!r)throw new Error("invalid config: "+r);if(typeof r.withSeparableConvs!="boolean")throw new Error("config.withSeparableConvs has to be a boolean, have: "+r.withSeparableConvs);if(!Ff(r.iouThreshold)||r.iouThreshold<0||r.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+r.iouThreshold);if(!Array.isArray(r.classes)||!r.classes.length||!r.classes.every(function(t){return typeof t=="string"}))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(r.classes));if(!Array.isArray(r.anchors)||!r.anchors.length||!r.anchors.map(function(t){return t||{}}).every(function(t){return Ff(t.x)&&Ff(t.y)}))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(r.anchors));if(r.meanRgb&&(!Array.isArray(r.meanRgb)||r.meanRgb.length!==3||!r.meanRgb.every(Ff)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(r.meanRgb))}function Ly(r){return Ee(function(){var t=un(r,Ut(.10000000149011612));return Ea(zd(Fa(r,t)),t)})}function Po(r,t){return Ee(function(){var e=oo(r,[[0,0],[1,1],[1,1],[0,0]]);return e=$u(e,t.conv.filters,[1,1],"valid"),e=Fa(e,t.bn.sub),e=un(e,t.bn.truediv),e=Ea(e,t.conv.bias),Ly(e)})}function Fo(r,t){return Ee(function(){var e=oo(r,[[0,0],[1,1],[1,1],[0,0]]);return e=FR(e,t.depthwise_filter,t.pointwise_filter,[1,1],"valid"),e=Ea(e,t.bias),Ly(e)})}function oq(r,t){var e=Hd(r,t);function n(o,u){var l=za(r(o)),h=za(r(o));return t.push({paramPath:u+"/sub"},{paramPath:u+"/truediv"}),{sub:l,truediv:h}}function a(o,u,l){var h=e(o,u,3,l+"/conv"),f=n(u,l+"/bn");return{conv:h,bn:f}}var i=By(r,t);return{extractConvParams:e,extractConvWithBatchNormParams:a,extractSeparableConvParams:i}}function uq(r,t,e,n){var a=lo(r),i=a.extractWeights,o=a.getRemainingWeights,u=[],l=oq(i,u),h=l.extractConvParams,f=l.extractConvWithBatchNormParams,p=l.extractSeparableConvParams,v;if(t.withSeparableConvs){var m=n[0],x=n[1],b=n[2],E=n[3],C=n[4],R=n[5],_=n[6],A=n[7],k=n[8],D=t.isFirstLayerConv2d?h(m,x,3,"conv0"):p(m,x,"conv0"),P=p(x,b,"conv1"),M=p(b,E,"conv2"),O=p(E,C,"conv3"),F=p(C,R,"conv4"),W=p(R,_,"conv5"),j=A?p(_,A,"conv6"):void 0,ot=k?p(A,k,"conv7"):void 0,nt=h(k||A||_,5*e,1,"conv8");v={conv0:D,conv1:P,conv2:M,conv3:O,conv4:F,conv5:W,conv6:j,conv7:ot,conv8:nt}}else{var m=n[0],x=n[1],b=n[2],E=n[3],C=n[4],R=n[5],_=n[6],A=n[7],k=n[8],D=f(m,x,"conv0"),P=f(x,b,"conv1"),M=f(b,E,"conv2"),O=f(E,C,"conv3"),F=f(C,R,"conv4"),W=f(R,_,"conv5"),j=f(_,A,"conv6"),ot=f(A,k,"conv7"),nt=h(k,5*e,1,"conv8");v={conv0:D,conv1:P,conv2:M,conv3:O,conv4:F,conv5:W,conv6:j,conv7:ot,conv8:nt}}if(o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{params:v,paramMappings:u}}function sq(r,t){var e=ru(r,t);function n(u){var l=e(u+"/sub",1),h=e(u+"/truediv",1);return{sub:l,truediv:h}}function a(u){var l=e(u+"/filters",4),h=e(u+"/bias",1);return{filters:l,bias:h}}function i(u){var l=a(u+"/conv"),h=n(u+"/bn");return{conv:l,bn:h}}var o=Py(e);return{extractConvParams:a,extractConvWithBatchNormParams:i,extractSeparableConvParams:o}}function lq(r,t){var e=[],n=sq(r,e),a=n.extractConvParams,i=n.extractConvWithBatchNormParams,o=n.extractSeparableConvParams,u;if(t.withSeparableConvs){var l=t.filterSizes&&t.filterSizes.length||9;u={conv0:t.isFirstLayerConv2d?a("conv0"):o("conv0"),conv1:o("conv1"),conv2:o("conv2"),conv3:o("conv3"),conv4:o("conv4"),conv5:o("conv5"),conv6:l>7?o("conv6"):void 0,conv7:l>8?o("conv7"):void 0,conv8:a("conv8")}}else u={conv0:i("conv0"),conv1:i("conv1"),conv2:i("conv2"),conv3:i("conv3"),conv4:i("conv4"),conv5:i("conv5"),conv6:i("conv6"),conv7:i("conv7"),conv8:a("conv8")};return so(r,e),{params:u,paramMappings:e}}var yE;(function(r){r[r.XS=224]="XS",r[r.SM=320]="SM",r[r.MD=416]="MD",r[r.LG=608]="LG"})(yE||(yE={}));var zy=(function(){function r(t){var e=t===void 0?{}:t,n=e.inputSize,a=e.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=n||416,this._scoreThreshold=a||.5,typeof this._inputSize!="number"||this._inputSize%32!==0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if(typeof this._scoreThreshold!="number"||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(r.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),r})(),E_=(function(r){Jc(t,r);function t(e){var n=r.call(this,"TinyYolov2")||this;return iq(e),n._config=e,n}return Object.defineProperty(t.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),t.prototype.runTinyYolov2=function(e,n){var a=Po(e,n.conv0);return a=Vr(a,[2,2],[2,2],"same"),a=Po(a,n.conv1),a=Vr(a,[2,2],[2,2],"same"),a=Po(a,n.conv2),a=Vr(a,[2,2],[2,2],"same"),a=Po(a,n.conv3),a=Vr(a,[2,2],[2,2],"same"),a=Po(a,n.conv4),a=Vr(a,[2,2],[2,2],"same"),a=Po(a,n.conv5),a=Vr(a,[2,2],[1,1],"same"),a=Po(a,n.conv6),a=Po(a,n.conv7),La(a,n.conv8,"valid",!1)},t.prototype.runMobilenet=function(e,n){var a=this.config.isFirstLayerConv2d?Ly(La(e,n.conv0,"valid",!1)):Fo(e,n.conv0);return a=Vr(a,[2,2],[2,2],"same"),a=Fo(a,n.conv1),a=Vr(a,[2,2],[2,2],"same"),a=Fo(a,n.conv2),a=Vr(a,[2,2],[2,2],"same"),a=Fo(a,n.conv3),a=Vr(a,[2,2],[2,2],"same"),a=Fo(a,n.conv4),a=Vr(a,[2,2],[2,2],"same"),a=Fo(a,n.conv5),a=Vr(a,[2,2],[1,1],"same"),a=n.conv6?Fo(a,n.conv6):a,a=n.conv7?Fo(a,n.conv7):a,La(a,n.conv8,"valid",!1)},t.prototype.forwardInput=function(e,n){var a=this,i=this.params;if(!i)throw new Error("TinyYolov2 - load model before inference");return Ee(function(){var o=e.toBatchTensor(n,!1).toFloat();return o=a.config.meanRgb?uh(o,a.config.meanRgb):o,o=o.div(Ut(256)),a.config.withSeparableConvs?a.runMobilenet(o,i):a.runTinyYolov2(o,i)})},t.prototype.forward=function(e,n){return ma(this,void 0,void 0,function(){var a;return ga(this,function(i){switch(i.label){case 0:return a=this.forwardInput,[4,Vn(e)];case 1:return[4,a.apply(this,[i.sent(),n])];case 2:return[2,i.sent()]}})})},t.prototype.detect=function(e,n){return n===void 0&&(n={}),ma(this,void 0,void 0,function(){var a,i,o,u,l,h,f,p,v,m,x,b,E,C,R=this;return ga(this,function(_){switch(_.label){case 0:return a=new zy(n),i=a.inputSize,o=a.scoreThreshold,[4,Vn(e)];case 1:return u=_.sent(),[4,this.forwardInput(u,i)];case 2:return l=_.sent(),h=Ee(function(){return Id(l)[0].expandDims()}),f={width:u.getInputWidth(0),height:u.getInputHeight(0)},[4,this.extractBoxes(h,u.getReshapedInputDimensions(0),o)];case 3:return p=_.sent(),l.dispose(),h.dispose(),v=p.map(function(A){return A.box}),m=p.map(function(A){return A.score}),x=p.map(function(A){return A.classScore}),b=p.map(function(A){return R.config.classes[A.label]}),E=Bc(v.map(function(A){return A.rescale(i)}),m,this.config.iouThreshold,!0),C=E.map(function(A){return new c_(m[A],x[A],b[A],v[A],f)}),[2,C]}})})},t.prototype.getDefaultModelName=function(){return""},t.prototype.extractParamsFromWeigthMap=function(e){return lq(e,this.config)},t.prototype.extractParams=function(e){var n=this.config.filterSizes||t.DEFAULT_FILTER_SIZES,a=n?n.length:void 0;if(a!==7&&a!==8&&a!==9)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+a+" filterSizes in config");return uq(e,this.config,this.boxEncodingSize,n)},t.prototype.extractBoxes=function(e,n,a){return ma(this,void 0,void 0,function(){var i,o,u,l,h,f,p,v,m,x,b,E,C,R,_,A,k,D,P,M,O,F,W,j,ot,nt,at,V,X,Q=this;return ga(this,function(ut){switch(ut.label){case 0:return i=n.width,o=n.height,u=Math.max(i,o),l=u/i,h=u/o,f=e.shape[1],p=this.config.anchors.length,v=Ee(function(){var B=e.reshape([f,f,p,Q.boxEncodingSize]),$=B.slice([0,0,0,0],[f,f,p,4]),ht=B.slice([0,0,0,4],[f,f,p,1]),ft=Q.withClassScores?Bd(B.slice([0,0,0,5],[f,f,p,Q.config.classes.length]),3):Ut(0);return[$,ht,ft]}),m=v[0],x=v[1],b=v[2],E=[],[4,x.array()];case 1:return C=ut.sent(),[4,m.array()];case 2:R=ut.sent(),_=0,ut.label=3;case 3:if(!(_<f))return[3,12];A=0,ut.label=4;case 4:if(!(A<f))return[3,11];k=0,ut.label=5;case 5:return k<p?(D=Vm(C[_][A][k][0]),!a||D>a?(P=(A+Vm(R[_][A][k][0]))/f*l,M=(_+Vm(R[_][A][k][1]))/f*h,O=Math.exp(R[_][A][k][2])*this.config.anchors[k].x/f*l,F=Math.exp(R[_][A][k][3])*this.config.anchors[k].y/f*h,W=P-O/2,j=M-F/2,ot={row:_,col:A,anchor:k},this.withClassScores?[4,this.extractPredictedClass(b,ot)]:[3,7]):[3,9]):[3,10];case 6:return X=ut.sent(),[3,8];case 7:X={classScore:1,label:0},ut.label=8;case 8:nt=X,at=nt.classScore,V=nt.label,E.push(nd({box:new Gd(W,j,W+O,j+F),score:D,classScore:D*at,label:V},ot)),ut.label=9;case 9:return k++,[3,5];case 10:return A++,[3,4];case 11:return _++,[3,3];case 12:return m.dispose(),x.dispose(),b.dispose(),[2,E]}})})},t.prototype.extractPredictedClass=function(e,n){return ma(this,void 0,void 0,function(){var a,i,o,u;return ga(this,function(l){switch(l.label){case 0:return a=n.row,i=n.col,o=n.anchor,[4,e.array()];case 1:return u=l.sent(),[2,Array(this.config.classes.length).fill(0).map(function(h,f){return u[a][i][o][f]}).map(function(h,f){return{classScore:h,label:f}}).reduce(function(h,f){return h.classScore>f.classScore?h:f})]}})})},t.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],t})(co);function Lo(r,t,e){if(e===void 0&&(e=!1),r.beginPath(),t.slice(1).forEach(function(i,o){var u=i.x,l=i.y,h=t[o];r.moveTo(h.x,h.y),r.lineTo(u,l)}),e){var n=t[t.length-1],a=t[0];if(!n||!a)return;r.moveTo(n.x,n.y),r.lineTo(a.x,a.y)}r.stroke()}var Jr=(function(r){ie(t,r);function t(e,n,a){return r.call(this,e,e,"",n,a)||this}return t.prototype.forSize=function(e,n){var a=r.prototype.forSize.call(this,e,n),i=a.score,o=a.relativeBox,u=a.imageDims;return new t(i,o,u)},t})(c_);function Pc(r){return r.detection instanceof Jr}function Fc(r,t){var e={detection:t};return Object.assign({},r,e)}function cq(r,t){var e=Array.isArray(t)?t:[t];e.forEach(function(n){var a=n instanceof Jr?n.score:Pc(n)?n.detection.score:void 0,i=n instanceof Jr?n.box:Pc(n)?n.detection.box:new mi(n),o=a?""+Ay(a):void 0;new g_(i,{label:o}).draw(r)})}function Qr(r,t,e){return Ht(function(){var n=WC(r,t.depthwise_filter,t.pointwise_filter,e,"same");return n=we(n,t.bias),n})}function Gm(r,t,e){return e===void 0&&(e=!1),Ht(function(){var n=wn(e?we(ro(r,t.conv0.filters,[2,2],"same"),t.conv0.bias):Qr(r,t.conv0,[2,2])),a=Qr(n,t.conv1,[1,1]),i=wn(we(n,a)),o=Qr(i,t.conv2,[1,1]);return wn(we(n,we(a,o)))})}function Lf(r,t,e,n){return e===void 0&&(e=!1),n===void 0&&(n=!0),Ht(function(){var a=wn(e?we(ro(r,t.conv0.filters,n?[2,2]:[1,1],"same"),t.conv0.bias):Qr(r,t.conv0,n?[2,2]:[1,1])),i=Qr(a,t.conv1,[1,1]),o=wn(we(a,i)),u=Qr(o,t.conv2,[1,1]),l=wn(we(a,we(i,u))),h=Qr(l,t.conv3,[1,1]);return wn(we(a,we(i,we(u,h))))})}function C_(r,t){var e=Hd(r,t),n=By(r,t);function a(o,u,l,h){h===void 0&&(h=!1);var f=h?e(o,u,3,l+"/conv0"):n(o,u,l+"/conv0"),p=n(u,u,l+"/conv1"),v=n(u,u,l+"/conv2");return{conv0:f,conv1:p,conv2:v}}function i(o,u,l,h){h===void 0&&(h=!1);var f=a(o,u,l,h),p=f.conv0,v=f.conv1,m=f.conv2,x=n(u,u,l+"/conv3");return{conv0:p,conv1:v,conv2:m,conv3:x}}return{extractDenseBlock3Params:a,extractDenseBlock4Params:i}}function hq(r){var t=[],e=lo(r),n=e.extractWeights,a=e.getRemainingWeights,i=C_(n,t).extractDenseBlock4Params,o=i(3,32,"dense0",!0),u=i(32,64,"dense1"),l=i(64,128,"dense2"),h=i(128,256,"dense3");if(a().length!==0)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:t,params:{dense0:o,dense1:u,dense2:l,dense3:h}}}function S_(r){return function(t){var e=r(t+"/filters",4),n=r(t+"/bias",1);return{filters:e,bias:n}}}function R_(r,t){var e=ru(r,t),n=S_(e),a=Py(e);function i(u,l){l===void 0&&(l=!1);var h=l?n(u+"/conv0"):a(u+"/conv0"),f=a(u+"/conv1"),p=a(u+"/conv2");return{conv0:h,conv1:f,conv2:p}}function o(u,l){l===void 0&&(l=!1);var h=l?n(u+"/conv0"):a(u+"/conv0"),f=a(u+"/conv1"),p=a(u+"/conv2"),v=a(u+"/conv3");return{conv0:h,conv1:f,conv2:p,conv3:v}}return{extractDenseBlock3Params:i,extractDenseBlock4Params:o}}function fq(r){var t=[],e=R_(r,t).extractDenseBlock4Params,n={dense0:e("dense0",!0),dense1:e("dense1"),dense2:e("dense2"),dense3:e("dense3")};return so(r,t),{params:n,paramMappings:t}}var __=(function(r){ie(t,r);function t(){return r.call(this,"FaceFeatureExtractor")||this}return t.prototype.forwardInput=function(e){var n=this.params;if(!n)throw new Error("FaceFeatureExtractor - load model before inference");return Ht(function(){var a=e.toBatchTensor(112,!0),i=[122.782,117.001,104.298],o=uh(a,i).div(Tt(255)),u=Lf(o,n.dense0,!0);return u=Lf(u,n.dense1),u=Lf(u,n.dense2),u=Lf(u,n.dense3),u=$c(u,[7,7],[2,2],"valid"),u})},t.prototype.forward=function(e){return Jt(this,void 0,void 0,function(){var n;return te(this,function(a){switch(a.label){case 0:return n=this.forwardInput,[4,Vn(e)];case 1:return[2,n.apply(this,[a.sent()])]}})})},t.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},t.prototype.extractParamsFromWeigthMap=function(e){return fq(e)},t.prototype.extractParams=function(e){return hq(e)},t})(co);function di(r,t){return Ht(function(){return we(Yg(r,t.weights),t.bias)})}function dq(r,t,e){var n=[],a=lo(r),i=a.extractWeights,o=a.getRemainingWeights,u=My(i,n),l=u(t,e,"fc");if(o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:n,params:{fc:l}}}function pq(r){var t=[],e=ru(r,t);function n(i){var o=e(i+"/weights",2),u=e(i+"/bias",1);return{weights:o,bias:u}}var a={fc:n("fc")};return so(r,t),{params:a,paramMappings:t}}function A_(r){var t={},e={};return Object.keys(r).forEach(function(n){var a=n.startsWith("fc")?e:t;a[n]=r[n]}),{featureExtractorMap:t,classifierMap:e}}var T_=(function(r){ie(t,r);function t(e,n){var a=r.call(this,e)||this;return a._faceFeatureExtractor=n,a}return Object.defineProperty(t.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),t.prototype.runNet=function(e){var n=this,a=this.params;if(!a)throw new Error(this._name+" - load model before inference");return Ht(function(){var i=e instanceof Ed?n.faceFeatureExtractor.forwardInput(e):e;return di(i.as2D(i.shape[0],-1),a.fc)})},t.prototype.dispose=function(e){e===void 0&&(e=!0),this.faceFeatureExtractor.dispose(e),r.prototype.dispose.call(this,e)},t.prototype.loadClassifierParams=function(e){var n=this.extractClassifierParams(e),a=n.params,i=n.paramMappings;this._params=a,this._paramMappings=i},t.prototype.extractClassifierParams=function(e){return dq(e,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},t.prototype.extractParamsFromWeigthMap=function(e){var n=A_(e),a=n.featureExtractorMap,i=n.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(a),pq(i)},t.prototype.extractParams=function(e){var n=this.getClassifierChannelsIn(),a=this.getClassifierChannelsOut(),i=a*n+a,o=e.slice(0,e.length-i),u=e.slice(e.length-i);return this.faceFeatureExtractor.extractWeights(o),this.extractClassifierParams(u)},t})(co),xE=["neutral","happy","sad","angry","fearful","disgusted","surprised"],Uy=(function(){function r(t){var e=this;if(t.length!==7)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+t.length);xE.forEach(function(n,a){e[n]=t[a]})}return r.prototype.asSortedArray=function(){var t=this;return xE.map(function(e){return{expression:e,probability:t[e]}}).sort(function(e,n){return n.probability-e.probability})},r})(),vq=(function(r){ie(t,r);function t(e){return e===void 0&&(e=new __),r.call(this,"FaceExpressionNet",e)||this}return t.prototype.forwardInput=function(e){var n=this;return Ht(function(){return Jo(n.runNet(e))})},t.prototype.forward=function(e){return Jt(this,void 0,void 0,function(){var n;return te(this,function(a){switch(a.label){case 0:return n=this.forwardInput,[4,Vn(e)];case 1:return[2,n.apply(this,[a.sent()])]}})})},t.prototype.predictExpressions=function(e){return Jt(this,void 0,void 0,function(){var n,a,i,o,u=this;return te(this,function(l){switch(l.label){case 0:return[4,Vn(e)];case 1:return n=l.sent(),[4,this.forwardInput(n)];case 2:return a=l.sent(),[4,Promise.all(Zn(a).map(function(h){return Jt(u,void 0,void 0,function(){var f;return te(this,function(p){switch(p.label){case 0:return[4,h.data()];case 1:return f=p.sent(),h.dispose(),[2,f]}})})}))];case 3:return i=l.sent(),a.dispose(),o=i.map(function(h){return new Uy(h)}),[2,n.isBatchInput?o:o[0]]}})})},t.prototype.getDefaultModelName=function(){return"face_expression_model"},t.prototype.getClassifierChannelsIn=function(){return 256},t.prototype.getClassifierChannelsOut=function(){return 7},t})(T_);function mq(r){return r.expressions instanceof Uy}function k_(r,t){var e={expressions:t};return Object.assign({},r,e)}function gq(r,t,e,n){e===void 0&&(e=.1);var a=Array.isArray(t)?t:[t];a.forEach(function(i){var o=i instanceof Uy?i:mq(i)?i.expressions:void 0;if(!o)throw new Error("drawFaceExpressions - expected faceExpressions to be FaceExpressions | WithFaceExpressions<{}> or array thereof");var u=o.asSortedArray(),l=u.filter(function(p){return p.probability>e}),h=Pc(i)?i.detection.box.bottomLeft:n||new xe(0,0),f=new Oy(l.map(function(p){return p.expression+" ("+Ay(p.probability)+")"}),h);f.draw(r)})}function yq(r){var t=r.map(function(u){return u.x}),e=r.map(function(u){return u.y}),n=t.reduce(function(u,l){return l<u?l:u},1/0),a=e.reduce(function(u,l){return l<u?l:u},1/0),i=t.reduce(function(u,l){return u<l?l:u},0),o=e.reduce(function(u,l){return u<l?l:u},0);return new Gd(n,a,i,o)}var xq=.5,bq=.43,wq=.45,dl=(function(){function r(t,e,n){n===void 0&&(n=new xe(0,0));var a=e.width,i=e.height;this._imgDims=new Pu(a,i),this._shift=n,this._positions=t.map(function(o){return o.mul(new xe(a,i)).add(n)})}return Object.defineProperty(r.prototype,"shift",{get:function(){return new xe(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"relativePositions",{get:function(){var t=this;return this._positions.map(function(e){return e.sub(t._shift).div(new xe(t.imageWidth,t.imageHeight))})},enumerable:!0,configurable:!0}),r.prototype.forSize=function(t,e){return new this.constructor(this.relativePositions,{width:t,height:e})},r.prototype.shiftBy=function(t,e){return new this.constructor(this.relativePositions,this._imgDims,new xe(t,e))},r.prototype.shiftByPoint=function(t){return this.shiftBy(t.x,t.y)},r.prototype.align=function(t,e){if(e===void 0&&(e={}),t){var n=t instanceof Jr?t.box.floor():new mi(t);return this.shiftBy(n.x,n.y).align(null,e)}var a=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},e),i=a.useDlibAlignment,o=a.minBoxPadding;return i?this.alignDlib():this.alignMinBbox(o)},r.prototype.alignDlib=function(){var t=this.getRefPointsForAlignment(),e=t[0],n=t[1],a=t[2],i=function(p){return a.sub(p).magnitude()},o=(i(e)+i(n))/2,u=Math.floor(o/wq),l=Ty(t),h=Math.floor(Math.max(0,l.x-xq*u)),f=Math.floor(Math.max(0,l.y-bq*u));return new ky(h,f,Math.min(u,this.imageWidth+h),Math.min(u,this.imageHeight+f))},r.prototype.alignMinBbox=function(t){var e=yq(this.positions);return e.pad(e.width*t,e.height*t)},r.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},r})(),D_=(function(r){ie(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getJawOutline=function(){return this.positions.slice(0,17)},t.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},t.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},t.prototype.getNose=function(){return this.positions.slice(27,36)},t.prototype.getLeftEye=function(){return this.positions.slice(36,42)},t.prototype.getRightEye=function(){return this.positions.slice(42,48)},t.prototype.getMouth=function(){return this.positions.slice(48,68)},t.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(Ty)},t})(dl);function Wy(r){return Pc(r)&&r.landmarks instanceof dl&&r.unshiftedLandmarks instanceof dl&&r.alignedRect instanceof Jr}function jd(r,t){var e=r.detection.box,n=t.shiftBy(e.x,e.y),a=n.align(),i=r.detection.imageDims,o=new Jr(r.detection.score,a.rescale(i.reverse()),i),u={landmarks:n,unshiftedLandmarks:t,alignedRect:o};return Object.assign({},r,u)}var I_=(function(){function r(t){t===void 0&&(t={});var e=t.drawLines,n=e===void 0?!0:e,a=t.drawPoints,i=a===void 0?!0:a,o=t.lineWidth,u=t.lineColor,l=t.pointSize,h=t.pointColor;this.drawLines=n,this.drawPoints=i,this.lineWidth=o||1,this.pointSize=l||2,this.lineColor=u||"rgba(0, 255, 255, 1)",this.pointColor=h||"rgba(255, 0, 255, 1)"}return r})(),N_=(function(){function r(t,e){e===void 0&&(e={}),this.faceLandmarks=t,this.options=new I_(e)}return r.prototype.draw=function(t){var e=gi(t),n=this.options,a=n.drawLines,i=n.drawPoints,o=n.lineWidth,u=n.lineColor,l=n.pointSize,h=n.pointColor;if(a&&this.faceLandmarks instanceof D_&&(e.strokeStyle=u,e.lineWidth=o,Lo(e,this.faceLandmarks.getJawOutline()),Lo(e,this.faceLandmarks.getLeftEyeBrow()),Lo(e,this.faceLandmarks.getRightEyeBrow()),Lo(e,this.faceLandmarks.getNose()),Lo(e,this.faceLandmarks.getLeftEye(),!0),Lo(e,this.faceLandmarks.getRightEye(),!0),Lo(e,this.faceLandmarks.getMouth(),!0)),i){e.strokeStyle=h,e.fillStyle=h;var f=function(p){e.beginPath(),e.arc(p.x,p.y,l,0,2*Math.PI),e.fill()};this.faceLandmarks.positions.forEach(f)}},r})();function Eq(r,t){var e=Array.isArray(t)?t:[t];e.forEach(function(n){var a=n instanceof dl?n:Wy(n)?n.landmarks:void 0;if(!a)throw new Error("drawFaceLandmarks - expected faceExpressions to be FaceLandmarks | WithFaceLandmarks<WithFaceDetection<{}>> or array thereof");new N_(a).draw(r)})}const Cq=Object.freeze(Object.defineProperty({__proto__:null,DrawFaceLandmarks:N_,DrawFaceLandmarksOptions:I_,drawContour:Lo,drawDetections:cq,drawFaceExpressions:gq,drawFaceLandmarks:Eq},Symbol.toStringTag,{value:"Module"}));function Sq(r,t){var e=Hd(r,t),n=By(r,t);function a(o,u,l){var h=n(o,u,l+"/separable_conv0"),f=n(u,u,l+"/separable_conv1"),p=e(o,u,1,l+"/expansion_conv");return{separable_conv0:h,separable_conv1:f,expansion_conv:p}}function i(o,u){var l=n(o,o,u+"/separable_conv0"),h=n(o,o,u+"/separable_conv1"),f=n(o,o,u+"/separable_conv2");return{separable_conv0:l,separable_conv1:h,separable_conv2:f}}return{extractConvParams:e,extractSeparableConvParams:n,extractReductionBlockParams:a,extractMainBlockParams:i}}function Rq(r,t){var e=[],n=lo(r),a=n.extractWeights,i=n.getRemainingWeights,o=Sq(a,e),u=o.extractConvParams,l=o.extractSeparableConvParams,h=o.extractReductionBlockParams,f=o.extractMainBlockParams,p=u(3,32,3,"entry_flow/conv_in"),v=h(32,64,"entry_flow/reduction_block_0"),m=h(64,128,"entry_flow/reduction_block_1"),x={conv_in:p,reduction_block_0:v,reduction_block_1:m},b={};Mc(t,0,1).forEach(function(_){b["main_block_"+_]=f(128,"middle_flow/main_block_"+_)});var E=h(128,256,"exit_flow/reduction_block"),C=l(256,512,"exit_flow/separable_conv"),R={reduction_block:E,separable_conv:C};if(i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:e,params:{entry_flow:x,middle_flow:b,exit_flow:R}}}function _q(r,t){var e=ru(r,t),n=S_(e),a=Py(e);function i(u){var l=a(u+"/separable_conv0"),h=a(u+"/separable_conv1"),f=n(u+"/expansion_conv");return{separable_conv0:l,separable_conv1:h,expansion_conv:f}}function o(u){var l=a(u+"/separable_conv0"),h=a(u+"/separable_conv1"),f=a(u+"/separable_conv2");return{separable_conv0:l,separable_conv1:h,separable_conv2:f}}return{extractConvParams:n,extractSeparableConvParams:a,extractReductionBlockParams:i,extractMainBlockParams:o}}function Aq(r,t){var e=[],n=_q(r,e),a=n.extractConvParams,i=n.extractSeparableConvParams,o=n.extractReductionBlockParams,u=n.extractMainBlockParams,l=a("entry_flow/conv_in"),h=o("entry_flow/reduction_block_0"),f=o("entry_flow/reduction_block_1"),p={conv_in:l,reduction_block_0:h,reduction_block_1:f},v={};Mc(t,0,1).forEach(function(E){v["main_block_"+E]=u("middle_flow/main_block_"+E)});var m=o("exit_flow/reduction_block"),x=i("exit_flow/separable_conv"),b={reduction_block:m,separable_conv:x};return so(r,e),{params:{entry_flow:p,middle_flow:v,exit_flow:b},paramMappings:e}}function O_(r,t,e){return we(ro(r,t.filters,e,"same"),t.bias)}function Hm(r,t,e){e===void 0&&(e=!0);var n=e?wn(r):r;return n=Qr(n,t.separable_conv0,[1,1]),n=Qr(wn(n),t.separable_conv1,[1,1]),n=il(n,[3,3],[2,2],"same"),n=we(n,O_(r,t.expansion_conv,[2,2])),n}function Tq(r,t){var e=Qr(wn(r),t.separable_conv0,[1,1]);return e=Qr(wn(e),t.separable_conv1,[1,1]),e=Qr(wn(e),t.separable_conv2,[1,1]),e=we(e,r),e}var kq=(function(r){ie(t,r);function t(e){var n=r.call(this,"TinyXception")||this;return n._numMainBlocks=e,n}return t.prototype.forwardInput=function(e){var n=this,a=this.params;if(!a)throw new Error("TinyXception - load model before inference");return Ht(function(){var i=e.toBatchTensor(112,!0),o=[122.782,117.001,104.298],u=uh(i,o).div(Tt(256)),l=wn(O_(u,a.entry_flow.conv_in,[2,2]));return l=Hm(l,a.entry_flow.reduction_block_0,!1),l=Hm(l,a.entry_flow.reduction_block_1),Mc(n._numMainBlocks,0,1).forEach(function(h){l=Tq(l,a.middle_flow["main_block_"+h])}),l=Hm(l,a.exit_flow.reduction_block),l=wn(Qr(l,a.exit_flow.separable_conv,[1,1])),l})},t.prototype.forward=function(e){return Jt(this,void 0,void 0,function(){var n;return te(this,function(a){switch(a.label){case 0:return n=this.forwardInput,[4,Vn(e)];case 1:return[2,n.apply(this,[a.sent()])]}})})},t.prototype.getDefaultModelName=function(){return"tiny_xception_model"},t.prototype.extractParamsFromWeigthMap=function(e){return Aq(e,this._numMainBlocks)},t.prototype.extractParams=function(e){return Rq(e,this._numMainBlocks)},t})(co);function Dq(r){var t=[],e=lo(r),n=e.extractWeights,a=e.getRemainingWeights,i=My(n,t),o=i(512,1,"fc/age"),u=i(512,2,"fc/gender");if(a().length!==0)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:t,params:{fc:{age:o,gender:u}}}}function Iq(r){var t=[],e=ru(r,t);function n(i){var o=e(i+"/weights",2),u=e(i+"/bias",1);return{weights:o,bias:u}}var a={fc:{age:n("fc/age"),gender:n("fc/gender")}};return so(r,t),{params:a,paramMappings:t}}var Cd;(function(r){r.FEMALE="female",r.MALE="male"})(Cd||(Cd={}));var Nq=(function(r){ie(t,r);function t(e){e===void 0&&(e=new kq(2));var n=r.call(this,"AgeGenderNet")||this;return n._faceFeatureExtractor=e,n}return Object.defineProperty(t.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),t.prototype.runNet=function(e){var n=this,a=this.params;if(!a)throw new Error(this._name+" - load model before inference");return Ht(function(){var i=e instanceof Ed?n.faceFeatureExtractor.forwardInput(e):e,o=$c(i,[7,7],[2,2],"valid").as2D(i.shape[0],-1),u=di(o,a.fc.age).as1D(),l=di(o,a.fc.gender);return{age:u,gender:l}})},t.prototype.forwardInput=function(e){var n=this;return Ht(function(){var a=n.runNet(e),i=a.age,o=a.gender;return{age:i,gender:Jo(o)}})},t.prototype.forward=function(e){return Jt(this,void 0,void 0,function(){var n;return te(this,function(a){switch(a.label){case 0:return n=this.forwardInput,[4,Vn(e)];case 1:return[2,n.apply(this,[a.sent()])]}})})},t.prototype.predictAgeAndGender=function(e){return Jt(this,void 0,void 0,function(){var n,a,i,o,u,l,h=this;return te(this,function(f){switch(f.label){case 0:return[4,Vn(e)];case 1:return n=f.sent(),[4,this.forwardInput(n)];case 2:return a=f.sent(),i=Zn(a.age),o=Zn(a.gender),u=i.map(function(p,v){return{ageTensor:p,genderTensor:o[v]}}),[4,Promise.all(u.map(function(p){var v=p.ageTensor,m=p.genderTensor;return Jt(h,void 0,void 0,function(){var x,b,E,C,R;return te(this,function(_){switch(_.label){case 0:return[4,v.data()];case 1:return x=_.sent()[0],[4,m.data()];case 2:return b=_.sent()[0],E=b>.5,C=E?Cd.MALE:Cd.FEMALE,R=E?b:1-b,v.dispose(),m.dispose(),[2,{age:x,gender:C,genderProbability:R}]}})})}))];case 3:return l=f.sent(),a.age.dispose(),a.gender.dispose(),[2,n.isBatchInput?l:l[0]]}})})},t.prototype.getDefaultModelName=function(){return"age_gender_model"},t.prototype.dispose=function(e){e===void 0&&(e=!0),this.faceFeatureExtractor.dispose(e),r.prototype.dispose.call(this,e)},t.prototype.loadClassifierParams=function(e){var n=this.extractClassifierParams(e),a=n.params,i=n.paramMappings;this._params=a,this._paramMappings=i},t.prototype.extractClassifierParams=function(e){return Dq(e)},t.prototype.extractParamsFromWeigthMap=function(e){var n=A_(e),a=n.featureExtractorMap,i=n.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(a),Iq(i)},t.prototype.extractParams=function(e){var n=1539,a=e.slice(0,e.length-n),i=e.slice(e.length-n);return this.faceFeatureExtractor.extractWeights(a),this.extractClassifierParams(i)},t})(co),Oq=(function(r){ie(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getRefPointsForAlignment=function(){var e=this.positions;return[e[0],e[1],Ty([e[3],e[4]])]},t})(dl),bE=(function(){function r(t,e){this._label=t,this._distance=e}return Object.defineProperty(r.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),r.prototype.toString=function(t){return t===void 0&&(t=!0),""+this.label+(t?" ("+Ay(this.distance)+")":"")},r})(),qm=(function(){function r(t,e){if(typeof t!="string")throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(e)||e.some(function(n){return!(n instanceof Float32Array)}))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=t,this._descriptors=e}return Object.defineProperty(r.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),r})();function Vy(r,t){return Jt(this,void 0,void 0,function(){var e,n,a,i,o,u,l;return te(this,function(h){switch(h.label){case 0:return e=or.getEnv().Canvas,n=r,r instanceof e?[3,5]:[4,Vn(r)];case 1:if(a=h.sent(),a.batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return i=a.getInput(0),i instanceof e?(o=i,[3,4]):[3,2];case 2:return[4,tq(i)];case 3:o=h.sent(),h.label=4;case 4:n=o,h.label=5;case 5:return u=gi(n),l=t.map(function(f){return f instanceof Jr?f.forSize(n.width,n.height).box.floor():f}).map(function(f){return f.clipAtImageBorders(n.width,n.height)}),[2,l.map(function(f){var p=f.x,v=f.y,m=f.width,x=f.height,b=qd({width:m,height:x});return gi(b).putImageData(u.getImageData(p,v,m,x),0,0),b})]}})})}function Gy(r,t){return Jt(this,void 0,void 0,function(){return te(this,function(e){if(!Vd(r)&&!jo(r))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(jo(r)&&r.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,Ht(function(){var n=r.shape.slice(jo(r)?1:0),a=n[0],i=n[1],o=n[2],u=t.map(function(h){return h instanceof Jr?h.forSize(i,a).box:h}).map(function(h){return h.clipAtImageBorders(i,a)}),l=u.map(function(h){var f=h.x,p=h.y,v=h.width,m=h.height;return HC(r.as3D(a,i,o),[p,f,0],[m,v,o])});return l})]})})}var M_=(function(r){ie(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.postProcess=function(e,n,a){var i=a.map(function(u){var l=u.width,h=u.height,f=n/Math.max(h,l);return{width:l*f,height:h*f}}),o=i.length;return Ht(function(){var u=function(v,m){return Pa([_c([68],v),_c([68],m)],1).as2D(1,136).as1D()},l=function(v,m){var x=i[v],b=x.width,E=x.height;return m(b,E)?Math.abs(b-E)/2:0},h=function(v){return l(v,function(m,x){return m<x})},f=function(v){return l(v,function(m,x){return x<m})},p=e.mul(_c([o,136],n)).sub(Pa(Array.from(Array(o),function(v,m){return u(h(m),f(m))}))).div(Pa(Array.from(Array(o),function(v,m){return u(i[m].width,i[m].height)})));return p})},t.prototype.forwardInput=function(e){var n=this;return Ht(function(){var a=n.runNet(e);return n.postProcess(a,e.inputSize,e.inputDimensions.map(function(i){var o=i[0],u=i[1];return{height:o,width:u}}))})},t.prototype.forward=function(e){return Jt(this,void 0,void 0,function(){var n;return te(this,function(a){switch(a.label){case 0:return n=this.forwardInput,[4,Vn(e)];case 1:return[2,n.apply(this,[a.sent()])]}})})},t.prototype.detectLandmarks=function(e){return Jt(this,void 0,void 0,function(){var n,a,i,o=this;return te(this,function(u){switch(u.label){case 0:return[4,Vn(e)];case 1:return n=u.sent(),a=Ht(function(){return Zn(o.forwardInput(n))}),[4,Promise.all(a.map(function(l,h){return Jt(o,void 0,void 0,function(){var f,p,v,m,x;return te(this,function(b){switch(b.label){case 0:return v=(p=Array).from,[4,l.data()];case 1:return f=v.apply(p,[b.sent()]),m=f.filter(function(E,C){return dE(C)}),x=f.filter(function(E,C){return!dE(C)}),[2,new D_(Array(68).fill(0).map(function(E,C){return new xe(m[C],x[C])}),{height:n.getInputHeight(h),width:n.getInputWidth(h)})]}})})}))];case 2:return i=u.sent(),a.forEach(function(l){return l.dispose()}),[2,n.isBatchInput?i:i[0]]}})})},t.prototype.getClassifierChannelsOut=function(){return 136},t})(T_),B_=(function(r){ie(t,r);function t(e){return e===void 0&&(e=new __),r.call(this,"FaceLandmark68Net",e)||this}return t.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},t.prototype.getClassifierChannelsIn=function(){return 256},t})(M_);function Mq(r){var t=[],e=R_(r,t).extractDenseBlock3Params,n={dense0:e("dense0",!0),dense1:e("dense1"),dense2:e("dense2")};return so(r,t),{params:n,paramMappings:t}}function Bq(r){var t=[],e=lo(r),n=e.extractWeights,a=e.getRemainingWeights,i=C_(n,t).extractDenseBlock3Params,o=i(3,32,"dense0",!0),u=i(32,64,"dense1"),l=i(64,128,"dense2");if(a().length!==0)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:t,params:{dense0:o,dense1:u,dense2:l}}}var Pq=(function(r){ie(t,r);function t(){return r.call(this,"TinyFaceFeatureExtractor")||this}return t.prototype.forwardInput=function(e){var n=this.params;if(!n)throw new Error("TinyFaceFeatureExtractor - load model before inference");return Ht(function(){var a=e.toBatchTensor(112,!0),i=[122.782,117.001,104.298],o=uh(a,i).div(Tt(255)),u=Gm(o,n.dense0,!0);return u=Gm(u,n.dense1),u=Gm(u,n.dense2),u=$c(u,[14,14],[2,2],"valid"),u})},t.prototype.forward=function(e){return Jt(this,void 0,void 0,function(){var n;return te(this,function(a){switch(a.label){case 0:return n=this.forwardInput,[4,Vn(e)];case 1:return[2,n.apply(this,[a.sent()])]}})})},t.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},t.prototype.extractParamsFromWeigthMap=function(e){return Mq(e)},t.prototype.extractParams=function(e){return Bq(e)},t})(co),Fq=(function(r){ie(t,r);function t(e){return e===void 0&&(e=new Pq),r.call(this,"FaceLandmark68TinyNet",e)||this}return t.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},t.prototype.getClassifierChannelsIn=function(){return 128},t})(M_);(function(r){ie(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t})(B_);function Lq(r,t){return we(Zi(r,t.weights),t.biases)}function Hy(r,t,e,n,a){a===void 0&&(a="same");var i=t.conv,o=i.filters,u=i.bias,l=ro(r,o,e,a);return l=we(l,u),l=Lq(l,t.scale),n?wn(l):l}function zq(r,t){return Hy(r,t,[1,1],!0)}function P_(r,t){return Hy(r,t,[1,1],!1)}function F_(r,t){return Hy(r,t,[2,2],!0,"valid")}function Uq(r,t){function e(u,l,h){var f=r(u),p=f.length/(l*h*h);if(jH(p))throw new Error("depth has to be an integer: "+p+", weights.length: "+f.length+", numFilters: "+l+", filterSize: "+h);return Ht(function(){return Ko(Oa(f,[l,p,h,h]),[2,3,1,0])})}function n(u,l,h,f){var p=e(u,l,h),v=jr(r(l));return t.push({paramPath:f+"/filters"},{paramPath:f+"/bias"}),{filters:p,bias:v}}function a(u,l){var h=jr(r(u)),f=jr(r(u));return t.push({paramPath:l+"/weights"},{paramPath:l+"/biases"}),{weights:h,biases:f}}function i(u,l,h,f){var p=n(u,l,h,f+"/conv"),v=a(l,f+"/scale");return{conv:p,scale:v}}function o(u,l,h,f,p){p===void 0&&(p=!1);var v=i((p?.5:1)*u,l,h,f+"/conv1"),m=i(u,l,h,f+"/conv2");return{conv1:v,conv2:m}}return{extractConvLayerParams:i,extractResidualLayerParams:o}}function Wq(r){var t=lo(r),e=t.extractWeights,n=t.getRemainingWeights,a=[],i=Uq(e,a),o=i.extractConvLayerParams,u=i.extractResidualLayerParams,l=o(4704,32,7,"conv32_down"),h=u(9216,32,3,"conv32_1"),f=u(9216,32,3,"conv32_2"),p=u(9216,32,3,"conv32_3"),v=u(36864,64,3,"conv64_down",!0),m=u(36864,64,3,"conv64_1"),x=u(36864,64,3,"conv64_2"),b=u(36864,64,3,"conv64_3"),E=u(147456,128,3,"conv128_down",!0),C=u(147456,128,3,"conv128_1"),R=u(147456,128,3,"conv128_2"),_=u(589824,256,3,"conv256_down",!0),A=u(589824,256,3,"conv256_1"),k=u(589824,256,3,"conv256_2"),D=u(589824,256,3,"conv256_down_out"),P=Ht(function(){return Ko(_d(e(256*128),[128,256]),[1,0])});if(a.push({paramPath:"fc"}),n().length!==0)throw new Error("weights remaing after extract: "+n().length);var M={conv32_down:l,conv32_1:h,conv32_2:f,conv32_3:p,conv64_down:v,conv64_1:m,conv64_2:x,conv64_3:b,conv128_down:E,conv128_1:C,conv128_2:R,conv256_down:_,conv256_1:A,conv256_2:k,conv256_down_out:D,fc:P};return{params:M,paramMappings:a}}function Vq(r,t){var e=ru(r,t);function n(o){var u=e(o+"/scale/weights",1),l=e(o+"/scale/biases",1);return{weights:u,biases:l}}function a(o){var u=e(o+"/conv/filters",4),l=e(o+"/conv/bias",1),h=n(o);return{conv:{filters:u,bias:l},scale:h}}function i(o){return{conv1:a(o+"/conv1"),conv2:a(o+"/conv2")}}return{extractConvLayerParams:a,extractResidualLayerParams:i}}function Gq(r){var t=[],e=Vq(r,t),n=e.extractConvLayerParams,a=e.extractResidualLayerParams,i=n("conv32_down"),o=a("conv32_1"),u=a("conv32_2"),l=a("conv32_3"),h=a("conv64_down"),f=a("conv64_1"),p=a("conv64_2"),v=a("conv64_3"),m=a("conv128_down"),x=a("conv128_1"),b=a("conv128_2"),E=a("conv256_down"),C=a("conv256_1"),R=a("conv256_2"),_=a("conv256_down_out"),A=r.fc;if(t.push({originalPath:"fc",paramPath:"fc"}),!qH(A))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+A);var k={conv32_down:i,conv32_1:o,conv32_2:u,conv32_3:l,conv64_down:h,conv64_1:f,conv64_2:p,conv64_3:v,conv128_down:m,conv128_1:x,conv128_2:b,conv256_down:E,conv256_1:C,conv256_2:R,conv256_down_out:_,fc:A};return so(r,t),{params:k,paramMappings:t}}function ai(r,t){var e=zq(r,t.conv1);return e=P_(e,t.conv2),e=we(e,r),e=wn(e),e}function zf(r,t){var e=F_(r,t.conv1);e=P_(e,t.conv2);var n=$c(r,2,2,"valid"),a=dn(n.shape),i=n.shape[3]!==e.shape[3],o=n.shape[1]!==e.shape[1]||n.shape[2]!==e.shape[2];if(o){var u=e.shape.slice();u[1]=1;var l=dn(u);e=Rr([e,l],1);var h=e.shape.slice();h[2]=1;var f=dn(h);e=Rr([e,f],2)}return n=i?Rr([n,a],3):n,e=we(n,e),e=wn(e),e}var Hq=(function(r){ie(t,r);function t(){return r.call(this,"FaceRecognitionNet")||this}return t.prototype.forwardInput=function(e){var n=this.params;if(!n)throw new Error("FaceRecognitionNet - load model before inference");return Ht(function(){var a=e.toBatchTensor(150,!0).toFloat(),i=[122.782,117.001,104.298],o=uh(a,i).div(Tt(256)),u=F_(o,n.conv32_down);u=il(u,3,2,"valid"),u=ai(u,n.conv32_1),u=ai(u,n.conv32_2),u=ai(u,n.conv32_3),u=zf(u,n.conv64_down),u=ai(u,n.conv64_1),u=ai(u,n.conv64_2),u=ai(u,n.conv64_3),u=zf(u,n.conv128_down),u=ai(u,n.conv128_1),u=ai(u,n.conv128_2),u=zf(u,n.conv256_down),u=ai(u,n.conv256_1),u=ai(u,n.conv256_2),u=zf(u,n.conv256_down_out);var l=u.mean([1,2]),h=Yg(l,n.fc);return h})},t.prototype.forward=function(e){return Jt(this,void 0,void 0,function(){var n;return te(this,function(a){switch(a.label){case 0:return n=this.forwardInput,[4,Vn(e)];case 1:return[2,n.apply(this,[a.sent()])]}})})},t.prototype.computeFaceDescriptor=function(e){return Jt(this,void 0,void 0,function(){var n,a,i,o=this;return te(this,function(u){switch(u.label){case 0:return[4,Vn(e)];case 1:return n=u.sent(),a=Ht(function(){return Zn(o.forwardInput(n))}),[4,Promise.all(a.map(function(l){return l.data()}))];case 2:return i=u.sent(),a.forEach(function(l){return l.dispose()}),[2,n.isBatchInput?i:i[0]]}})})},t.prototype.getDefaultModelName=function(){return"face_recognition_model"},t.prototype.extractParamsFromWeigthMap=function(e){return Gq(e)},t.prototype.extractParams=function(e){return Wq(e)},t})(co);function L_(r,t){var e={descriptor:t};return Object.assign({},r,e)}var z_=(function(){function r(t){var e=t===void 0?{}:t,n=e.minFaceSize,a=e.scaleFactor,i=e.maxNumScales,o=e.scoreThresholds,u=e.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=n||20,this._scaleFactor=a||.709,this._maxNumScales=i||10,this._scoreThresholds=o||[.6,.7,.7],this._scaleSteps=u,typeof this._minFaceSize!="number"||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if(typeof this._scaleFactor!="number"||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if(typeof this._maxNumScales!="number"||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||this._scoreThresholds.length!==3||this._scoreThresholds.some(function(l){return typeof l!="number"}))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some(function(l){return typeof l!="number"})))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(r.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),r})();function qq(r,t){function e(l,h){var f=Oa(r(9*l),[3,3,l,1]),p=jr(r(l)),v=jr(r(l)),m=jr(r(l)),x=jr(r(l));return t.push({paramPath:h+"/filters"},{paramPath:h+"/batch_norm_scale"},{paramPath:h+"/batch_norm_offset"},{paramPath:h+"/batch_norm_mean"},{paramPath:h+"/batch_norm_variance"}),{filters:f,batch_norm_scale:p,batch_norm_offset:v,batch_norm_mean:m,batch_norm_variance:x}}function n(l,h,f,p,v){var m=Oa(r(l*h*f*f),[f,f,l,h]),x=jr(r(h));return t.push({paramPath:p+"/filters"},{paramPath:p+"/"+(v?"batch_norm_offset":"bias")}),{filters:m,bias:x}}function a(l,h,f,p){var v=n(l,h,f,p,!0),m=v.filters,x=v.bias;return{filters:m,batch_norm_offset:x}}function i(l,h,f){var p=e(l,f+"/depthwise_conv"),v=a(l,h,1,f+"/pointwise_conv");return{depthwise_conv:p,pointwise_conv:v}}function o(){var l=a(3,32,3,"mobilenetv1/conv_0"),h=i(32,64,"mobilenetv1/conv_1"),f=i(64,128,"mobilenetv1/conv_2"),p=i(128,128,"mobilenetv1/conv_3"),v=i(128,256,"mobilenetv1/conv_4"),m=i(256,256,"mobilenetv1/conv_5"),x=i(256,512,"mobilenetv1/conv_6"),b=i(512,512,"mobilenetv1/conv_7"),E=i(512,512,"mobilenetv1/conv_8"),C=i(512,512,"mobilenetv1/conv_9"),R=i(512,512,"mobilenetv1/conv_10"),_=i(512,512,"mobilenetv1/conv_11"),A=i(512,1024,"mobilenetv1/conv_12"),k=i(1024,1024,"mobilenetv1/conv_13");return{conv_0:l,conv_1:h,conv_2:f,conv_3:p,conv_4:v,conv_5:m,conv_6:x,conv_7:b,conv_8:E,conv_9:C,conv_10:R,conv_11:_,conv_12:A,conv_13:k}}function u(){var l=a(1024,256,1,"prediction_layer/conv_0"),h=a(256,512,3,"prediction_layer/conv_1"),f=a(512,128,1,"prediction_layer/conv_2"),p=a(128,256,3,"prediction_layer/conv_3"),v=a(256,128,1,"prediction_layer/conv_4"),m=a(128,256,3,"prediction_layer/conv_5"),x=a(256,64,1,"prediction_layer/conv_6"),b=a(64,128,3,"prediction_layer/conv_7"),E=n(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),C=n(512,9,1,"prediction_layer/box_predictor_0/class_predictor"),R=n(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),_=n(1024,18,1,"prediction_layer/box_predictor_1/class_predictor"),A=n(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),k=n(512,18,1,"prediction_layer/box_predictor_2/class_predictor"),D=n(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),P=n(256,18,1,"prediction_layer/box_predictor_3/class_predictor"),M=n(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),O=n(256,18,1,"prediction_layer/box_predictor_4/class_predictor"),F=n(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),W=n(128,18,1,"prediction_layer/box_predictor_5/class_predictor"),j={box_encoding_predictor:E,class_predictor:C},ot={box_encoding_predictor:R,class_predictor:_},nt={box_encoding_predictor:A,class_predictor:k},at={box_encoding_predictor:D,class_predictor:P},V={box_encoding_predictor:M,class_predictor:O},X={box_encoding_predictor:F,class_predictor:W};return{conv_0:l,conv_1:h,conv_2:f,conv_3:p,conv_4:v,conv_5:m,conv_6:x,conv_7:b,box_predictor_0:j,box_predictor_1:ot,box_predictor_2:nt,box_predictor_3:at,box_predictor_4:V,box_predictor_5:X}}return{extractMobilenetV1Params:o,extractPredictionLayerParams:u}}function jq(r){var t=[],e=lo(r),n=e.extractWeights,a=e.getRemainingWeights,i=qq(n,t),o=i.extractMobilenetV1Params,u=i.extractPredictionLayerParams,l=o(),h=u(),f=Lg(n(5118*4),[1,5118,4]),p={extra_dim:f};if(t.push({paramPath:"output_layer/extra_dim"}),a().length!==0)throw new Error("weights remaing after extract: "+a().length);return{params:{mobilenetv1:l,prediction_layer:h,output_layer:p},paramMappings:t}}function Xq(r,t){var e=ru(r,t);function n(h,f,p){var v=e(h+"/Conv2d_"+f+"_pointwise/weights",4,p+"/filters"),m=e(h+"/Conv2d_"+f+"_pointwise/convolution_bn_offset",1,p+"/batch_norm_offset");return{filters:v,batch_norm_offset:m}}function a(h){var f="mobilenetv1/conv_"+h,p="MobilenetV1/Conv2d_"+h+"_depthwise",v=f+"/depthwise_conv",m=f+"/pointwise_conv",x=e(p+"/depthwise_weights",4,v+"/filters"),b=e(p+"/BatchNorm/gamma",1,v+"/batch_norm_scale"),E=e(p+"/BatchNorm/beta",1,v+"/batch_norm_offset"),C=e(p+"/BatchNorm/moving_mean",1,v+"/batch_norm_mean"),R=e(p+"/BatchNorm/moving_variance",1,v+"/batch_norm_variance");return{depthwise_conv:{filters:x,batch_norm_scale:b,batch_norm_offset:E,batch_norm_mean:C,batch_norm_variance:R},pointwise_conv:n("MobilenetV1",h,m)}}function i(){return{conv_0:n("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:a(1),conv_2:a(2),conv_3:a(3),conv_4:a(4),conv_5:a(5),conv_6:a(6),conv_7:a(7),conv_8:a(8),conv_9:a(9),conv_10:a(10),conv_11:a(11),conv_12:a(12),conv_13:a(13)}}function o(h,f){var p=e(h+"/weights",4,f+"/filters"),v=e(h+"/biases",1,f+"/bias");return{filters:p,bias:v}}function u(h){var f=o("Prediction/BoxPredictor_"+h+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+h+"/box_encoding_predictor"),p=o("Prediction/BoxPredictor_"+h+"/ClassPredictor","prediction_layer/box_predictor_"+h+"/class_predictor");return{box_encoding_predictor:f,class_predictor:p}}function l(){return{conv_0:n("Prediction",0,"prediction_layer/conv_0"),conv_1:n("Prediction",1,"prediction_layer/conv_1"),conv_2:n("Prediction",2,"prediction_layer/conv_2"),conv_3:n("Prediction",3,"prediction_layer/conv_3"),conv_4:n("Prediction",4,"prediction_layer/conv_4"),conv_5:n("Prediction",5,"prediction_layer/conv_5"),conv_6:n("Prediction",6,"prediction_layer/conv_6"),conv_7:n("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:u(0),box_predictor_1:u(1),box_predictor_2:u(2),box_predictor_3:u(3),box_predictor_4:u(4),box_predictor_5:u(5)}}return{extractMobilenetV1Params:i,extractPredictionLayerParams:l}}function Kq(r){var t=[],e=Xq(r,t),n=e.extractMobilenetV1Params,a=e.extractPredictionLayerParams,i=r["Output/extra_dim"];if(t.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!Vd(i))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+i);var o={mobilenetv1:n(),prediction_layer:a(),output_layer:{extra_dim:i}};return so(r,t),{params:o,paramMappings:t}}function oi(r,t,e){return Ht(function(){var n=ro(r,t.filters,e,"same");return n=we(n,t.batch_norm_offset),jg(n,0,6)})}var Yq=.0010000000474974513;function Qq(r,t,e){return Ht(function(){var n=Kg(r,t.filters,e,"same");return n=FC(n,t.batch_norm_mean,t.batch_norm_variance,t.batch_norm_offset,t.batch_norm_scale,Yq),jg(n,0,6)})}function Zq(r){return[2,4,6,12].some(function(t){return t===r})?[2,2]:[1,1]}function $q(r,t){return Ht(function(){var e=null,n=oi(r,t.conv_0,[2,2]),a=[t.conv_1,t.conv_2,t.conv_3,t.conv_4,t.conv_5,t.conv_6,t.conv_7,t.conv_8,t.conv_9,t.conv_10,t.conv_11,t.conv_12,t.conv_13];if(a.forEach(function(i,o){var u=o+1,l=Zq(u);n=Qq(n,i.depthwise_conv,l),n=oi(n,i.pointwise_conv,[1,1]),u===11&&(e=n)}),e===null)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:n,conv11:e}})}function Jq(r,t,e,n,a){var i=r.shape[0],o=Math.min(e,i),u=t.map(function(f,p){return{score:f,boxIndex:p}}).filter(function(f){return f.score>a}).sort(function(f,p){return p.score-f.score}),l=function(f){return f<=n?1:0},h=[];return u.forEach(function(f){if(!(h.length>=o)){for(var p=f.score,v=h.length-1;v>=0;--v){var m=tj(r,f.boxIndex,h[v]);if(m!==0&&(f.score*=l(m),f.score<=a))break}p===f.score&&h.push(f.boxIndex)}}),h}function tj(r,t,e){var n=r.arraySync(),a=Math.min(n[t][0],n[t][2]),i=Math.min(n[t][1],n[t][3]),o=Math.max(n[t][0],n[t][2]),u=Math.max(n[t][1],n[t][3]),l=Math.min(n[e][0],n[e][2]),h=Math.min(n[e][1],n[e][3]),f=Math.max(n[e][0],n[e][2]),p=Math.max(n[e][1],n[e][3]),v=(o-a)*(u-i),m=(f-l)*(p-h);if(v<=0||m<=0)return 0;var x=Math.max(a,l),b=Math.max(i,h),E=Math.min(o,f),C=Math.min(u,p),R=Math.max(E-x,0)*Math.max(C-b,0);return R/(v+m-R)}function ej(r){var t=Zn(Ko(r,[1,0])),e=[vi(t[2],t[0]),vi(t[3],t[1])],n=[we(t[0],ji(e[0],Tt(2))),we(t[1],ji(e[1],Tt(2)))];return{sizes:e,centers:n}}function nj(r,t){var e=ej(r),n=e.sizes,a=e.centers,i=Zn(Ko(t,[1,0])),o=ji(Zi(og(ji(i[2],Tt(5))),n[0]),Tt(2)),u=we(Zi(ji(i[0],Tt(10)),n[0]),a[0]),l=ji(Zi(og(ji(i[3],Tt(5))),n[1]),Tt(2)),h=we(Zi(ji(i[1],Tt(10)),n[1]),a[1]);return Ko(Pa([vi(u,o),vi(h,l),we(u,o),we(h,l)]),[1,0])}function rj(r,t,e){return Ht(function(){var n=r.shape[0],a=nj(Ba(Xs(e.extra_dim,[n,1,1]),[-1,4]),Ba(r,[-1,4]));a=Ba(a,[n,a.shape[0]/n,4]);var i=OC(Xo(t,[0,0,1],[-1,-1,-1])),o=Xo(i,[0,0,0],[-1,-1,1]);o=Ba(o,[n,o.shape[1]]);var u=Zn(a),l=Zn(o);return{boxes:u,scores:l}})}function Fs(r,t){return Ht(function(){var e=r.shape[0],n=Ba(La(r,t.box_encoding_predictor),[e,-1,1,4]),a=Ba(La(r,t.class_predictor),[e,-1,3]);return{boxPredictionEncoding:n,classPrediction:a}})}function aj(r,t,e){return Ht(function(){var n=oi(r,e.conv_0,[1,1]),a=oi(n,e.conv_1,[2,2]),i=oi(a,e.conv_2,[1,1]),o=oi(i,e.conv_3,[2,2]),u=oi(o,e.conv_4,[1,1]),l=oi(u,e.conv_5,[2,2]),h=oi(l,e.conv_6,[1,1]),f=oi(h,e.conv_7,[2,2]),p=Fs(t,e.box_predictor_0),v=Fs(r,e.box_predictor_1),m=Fs(a,e.box_predictor_2),x=Fs(o,e.box_predictor_3),b=Fs(l,e.box_predictor_4),E=Fs(f,e.box_predictor_5),C=Rr([p.boxPredictionEncoding,v.boxPredictionEncoding,m.boxPredictionEncoding,x.boxPredictionEncoding,b.boxPredictionEncoding,E.boxPredictionEncoding],1),R=Rr([p.classPrediction,v.classPrediction,m.classPrediction,x.classPrediction,b.classPrediction,E.classPrediction],1);return{boxPredictions:C,classPredictions:R}})}var Xd=(function(){function r(t){var e=t===void 0?{}:t,n=e.minConfidence,a=e.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=n||.5,this._maxResults=a||100,typeof this._minConfidence!="number"||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if(typeof this._maxResults!="number")throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(r.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),r})(),U_=(function(r){ie(t,r);function t(){return r.call(this,"SsdMobilenetv1")||this}return t.prototype.forwardInput=function(e){var n=this.params;if(!n)throw new Error("SsdMobilenetv1 - load model before inference");return Ht(function(){var a=e.toBatchTensor(512,!1).toFloat(),i=vi(Zi(a,Tt(.007843137718737125)),Tt(1)),o=$q(i,n.mobilenetv1),u=aj(o.out,o.conv11,n.prediction_layer),l=u.boxPredictions,h=u.classPredictions;return rj(l,h,n.output_layer)})},t.prototype.forward=function(e){return Jt(this,void 0,void 0,function(){var n;return te(this,function(a){switch(a.label){case 0:return n=this.forwardInput,[4,Vn(e)];case 1:return[2,n.apply(this,[a.sent()])]}})})},t.prototype.locateFaces=function(e,n){return n===void 0&&(n={}),Jt(this,void 0,void 0,function(){var a,i,o,u,l,h,f,p,v,m,x,b,E,C,R,_,A,k,D,P,M;return te(this,function(O){switch(O.label){case 0:return a=new Xd(n),i=a.maxResults,o=a.minConfidence,[4,Vn(e)];case 1:for(u=O.sent(),l=this.forwardInput(u),h=l.boxes,f=l.scores,p=h[0],v=f[0],m=1;m<h.length;m++)h[m].dispose(),f[m].dispose();return E=(b=Array).from,[4,v.data()];case 2:return x=E.apply(b,[O.sent()]),C=.5,R=Jq(p,x,i,C,o),_=u.getReshapedInputDimensions(0),A=u.inputSize,k=A/_.width,D=A/_.height,P=p.arraySync(),M=R.map(function(F){var W=[Math.max(0,P[F][0]),Math.min(1,P[F][2])].map(function(X){return X*D}),j=W[0],ot=W[1],nt=[Math.max(0,P[F][1]),Math.min(1,P[F][3])].map(function(X){return X*k}),at=nt[0],V=nt[1];return new Jr(x[F],new ky(at,j,V-at,ot-j),{height:u.getInputHeight(0),width:u.getInputWidth(0)})}),p.dispose(),v.dispose(),[2,M]}})})},t.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},t.prototype.extractParamsFromWeigthMap=function(e){return Kq(e)},t.prototype.extractParams=function(e){return jq(e)},t})(co);(function(r){ie(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t})(U_);var W_=(function(r){ie(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e._name="TinyFaceDetectorOptions",e}return t})(zy),sh=(function(){function r(){}return r.prototype.then=function(t){return Jt(this,void 0,void 0,function(){var e;return te(this,function(n){switch(n.label){case 0:return e=t,[4,this.run()];case 1:return[2,e.apply(void 0,[n.sent()])]}})})},r.prototype.run=function(){return Jt(this,void 0,void 0,function(){return te(this,function(t){throw new Error("ComposableTask - run is not implemented")})})},r})();function Kd(r,t,e,n,a){return a===void 0&&(a=function(i){var o=i.alignedRect;return o}),Jt(this,void 0,void 0,function(){var i,o,u,l,h;return te(this,function(f){switch(f.label){case 0:return i=r.map(function(p){return Wy(p)?a(p):p.detection}),u=n,u?[3,5]:t instanceof kt?[4,Gy(t,i)]:[3,2];case 1:return l=f.sent(),[3,4];case 2:return[4,Vy(t,i)];case 3:l=f.sent(),f.label=4;case 4:u=l,f.label=5;case 5:return o=u,[4,e(o)];case 6:return h=f.sent(),o.forEach(function(p){return p instanceof kt&&p.dispose()}),[2,h]}})})}function qy(r,t,e,n,a){return Jt(this,void 0,void 0,function(){var i=this;return te(this,function(o){return[2,Kd([r],t,function(u){return Jt(i,void 0,void 0,function(){return te(this,function(l){return[2,e(u[0])]})})},n,a)]})})}function ij(r){return Ht(function(){return Pa(Zn(r,3).reverse(),3)})}var Uf=2,Sd=12;function oj(r,t){var e=Hd(r,t),n=My(r,t);function a(h,f){var p=jr(r(h));return t.push({paramPath:f}),p}function i(h,f,p){p===void 0&&(p=!1);var v=e(h[0],h[1],3,f+"/conv1"),m=a(h[1],f+"/prelu1_alpha"),x=e(h[1],h[2],3,f+"/conv2"),b=a(h[2],f+"/prelu2_alpha"),E=e(h[2],h[3],p?2:3,f+"/conv3"),C=a(h[3],f+"/prelu3_alpha");return{conv1:v,prelu1_alpha:m,conv2:x,prelu2_alpha:b,conv3:E,prelu3_alpha:C}}function o(){var h=i([3,10,16,32],"pnet"),f=e(32,2,1,"pnet/conv4_1"),p=e(32,4,1,"pnet/conv4_2");return Ji({},h,{conv4_1:f,conv4_2:p})}function u(){var h=i([3,28,48,64],"rnet",!0),f=n(576,128,"rnet/fc1"),p=a(128,"rnet/prelu4_alpha"),v=n(128,2,"rnet/fc2_1"),m=n(128,4,"rnet/fc2_2");return Ji({},h,{fc1:f,prelu4_alpha:p,fc2_1:v,fc2_2:m})}function l(){var h=i([3,32,64,64],"onet"),f=e(64,128,2,"onet/conv4"),p=a(128,"onet/prelu4_alpha"),v=n(1152,256,"onet/fc1"),m=a(256,"onet/prelu5_alpha"),x=n(256,2,"onet/fc2_1"),b=n(256,4,"onet/fc2_2"),E=n(256,10,"onet/fc2_3");return Ji({},h,{conv4:f,prelu4_alpha:p,fc1:v,prelu5_alpha:m,fc2_1:x,fc2_2:b,fc2_3:E})}return{extractPNetParams:o,extractRNetParams:u,extractONetParams:l}}function uj(r){var t=lo(r),e=t.extractWeights,n=t.getRemainingWeights,a=[],i=oj(e,a),o=i.extractPNetParams,u=i.extractRNetParams,l=i.extractONetParams,h=o(),f=u(),p=l();if(n().length!==0)throw new Error("weights remaing after extract: "+n().length);return{params:{pnet:h,rnet:f,onet:p},paramMappings:a}}function sj(r,t){var e=ru(r,t);function n(f){var p=e(f+"/weights",4,f+"/filters"),v=e(f+"/bias",1);return{filters:p,bias:v}}function a(f){var p=e(f+"/weights",2),v=e(f+"/bias",1);return{weights:p,bias:v}}function i(f){return e(f,1)}function o(f){var p=n(f+"/conv1"),v=i(f+"/prelu1_alpha"),m=n(f+"/conv2"),x=i(f+"/prelu2_alpha"),b=n(f+"/conv3"),E=i(f+"/prelu3_alpha");return{conv1:p,prelu1_alpha:v,conv2:m,prelu2_alpha:x,conv3:b,prelu3_alpha:E}}function u(){var f=o("pnet"),p=n("pnet/conv4_1"),v=n("pnet/conv4_2");return Ji({},f,{conv4_1:p,conv4_2:v})}function l(){var f=o("rnet"),p=a("rnet/fc1"),v=i("rnet/prelu4_alpha"),m=a("rnet/fc2_1"),x=a("rnet/fc2_2");return Ji({},f,{fc1:p,prelu4_alpha:v,fc2_1:m,fc2_2:x})}function h(){var f=o("onet"),p=n("onet/conv4"),v=i("onet/prelu4_alpha"),m=a("onet/fc1"),x=i("onet/prelu5_alpha"),b=a("onet/fc2_1"),E=a("onet/fc2_2"),C=a("onet/fc2_3");return Ji({},f,{conv4:p,prelu4_alpha:v,fc1:m,prelu5_alpha:x,fc2_1:b,fc2_2:E,fc2_3:C})}return{extractPNetParams:u,extractRNetParams:l,extractONetParams:h}}function lj(r){var t=[],e=sj(r,t),n=e.extractPNetParams,a=e.extractRNetParams,i=e.extractONetParams,o=n(),u=a(),l=i();return so(r,t),{params:{pnet:o,rnet:u,onet:l},paramMappings:t}}function Mg(r,t){var e=t[0],n=t[1];return{height:Math.floor(e*r),width:Math.floor(n*r)}}function cj(r,t,e){for(var n=e[0],a=e[1],i=Sd/r,o=[],u=Math.min(n,a)*i,l=0;u>=12;)o.push(i*Math.pow(t,l)),u=u*t,l+=1;return o}var jy=(function(r){ie(t,r);function t(e,n,a,i){return r.call(this,{left:e,top:n,right:a,bottom:i},!0)||this}return t})(mi);function V_(r){return Ht(function(){return Zi(vi(r,Tt(127.5)),Tt(.0078125))})}function el(r,t){return Ht(function(){return we(wn(r),Zi(t,$f(wn($f(r)))))})}function Xy(r,t,e){return e===void 0&&(e=!1),Ht(function(){var n=La(r,t.conv1,"valid");return n=el(n,t.prelu1_alpha),n=il(n,e?[2,2]:[3,3],[2,2],"same"),n=La(n,t.conv2,"valid"),n=el(n,t.prelu2_alpha),n=e?n:il(n,[3,3],[2,2],"valid"),n=La(n,t.conv3,"valid"),n=el(n,t.prelu3_alpha),n})}function hj(r,t){return Ht(function(){var e=Xy(r,t,!0),n=La(e,t.conv4_1,"valid"),a=pa(Td(n,3),3),i=Jo(vi(n,a),3),o=La(e,t.conv4_2,"valid");return{prob:i,regions:o}})}function fj(r,t){return Ht(function(){var e=Mg(t,r.shape.slice(1)),n=e.height,a=e.width,i=oS.resizeBilinear(r,[n,a]),o=V_(i);return Ko(o,[0,2,1,3])})}function dj(r,t,e,n){for(var a=[],i=r.arraySync(),o=0;o<r.shape[0];o++)for(var u=0;u<r.shape[1];u++)i[o][u]>=n&&a.push(new xe(u,o));var l=a.map(function(h){var f=new Gd(Math.round((h.y*Uf+1)/e),Math.round((h.x*Uf+1)/e),Math.round((h.y*Uf+Sd)/e),Math.round((h.x*Uf+Sd)/e)),p=i[h.y][h.x],v=t.arraySync(),m=new jy(v[h.y][h.x][0],v[h.y][h.x][1],v[h.y][h.x][2],v[h.y][h.x][3]);return{cell:f,score:p,region:m}});return l}function pj(r,t,e,n,a){a.stage1=[];var i=t.map(function(v){return Ht(function(){var m={scale:v},x=fj(r,v),b=Date.now(),E=hj(x,n),C=E.prob,R=E.regions;m.pnet=Date.now()-b;var _=Zn(Zn(C,3)[1])[0],A=Zn(R)[0];return{scoresTensor:_,regionsTensor:A,scale:v,statsForScale:m}})}),o=i.map(function(v){var m=v.scoresTensor,x=v.regionsTensor,b=v.scale,E=v.statsForScale,C=dj(m,x,b,e);if(m.dispose(),x.dispose(),!C.length)return a.stage1.push(E),[];var R=Date.now(),_=Bc(C.map(function(A){return A.cell}),C.map(function(A){return A.score}),.5);return E.nms=Date.now()-R,E.numBoxes=_.length,a.stage1.push(E),_.map(function(A){return C[A]})}),u=o.reduce(function(v,m){return v.concat(m)},[]),l=[],h=[];if(u.length>0){var f=Date.now(),p=Bc(u.map(function(v){return v.cell}),u.map(function(v){return v.score}),.7);a.stage1_nms=Date.now()-f,h=p.map(function(v){return u[v].score}),l=p.map(function(v){return u[v]}).map(function(v){var m=v.cell,x=v.region;return new Gd(m.left+x.left*m.width,m.top+x.top*m.height,m.right+x.right*m.width,m.bottom+x.bottom*m.height).toSquare().round()})}return{boxes:l,scores:h}}function G_(r,t,e){var n=e.width,a=e.height;return Jt(this,void 0,void 0,function(){var i,o,u,l=this;return te(this,function(h){switch(h.label){case 0:return i=gi(r),[4,Promise.all(t.map(function(f){return Jt(l,void 0,void 0,function(){var p,v,m,x,b,E,C,R;return te(this,function(_){return p=f.padAtBorders(r.height,r.width),v=p.y,m=p.ey,x=p.x,b=p.ex,E=x-1,C=v-1,R=i.getImageData(E,C,b-E,m-C),[2,or.isNodejs()?Fy(R):createImageBitmap(R)]})})}))];case 1:return o=h.sent(),u=[],o.forEach(function(f){var p=qd({width:n,height:a}),v=gi(p);v.drawImage(f,0,0,n,a);for(var m=v.getImageData(0,0,n,a).data,x=[],b=0;b<m.length;b+=4)x.push(m[b+2]),x.push(m[b+1]),x.push(m[b]);u.push(x)}),[2,u.map(function(f){var p=Ht(function(){var v=Ko(Oa(f,[1,n,a,3]),[0,2,1,3]).toFloat();return V_(v)});return p})]}})})}function vj(r,t){return Ht(function(){var e=Xy(r,t),n=Ba(e,[e.shape[0],t.fc1.weights.shape[0]]),a=di(n,t.fc1),i=el(a,t.prelu4_alpha),o=di(i,t.fc2_1),u=pa(Td(o,1),1),l=Jo(vi(o,u),1),h=di(i,t.fc2_2),f=Zn(l,1)[1];return{scores:f,regions:h}})}function mj(r,t,e,n,a){return Jt(this,void 0,void 0,function(){var i,o,u,l,h,f,p,v,m,x,b,E,C,R;return te(this,function(_){switch(_.label){case 0:return i=Date.now(),[4,G_(r,t,{width:24,height:24})];case 1:return o=_.sent(),a.stage2_extractImagePatches=Date.now()-i,i=Date.now(),u=o.map(function(A){var k=vj(A,n);return A.dispose(),k}),a.stage2_rnet=Date.now()-i,l=u.length>1?Rr(u.map(function(A){return A.scores})):u[0].scores,p=(f=Array).from,[4,l.data()];case 2:return h=p.apply(f,[_.sent()]),l.dispose(),v=h.map(function(A,k){return{score:A,idx:k}}).filter(function(A){return A.score>e}).map(function(A){var k=A.idx;return k}),m=v.map(function(A){return t[A]}),x=v.map(function(A){return h[A]}),b=[],E=[],m.length>0&&(i=Date.now(),C=Bc(m,x,.7),a.stage2_nms=Date.now()-i,R=C.map(function(A){var k=u[v[A]].regions.arraySync();return new jy(k[0][0],k[0][1],k[0][2],k[0][3])}),E=C.map(function(A){return x[A]}),b=C.map(function(A,k){return m[A].calibrate(R[k])})),u.forEach(function(A){A.regions.dispose(),A.scores.dispose()}),[2,{boxes:b,scores:E}]}})})}function gj(r,t){return Ht(function(){var e=Xy(r,t);e=il(e,[2,2],[2,2],"same"),e=La(e,t.conv4,"valid"),e=el(e,t.prelu4_alpha);var n=Ba(e,[e.shape[0],t.fc1.weights.shape[0]]),a=di(n,t.fc1),i=el(a,t.prelu5_alpha),o=di(i,t.fc2_1),u=pa(Td(o,1),1),l=Jo(vi(o,u),1),h=di(i,t.fc2_2),f=di(i,t.fc2_3),p=Zn(l,1)[1];return{scores:p,regions:h,points:f}})}function yj(r,t,e,n,a){return Jt(this,void 0,void 0,function(){var i,o,u,l,h,f,p,v,m,x,b,E,C,R,_;return te(this,function(A){switch(A.label){case 0:return i=Date.now(),[4,G_(r,t,{width:48,height:48})];case 1:return o=A.sent(),a.stage3_extractImagePatches=Date.now()-i,i=Date.now(),u=o.map(function(k){var D=gj(k,n);return k.dispose(),D}),a.stage3_onet=Date.now()-i,l=u.length>1?Rr(u.map(function(k){return k.scores})):u[0].scores,p=(f=Array).from,[4,l.data()];case 2:return h=p.apply(f,[A.sent()]),l.dispose(),v=h.map(function(k,D){return{score:k,idx:D}}).filter(function(k){return k.score>e}).map(function(k){var D=k.idx;return D}),m=v.map(function(k){var D=u[k].regions.arraySync();return new jy(D[0][0],D[0][1],D[0][2],D[0][3])}),x=v.map(function(k,D){return t[k].calibrate(m[D])}),b=v.map(function(k){return h[k]}),E=[],C=[],R=[],x.length>0&&(i=Date.now(),_=Bc(x,b,.7,!1),a.stage3_nms=Date.now()-i,E=_.map(function(k){return x[k]}),C=_.map(function(k){return b[k]}),R=_.map(function(k,D){return Array(5).fill(0).map(function(P,M){var O=u[k].points.arraySync();return new xe(O[0][M]*(E[D].width+1)+E[D].left,O[0][M+5]*(E[D].height+1)+E[D].top)})})),u.forEach(function(k){k.regions.dispose(),k.scores.dispose(),k.points.dispose()}),[2,{boxes:E,scores:C,points:R}]}})})}var xj=(function(r){ie(t,r);function t(){return r.call(this,"Mtcnn")||this}return t.prototype.forwardInput=function(e,n){return n===void 0&&(n={}),Jt(this,void 0,void 0,function(){var a,i,o,u,l,h,f,p,v,m,x,b,E,C,R,_,A,k,D,P,M;return te(this,function(O){switch(O.label){case 0:if(a=this.params,!a)throw new Error("Mtcnn - load model before inference");if(i=e.canvases[0],!i)throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return o={},u=Date.now(),l=Ht(function(){return ij(pa(KU.fromPixels(i)).toFloat())}),h=function(F){return l.dispose(),o.total=Date.now()-u,F},f=l.shape.slice(1),p=f[0],v=f[1],m=new z_(n),x=m.minFaceSize,b=m.scaleFactor,E=m.maxNumScales,C=m.scoreThresholds,R=m.scaleSteps,_=(R||cj(x,b,[p,v])).filter(function(F){var W=Mg(F,[p,v]);return Math.min(W.width,W.height)>Sd}).slice(0,E),o.scales=_,o.pyramid=_.map(function(F){return Mg(F,[p,v])}),A=Date.now(),[4,pj(l,_,C[0],a.pnet,o)];case 1:return k=O.sent(),o.total_stage1=Date.now()-A,k.boxes.length?(o.stage2_numInputBoxes=k.boxes.length,A=Date.now(),[4,mj(i,k.boxes,C[1],a.rnet,o)]):[2,h({results:[],stats:o})];case 2:return D=O.sent(),o.total_stage2=Date.now()-A,D.boxes.length?(o.stage3_numInputBoxes=D.boxes.length,A=Date.now(),[4,yj(i,D.boxes,C[2],a.onet,o)]):[2,h({results:[],stats:o})];case 3:return P=O.sent(),o.total_stage3=Date.now()-A,M=P.boxes.map(function(F,W){return jd(Fc({},new Jr(P.scores[W],new ky(F.left/v,F.top/p,F.width/v,F.height/p),{height:p,width:v})),new Oq(P.points[W].map(function(j){return j.sub(new xe(F.left,F.top)).div(new xe(F.width,F.height))}),{width:F.width,height:F.height}))}),[2,h({results:M,stats:o})]}})})},t.prototype.forward=function(e,n){return n===void 0&&(n={}),Jt(this,void 0,void 0,function(){var a;return te(this,function(i){switch(i.label){case 0:return a=this.forwardInput,[4,Vn(e)];case 1:return[4,a.apply(this,[i.sent(),n])];case 2:return[2,i.sent().results]}})})},t.prototype.forwardWithStats=function(e,n){return n===void 0&&(n={}),Jt(this,void 0,void 0,function(){var a;return te(this,function(i){switch(i.label){case 0:return a=this.forwardInput,[4,Vn(e)];case 1:return[2,a.apply(this,[i.sent(),n])]}})})},t.prototype.getDefaultModelName=function(){return"mtcnn_model"},t.prototype.extractParamsFromWeigthMap=function(e){return lj(e)},t.prototype.extractParams=function(e){return uj(e)},t})(co),bj=.4,wj=[new xe(1.603231,2.094468),new xe(6.041143,7.080126),new xe(2.882459,3.518061),new xe(4.266906,5.178857),new xe(9.041765,10.66308)],Ej=[117.001,114.697,97.404],Cj=(function(r){ie(t,r);function t(){var e=this,n={withSeparableConvs:!0,iouThreshold:bj,classes:["face"],anchors:wj,meanRgb:Ej,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]};return e=r.call(this,n)||this,e}return Object.defineProperty(t.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),t.prototype.locateFaces=function(e,n){return Jt(this,void 0,void 0,function(){var a;return te(this,function(i){switch(i.label){case 0:return[4,this.detect(e,n)];case 1:return a=i.sent(),[2,a.map(function(o){return new Jr(o.score,o.relativeBox,{width:o.imageWidth,height:o.imageHeight})})]}})})},t.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},t.prototype.extractParamsFromWeigthMap=function(e){return r.prototype.extractParamsFromWeigthMap.call(this,e)},t})(E_),Sj=.4,Rj=[new xe(.738768,.874946),new xe(2.42204,2.65704),new xe(4.30971,7.04493),new xe(10.246,4.59428),new xe(12.6868,11.8741)],_j=[new xe(1.603231,2.094468),new xe(6.041143,7.080126),new xe(2.882459,3.518061),new xe(4.266906,5.178857),new xe(9.041765,10.66308)],Aj=[117.001,114.697,97.404],Tj="tiny_yolov2_model",kj="tiny_yolov2_separable_conv_model",Dj=(function(r){ie(t,r);function t(e){e===void 0&&(e=!0);var n=this,a=Object.assign({},{withSeparableConvs:e,iouThreshold:Sj,classes:["face"]},e?{anchors:_j,meanRgb:Aj}:{anchors:Rj,withClassScores:!0});return n=r.call(this,a)||this,n}return Object.defineProperty(t.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),t.prototype.locateFaces=function(e,n){return Jt(this,void 0,void 0,function(){var a;return te(this,function(i){switch(i.label){case 0:return[4,this.detect(e,n)];case 1:return a=i.sent(),[2,a.map(function(o){return new Jr(o.score,o.relativeBox,{width:o.imageWidth,height:o.imageHeight})})]}})})},t.prototype.getDefaultModelName=function(){return this.withSeparableConvs?kj:Tj},t.prototype.extractParamsFromWeigthMap=function(e){return r.prototype.extractParamsFromWeigthMap.call(this,e)},t})(E_),Zr={ssdMobilenetv1:new U_,tinyFaceDetector:new Cj,tinyYolov2:new Dj,mtcnn:new xj,faceLandmark68Net:new B_,faceLandmark68TinyNet:new Fq,faceRecognitionNet:new Hq,faceExpressionNet:new vq,ageGenderNet:new Nq};function H_(r,t){var e={age:t};return Object.assign({},r,e)}function q_(r,t,e){var n={gender:t,genderProbability:e};return Object.assign({},r,n)}var j_=(function(r){ie(t,r);function t(e,n,a){var i=r.call(this)||this;return i.parentTask=e,i.input=n,i.extractedFaces=a,i}return t})(sh),Ky=(function(r){ie(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.run=function(){return Jt(this,void 0,void 0,function(){var e,n,a=this;return te(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return e=i.sent(),[4,Kd(e,this.input,function(o){return Jt(a,void 0,void 0,function(){return te(this,function(u){switch(u.label){case 0:return[4,Promise.all(o.map(function(l){return Zr.faceExpressionNet.predictExpressions(l)}))];case 1:return[2,u.sent()]}})})},this.extractedFaces)];case 2:return n=i.sent(),[2,e.map(function(o,u){return k_(o,n[u])})]}})})},t.prototype.withAgeAndGender=function(){return new $y(this,this.input)},t})(j_),Yy=(function(r){ie(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.run=function(){return Jt(this,void 0,void 0,function(){var e,n;return te(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return e=a.sent(),e?[4,qy(e,this.input,function(i){return Zr.faceExpressionNet.predictExpressions(i)},this.extractedFaces)]:[2];case 2:return n=a.sent(),[2,k_(e,n)]}})})},t.prototype.withAgeAndGender=function(){return new Jy(this,this.input)},t})(j_),Qy=(function(r){ie(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.withAgeAndGender=function(){return new t0(this,this.input)},t.prototype.withFaceDescriptors=function(){return new n0(this,this.input)},t})(Ky),Zy=(function(r){ie(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.withAgeAndGender=function(){return new e0(this,this.input)},t.prototype.withFaceDescriptor=function(){return new r0(this,this.input)},t})(Yy),X_=(function(r){ie(t,r);function t(e,n,a){var i=r.call(this)||this;return i.parentTask=e,i.input=n,i.extractedFaces=a,i}return t})(sh),$y=(function(r){ie(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.run=function(){return Jt(this,void 0,void 0,function(){var e,n,a=this;return te(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return e=i.sent(),[4,Kd(e,this.input,function(o){return Jt(a,void 0,void 0,function(){return te(this,function(u){switch(u.label){case 0:return[4,Promise.all(o.map(function(l){return Zr.ageGenderNet.predictAgeAndGender(l)}))];case 1:return[2,u.sent()]}})})},this.extractedFaces)];case 2:return n=i.sent(),[2,e.map(function(o,u){var l=n[u],h=l.age,f=l.gender,p=l.genderProbability;return H_(q_(o,f,p),h)})]}})})},t.prototype.withFaceExpressions=function(){return new Ky(this,this.input)},t})(X_),Jy=(function(r){ie(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.run=function(){return Jt(this,void 0,void 0,function(){var e,n,a,i,o;return te(this,function(u){switch(u.label){case 0:return[4,this.parentTask];case 1:return e=u.sent(),e?[4,qy(e,this.input,function(l){return Zr.ageGenderNet.predictAgeAndGender(l)},this.extractedFaces)]:[2];case 2:return n=u.sent(),a=n.age,i=n.gender,o=n.genderProbability,[2,H_(q_(e,i,o),a)]}})})},t.prototype.withFaceExpressions=function(){return new Yy(this,this.input)},t})(X_),t0=(function(r){ie(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.withFaceExpressions=function(){return new Qy(this,this.input)},t.prototype.withFaceDescriptors=function(){return new n0(this,this.input)},t})($y),e0=(function(r){ie(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.withFaceExpressions=function(){return new Zy(this,this.input)},t.prototype.withFaceDescriptor=function(){return new r0(this,this.input)},t})(Jy),K_=(function(r){ie(t,r);function t(e,n){var a=r.call(this)||this;return a.parentTask=e,a.input=n,a}return t})(sh),n0=(function(r){ie(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.run=function(){return Jt(this,void 0,void 0,function(){var e,n;return te(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return e=a.sent(),[4,Kd(e,this.input,function(i){return Promise.all(i.map(function(o){return Zr.faceRecognitionNet.computeFaceDescriptor(o)}))},null,function(i){return i.landmarks.align(null,{useDlibAlignment:!0})})];case 2:return n=a.sent(),[2,n.map(function(i,o){return L_(e[o],i)})]}})})},t.prototype.withFaceExpressions=function(){return new Qy(this,this.input)},t.prototype.withAgeAndGender=function(){return new t0(this,this.input)},t})(K_),r0=(function(r){ie(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.run=function(){return Jt(this,void 0,void 0,function(){var e,n;return te(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return e=a.sent(),e?[4,qy(e,this.input,function(i){return Zr.faceRecognitionNet.computeFaceDescriptor(i)},null,function(i){return i.landmarks.align(null,{useDlibAlignment:!0})})]:[2];case 2:return n=a.sent(),[2,L_(e,n)]}})})},t.prototype.withFaceExpressions=function(){return new Zy(this,this.input)},t.prototype.withAgeAndGender=function(){return new e0(this,this.input)},t})(K_),Y_=(function(r){ie(t,r);function t(e,n,a){var i=r.call(this)||this;return i.parentTask=e,i.input=n,i.useTinyLandmarkNet=a,i}return Object.defineProperty(t.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?Zr.faceLandmark68TinyNet:Zr.faceLandmark68Net},enumerable:!0,configurable:!0}),t})(sh),Ij=(function(r){ie(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.run=function(){return Jt(this,void 0,void 0,function(){var e,n,a,i,o,u=this;return te(this,function(l){switch(l.label){case 0:return[4,this.parentTask];case 1:return e=l.sent(),n=e.map(function(h){return h.detection}),this.input instanceof kt?[4,Gy(this.input,n)]:[3,3];case 2:return i=l.sent(),[3,5];case 3:return[4,Vy(this.input,n)];case 4:i=l.sent(),l.label=5;case 5:return a=i,[4,Promise.all(a.map(function(h){return u.landmarkNet.detectLandmarks(h)}))];case 6:return o=l.sent(),a.forEach(function(h){return h instanceof kt&&h.dispose()}),[2,e.map(function(h,f){return jd(h,o[f])})]}})})},t.prototype.withFaceExpressions=function(){return new Qy(this,this.input)},t.prototype.withAgeAndGender=function(){return new t0(this,this.input)},t.prototype.withFaceDescriptors=function(){return new n0(this,this.input)},t})(Y_),Nj=(function(r){ie(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.run=function(){return Jt(this,void 0,void 0,function(){var e,n,a,i,o;return te(this,function(u){switch(u.label){case 0:return[4,this.parentTask];case 1:return e=u.sent(),e?(n=e.detection,this.input instanceof kt?[4,Gy(this.input,[n])]:[3,3]):[2];case 2:return i=u.sent(),[3,5];case 3:return[4,Vy(this.input,[n])];case 4:i=u.sent(),u.label=5;case 5:return a=i,[4,this.landmarkNet.detectLandmarks(a[0])];case 6:return o=u.sent(),a.forEach(function(l){return l instanceof kt&&l.dispose()}),[2,jd(e,o)]}})})},t.prototype.withFaceExpressions=function(){return new Zy(this,this.input)},t.prototype.withAgeAndGender=function(){return new e0(this,this.input)},t.prototype.withFaceDescriptor=function(){return new r0(this,this.input)},t})(Y_),Q_=(function(r){ie(t,r);function t(e,n){n===void 0&&(n=new Xd);var a=r.call(this)||this;return a.input=e,a.options=n,a}return t})(sh),Z_=(function(r){ie(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.run=function(){return Jt(this,void 0,void 0,function(){var e,n,a,i;return te(this,function(o){switch(o.label){case 0:return e=this,n=e.input,a=e.options,a instanceof z_?[4,Zr.mtcnn.forward(n,a)]:[3,2];case 1:return[2,o.sent().map(function(u){return u.detection})];case 2:if(i=a instanceof W_?function(u){return Zr.tinyFaceDetector.locateFaces(u,a)}:a instanceof Xd?function(u){return Zr.ssdMobilenetv1.locateFaces(u,a)}:a instanceof zy?function(u){return Zr.tinyYolov2.locateFaces(u,a)}:null,!i)throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,i(n)]}})})},t.prototype.runAndExtendWithFaceDetections=function(){var e=this;return new Promise(function(n){return Jt(e,void 0,void 0,function(){var a;return te(this,function(i){switch(i.label){case 0:return[4,this.run()];case 1:return a=i.sent(),[2,n(a.map(function(o){return Fc({},o)}))]}})})})},t.prototype.withFaceLandmarks=function(e){return e===void 0&&(e=!1),new Ij(this.runAndExtendWithFaceDetections(),this.input,e)},t.prototype.withFaceExpressions=function(){return new Ky(this.runAndExtendWithFaceDetections(),this.input)},t.prototype.withAgeAndGender=function(){return new $y(this.runAndExtendWithFaceDetections(),this.input)},t})(Q_);(function(r){ie(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.run=function(){return Jt(this,void 0,void 0,function(){var e,n;return te(this,function(a){switch(a.label){case 0:return[4,new Z_(this.input,this.options)];case 1:return e=a.sent(),n=e[0],e.forEach(function(i){i.score>n.score&&(n=i)}),[2,n]}})})},t.prototype.runAndExtendWithFaceDetection=function(){var e=this;return new Promise(function(n){return Jt(e,void 0,void 0,function(){var a;return te(this,function(i){switch(i.label){case 0:return[4,this.run()];case 1:return a=i.sent(),[2,n(a?Fc({},a):void 0)]}})})})},t.prototype.withFaceLandmarks=function(e){return e===void 0&&(e=!1),new Nj(this.runAndExtendWithFaceDetection(),this.input,e)},t.prototype.withFaceExpressions=function(){return new Yy(this.runAndExtendWithFaceDetection(),this.input)},t.prototype.withAgeAndGender=function(){return new Jy(this.runAndExtendWithFaceDetection(),this.input)},t})(Q_);function Oj(r,t){return t===void 0&&(t=new Xd),new Z_(r,t)}function Mj(r,t){if(r.length!==t.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var e=Array.from(r),n=Array.from(t);return Math.sqrt(e.map(function(a,i){return a-n[i]}).reduce(function(a,i){return a+Math.pow(i,2)},0))}(function(){function r(t,e){e===void 0&&(e=.6),this._distanceThreshold=e;var n=Array.isArray(t)?t:[t];if(!n.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var a=1,i=function(){return"person "+a++};this._labeledDescriptors=n.map(function(o){if(o instanceof qm)return o;if(o instanceof Float32Array)return new qm(i(),[o]);if(o.descriptor&&o.descriptor instanceof Float32Array)return new qm(i(),[o.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")})}return Object.defineProperty(r.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),r.prototype.computeMeanDistance=function(t,e){return e.map(function(n){return Mj(n,t)}).reduce(function(n,a){return n+a},0)/(e.length||1)},r.prototype.matchDescriptor=function(t){var e=this;return this.labeledDescriptors.map(function(n){var a=n.descriptors,i=n.label;return new bE(i,e.computeMeanDistance(t,a))}).reduce(function(n,a){return n.distance<a.distance?n:a})},r.prototype.findBestMatch=function(t){var e=this.matchDescriptor(t);return e.distance<this.distanceThreshold?e:new bE("unknown",e.distance)},r})();function $_(r,t){var e=new Pu(t.width,t.height),n=e.width,a=e.height;if(n<=0||a<=0)throw new Error("resizeResults - invalid dimensions: "+JSON.stringify({width:n,height:a}));if(Array.isArray(r))return r.map(function(u){return $_(u,{width:n,height:a})});if(Wy(r)){var i=r.detection.forSize(n,a),o=r.unshiftedLandmarks.forSize(i.box.width,i.box.height);return jd(Fc(r,i),o)}return Pc(r)?Fc(r,r.detection.forSize(n,a)):r instanceof dl||r instanceof Jr?r.forSize(n,a):r}Ji({},QH,Cq);const Bj=({onRouteChange:r,isSignedIn:t})=>t?It.jsx("nav",{style:{display:"flex",justifyContent:"flex-end"},children:It.jsx("p",{onClick:()=>r("signout"),className:"f3 link dim black underline pa3 pointer",children:"Sign Out"})}):It.jsxs("nav",{style:{display:"flex",justifyContent:"flex-end"},children:[It.jsx("p",{onClick:()=>r("signin"),className:"f3 link dim black underline pa3 pointer",children:"Sign In"}),It.jsx("p",{onClick:()=>r("register"),className:"f3 link dim black underline pa3 pointer",children:"Register"})]}),Pj=({imageUrl:r,boxes:t})=>It.jsx("div",{className:"center ma",children:It.jsxs("div",{className:"absolute mt2",children:[r&&It.jsx("img",{id:"inputimage",alt:"",src:r,width:"500px",height:"auto"}),t.map((e,n)=>It.jsx("div",{className:"bounding-box",style:{top:e.topRow,left:e.leftCol,width:e.width,height:e.height}},n))]})}),wE=(r,t,e,n)=>{r.style.transition=`${t} ${e}ms ${n}`},Ki=(r,t,e)=>Math.min(Math.max(r,t),e);class Fj{constructor(t,e){this.glareAngle=0,this.glareOpacity=0,this.calculateGlareSize=o=>{const{width:u,height:l}=o,h=Math.sqrt(u**2+l**2);return{width:h,height:h}},this.setSize=o=>{const u=this.calculateGlareSize(o);this.glareEl.style.width=`${u.width}px`,this.glareEl.style.height=`${u.height}px`},this.update=(o,u,l,h)=>{this.updateAngle(o,u.glareReverse),this.updateOpacity(o,u,l,h)},this.updateAngle=(o,u)=>{const{xPercentage:l,yPercentage:h}=o,f=180/Math.PI,p=l?Math.atan2(h,-l)*f:0;this.glareAngle=p-(u?180:0)},this.updateOpacity=(o,u,l,h)=>{const{xPercentage:f,yPercentage:p}=o,{glarePosition:v,glareReverse:m,glareMaxOpacity:x}=u,b=l?-1:1,E=h?-1:1,C=m?-1:1;let R=0;switch(v){case"top":R=-f*b*C;break;case"right":R=p*E*C;break;case"bottom":case void 0:R=f*b*C;break;case"left":R=-p*E*C;break;case"all":R=Math.hypot(f,p)}const _=Ki(R,0,100);this.glareOpacity=_*x/100},this.render=o=>{const{glareColor:u}=o;this.glareEl.style.transform=`rotate(${this.glareAngle}deg) translate(-50%, -50%)`,this.glareEl.style.opacity=this.glareOpacity.toString(),this.glareEl.style.background=`linear-gradient(0deg, rgba(255,255,255,0) 0%, ${u} 100%)`},this.glareWrapperEl=document.createElement("div"),this.glareEl=document.createElement("div"),this.glareWrapperEl.appendChild(this.glareEl),this.glareWrapperEl.className="glare-wrapper",this.glareEl.className="glare";const n={position:"absolute",top:"0",left:"0",width:"100%",height:"100%",overflow:"hidden",borderRadius:e,WebkitMaskImage:"-webkit-radial-gradient(white, black)",pointerEvents:"none"},a=this.calculateGlareSize(t),i={position:"absolute",top:"50%",left:"50%",transformOrigin:"0% 0%",pointerEvents:"none",width:`${a.width}px`,height:`${a.height}px`};Object.assign(this.glareWrapperEl.style,n),Object.assign(this.glareEl.style,i)}}class Lj{constructor(){this.tiltAngleX=0,this.tiltAngleY=0,this.tiltAngleXPercentage=0,this.tiltAngleYPercentage=0,this.update=(t,e)=>{this.updateTilt(t,e),this.updateTiltManualInput(t,e),this.updateTiltReverse(e),this.updateTiltLimits(e)},this.updateTilt=(t,e)=>{const{xPercentage:n,yPercentage:a}=t,{tiltMaxAngleX:i,tiltMaxAngleY:o}=e;this.tiltAngleX=n*i/100,this.tiltAngleY=a*o/100*-1},this.updateTiltManualInput=(t,e)=>{const{tiltAngleXManual:n,tiltAngleYManual:a,tiltMaxAngleX:i,tiltMaxAngleY:o}=e;(n!==null||a!==null)&&(this.tiltAngleX=n!==null?n:0,this.tiltAngleY=a!==null?a:0,t.xPercentage=100*this.tiltAngleX/i,t.yPercentage=100*this.tiltAngleY/o)},this.updateTiltReverse=t=>{const e=t.tiltReverse?-1:1;this.tiltAngleX=e*this.tiltAngleX,this.tiltAngleY=e*this.tiltAngleY},this.updateTiltLimits=t=>{const{tiltAxis:e}=t;this.tiltAngleX=Ki(this.tiltAngleX,-90,90),this.tiltAngleY=Ki(this.tiltAngleY,-90,90),e&&(this.tiltAngleX=e==="x"?this.tiltAngleX:0,this.tiltAngleY=e==="y"?this.tiltAngleY:0)},this.updateTiltAnglesPercentage=t=>{const{tiltMaxAngleX:e,tiltMaxAngleY:n}=t;this.tiltAngleXPercentage=this.tiltAngleX/e*100,this.tiltAngleYPercentage=this.tiltAngleY/n*100},this.render=t=>{t.style.transform+=`rotateX(${this.tiltAngleX}deg) rotateY(${this.tiltAngleY}deg) `}}}const zj={scale:1,perspective:1e3,flipVertically:!1,flipHorizontally:!1,reset:!0,transitionEasing:"cubic-bezier(.03,.98,.52,.99)",transitionSpeed:400,trackOnWindow:!1,gyroscope:!1,tiltEnable:!0,tiltReverse:!1,tiltAngleXInitial:0,tiltAngleYInitial:0,tiltMaxAngleX:20,tiltMaxAngleY:20,tiltAxis:void 0,tiltAngleXManual:null,tiltAngleYManual:null,glareEnable:!1,glareMaxOpacity:.7,glareColor:"#ffffff",glarePosition:"bottom",glareReverse:!1,glareBorderRadius:"0"};class J_ extends Lc.PureComponent{constructor(){super(...arguments),this.wrapperEl={node:null,size:{width:0,height:0,left:0,top:0},clientPosition:{x:null,y:null,xPercentage:0,yPercentage:0},updateAnimationId:null,scale:1},this.tilt=null,this.glare=null,this.addDeviceOrientationEventListener=async()=>{if(!window.DeviceOrientationEvent)return;const t=DeviceOrientationEvent.requestPermission;typeof t=="function"?await t()==="granted"&&window.addEventListener("deviceorientation",this.onMove):window.addEventListener("deviceorientation",this.onMove)},this.setSize=()=>{this.setWrapperElSize(),this.glare&&this.glare.setSize(this.wrapperEl.size)},this.mainLoop=t=>{this.wrapperEl.updateAnimationId!==null&&cancelAnimationFrame(this.wrapperEl.updateAnimationId),this.processInput(t),this.update(t.type),this.wrapperEl.updateAnimationId=requestAnimationFrame(this.renderFrame)},this.onEnter=t=>{const{onEnter:e}=this.props;this.setSize(),this.wrapperEl.node.style.willChange="transform",this.setTransitions(),e&&e({event:t})},this.onMove=t=>{this.mainLoop(t),this.emitOnMove(t)},this.onLeave=t=>{const{onLeave:e}=this.props;if(this.setTransitions(),e&&e({event:t}),this.props.reset){const n=new CustomEvent("autoreset");this.onMove(n)}},this.processInput=t=>{const{scale:e}=this.props;switch(t.type){case"mousemove":this.wrapperEl.clientPosition.x=t.pageX,this.wrapperEl.clientPosition.y=t.pageY,this.wrapperEl.scale=e;break;case"touchmove":this.wrapperEl.clientPosition.x=t.touches[0].pageX,this.wrapperEl.clientPosition.y=t.touches[0].pageY,this.wrapperEl.scale=e;break;case"deviceorientation":this.processInputDeviceOrientation(t),this.wrapperEl.scale=e;break;case"autoreset":{const{tiltAngleXInitial:n,tiltAngleYInitial:a,tiltMaxAngleX:i,tiltMaxAngleY:o}=this.props,u=a/o*100;this.wrapperEl.clientPosition.xPercentage=Ki(n/i*100,-100,100),this.wrapperEl.clientPosition.yPercentage=Ki(u,-100,100),this.wrapperEl.scale=1;break}}},this.processInputDeviceOrientation=t=>{if(!t.gamma||!t.beta||!this.props.gyroscope)return;const{tiltMaxAngleX:e,tiltMaxAngleY:n}=this.props,a=t.gamma;this.wrapperEl.clientPosition.xPercentage=t.beta/e*100,this.wrapperEl.clientPosition.yPercentage=a/n*100,this.wrapperEl.clientPosition.xPercentage=Ki(this.wrapperEl.clientPosition.xPercentage,-100,100),this.wrapperEl.clientPosition.yPercentage=Ki(this.wrapperEl.clientPosition.yPercentage,-100,100)},this.update=t=>{const{tiltEnable:e,flipVertically:n,flipHorizontally:a}=this.props;t!=="autoreset"&&t!=="deviceorientation"&&t!=="propChange"&&this.updateClientInput(),e&&this.tilt.update(this.wrapperEl.clientPosition,this.props),this.updateFlip(),this.tilt.updateTiltAnglesPercentage(this.props),this.glare&&this.glare.update(this.wrapperEl.clientPosition,this.props,n,a)},this.updateClientInput=()=>{const{trackOnWindow:t}=this.props;let e,n;if(t){const{x:a,y:i}=this.wrapperEl.clientPosition;e=i/window.innerHeight*200-100,n=a/window.innerWidth*200-100}else{const{size:{width:a,height:i,left:o,top:u},clientPosition:{x:l,y:h}}=this.wrapperEl;e=(h-u)/i*200-100,n=(l-o)/a*200-100}this.wrapperEl.clientPosition.xPercentage=Ki(e,-100,100),this.wrapperEl.clientPosition.yPercentage=Ki(n,-100,100)},this.updateFlip=()=>{const{flipVertically:t,flipHorizontally:e}=this.props;t&&(this.tilt.tiltAngleX+=180,this.tilt.tiltAngleY*=-1),e&&(this.tilt.tiltAngleY+=180)},this.renderFrame=()=>{this.resetWrapperElTransform(),this.renderPerspective(),this.tilt.render(this.wrapperEl.node),this.renderScale(),this.glare&&this.glare.render(this.props)}}componentDidMount(){if(this.tilt=new Lj,this.initGlare(),this.setSize(),this.addEventListeners(),typeof CustomEvent>"u")return;const t=new CustomEvent("autoreset");this.mainLoop(t);const e=new CustomEvent("initial");this.emitOnMove(e)}componentWillUnmount(){this.wrapperEl.updateAnimationId!==null&&cancelAnimationFrame(this.wrapperEl.updateAnimationId),this.removeEventListeners()}componentDidUpdate(){const t=new CustomEvent("propChange");this.mainLoop(t),this.emitOnMove(t)}addEventListeners(){const{trackOnWindow:t,gyroscope:e}=this.props;window.addEventListener("resize",this.setSize),t&&(window.addEventListener("mouseenter",this.onEnter),window.addEventListener("mousemove",this.onMove),window.addEventListener("mouseout",this.onLeave),window.addEventListener("touchstart",this.onEnter),window.addEventListener("touchmove",this.onMove),window.addEventListener("touchend",this.onLeave)),e&&this.addDeviceOrientationEventListener()}removeEventListeners(){const{trackOnWindow:t,gyroscope:e}=this.props;window.removeEventListener("resize",this.setSize),t&&(window.removeEventListener("mouseenter",this.onEnter),window.removeEventListener("mousemove",this.onMove),window.removeEventListener("mouseout",this.onLeave),window.removeEventListener("touchstart",this.onEnter),window.removeEventListener("touchmove",this.onMove),window.removeEventListener("touchend",this.onLeave)),e&&window.DeviceOrientationEvent&&window.removeEventListener("deviceorientation",this.onMove)}setWrapperElSize(){const t=this.wrapperEl.node.getBoundingClientRect();this.wrapperEl.size.width=this.wrapperEl.node.offsetWidth,this.wrapperEl.size.height=this.wrapperEl.node.offsetHeight,this.wrapperEl.size.left=t.left+window.scrollX,this.wrapperEl.size.top=t.top+window.scrollY}initGlare(){const{glareEnable:t,glareBorderRadius:e}=this.props;t&&(this.glare=new Fj(this.wrapperEl.size,e),this.wrapperEl.node.appendChild(this.glare.glareWrapperEl))}emitOnMove(t){const{onMove:e}=this.props;if(!e)return;let n=0,a=0;this.glare&&(n=this.glare.glareAngle,a=this.glare.glareOpacity),e({tiltAngleX:this.tilt.tiltAngleX,tiltAngleY:this.tilt.tiltAngleY,tiltAngleXPercentage:this.tilt.tiltAngleXPercentage,tiltAngleYPercentage:this.tilt.tiltAngleYPercentage,glareAngle:n,glareOpacity:a,event:t})}resetWrapperElTransform(){this.wrapperEl.node.style.transform=""}renderPerspective(){const{perspective:t}=this.props;this.wrapperEl.node.style.transform+=`perspective(${t}px) `}renderScale(){const{scale:t}=this.wrapperEl;this.wrapperEl.node.style.transform+=`scale3d(${t},${t},${t})`}setTransitions(){const{transitionSpeed:t,transitionEasing:e}=this.props;wE(this.wrapperEl.node,"all",t,e),this.glare&&wE(this.glare.glareEl,"opacity",t,e)}render(){const{children:t,className:e,style:n}=this.props;return It.jsx("div",{ref:a=>{this.wrapperEl.node=a},onMouseEnter:this.onEnter,onMouseMove:this.onMove,onMouseLeave:this.onLeave,onTouchStart:this.onEnter,onTouchMove:this.onMove,onTouchEnd:this.onLeave,className:e,style:n,children:t})}}J_.defaultProps=zj;const Uj="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAACXBIWXMAAAsTAAALEwEAmpwYAAANjElEQVR4nO1dCbRVVRn+7uMJ7wFB4AQoKaClK1CTMjPHxOplYGaYqTSoSVrikGQhKaIWQlloYaEhmQODOZYpopUgCKKikvoUNbNQMTVnQX239S+/0/r73efcfcZ7ntxvrb24i3fOns4+e///9w8HaKCBBhpoIAU2AXAsgMsB3AXgIQDLAVwF4HgA28aoa2sA4wFcAeB+1reUdR/DthoIQV8A5wFYB6AaUd4GcCWA7SPq+hAf4Fs16noDwHQAfQocZ6fAJwA8WWPybHkVwJGOur4B4JWYdf0DwK51GHcpsS8nt6rKUwBmAvgKgBEARgM4E8B9jsn8E4BDWW50/P1vAM4AcBCAzwE4HMCFAJ4218lD3AcbOLYB8IKalHUAJgNoCbm+AuAAPrBaq14mfCTvcUHaOMtskc8BGIwNFDJRt5r9fF/PezcHcHPEw7iJ1/hgP7Yd3LsQGyg+YybxkAQPVN6ASwGsBHAPgN8B2D/irQjDoaYv8pA2OFypJuC2encGwCLVH+nbBgVZwc+qCfhsvTuEd/oQ9OfZBG9Zp8GmAEZR2RMlbYzZIl4H0C1h3cNY5yks8ntowrpazFnydfb5FP47qrMrkiKu3kJFLkoaWp1iAp931PdchJRWC495KKULOpt43J2HaxwF78AE7fQE8FpIfT0S1DfWvCG1ysUAWlFyvA/AHSGa8PUA5vCtsZp0B4AJCd/CGQB+zTIjhuisMcXR51fIe82jGO1iEpZwYZQScgjeYDq8AsAnHde2ktzTB3sVwFF16PdY04e1AL7FN91iTwB3m+uvL6sAcJTp6EyPw3oLAPeaVbkFisNAQ9uILjOgxj1yPv3GjFX4s1JhI25LWtvt4nlvf67KKotQI0Vhqmr3KfbFBzK2P6t7/w6gGSXC540YW2uVWewN4GG+/q6tIi98V/VbiMy4b5fmwYS4LA1+pjomB3dR+CKNT/NYrogpsTUBODihICCYr8Ytc1AaXKU6dlxBbfYKMWato7RXBMapdmUOSoPbVce+VFCbXQE8E0K7y9+KwJdVuzIHpcGCOkkcg7hKA+pkHP+vKBypxi26SmkwQ3XsfJQf3TKq5wI1bpmDukOcCSaRjwo69kwGW8b+AFZ56jJxIGfLZWQG/pBSoetqFNvVnIsPog7YhHxVmFfHTinrX6nqWpCQm3IJActMPz+Qor6hIWOXObkEwMYoCMMB/CuCdLsnBdsa4OemThFn0+JSU+d1KetrpmEtbB6E+/oIcsZQ0tu6YfEEOQnAbnRMy4LX6QJglmnnC47rJgJoB/Aoi/w+1XHdaFPXRWQXssBA8nXjuc3qdv4N4MPICS10qQkaWw/gO1Su8kCFzHDQngzWOta5VmaHw/FNuw/dkmOfu9C7cr1ZsFmeg//D942h5oCC3ITeVu3KdhmgyRCTQVlpJnwX0+8hBfT7QNPvk7NuYCPjC3UuisMtqt0fOmj8PWgXGcHf1mh0lhEQioI+B9dkTT7uoSp/o0gJAu94HQZty7kSF79X90tdRUqimtpx2YUS4weqYnHXrJcB6cYE92uHOqmrXgyGMAmZYbqqWF7FIjFetS3sahr/r8z38hjzJr8zw0xV8Y9RLOartsWgZNGTUlWfEPv2T9T9c1EstK1ebP6Z4eyUSloLjU9iWWuLuQ+/qtpui3hYQRG7iKVhtIlYxGVfbE3n76T2krmqbfHezwwHq4rXJpCr29T9i2Pc9ysjqeh2N47QkvuaxfB0QhJwKe+Rw7kf4qGb4boyNUu830gM4pURByPMA/XBjlTyovb/eY6H4bJYfs8ojjt4tN9k/LTESzIOjjGSaW9kjItVAy8DeJAr4HEaZ6Zz4l0YYiZtM4/2dlPX3xkhx9c6QwI96k5Vn0Rs+WxXus+bhDC+4oH/SzprP0oOaxXnKI24HolRDp4mrOwTQoOsUddMiGEAmpZgu3ChP+s6wvP6E1V/xcXUhcWec3I/H1xq9DWKlU8RIg81pJ2nY7jc1AOtxsbjYiZaPPyWbZlPM0AibMFtSVcoHfgLdQNhXz9OF56jGbc3McIfa4CRmJaV2A1zlurnm+TUEHI2PUhp6psA9iLf1kbub5E5B6skaGMvxu6M6dYV3cyDNg2ON3XKKtw95UreU3FZe6Z0gJZx/9b0MS1vtyMdB+1D6ZXGmDMpI8q6QluEtbAlYY67eLK9ccRUuwiXZuThLn39qal7bhIiMUw7ToMmavsdKVdh3xj2EB/s5HgYWQfo/Mi04aUka8lhcY7GnN0ZhXsbRcwkONVhMUwS1gCK1VcDeJGLMK0ZOqyNpeahR2Jb8wTFuNNAttjVzHGkwnmyulDiIBrIB9qkPMGXqpaDvIF8cLqvT7D20ZWcIA3kg4N8d6J2deGnUX4Mpm4T+PYeX7Bvb1Lsp+ZZ4mJCsURdKJ7dZUa3Eni/J8Uhvl7z2uCTVHzEBhQfkhQTfRVEfaHwMFmjK9ng0bTkfSyle8yBjggql4djHAxgHw8ig5DUj6t/RADrYt+Fv70hEpOmqQjDHx0r+kUalXZC/dDC80c7eQdlfQK+bVe+qUILnWaU62GGJd6uVmW6U2IHD0i3GVyF4suaFDYu3VIes+qQHWEvj/SC8rDiQFsoqwx96OZYlDLXsezfVSqL12bkPXEokwmsIDHoSmWxgglrisARxg83KE+wH3fTHhSXG+vnMOjNdzyotjRbS1DE0z0rbMQ9f7lp4/a8HJQVRpr4Fsmbck7KHUCjlelow+ZR3hpvbEr52FZybYyEAHHQbCyKVWqztTCCYWVBrpMLIuz6Gn1MsgJJerAzskcT41DsPD6chEkebNIf/bMAC98Ms2J7JMgGVOs+S128VCMHcFpsbM6oF5Im2uzFrAxBRV9F/uhJL5ag46055cvSe/kJyB+HZ+ESpKOO1ibUF7ZjBrk4itog2qN9xOChXO1TWE73FNWb6Td1WIx+7cI32GdLrBVTH+YIEolzVAVyOCGBpPFyRvF8ZcAatSUm8ZiZo+ZT3JFiQ7v/SNBLXJxkAkE7Ox5V4xFlLy70NilzW3hcxfKUAygbJhldKU0+MZnb2Lg65cGn0/j5+NKWHTuq8axLEMV7YtpENdrz/BcpPULyYl+PY47HQPu/g5HBeaCXGVO/FCL9jLSJVcQ7Lw42M53PIhODyyPfegVWSdzJ3/IQyeM6jIcZ/xIl6NnaDDgO49nFuI3mweQ2h7AJ7TmxCTurNl6N2cZeZsFslbQTCw2/VPGgJMbQr+klda/YWfJAb3rmj2YZlUccRoh2P5VjrfU2VowvVqo0TjrQJkpa6skUdzomQpenctpGkqDCjD1xHOH6hJiLqxzzuRHbsn6Q1SyyYmuzbgcTR1rnOp1yI6zMj+EFeQS3hQUZfx9qgPoKwl2e7EMXz5CMVY4Plo03276Nf0wEmZBHTOPiv7UlpSkdR1GlRnsR3TwvcTyUXjEdyVbG+DhLFPo7+lorR3Bvk0+yyjGdyjHaL/2s5pxs6XiI7VnuEtso0k/L4vpQ7eCW1mK2BxsHuJbXRdmqJ5h7FqbMMlTh3l31FD2HcKuxFs4rTD9amR1CvwWPOJwvHssjx8qAGvmhwsycLSHhy2/V2E8nmeslIMbiQmPxW8+Y+qgAzKizMPjyjysx25wIo5nO/2vLXxPkMfZGE5Uxm8BseY3zoYma6n/MfRNjxHk/blanb1h0xfBQteIyJpu6XuBiq9QY3wpzn8zRt3OMHvg/dDOKjoS0+VoiT6JGfasHa9rfvAESIRW1DQX5UPTkfcq8QbXOo4EM21tCysjXsne0aufhAkzQ74J+SySEOS9cp9qR1euawMEsLnv4NHX/NTn2U4dxy9wUjidCVm7WOE21I/F/cXGN59mRFnurdiSFSF2/amZ1kzKlZ7qpoPRM481BXjh0YrH2DJNKRmm6sxEfswt4Q7oaXc3HYyZzDDYH7vk5fWnmhoiMcM10zRzOMsyhfZ+R1BfKExWaJ7TgULeQiPOMhDOPWmpW2JyB+64cJU0mfCKMBNWH7ZsJaPMoDHToWEUneHuX0me9Dt/iRF1CNjQrcrPdMyzapYdoRkHE4DQYw7EtdSiQy3KK3o2F3o5MBUHpSOkR2JWm5EdCIrqmkop5nmUtvWVc2nc7Obg0wTzDQ4xiVQoPifOYZI0KjfhaWQyKJL9/r+Byx/geIjtdyi+1VegMMMUccnGTf5URO5jzbArHWsoHYdFk3PGX5fAVsy2Zx3AZKf81pGQmZyxYgH1fbvJfFcJRZQmdfLJK+0EWq6nCiNuoz6S+Tse0rNrT3y3siJnIs1TQri9VpsJL86b0MAxwrTI3pcdLs2MMcV2iSoVWRxq8hQmTzWxvLIkBZzROKYbj+H/6mnt94vgcGOSQHm8rg1ibFr0cHyx+jSmafL5wM4Rbhj5Qg/hHl4dJb2rk+to3uWX6WO224oFtY0+WdIJwa290d9jXAyVyERM1j+HePJIk4DQeni7dZrKHQezMEJ3hPuovY9lWG9s+m31xWQtnd4ZPdSfBYR4Rr9WIsirmgdrm6RETVp5koOp7Gt1pNbQJNqsRZSUjuJJ4JMo9XwtJBxhWHqDJucjv8pYCH6WZdA63iweo7S+hhn9sGrdLB7ZinZexjXa2uYh9OIF9aqCBBhpoADXxX9+11ZtlAW3BAAAAAElFTkSuQmCC",Wj=()=>It.jsx("div",{className:"ma4 mt0",children:It.jsx(J_,{className:"br2 shadow-2",tiltMaxAngleX:8,tiltMaxAngleY:8,perspective:2500,style:{height:"150px",width:"150px"},children:It.jsx("div",{className:"flex items-center justify-center pa3",children:It.jsx("img",{alt:"brain",src:Uj,style:{width:"100%"}})})})}),Vj=({onInputChange:r,onButtonSubmit:t})=>It.jsxs("div",{children:[It.jsx("p",{className:"f3",children:"This Magic Brain will detect faces in your pictures. Give it a try."}),It.jsx("div",{className:"center",children:It.jsxs("div",{className:"form center pa4 br3 shadow-5",children:[It.jsx("input",{className:"f4 pa2 w-70 center",type:"text",onChange:r}),It.jsx("button",{className:"w-30 grow f4 link ph3 pv2 dib bg-light-purple",onClick:t,children:"Detect"})]})})]}),Gj=({name:r,entries:t})=>It.jsxs("div",{children:[It.jsx("div",{className:"white f3",children:`${r}, your current rank is...`}),It.jsx("div",{className:"white f1",children:t})]});var Gf={exports:{}};/*!
* raf-manager v0.3.3
*
* Copyright 2018-2025, drawcall <co***@gmail.com>
* Licensed under the MIT license
* http://www.opensource.org/licenses/mit-license
*
*/var Hj=Gf.exports,EE;function qj(){return EE||(EE=1,(function(r,t){(function(e,n){r.exports=n()})(Hj,function(){return(function(){for(var e=["ms","moz","webkit","o"],n=0;n<e.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[e[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[n]+"CancelAnimationFrame"]||window[e[n]+"CancelRequestAnimationFrame"]})(),{timer:0,state:"stop",animations:[],paused:!1,immediate:!0,add:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:60,a={callback:e,fps:n,n:60/n,param:arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,i:0};return this.animations.push(a),this.immediate&&this.animations.length>=1&&this.start(),this},getIndex:function(e){for(var n=0;n<this.animations.length;n++)if(this.animations[n].callback===e)return n;return-1},remove:function(e){if(!(this.getIndex(e)<0))return this.deleteMap(e),this.immediate&&this.animations.length===0&&this.stop(),this},deleteMap:function(e){var n=this.getIndex(e),a=this.animations[n];for(var i in a)delete a[i];this.animations.splice(n,1)},start:function(){if(this.state!=="start")return this.state="start",this.tick(),this},stop:function(){if(this.state!=="stop")return this.state="stop",cancelAnimationFrame(this.timer),this},pause:function(){if(this.state==="start"&&!this.paused)return this.paused=!0,this},resume:function(){if(this.state==="start"&&this.paused)return this.paused=!1,this},tick:function(){var e=this;if(this.timer=requestAnimationFrame(function(){e.tick()}),!this.paused)for(var n=0;n<this.animations.length;n++){var a=this.animations[n],i=a.callback,o=a.param;a.i++,a.i>=a.n&&(i(o),a.i=0)}}}})})(Gf)),Gf.exports}var jj=qj();const Ze=Rd(jj);var Hf={exports:{}};/*!
* Proton v4.2.1
* https://github.com/drawcall/Proton
*
* Copyright 2013-2020, A-JIE
* Licensed under the MIT license
* http://www.opensource.org/licenses/mit-license
*
*/var Xj=Hf.exports,CE;function Kj(){return CE||(CE=1,(function(r,t){(function(e,n){r.exports=n()})(Xj,function(){var e=3.1415926,n={PI:e,PIx2:2*e,PI_2:e/2,PI_180:e/180,N180_PI:180/e,Infinity:-999,isInfinity:function(y){return y===this.Infinity||y===1/0},randomAToB:function(y,T,I){return 2<arguments.length&&I!==void 0&&I?Math.floor(Math.random()*(T-y))+y:y+Math.random()*(T-y)},randomFloating:function(y,T,I){return this.randomAToB(y-T,y+T,I)},randomColor:function(){return"#"+("00000"+(16777216*Math.random()<<0).toString(16)).slice(-6)},randomZone:function(){},floor:function(y,T){return T=1<arguments.length&&T!==void 0?T:4,T=Math.pow(10,T),Math.floor(y*T)/T},degreeTransform:function(y){return y*e/180},toColor16:function(y){return"#"+y.toString(16)}},a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(y){return typeof y}:function(y){return y&&typeof Symbol=="function"&&y.constructor===Symbol&&y!==Symbol.prototype?"symbol":typeof y},i=function(y,T){if(!(y instanceof T))throw new TypeError("Cannot call a class as a function")},o=function(y,T,I){return T&&u(y.prototype,T),I&&u(y,I),y};function u(y,T){for(var I=0;I<T.length;I++){var U=T[I];U.enumerable=U.enumerable||!1,U.configurable=!0,"value"in U&&(U.writable=!0),Object.defineProperty(y,U.key,U)}}function l(y,T,I){y===null&&(y=Function.prototype);var U=Object.getOwnPropertyDescriptor(y,T);if(U!==void 0)return"value"in U?U.value:(U=U.get,U!==void 0?U.call(I):void 0);if((y=Object.getPrototypeOf(y))!==null)return l(y,T,I)}var h=function(y,T){if(typeof T!="function"&&T!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof T);y.prototype=Object.create(T&&T.prototype,{constructor:{value:y,enumerable:!1,writable:!0,configurable:!0}}),T&&(Object.setPrototypeOf?Object.setPrototypeOf(y,T):y.__proto__=T)},f=function(y,T){if(!y)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!T||typeof T!="object"&&typeof T!="function"?y:T},p=(o(v,[{key:"getValue",value:function(y){return y=0<arguments.length&&y!==void 0&&y,this.isArray?O.getRandFromArray(this.a):this.center?n.randomFloating(this.a,this.b,y):n.randomAToB(this.a,this.b,y)}}],[{key:"setSpanValue",value:function(y,T,I){return y instanceof v?y:T===void 0?new v(y):I===void 0?new v(y,T):new v(y,T,I)}},{key:"getSpanValue",value:function(y){return y instanceof v?y.getValue():y}}]),v);function v(y,T,I){i(this,v),O.isArray(y)?(this.isArray=!0,this.a=y):(this.isArray=!1,this.a=O.initValue(y,1),this.b=O.initValue(T,this.a),this.center=O.initValue(I,!1))}var m=function(y){--y;for(var T=1;T<32;T<<=1)y|=y>>T;return y+1},x=function(y,T){return[1,0,0,0,1,0,y,T,1]},b=function(I){var T=Math.cos(I),I=Math.sin(I);return[T,-I,0,I,T,0,0,0,1]},E=function(y,T){return[y,0,0,0,T,0,0,0,1]},C=function(Sn,en){var I=Sn[0],U=Sn[1],J=Sn[2],At=Sn[3],$e=Sn[4],Pn=Sn[5],Je=Sn[6],tn=Sn[7],hr=Sn[8],cn=en[0],Mr=en[1],$a=en[2],Di=en[3],gn=en[4],He=en[5],uu=en[6],Sn=en[7],en=en[8];return[I*cn+U*Di+J*uu,I*Mr+U*gn+J*Sn,I*$a+U*He+J*en,At*cn+$e*Di+Pn*uu,At*Mr+$e*gn+Pn*Sn,At*$a+$e*He+Pn*en,Je*cn+tn*Di+hr*uu,Je*Mr+tn*gn+hr*Sn,Je*$a+tn*He+hr*en]},R={createCanvas:function(y,T,I,At){var J=3<arguments.length&&At!==void 0?At:"absolute",At=document.createElement("canvas");return At.id=y,At.width=T,At.height=I,At.style.opacity=0,At.style.position=J,this.transform(At,-500,-500,0,0),At},createDiv:function(y,T,I){var U=document.createElement("div");return U.id=y,U.style.position="absolute",this.resize(U,T,I),U},resize:function(y,T,I){y.style.width=T+"px",y.style.height=I+"px",y.style.marginLeft=-T/2+"px",y.style.marginTop=-I/2+"px"},transform:function(y,T,I,U,J){y.style.willChange="transform";var At="translate("+T+"px, "+I+"px) scale("+U+") rotate("+J+"deg)";this.css3(y,"transform",At)},transform3d:function(y,T,I,U,J){y.style.willChange="transform",J="translate3d("+T+"px, "+I+"px, 0) scale("+U+") rotate("+J+"deg)",this.css3(y,"backfaceVisibility","hidden"),this.css3(y,"transform",J)},css3:function(y,T,I){var U=T.charAt(0).toUpperCase()+T.substr(1);y.style["Webkit"+U]=I,y.style["Moz"+U]=I,y.style["O"+U]=I,y.style["ms"+U]=I,y.style[""+T]=I}},_={},A={},k=0,D=function(y,T,I){return y.drawImage(T,I.x,I.y),T=y.getImageData(I.x,I.y,I.width,I.height),y.clearRect(I.x,I.y,I.width,I.height),T},P=function(y,T,I){var U=typeof y=="string"?y:y.src;_[U]?T(_[U],I):((y=new Image).onload=function(J){_[U]=J.target,T(_[U],I)},y.src=U)},M=function(y,T,I){var U,J,At=y.src;return A[At]||(U=m(y.width),J=m(y.height),(J=R.createCanvas("proton_canvas_cache_"+ ++k,U,J)).getContext("2d").drawImage(y,0,0,y.width,y.height),A[At]=J),A[At]},O={initValue:function(y,T){return y=y??T},isArray:function(y){return Object.prototype.toString.call(y)==="[object Array]"},emptyArray:function(y){y&&(y.length=0)},toArray:function(y){return this.isArray(y)?y:[y]},getRandFromArray:function(y){return y?y[Math.floor(y.length*Math.random())]:null},emptyObject:function(y,T){var I,U=1<arguments.length&&T!==void 0?T:null;for(I in y)U&&-1<U.indexOf(I)||delete y[I]},classApply:function(y,T){return T=1<arguments.length&&T!==void 0?T:null,new(T?y.bind.apply(y,[null].concat(T)):y)},setVectorVal:function(y,T){T=1<arguments.length&&T!==void 0?T:null,T&&(this.hasProp(T,"x")&&(y.p.x=T.x),this.hasProp(T,"y")&&(y.p.y=T.y),this.hasProp(T,"vx")&&(y.v.x=T.vx),this.hasProp(T,"vy")&&(y.v.y=T.vy),this.hasProp(T,"ax")&&(y.a.x=T.ax),this.hasProp(T,"ay")&&(y.a.y=T.ay),this.hasProp(T,"p")&&y.p.copy(T.p),this.hasProp(T,"v")&&y.v.copy(T.v),this.hasProp(T,"a")&&y.a.copy(T.a),this.hasProp(T,"position")&&y.p.copy(T.position),this.hasProp(T,"velocity")&&y.v.copy(T.velocity),this.hasProp(T,"accelerate")&&y.a.copy(T.accelerate))},hasProp:function(y,T){return!!y&&y[T]!==void 0},setProp:function(y,T){for(var I in T)y.hasOwnProperty(I)&&(y[I]=p.getSpanValue(T[I]));return y},getImageData:function(y,T,I){return D(y,T,I)},destroyAll:function(y,T){for(var I=1<arguments.length&&T!==void 0?T:null,U=y.length;U--;){try{y[U].destroy(I)}catch{}delete y[U]}y.length=0},assign:function(y,T){if(typeof Object.assign=="function")return Object.assign(y,T);for(var I in T)Object.prototype.hasOwnProperty.call(T,I)&&(y[I]=T[I]);return y}},F={},W={_index:0,_cache:{},id:function(y){return F[y]!==void 0&&F[y]!==null||(F[y]=0),y+"_"+F[y]++},getId:function(y){var T=this.getIdFromCache(y);return T||(T="PUID_"+this._index++,this._cache[T]=y,T)},getIdFromCache:function(y){var T,I=void 0;for(I in this._cache)if((T=this._cache[I])===y||this.isBody(T,y)&&T.src===y.src)return I;return null},isBody:function(y,T){return(y===void 0?"undefined":a(y))==="object"&&(T===void 0?"undefined":a(T))==="object"&&y.isInner&&T.isInner},getTarget:function(y){return this._cache[y]}},j=(o(ot,[{key:"get",value:function(y,T,I){var U=void 0;return I=I||y.__puid||W.getId(y),(U=this.cache[I]&&0<this.cache[I].length?this.cache[I].pop():this.createOrClone(y,T)).__puid=y.__puid||I,U}},{key:"expire",value:function(y){return this.getCache(y.__puid).push(y)}},{key:"createOrClone",value:function(y,T){return this.total++,this.create?this.create(y,T):typeof y=="function"?O.classApply(y,T):y.clone()}},{key:"getCount",value:function(){var y,T=0;for(y in this.cache)T+=this.cache[y].length;return T++}},{key:"destroy",value:function(){for(var y in this.cache)this.cache[y].length=0,delete this.cache[y]}},{key:"getCache",value:function(y){return y=0<arguments.length&&y!==void 0?y:"default",this.cache[y]||(this.cache[y]=[]),this.cache[y]}}]),ot);function ot(y){i(this,ot),this.total=0,this.cache={}}var nt=(o(at,[{key:"update",value:function(U,J){this.add(U,J);var I=this.getEmitter(),U=this.getRenderer(),J="";switch(this.type){case 2:J+="emitter:"+this.proton.emitters.length+"<br>",I&&(J+="em speed:"+I.emitSpeed+"<br>"),I&&(J+="pos:"+this.getEmitterPos(I));break;case 3:I&&(J+="initializes:"+I.initializes.length+"<br>"),I&&(J+='<span style="display:inline-block;">'+this.concatArr(I.initializes)+"</span><br>"),I&&(J+="behaviours:"+I.behaviours.length+"<br>"),I&&(J+='<span style="display:inline-block;">'+this.concatArr(I.behaviours)+"</span><br>");break;case 4:U&&(J+=U.name+"<br>"),U&&(J+="body:"+this.getCreatedNumber(U)+"<br>");break;default:J+="particles:"+this.proton.getCount()+"<br>",J+="pool:"+this.proton.pool.getCount()+"<br>",J+="total:"+this.proton.pool.total}this.container.innerHTML=J}},{key:"add",value:function(y,T){var I=this;if(!this.container){this.type=1,this.container=document.createElement("div"),this.container.style.cssText=["position:absolute;bottom:0px;left:0;cursor:pointer;","opacity:0.9;z-index:10000;padding:10px;font-size:12px;font-family:Helvetica,Arial,sans-serif;","width:120px;height:50px;background-color:#002;color:#0ff;"].join(""),this.container.addEventListener("click",function(At){I.type++,4<I.type&&(I.type=1)},!1);var U=void 0,J=void 0;switch(y){case 2:U="#201",J="#f08";break;case 3:U="#020",J="#0f0";break;default:U="#002",J="#0ff"}this.container.style["background-color"]=U,this.container.style.color=J}this.container.parentNode||(T=T||this.body||document.body).appendChild(this.container)}},{key:"getEmitter",value:function(){return this.proton.emitters[this.emitterIndex]}},{key:"getRenderer",value:function(){return this.proton.renderers[this.rendererIndex]}},{key:"concatArr",value:function(y){var T="";if(!y||!y.length)return T;for(var I=0;I<y.length;I++)T+=(y[I].name||"").substr(0,1)+".";return T}},{key:"getCreatedNumber",value:function(y){return y.pool.total||y.cpool&&y.cpool.total||0}},{key:"getEmitterPos",value:function(y){return Math.round(y.p.x)+","+Math.round(y.p.y)}}]),at);function at(y){i(this,at),this.proton=y,this.container=null,this.type=1,this.emitterIndex=0,this.rendererIndex=0}var V=(o(X,[{key:"addEventListener",value:function(y,T){return this._listeners?this.removeEventListener(y,T):this._listeners={},this._listeners[y]||(this._listeners[y]=[]),this._listeners[y].push(T),T}},{key:"removeEventListener",value:function(y,T){if(this._listeners&&this._listeners[y]){for(var I=this._listeners[y],U=I.length,J=0;J<U;J++)if(I[J]===T){U===1?delete this._listeners[y]:I.splice(J,1);break}}}},{key:"removeAllEventListeners",value:function(y){y?this._listeners&&delete this._listeners[y]:this._listeners=null}},{key:"dispatchEvent",value:function(y,T){var I=!1,U=this._listeners;if(y&&U){var J=U[y];if(!J)return I;for(var At=void 0,$e=J.length;$e--;)At=J[$e],I=I||At(T)}return!!I}},{key:"hasEventListener",value:function(y){var T=this._listeners;return!(!T||!T[y])}}],[{key:"bind",value:function(y){y.prototype.dispatchEvent=X.prototype.dispatchEvent,y.prototype.hasEventListener=X.prototype.hasEventListener,y.prototype.addEventListener=X.prototype.addEventListener,y.prototype.removeEventListener=X.prototype.removeEventListener,y.prototype.removeAllEventListeners=X.prototype.removeAllEventListeners}}]),X);function X(){i(this,X),this._listeners=null}var Q=(o(ut,[{key:"calculate",value:function(y,T,I){this.eulerIntegrate(y,T,I)}},{key:"eulerIntegrate",value:function(y,T,I){y.sleep||(y.old.p.copy(y.p),y.old.v.copy(y.v),y.a.multiplyScalar(1/y.mass),y.v.add(y.a.multiplyScalar(T)),y.p.add(y.old.v.multiplyScalar(T)),I&&y.v.multiplyScalar(I),y.a.clear())}}]),ut);function ut(y){i(this,ut),this.type=y}var B=(o($,[{key:"addRenderer",value:function(y){y.init(this),this.renderers.push(y)}},{key:"removeRenderer",value:function(y){var T=this.renderers.indexOf(y);this.renderers.splice(T,1),y.remove(this)}},{key:"addEmitter",value:function(y){this.emitters.push(y),(y.parent=this).dispatchEvent($.EMITTER_ADDED,y)}},{key:"removeEmitter",value:function(y){var T=this.emitters.indexOf(y);this.emitters.splice(T,1),y.parent=null,this.dispatchEvent($.EMITTER_REMOVED,y)}},{key:"update",value:function(){this._fps==="auto"?(this.dispatchEvent($.PROTON_UPDATE),$.USE_CLOCK?(this.then||(this.then=new Date().getTime()),this.now=new Date().getTime(),this.elapsed=.001*(this.now-this.then),this.amendChangeTabsBug(),0<this.elapsed&&this.emittersUpdate(this.elapsed),this.then=this.now):this.emittersUpdate($.DEFAULT_INTERVAL),this.dispatchEvent($.PROTON_UPDATE_AFTER)):(this.then||(this.then=new Date().getTime()),this.now=new Date().getTime(),this.elapsed=.001*(this.now-this.then),this.elapsed>this._interval&&(this.dispatchEvent($.PROTON_UPDATE),this.emittersUpdate(this._interval),this.then=this.now-this.elapsed%this._interval*1e3,this.dispatchEvent($.PROTON_UPDATE_AFTER)))}},{key:"emittersUpdate",value:function(y){for(var T=this.emitters.length;T--;)this.emitters[T].update(y)}},{key:"amendChangeTabsBug",value:function(){$.amendChangeTabsBug&&.5<this.elapsed&&(this.then=new Date().getTime(),this.elapsed=0)}},{key:"getCount",value:function(){for(var y=0,T=this.emitters.length;T--;)y+=this.emitters[T].particles.length;return y}},{key:"getAllParticles",value:function(){for(var y=[],T=this.emitters.length;T--;)y=y.concat(this.emitters[T].particles);return y}},{key:"destroyAllEmitters",value:function(){O.destroyAll(this.emitters)}},{key:"destroy",value:function(y){function T(){I.time=0,I.then=0,I.pool.destroy(),O.destroyAll(I.emitters),O.destroyAll(I.renderers,I.getAllParticles())}var I=this;0<arguments.length&&y!==void 0&&y?setTimeout(T,200):T()}},{key:"fps",set:function(y){this._fps=y,this._interval=y==="auto"?$.DEFAULT_INTERVAL:n.floor(1/y,7)},get:function(){return this._fps}}]),$);function $(y){i(this,$),this.emitters=[],this.renderers=[],this.time=0,this.now=0,this.then=0,this.elapsed=0,this.stats=new nt(this),this.pool=new j(80),this.integrationType=O.initValue(y,$.EULER),this.integrator=new Q(this.integrationType),this._fps="auto",this._interval=$.DEFAULT_INTERVAL}B.USE_CLOCK=!1,B.MEASURE=100,B.EULER="euler",B.RK2="runge-kutta2",B.PARTICLE_CREATED="PARTICLE_CREATED",B.PARTICLE_UPDATE="PARTICLE_UPDATE",B.PARTICLE_SLEEP="PARTICLE_SLEEP",B.PARTICLE_DEAD="PARTICLE_DEAD",B.EMITTER_ADDED="EMITTER_ADDED",B.EMITTER_REMOVED="EMITTER_REMOVED",B.PROTON_UPDATE="PROTON_UPDATE",B.PROTON_UPDATE_AFTER="PROTON_UPDATE_AFTER",B.DEFAULT_INTERVAL=.0167,B.amendChangeTabsBug=!0,V.bind(B);var ht=(o(ft,[{key:"reset",value:function(){this.r=255,this.g=255,this.b=255}}]),ft);function ft(){var y=0<arguments.length&&arguments[0]!==void 0?arguments[0]:255,T=1<arguments.length&&arguments[1]!==void 0?arguments[1]:255,I=2<arguments.length&&arguments[2]!==void 0?arguments[2]:255;i(this,ft),this.r=y,this.g=T,this.b=I}var xt={easeLinear:function(y){return y},easeInQuad:function(y){return Math.pow(y,2)},easeOutQuad:function(y){return-(Math.pow(y-1,2)-1)},easeInOutQuad:function(y){return(y/=.5)<1?.5*Math.pow(y,2):-.5*((y-=2)*y-2)},easeInCubic:function(y){return Math.pow(y,3)},easeOutCubic:function(y){return Math.pow(y-1,3)+1},easeInOutCubic:function(y){return(y/=.5)<1?.5*Math.pow(y,3):.5*(Math.pow(y-2,3)+2)},easeInQuart:function(y){return Math.pow(y,4)},easeOutQuart:function(y){return-(Math.pow(y-1,4)-1)},easeInOutQuart:function(y){return(y/=.5)<1?.5*Math.pow(y,4):-.5*((y-=2)*Math.pow(y,3)-2)},easeInSine:function(y){return 1-Math.cos(y*n.PI_2)},easeOutSine:function(y){return Math.sin(y*n.PI_2)},easeInOutSine:function(y){return-.5*(Math.cos(Math.PI*y)-1)},easeInExpo:function(y){return y===0?0:Math.pow(2,10*(y-1))},easeOutExpo:function(y){return y===1?1:1-Math.pow(2,-10*y)},easeInOutExpo:function(y){return y===0?0:y===1?1:(y/=.5)<1?.5*Math.pow(2,10*(y-1)):.5*(2-Math.pow(2,-10*--y))},easeInCirc:function(y){return-(Math.sqrt(1-y*y)-1)},easeOutCirc:function(y){return Math.sqrt(1-Math.pow(y-1,2))},easeInOutCirc:function(y){return(y/=.5)<1?-.5*(Math.sqrt(1-y*y)-1):.5*(Math.sqrt(1-(y-=2)*y)+1)},easeInBack:function(y){return y*y*(2.70158*y-1.70158)},easeOutBack:function(y){return--y*y*(2.70158*y+1.70158)+1},easeInOutBack:function(y){var T=1.70158;return(y/=.5)<1?y*y*((1+(T*=1.525))*y-T)*.5:.5*((y-=2)*y*((1+(T*=1.525))*y+T)+2)},getEasing:function(y){return typeof y=="function"?y:this[y]||this.easeLinear}},wt=(o(Rt,[{key:"set",value:function(y,T){return this.x=y,this.y=T,this}},{key:"setX",value:function(y){return this.x=y,this}},{key:"setY",value:function(y){return this.y=y,this}},{key:"getGradient",value:function(){return this.x!==0?Math.atan2(this.y,this.x):0<this.y?n.PI_2:this.y<0?-n.PI_2:void 0}},{key:"copy",value:function(y){return this.x=y.x,this.y=y.y,this}},{key:"add",value:function(y,T){return T!==void 0?this.addVectors(y,T):(this.x+=y.x,this.y+=y.y,this)}},{key:"addXY",value:function(y,T){return this.x+=y,this.y+=T,this}},{key:"addVectors",value:function(y,T){return this.x=y.x+T.x,this.y=y.y+T.y,this}},{key:"sub",value:function(y,T){return T!==void 0?this.subVectors(y,T):(this.x-=y.x,this.y-=y.y,this)}},{key:"subVectors",value:function(y,T){return this.x=y.x-T.x,this.y=y.y-T.y,this}},{key:"divideScalar",value:function(y){return y!==0?(this.x/=y,this.y/=y):this.set(0,0),this}},{key:"multiplyScalar",value:function(y){return this.x*=y,this.y*=y,this}},{key:"negate",value:function(){return this.multiplyScalar(-1)}},{key:"dot",value:function(y){return this.x*y.x+this.y*y.y}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"normalize",value:function(){return this.divideScalar(this.length())}},{key:"distanceTo",value:function(y){return Math.sqrt(this.distanceToSquared(y))}},{key:"rotate",value:function(y){var T=this.x,I=this.y;return this.x=T*Math.cos(y)+I*Math.sin(y),this.y=-T*Math.sin(y)+I*Math.cos(y),this}},{key:"distanceToSquared",value:function(I){var T=this.x-I.x,I=this.y-I.y;return T*T+I*I}},{key:"lerp",value:function(y,T){return this.x+=(y.x-this.x)*T,this.y+=(y.y-this.y)*T,this}},{key:"equals",value:function(y){return y.x===this.x&&y.y===this.y}},{key:"clear",value:function(){return this.x=0,this.y=0,this}},{key:"clone",value:function(){return new Rt(this.x,this.y)}}]),Rt);function Rt(y,T){i(this,Rt),this.x=y||0,this.y=T||0}var Dt=(o(_t,[{key:"getDirection",value:function(){return Math.atan2(this.v.x,-this.v.y)*n.N180_PI}},{key:"reset",value:function(){return this.life=1/0,this.age=0,this.dead=!1,this.sleep=!1,this.body=null,this.sprite=null,this.parent=null,this.energy=1,this.mass=1,this.radius=10,this.alpha=1,this.scale=1,this.rotation=0,this.color=null,this.p.set(0,0),this.v.set(0,0),this.a.set(0,0),this.old.p.set(0,0),this.old.v.set(0,0),this.old.a.set(0,0),this.easing=xt.easeLinear,this.rgb.reset(),O.emptyObject(this.data),this.removeAllBehaviours(),this}},{key:"update",value:function(y,T){this.sleep||(this.age+=y,this.applyBehaviours(y,T)),this.age<this.life?(T=this.easing(this.age/this.life),this.energy=Math.max(1-T,0)):this.destroy()}},{key:"applyBehaviours",value:function(y,T){for(var I=this.behaviours.length,U=void 0,U=0;U<I;U++)this.behaviours[U]&&this.behaviours[U].applyBehaviour(this,y,T)}},{key:"addBehaviour",value:function(y){this.behaviours.push(y),y.hasOwnProperty("parents")&&y.parents.push(this),y.initialize(this)}},{key:"addBehaviours",value:function(y){for(var T=y.length,I=void 0,I=0;I<T;I++)this.addBehaviour(y[I])}},{key:"removeBehaviour",value:function(y){y=this.behaviours.indexOf(y),-1<y&&(this.behaviours.splice(y,1).parents=null)}},{key:"removeAllBehaviours",value:function(){O.emptyArray(this.behaviours)}},{key:"destroy",value:function(){this.removeAllBehaviours(),this.energy=0,this.dead=!0,this.parent=null}}]),_t);function _t(y){i(this,_t),this.id="",this.old={},this.data={},this.behaviours=[],this.p=[],this.v=[],this.a=[],this.rgb={},this.name="Particle",this.id=W.id(this.name),this.old={},this.data={},this.behaviours=[],this.p=new wt,this.v=new wt,this.a=new wt,this.old.p=new wt,this.old.v=new wt,this.old.a=new wt,this.rgb=new ht,this.reset(),y&&O.setProp(this,y)}var Pt={hexToRgb:function(y){return y=y.charAt(0)==="#"?y.substring(1,7):y,{r:parseInt(y.substring(0,2),16),g:parseInt(y.substring(2,4),16),b:parseInt(y.substring(4,6),16)}},rgbToHex:function(y){return"rgb("+y.r+", "+y.g+", "+y.b+")"},getHex16FromParticle:function(y){return 65536*Number(y.rgb.r)+256*Number(y.rgb.g)+Number(y.rgb.b)}},jt=(o(Ft,[{key:"set",value:function(y,T){return this.r=y,this.tha=T,this}},{key:"setR",value:function(y){return this.r=y,this}},{key:"setTha",value:function(y){return this.tha=y,this}},{key:"copy",value:function(y){return this.r=y.r,this.tha=y.tha,this}},{key:"toVector",value:function(){return new wt(this.getX(),this.getY())}},{key:"getX",value:function(){return this.r*Math.sin(this.tha)}},{key:"getY",value:function(){return-this.r*Math.cos(this.tha)}},{key:"normalize",value:function(){return this.r=1,this}},{key:"equals",value:function(y){return y.r===this.r&&y.tha===this.tha}},{key:"clear",value:function(){return this.r=0,this.tha=0,this}},{key:"clone",value:function(){return new Ft(this.r,this.tha)}}]),Ft);function Ft(y,T){i(this,Ft),this.r=Math.abs(y)||0,this.tha=T||0}var Wt={create:function(y){var T=new Float32Array(9);return y&&this.set(y,T),T},set:function(y,T){for(var I=0;I<9;I++)T[I]=y[I];return T},multiply:function(gn,He,I){var U=gn[0],J=gn[1],At=gn[2],$e=gn[3],Pn=gn[4],Je=gn[6],tn=gn[7],hr=He[0],cn=He[1],Mr=He[2],$a=He[3],Di=He[4],gn=He[6],He=He[7];return I[0]=hr*U+cn*$e,I[1]=hr*J+cn*Pn,I[2]=At*Mr,I[3]=$a*U+Di*$e,I[4]=$a*J+Di*Pn,I[6]=gn*U+He*$e+Je,I[7]=gn*J+He*Pn+tn,I},inverse:function(Je,T){var I=Je[0],U=Je[1],tn=Je[3],J=Je[4],At=Je[6],$e=Je[7],Pn=-tn,Je=$e*tn-J*At,tn=1/(I*J+U*Pn);return T[0]=J*tn,T[1]=-U*tn,T[3]=Pn*tn,T[4]=I*tn,T[6]=Je*tn,T[7]=(-$e*I+U*At)*tn,T},multiplyVec2:function(y,J,I){var U=J[0],J=J[1];return I[0]=U*y[0]+J*y[3]+y[6],I[1]=U*y[1]+J*y[4]+y[7],I}},Gt=(h($t,p),o($t,[{key:"getValue",value:function(){var y=O.getRandFromArray(this._arr);return y==="random"||y==="Random"?n.randomColor():y}}],[{key:"createArraySpan",value:function(y){return y?y instanceof $t?y:new $t(y):null}}]),$t);function $t(y){i(this,$t);var T=f(this,($t.__proto__||Object.getPrototypeOf($t)).call(this));return T._arr=O.toArray(y),T}var ue=(o(de,[{key:"contains",value:function(y,T){return y<=this.right&&y>=this.x&&T<=this.bottom&&T>=this.y}}]),de);function de(y,T,I,U){i(this,de),this.x=y,this.y=T,this.width=I,this.height=U,this.bottom=this.y+this.height,this.right=this.x+this.width}var Te=(o(je,[{key:"init",value:function(){this.startTime=0,this.nextTime=this.timePan.getValue()}},{key:"getValue",value:function(y){return this.startTime+=y,this.startTime>=this.nextTime?(this.startTime=0,this.nextTime=this.timePan.getValue(),this.numPan.b===1?.5<this.numPan.getValue(!1)?1:0:this.numPan.getValue(!0)):0}}]),je);function je(y,T){i(this,je),this.numPan=p.setSpanValue(O.initValue(y,1)),this.timePan=p.setSpanValue(O.initValue(T,1)),this.startTime=0,this.nextTime=0,this.init()}var Se=(o(vn,[{key:"reset",value:function(){}},{key:"init",value:function(y,T){T?this.initialize(T):this.initialize(y)}},{key:"initialize",value:function(){}}]),vn);function vn(){i(this,vn)}var Xe=(h(Ge,Se),o(Ge,[{key:"initialize",value:function(y){this.lifePan.a===1/0?y.life=1/0:y.life=this.lifePan.getValue()}}]),Ge);function Ge(y,T,I){i(this,Ge);var U=f(this,(Ge.__proto__||Object.getPrototypeOf(Ge)).call(this));return U.lifePan=p.setSpanValue(y,T,I),U.name="Life",U}var ln=(o(Gn,[{key:"getPosition",value:function(){}},{key:"crossing",value:function(){}}]),Gn);function Gn(){i(this,Gn),this.vector=new wt(0,0),this.random=0,this.crossType="dead",this.alert=!0}var Nn=(h(On,ln),o(On,[{key:"getPosition",value:function(){return this.vector.x=this.x,this.vector.y=this.y,this.vector}},{key:"crossing",value:function(){this.alert&&(console.error("Sorry, PointZone does not support crossing method!"),this.alert=!1)}}]),On);function On(y,T){i(this,On);var I=f(this,(On.__proto__||Object.getPrototypeOf(On)).call(this));return I.x=y,I.y=T,I}var Be=(h(Fe,Se),o(Fe,[{key:"reset",value:function(y){this.zone=O.initValue(y,new Nn)}},{key:"initialize",value:function(y){this.zone.getPosition(),y.p.x=this.zone.vector.x,y.p.y=this.zone.vector.y}}]),Fe);function Fe(y){i(this,Fe);var T=f(this,(Fe.__proto__||Object.getPrototypeOf(Fe)).call(this));return T.zone=O.initValue(y,new Nn),T.name="Position",T}var En=(h(Ga,Se),o(Ga,[{key:"reset",value:function(y,T,I){this.rPan=p.setSpanValue(y),this.thaPan=p.setSpanValue(T),this.type=O.initValue(I,"vector")}},{key:"normalizeVelocity",value:function(y){return y*B.MEASURE}},{key:"initialize",value:function(y){var T;this.type==="p"||this.type==="P"||this.type==="polar"?(T=new jt(this.normalizeVelocity(this.rPan.getValue()),this.thaPan.getValue()*n.PI_180),y.v.x=T.getX(),y.v.y=T.getY()):(y.v.x=this.normalizeVelocity(this.rPan.getValue()),y.v.y=this.normalizeVelocity(this.thaPan.getValue()))}}]),Ga);function Ga(y,T,I){i(this,Ga);var U=f(this,(Ga.__proto__||Object.getPrototypeOf(Ga)).call(this));return U.rPan=p.setSpanValue(y),U.thaPan=p.setSpanValue(T),U.type=O.initValue(I,"vector"),U.name="Velocity",U}var El=(h(Ha,Se),o(Ha,[{key:"initialize",value:function(y){y.mass=this.massPan.getValue()}}]),Ha);function Ha(y,T,I){i(this,Ha);var U=f(this,(Ha.__proto__||Object.getPrototypeOf(Ha)).call(this));return U.massPan=p.setSpanValue(y,T,I),U.name="Mass",U}var qa=(h(ur,Se),o(ur,[{key:"reset",value:function(y,T,I){this.radius=p.setSpanValue(y,T,I)}},{key:"initialize",value:function(y){y.radius=this.radius.getValue(),y.data.oldRadius=y.radius}}]),ur);function ur(y,T,I){i(this,ur);var U=f(this,(ur.__proto__||Object.getPrototypeOf(ur)).call(this));return U.radius=p.setSpanValue(y,T,I),U.name="Radius",U}var Dr=(h(Ca,Se),o(Ca,[{key:"initialize",value:function(y){var T=this.image.getValue();y.body=typeof T=="string"?{width:this.w,height:this.h,src:T,isInner:!0,inner:!0}:T}},{key:"setSpanValue",value:function(y){return y instanceof Gt?y:new Gt(y)}}]),Ca);function Ca(y,T,I){i(this,Ca);var U=f(this,(Ca.__proto__||Object.getPrototypeOf(Ca)).call(this));return U.image=U.setSpanValue(y),U.w=O.initValue(T,20),U.h=O.initValue(I,U.w),U.name="Body",U}var Cn=(o(es,[{key:"reset",value:function(y,T){this.life=O.initValue(y,1/0),this.easing=xt.getEasing(T)}},{key:"normalizeForce",value:function(y){return y.multiplyScalar(B.MEASURE)}},{key:"normalizeValue",value:function(y){return y*B.MEASURE}},{key:"initialize",value:function(){}},{key:"calculate",value:function(y,T){this.age+=T,this.age>=this.life||this.dead?(this.energy=0,this.dead=!0,this.destroy()):(y=this.easing(y.age/y.life),this.energy=Math.max(1-y,0))}},{key:"destroy",value:function(){for(var y=this.parents.length;y--;)this.parents[y].removeBehaviour(this);this.parents.length=0}}]),es);function es(y,T){i(this,es),this.life=O.initValue(y,1/0),this.easing=xt.getEasing(T),this.age=0,this.energy=1,this.dead=!1,this.parents=[],this.id="Behaviour_"+es.id++,this.name="Behaviour"}Cn.id=0;var Cl=(h(Sa,Cn),o(Sa,[{key:"reset",value:function(y,T,I,U){this.force=this.normalizeForce(new wt(y,T)),I&&l(Sa.prototype.__proto__||Object.getPrototypeOf(Sa.prototype),"reset",this).call(this,I,U)}},{key:"applyBehaviour",value:function(y,T,I){this.calculate(y,T,I),y.a.add(this.force)}}]),Sa);function Sa(y,T,I,U){return i(this,Sa),U=f(this,(Sa.__proto__||Object.getPrototypeOf(Sa)).call(this,I,U)),U.force=U.normalizeForce(new wt(y,T)),U.name="Force",U}var ns=(h(mr,Cn),o(mr,[{key:"reset",value:function(y,T,I,U,J){this.targetPosition=O.initValue(y,new wt),this.radius=O.initValue(I,1e3),this.force=O.initValue(this.normalizeValue(T),100),this.radiusSq=this.radius*this.radius,this.attractionForce=new wt,this.lengthSq=0,U&&l(mr.prototype.__proto__||Object.getPrototypeOf(mr.prototype),"reset",this).call(this,U,J)}},{key:"applyBehaviour",value:function(y,T,I){this.calculate(y,T,I),this.attractionForce.copy(this.targetPosition),this.attractionForce.sub(y.p),this.lengthSq=this.attractionForce.lengthSq(),4e-5<this.lengthSq&&this.lengthSq<this.radiusSq&&(this.attractionForce.normalize(),this.attractionForce.multiplyScalar(1-this.lengthSq/this.radiusSq),this.attractionForce.multiplyScalar(this.force),y.a.add(this.attractionForce))}}]),mr);function mr(y,T,I,U,J){return i(this,mr),J=f(this,(mr.__proto__||Object.getPrototypeOf(mr)).call(this,U,J)),J.targetPosition=O.initValue(y,new wt),J.radius=O.initValue(I,1e3),J.force=O.initValue(J.normalizeValue(T),100),J.radiusSq=J.radius*J.radius,J.attractionForce=new wt,J.lengthSq=0,J.name="Attraction",J}var Qd=(h(Ra,Cn),o(Ra,[{key:"reset",value:function(y,T,I,U,J){this.panFoce=new wt(y,T),this.panFoce=this.normalizeForce(this.panFoce),this.delay=I,U&&l(Ra.prototype.__proto__||Object.getPrototypeOf(Ra.prototype),"reset",this).call(this,U,J)}},{key:"initialize",value:function(y){y.data.time=0}},{key:"applyBehaviour",value:function(y,T,I){this.calculate(y,T,I),y.data.time+=T,y.data.time>=this.delay&&(y.a.addXY(n.randomAToB(-this.panFoce.x,this.panFoce.x),n.randomAToB(-this.panFoce.y,this.panFoce.y)),y.data.time=0)}}]),Ra);function Ra(y,T,I,U,J){return i(this,Ra),J=f(this,(Ra.__proto__||Object.getPrototypeOf(Ra)).call(this,U,J)),J.reset(y,T,I),J.time=0,J.name="RandomDrift",J}var lh=(h(na,Cl),o(na,[{key:"reset",value:function(y,T,I){l(na.prototype.__proto__||Object.getPrototypeOf(na.prototype),"reset",this).call(this,0,y,T,I)}}]),na);function na(y,T,I){return i(this,na),I=f(this,(na.__proto__||Object.getPrototypeOf(na)).call(this,0,y,T,I)),I.name="Gravity",I}var Sl=(h(_a,Cn),o(_a,[{key:"reset",value:function(y,T,I,U,J){this.emitter=O.initValue(y,null),this.mass=O.initValue(T,!0),this.callback=O.initValue(I,null),this.collisionPool=[],this.delta=new wt,U&&l(_a.prototype.__proto__||Object.getPrototypeOf(_a.prototype),"reset",this).call(this,U,J)}},{key:"applyBehaviour",value:function(y,T,I){for(var U,J,At,$e,Pn,Je,tn=(this.emitter?this.emitter.particles:this.pool).slice(I),hr=tn.length,cn=void 0,Mr=void 0,Mr=0;Mr<hr;Mr++)(cn=tn[Mr])!==y&&(this.delta.copy(cn.p),this.delta.sub(y.p),(U=this.delta.lengthSq())<=(Je=y.radius+cn.radius)*Je&&(J=Je-Math.sqrt(U),J+=.5,At=y.mass+cn.mass,$e=this.mass?cn.mass/At:.5,Pn=this.mass?y.mass/At:.5,y.p.add(this.delta.clone().normalize().multiplyScalar(J*-$e)),cn.p.add(this.delta.normalize().multiplyScalar(J*Pn)),this.callback&&this.callback(y,cn)))}}]),_a);function _a(y,T,I,U,J){return i(this,_a),J=f(this,(_a.__proto__||Object.getPrototypeOf(_a)).call(this,U,J)),J.reset(y,T,I),J.name="Collision",J}var Zd=(h(Hn,Cn),o(Hn,[{key:"reset",value:function(y,T,I,U){this.zone=y,this.zone.crossType=O.initValue(T,"dead"),I&&l(Hn.prototype.__proto__||Object.getPrototypeOf(Hn.prototype),"reset",this).call(this,I,U)}},{key:"applyBehaviour",value:function(y,T,I){this.calculate(y,T,I),this.zone.crossing(y)}}]),Hn);function Hn(y,T,I,U){return i(this,Hn),U=f(this,(Hn.__proto__||Object.getPrototypeOf(Hn)).call(this,I,U)),U.reset(y,T),U.name="CrossZone",U}var Mn=(h(Ke,Cn),o(Ke,[{key:"reset",value:function(y,T,I,U){this.same=T==null,this.a=p.setSpanValue(O.initValue(y,1)),this.b=p.setSpanValue(T),I&&l(Ke.prototype.__proto__||Object.getPrototypeOf(Ke.prototype),"reset",this).call(this,I,U)}},{key:"initialize",value:function(y){y.data.alphaA=this.a.getValue(),this.same?y.data.alphaB=y.data.alphaA:y.data.alphaB=this.b.getValue()}},{key:"applyBehaviour",value:function(y,T,I){this.calculate(y,T,I),y.alpha=y.data.alphaB+(y.data.alphaA-y.data.alphaB)*this.energy,y.alpha<.001&&(y.alpha=0)}}]),Ke);function Ke(y,T,I,U){return i(this,Ke),U=f(this,(Ke.__proto__||Object.getPrototypeOf(Ke)).call(this,I,U)),U.reset(y,T),U.name="Alpha",U}var ho=(h(ra,Cn),o(ra,[{key:"reset",value:function(y,T,I,U){this.same=T==null,this.a=p.setSpanValue(O.initValue(y,1)),this.b=p.setSpanValue(T),I&&l(ra.prototype.__proto__||Object.getPrototypeOf(ra.prototype),"reset",this).call(this,I,U)}},{key:"initialize",value:function(y){y.data.scaleA=this.a.getValue(),y.data.oldRadius=y.radius,y.data.scaleB=this.same?y.data.scaleA:this.b.getValue()}},{key:"applyBehaviour",value:function(y,T,I){this.calculate(y,T,I),y.scale=y.data.scaleB+(y.data.scaleA-y.data.scaleB)*this.energy,y.scale<1e-4&&(y.scale=0),y.radius=y.data.oldRadius*y.scale}}]),ra);function ra(y,T,I,U){return i(this,ra),U=f(this,(ra.__proto__||Object.getPrototypeOf(ra)).call(this,I,U)),U.reset(y,T),U.name="Scale",U}var $d=(h(ja,Cn),o(ja,[{key:"reset",value:function(y,T,I,U,J){this.same=T==null,this.a=p.setSpanValue(O.initValue(y,"Velocity")),this.b=p.setSpanValue(O.initValue(T,0)),this.style=O.initValue(I,"to"),U&&l(ja.prototype.__proto__||Object.getPrototypeOf(ja.prototype),"reset",this).call(this,U,J)}},{key:"initialize",value:function(y){y.rotation=this.a.getValue(),y.data.rotationA=this.a.getValue(),this.same||(y.data.rotationB=this.b.getValue())}},{key:"applyBehaviour",value:function(y,T,I){this.calculate(y,T,I),this.same?this.a.a!=="V"&&this.a.a!=="Velocity"&&this.a.a!=="v"||(y.rotation=y.getDirection()):this.style==="to"||this.style==="TO"||this.style==="_"?y.rotation+=y.data.rotationB+(y.data.rotationA-y.data.rotationB)*this.energy:y.rotation+=y.data.rotationB}}]),ja);function ja(y,T,I,U,J){return i(this,ja),J=f(this,(ja.__proto__||Object.getPrototypeOf(ja)).call(this,U,J)),J.reset(y,T,I),J.name="Rotate",J}var ch=(h(gr,Cn),o(gr,[{key:"reset",value:function(y,T,I,U){this.a=Gt.createArraySpan(y),this.b=Gt.createArraySpan(T),I&&l(gr.prototype.__proto__||Object.getPrototypeOf(gr.prototype),"reset",this).call(this,I,U)}},{key:"initialize",value:function(y){y.color=this.a.getValue(),y.data.colorA=Pt.hexToRgb(y.color),this.b&&(y.data.colorB=Pt.hexToRgb(this.b.getValue()))}},{key:"applyBehaviour",value:function(y,T,I){this.b?(this.calculate(y,T,I),y.rgb.r=y.data.colorB.r+(y.data.colorA.r-y.data.colorB.r)*this.energy,y.rgb.g=y.data.colorB.g+(y.data.colorA.g-y.data.colorB.g)*this.energy,y.rgb.b=y.data.colorB.b+(y.data.colorA.b-y.data.colorB.b)*this.energy,y.rgb.r=Math.floor(y.rgb.r),y.rgb.g=Math.floor(y.rgb.g),y.rgb.b=Math.floor(y.rgb.b)):(y.rgb.r=y.data.colorA.r,y.rgb.g=y.data.colorA.g,y.rgb.b=y.data.colorA.b)}}]),gr);function gr(y,T,I,U){return i(this,gr),U=f(this,(gr.__proto__||Object.getPrototypeOf(gr)).call(this,I,U)),U.reset(y,T),U.name="Color",U}var au="changing",fo=(h(sr,Cn),o(sr,[{key:"setAngleAndForce",value:function(y,T){this.force=au,this.angle=n.PI/2,y==="right"?this.angle=n.PI/2:y==="left"?this.angle=-n.PI/2:y==="random"?this.angle="random":y instanceof p?(this.angle="span",this.span=y):y&&(this.angle=y),String(T).toLowerCase()==="changing"||String(T).toLowerCase()==="chang"||String(T).toLowerCase()==="auto"?this.force=au:T&&(this.force=T)}},{key:"reset",value:function(y,T,I,U){this.angle=n.PI/2,this.setAngleAndForce(y,T),I&&l(sr.prototype.__proto__||Object.getPrototypeOf(sr.prototype),"reset",this).call(this,I,U)}},{key:"initialize",value:function(y){this.angle==="random"?y.data.cangle=n.randomAToB(-n.PI,n.PI):this.angle==="span"&&(y.data.cangle=this.span.getValue()),y.data.cyclone=new wt(0,0)}},{key:"applyBehaviour",value:function(y,T,I){this.calculate(y,T,I),T=void 0,I=y.v.getGradient(),this.angle==="random"||this.angle==="span"?I+=y.data.cangle:I+=this.angle,T=this.force===au?y.v.length()/100:this.force,y.data.cyclone.x=T*Math.cos(I),y.data.cyclone.y=T*Math.sin(I),y.data.cyclone=this.normalizeForce(y.data.cyclone),y.a.add(y.data.cyclone)}}]),sr);function sr(y,T,I,U){return i(this,sr),U=f(this,(sr.__proto__||Object.getPrototypeOf(sr)).call(this,I,U)),U.setAngleAndForce(y,T),U.name="Cyclone",U}var iu=(h(lr,ns),o(lr,[{key:"reset",value:function(y,T,I,U,J){l(lr.prototype.__proto__||Object.getPrototypeOf(lr.prototype),"reset",this).call(this,y,T,I,U,J),this.force*=-1}}]),lr);function lr(y,T,I,U,J){return i(this,lr),J=f(this,(lr.__proto__||Object.getPrototypeOf(lr)).call(this,y,T,I,U,J)),J.force*=-1,J.name="Repulsion",J}var mn=(h(Aa,Cn),o(Aa,[{key:"reset",value:function(y,T,I,U){this.distanceVec=new wt,this.centerPoint=O.initValue(y,new wt),this.force=O.initValue(this.normalizeValue(T),100),I&&l(Aa.prototype.__proto__||Object.getPrototypeOf(Aa.prototype),"reset",this).call(this,I,U)}},{key:"initialize",value:function(){}},{key:"applyBehaviour",value:function(y,T){this.distanceVec.set(this.centerPoint.x-y.p.x,this.centerPoint.y-y.p.y);var I,U=this.distanceVec.lengthSq();U!==0&&(I=this.distanceVec.length(),I=this.force*T/(U*I),y.v.x+=I*this.distanceVec.x,y.v.y+=I*this.distanceVec.y)}}]),Aa);function Aa(y,T,I,U){return i(this,Aa),U=f(this,(Aa.__proto__||Object.getPrototypeOf(Aa)).call(this,I,U)),U.distanceVec=new wt,U.centerPoint=O.initValue(y,new wt),U.force=O.initValue(U.normalizeValue(T),100),U.name="GravityWell",U}var hh={initialize:function(y,T,I){for(var U=I.length,J=void 0,J=0;J<U;J++)I[J]instanceof Se?I[J].init(y,T):this.init(y,T,I[J]);this.bindEmitter(y,T)},init:function(y,T,I){O.setProp(T,I),O.setVectorVal(T,I)},bindEmitter:function(y,T){y.bindEmitter&&(T.p.add(y.p),T.v.add(y.v),T.a.add(y.a),T.v.rotate(n.degreeTransform(y.rotation)))}},aa=(h(Ir,Dt),o(Ir,[{key:"emit",value:function(y,T){this.stoped=!1,this.emitTime=0,this.totalTime=O.initValue(y,1/0),T===!0||T==="life"||T==="destroy"?this.life=y==="once"?1:this.totalTime:isNaN(T)||(this.life=T),this.rate.init()}},{key:"stop",value:function(){this.totalTime=-1,this.emitTime=0,this.stoped=!0}},{key:"preEmit",value:function(y){var T=this.stoped,I=this.emitTime,U=this.totalTime;for(this.stoped=!1,this.emitTime=0,this.totalTime=y,this.rate.init();.0167<y;)y-=.0167,this.update(.0167);this.stoped=T,this.emitTime=I+Math.max(y,0),this.totalTime=U}},{key:"removeAllParticles",value:function(){for(var y=this.particles.length;y--;)this.particles[y].dead=!0}},{key:"addSelfInitialize",value:function(y){y.init?y.init(this):this.initAll()}},{key:"addInitialize",value:function(){for(var y=arguments.length,T=Array(y),I=0;I<y;I++)T[I]=arguments[I];for(var U=T.length;U--;)this.initializes.push(T[U])}},{key:"removeInitialize",value:function(y){y=this.initializes.indexOf(y),-1<y&&this.initializes.splice(y,1)}},{key:"removeAllInitializers",value:function(){O.emptyArray(this.initializes)}},{key:"addBehaviour",value:function(){for(var y=arguments.length,T=Array(y),I=0;I<y;I++)T[I]=arguments[I];for(var U=arguments.length;U--;){var J=T[U];this.behaviours.push(J),J.parents&&J.parents.push(this)}}},{key:"removeBehaviour",value:function(y){var T=this.behaviours.indexOf(y);return this.behaviours.splice(T,1),y.parents&&(T=y.parents.indexOf(y),y.parents.splice(T,1)),T}},{key:"removeAllBehaviours",value:function(){O.emptyArray(this.behaviours)}},{key:"update",value:function(y){this.age+=y,(this.age>=this.life||this.dead)&&this.destroy(),this.emitting(y),this.integrate(y)}},{key:"integrate",value:function(y){if(this.parent){var T=1-this.damping;this.parent.integrator.calculate(this,y,T);for(var U=void 0,I=void 0,U=this.particles.length-1;0<=U;U--)(I=this.particles[U]).update(y,U),this.parent.integrator.calculate(I,y,T),this.dispatch("PARTICLE_UPDATE",I),I.dead&&(this.dispatch("PARTICLE_DEAD",I),this.parent.pool.expire(I),this.particles.splice(U,1))}}},{key:"dispatch",value:function(y,T){this.parent&&this.parent.dispatchEvent(y,T),this.bindEvent&&this.dispatchEvent(y,T)}},{key:"emitting",value:function(y){if(this.totalTime==="once"){var T=void 0,I=this.rate.getValue(99999);for(0<I&&(this.emitSpeed=I),T=0;T<I;T++)this.createParticle();this.totalTime="none"}else if(this.emitTime+=y,this.emitTime<this.totalTime){var U=this.rate.getValue(y),J=void 0;for(0<U&&(this.emitSpeed=U),J=0;J<U;J++)this.createParticle()}}},{key:"createParticle",value:function(y,T){var I=this.parent.pool.get(Dt);return this.setupParticle(I,y,T),this.dispatch("PARTICLE_CREATED",I),I}},{key:"setupParticle",value:function(y,T,I){var U=this.initializes,J=this.behaviours;T&&(U=O.toArray(T)),I&&(J=O.toArray(I)),y.reset(),hh.initialize(this,y,U),y.addBehaviours(J),(y.parent=this).particles.push(y)}},{key:"remove",value:function(){this.stop(),O.destroyAll(this.particles)}},{key:"destroy",value:function(){this.dead=!0,this.remove(),this.removeAllInitializers(),this.removeAllBehaviours(),this.parent&&this.parent.removeEmitter(this)}}]),Ir);function Ir(){var y=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{};return i(this,Ir),y=f(this,(Ir.__proto__||Object.getPrototypeOf(Ir)).call(this,y)),y.particles=[],y.behaviours=[],y.initializes=[],y.emitTime=0,y.emitSpeed=0,y.totalTime=-1,y.damping=.006,y.bindEmitter=!0,y.rate=new Te(1,.1),y.name="Emitter",y.id=W.id(y.name),y}V.bind(aa);var Jd=(h(Ta,aa),o(Ta,[{key:"addSelfBehaviour",value:function(){for(var y=arguments.length,T=Array(y),I=0;I<y;I++)T[I]=arguments[I];for(var J=void 0,U=T.length,J=0;J<U;J++){var At=T[J];this.selfBehaviours.push(At),At.initialize(this)}}},{key:"removeSelfBehaviour",value:function(y){y=this.selfBehaviours.indexOf(y),-1<y&&this.selfBehaviours.splice(y,1)}},{key:"update",value:function(y){if(l(Ta.prototype.__proto__||Object.getPrototypeOf(Ta.prototype),"update",this).call(this,y),!this.sleep)for(var T=this.selfBehaviours.length,I=void 0,I=0;I<T;I++)this.selfBehaviours[I].applyBehaviour(this,y,I)}}]),Ta);function Ta(y){return i(this,Ta),y=f(this,(Ta.__proto__||Object.getPrototypeOf(Ta)).call(this,y)),y.selfBehaviours=[],y}var fh=(h(ia,aa),o(ia,[{key:"initEventHandler",value:function(){var y=this;this.mousemoveHandler=function(T){return y.mousemove.call(y,T)},this.mousedownHandler=function(T){return y.mousedown.call(y,T)},this.mouseupHandler=function(T){return y.mouseup.call(y,T)},this.mouseTarget.addEventListener("mousemove",this.mousemoveHandler,!1)}},{key:"emit",value:function(){this._allowEmitting=!0}},{key:"stop",value:function(){this._allowEmitting=!1}},{key:"mousemove",value:function(y){y.layerX||y.layerX===0?(this.p.x+=(y.layerX-this.p.x)*this.ease,this.p.y+=(y.layerY-this.p.y)*this.ease):!y.offsetX&&y.offsetX!==0||(this.p.x+=(y.offsetX-this.p.x)*this.ease,this.p.y+=(y.offsetY-this.p.y)*this.ease),this._allowEmitting&&l(ia.prototype.__proto__||Object.getPrototypeOf(ia.prototype),"emit",this).call(this,"once")}},{key:"destroy",value:function(){l(ia.prototype.__proto__||Object.getPrototypeOf(ia.prototype),"destroy",this).call(this),this.mouseTarget.removeEventListener("mousemove",this.mousemoveHandler,!1)}}]),ia);function ia(y,T,I){return i(this,ia),I=f(this,(ia.__proto__||Object.getPrototypeOf(ia)).call(this,I)),I.mouseTarget=O.initValue(y,window),I.ease=O.initValue(T,.7),I._allowEmitting=!1,I.initEventHandler(),I}var yr=(o(po,[{key:"setStroke",value:function(y,T){y=0<arguments.length&&y!==void 0?y:"#000000",T=1<arguments.length&&T!==void 0?T:1,this.stroke={color:y,thinkness:T}}},{key:"initHandler",value:function(){var y=this;this._protonUpdateHandler=function(){y.onProtonUpdate.call(y)},this._protonUpdateAfterHandler=function(){y.onProtonUpdateAfter.call(y)},this._emitterAddedHandler=function(T){y.onEmitterAdded.call(y,T)},this._emitterRemovedHandler=function(T){y.onEmitterRemoved.call(y,T)},this._particleCreatedHandler=function(T){y.onParticleCreated.call(y,T)},this._particleUpdateHandler=function(T){y.onParticleUpdate.call(y,T)},this._particleDeadHandler=function(T){y.onParticleDead.call(y,T)}}},{key:"init",value:function(y){(this.parent=y).addEventListener("PROTON_UPDATE",this._protonUpdateHandler),y.addEventListener("PROTON_UPDATE_AFTER",this._protonUpdateAfterHandler),y.addEventListener("EMITTER_ADDED",this._emitterAddedHandler),y.addEventListener("EMITTER_REMOVED",this._emitterRemovedHandler),y.addEventListener("PARTICLE_CREATED",this._particleCreatedHandler),y.addEventListener("PARTICLE_UPDATE",this._particleUpdateHandler),y.addEventListener("PARTICLE_DEAD",this._particleDeadHandler)}},{key:"resize",value:function(){}},{key:"destroy",value:function(){this.remove()}},{key:"remove",value:function(){this.parent.removeEventListener("PROTON_UPDATE",this._protonUpdateHandler),this.parent.removeEventListener("PROTON_UPDATE_AFTER",this._protonUpdateAfterHandler),this.parent.removeEventListener("EMITTER_ADDED",this._emitterAddedHandler),this.parent.removeEventListener("EMITTER_REMOVED",this._emitterRemovedHandler),this.parent.removeEventListener("PARTICLE_CREATED",this._particleCreatedHandler),this.parent.removeEventListener("PARTICLE_UPDATE",this._particleUpdateHandler),this.parent.removeEventListener("PARTICLE_DEAD",this._particleDeadHandler),this.parent=null}},{key:"onProtonUpdate",value:function(){}},{key:"onProtonUpdateAfter",value:function(){}},{key:"onEmitterAdded",value:function(){}},{key:"onEmitterRemoved",value:function(){}},{key:"onParticleCreated",value:function(){}},{key:"onParticleUpdate",value:function(){}},{key:"onParticleDead",value:function(){}}]),po);function po(y,T){i(this,po),this.pool=new j,this.element=y,this.stroke=T,this.circleConf={isCircle:!0},this.initHandler(),this.name="BaseRenderer"}var ka=(h(Xa,yr),o(Xa,[{key:"resize",value:function(y,T){this.element.width=y,this.element.height=T}},{key:"onProtonUpdate",value:function(){this.context.clearRect(0,0,this.element.width,this.element.height)}},{key:"onParticleCreated",value:function(y){y.body?P(y.body,this.addImg2Body,y):y.color=y.color||"#ff0000"}},{key:"onParticleUpdate",value:function(y){y.body?y.body instanceof Image&&this.drawImage(y):this.drawCircle(y)}},{key:"onParticleDead",value:function(y){y.body=null}},{key:"addImg2Body",value:function(y,T){T.body=y}},{key:"drawImage",value:function(y){var T,I=y.body.width*y.scale|0,U=y.body.height*y.scale|0,J=y.p.x-I/2,At=y.p.y-U/2;y.color?(y.data.buffer||(y.data.buffer=this.createBuffer(y.body)),(T=y.data.buffer.getContext("2d")).clearRect(0,0,y.data.buffer.width,y.data.buffer.height),T.globalAlpha=y.alpha,T.drawImage(y.body,0,0),T.globalCompositeOperation="source-atop",T.fillStyle=Pt.rgbToHex(y.rgb),T.fillRect(0,0,y.data.buffer.width,y.data.buffer.height),T.globalCompositeOperation="source-over",T.globalAlpha=1,this.context.drawImage(y.data.buffer,0,0,y.data.buffer.width,y.data.buffer.height,J,At,I,U)):(this.context.save(),this.context.globalAlpha=y.alpha,this.context.translate(y.p.x,y.p.y),this.context.rotate(n.degreeTransform(y.rotation)),this.context.translate(-y.p.x,-y.p.y),this.context.drawImage(y.body,0,0,y.body.width,y.body.height,J,At,I,U),this.context.globalAlpha=1,this.context.restore())}},{key:"drawCircle",value:function(y){y.rgb?this.context.fillStyle="rgba("+y.rgb.r+","+y.rgb.g+","+y.rgb.b+","+y.alpha+")":this.context.fillStyle=y.color,this.context.beginPath(),this.context.arc(y.p.x,y.p.y,y.radius,0,2*Math.PI,!0),this.stroke&&(this.context.strokeStyle=this.stroke.color,this.context.lineWidth=this.stroke.thinkness,this.context.stroke()),this.context.closePath(),this.context.fill()}},{key:"createBuffer",value:function(y){if(y instanceof Image){var T=y.width+"_"+y.height,I=this.bufferCache[T];return I||((I=document.createElement("canvas")).width=y.width,I.height=y.height,this.bufferCache[T]=I),I}}}]),Xa);function Xa(y){return i(this,Xa),y=f(this,(Xa.__proto__||Object.getPrototypeOf(Xa)).call(this,y)),y.stroke=null,y.context=y.element.getContext("2d"),y.bufferCache={},y.name="CanvasRenderer",y}var dh=(h(Nr,yr),o(Nr,[{key:"onParticleCreated",value:function(y){y.body?P(y.body,this.addImg2Body,y):(y.body=this.pool.get(this.circleConf,y),this.element.appendChild(y.body))}},{key:"onParticleUpdate",value:function(y){this.bodyReady(y)&&(this.transform3d?R.transform3d(y.body,y.p.x,y.p.y,y.scale,y.rotation):R.transform(y.body,y.p.x,y.p.y,y.scale,y.rotation),y.body.style.opacity=y.alpha,y.body.isCircle&&(y.body.style.backgroundColor=y.color||"#ff0000"))}},{key:"onParticleDead",value:function(y){this.bodyReady(y)&&(this.element.removeChild(y.body),this.pool.expire(y.body),y.body=null)}},{key:"bodyReady",value:function(y){return a(y.body)==="object"&&y.body&&!y.body.isInner}},{key:"addImg2Body",value:function(y,T){T.dead||(T.body=this.pool.get(y,T),R.resize(T.body,y.width,y.height),this.element.appendChild(T.body))}},{key:"createBody",value:function(y,T){return y.isCircle?this.createCircle(T):this.createSprite(y,T)}},{key:"createCircle",value:function(y){var T=R.createDiv(y.id+"_dom",2*y.radius,2*y.radius);return T.style.borderRadius=y.radius+"px",this.stroke&&(T.style.borderColor=this.stroke.color,T.style.borderWidth=this.stroke.thinkness+"px"),T.isCircle=!0,T}},{key:"createSprite",value:function(U,T){var I=typeof U=="string"?U:U.src,U=R.createDiv(T.id+"_dom",U.width,U.height);return U.style.backgroundImage="url("+I+")",U}}]),Nr);function Nr(y){i(this,Nr);var T=f(this,(Nr.__proto__||Object.getPrototypeOf(Nr)).call(this,y));return T.stroke=null,T.pool.create=function(I,U){return T.createBody(I,U)},T.addImg2Body=T.addImg2Body.bind(T),T.transform3d=!1,T.name="DomRenderer",T}var Rl=(h(Ka,yr),o(Ka,[{key:"onParticleCreated",value:function(y){y.body?this.createSprite(y):this.createCircle(y),this.element.addChild(y.body)}},{key:"onParticleUpdate",value:function(y){y.body&&(y.body.x=y.p.x,y.body.y=y.p.y,y.body.alpha=y.alpha,y.body.scaleX=y.body.scaleY=y.scale,y.body.rotation=y.rotation)}},{key:"onParticleDead",value:function(y){y.body&&(y.body.parent&&y.body.parent.removeChild(y.body),this.pool.expire(y.body),y.body=null),y.graphics&&this.pool.expire(y.graphics)}},{key:"createSprite",value:function(y){y.body=this.pool.get(y.body),y.body.parent||y.body.image&&(y.body.regX=y.body.image.width/2,y.body.regY=y.body.image.height/2)}},{key:"createCircle",value:function(y){var T=this.pool.get(createjs.Graphics);this.stroke&&(this.stroke instanceof String?T.beginStroke(this.stroke):T.beginStroke("#000000")),T.beginFill(y.color||"#ff0000").drawCircle(0,0,y.radius);var I=this.pool.get(createjs.Shape,[T]);y.body=I,y.graphics=T}}]),Ka);function Ka(y,T){return i(this,Ka),y=f(this,(Ka.__proto__||Object.getPrototypeOf(Ka)).call(this,y)),y.stroke=T,y.name="EaselRenderer",y}var tp=(h(_i,yr),o(_i,[{key:"resize",value:function(y,T){this.element.width=y,this.element.height=T}},{key:"createImageData",value:function(y){this.rectangle=y||new ue(0,0,this.element.width,this.element.height),this.imageData=this.context.createImageData(this.rectangle.width,this.rectangle.height),this.context.putImageData(this.imageData,this.rectangle.x,this.rectangle.y)}},{key:"onProtonUpdate",value:function(){this.context.clearRect(this.rectangle.x,this.rectangle.y,this.rectangle.width,this.rectangle.height),this.imageData=this.context.getImageData(this.rectangle.x,this.rectangle.y,this.rectangle.width,this.rectangle.height)}},{key:"onProtonUpdateAfter",value:function(){this.context.putImageData(this.imageData,this.rectangle.x,this.rectangle.y)}},{key:"onParticleCreated",value:function(){}},{key:"onParticleUpdate",value:function(y){this.imageData&&this.setPixel(this.imageData,Math.floor(y.p.x-this.rectangle.x),Math.floor(y.p.y-this.rectangle.y),y)}},{key:"setPixel",value:function(y,T,I,U){var J=U.rgb;T<0||T>this.element.width||I<0||I>this.elementwidth||(T=4*((I>>0)*y.width+(T>>0)),y.data[T]=J.r,y.data[1+T]=J.g,y.data[2+T]=J.b,y.data[3+T]=255*U.alpha)}},{key:"onParticleDead",value:function(){}}]),_i);function _i(y,T){return i(this,_i),y=f(this,(_i.__proto__||Object.getPrototypeOf(_i)).call(this,y)),y.context=y.element.getContext("2d"),y.imageData=null,y.rectangle=null,y.rectangle=T,y.createImageData(T),y.name="PixelRenderer",y}var Bn=void 0,ph=(h(Ya,yr),o(Ya,[{key:"setPIXI",value:function(y){try{Bn=y||{Sprite:{}},this.createFromImage=Bn.Sprite.from||Bn.Sprite.fromImage}catch{}}},{key:"onProtonUpdate",value:function(){}},{key:"onParticleCreated",value:function(y){y.body?y.body=this.pool.get(y.body,y):y.body=this.pool.get(this.circleConf,y),this.blendMode&&(y.body.blendMode=this.blendMode),this.element.addChild(y.body)}},{key:"onParticleUpdate",value:function(y){this.transform(y,y.body),this.setColor!==!0&&this.color!==!0||(y.body.tint=Pt.getHex16FromParticle(y))}},{key:"onParticleDead",value:function(y){this.element.removeChild(y.body),this.pool.expire(y.body),y.body=null}},{key:"destroy",value:function(y){l(Ya.prototype.__proto__||Object.getPrototypeOf(Ya.prototype),"destroy",this).call(this),this.pool.destroy();for(var T=y.length;T--;){var I=y[T];I.body&&this.element.removeChild(I.body)}}},{key:"transform",value:function(y,T){T.x=y.p.x,T.y=y.p.y,T.alpha=y.alpha,T.scale.x=y.scale,T.scale.y=y.scale,T.rotation=y.rotation*n.PI_180}},{key:"createBody",value:function(y,T){return y.isCircle?this.createCircle(T):this.createSprite(y)}},{key:"createSprite",value:function(y){return y=y.isInner?this.createFromImage(y.src):new Bn.Sprite(y),y.anchor.x=.5,y.anchor.y=.5,y}},{key:"createCircle",value:function(y){var T,I=new Bn.Graphics;return this.stroke&&(T=this.stroke instanceof String?this.stroke:0,I.beginStroke(T)),I.beginFill(y.color||36077),I.drawCircle(0,0,y.radius),I.endFill(),I}}]),Ya);function Ya(y,T){i(this,Ya);var I=f(this,(Ya.__proto__||Object.getPrototypeOf(Ya)).call(this,y));return I.stroke=T,I.color=!1,I.setColor=!1,I.blendMode=null,I.pool.create=function(U,J){return I.createBody(U,J)},I.setPIXI(window.PIXI),I.name="PixiRenderer",I}var rs=(o(as,[{key:"set",value:function(y,T){T===0?Wt.set(y,this.mats[0]):Wt.multiply(this.mats[T-1],y,this.mats[T]),this.size=Math.max(this.size,T+1)}},{key:"push",value:function(y){this.size===0?Wt.set(y,this.mats[0]):Wt.multiply(this.mats[this.size-1],y,this.mats[this.size]),this.size++}},{key:"pop",value:function(){0<this.size&&this.size--}},{key:"top",value:function(){return this.mats[this.size-1]}}]),as);function as(){i(this,as),this.mats=[];for(var y=this.size=0;y<20;y++)this.mats.push(Wt.create([0,0,0,0,0,0,0,0,0]))}h(Or,yr),o(Or,[{key:"init",value:function(y){l(Or.prototype.__proto__||Object.getPrototypeOf(Or.prototype),"init",this).call(this,y),this.resize(this.element.width,this.element.height)}},{key:"resize",value:function(y,T){this.umat[4]=-2,this.umat[7]=1,this.smat[0]=1/y,this.smat[4]=1/T,this.mstack.set(this.umat,0),this.mstack.set(this.smat,1),this.gl.viewport(0,0,y,T),this.element.width=y,this.element.height=T}},{key:"setMaxRadius",value:function(y){this.circleCanvasURL=this.createCircle(y)}},{key:"getVertexShader",value:function(){return["uniform vec2 viewport;","attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform mat3 tMat;","varying vec2 vTextureCoord;","varying float alpha;","void main() {","vec3 v = tMat * vec3(aVertexPosition, 1.0);","gl_Position = vec4(v.x, v.y, 0, 1);","vTextureCoord = aTextureCoord;","alpha = tMat[0][2];","}"].join(`
`)}},{key:"getFragmentShader",value:function(){return["precision mediump float;","varying vec2 vTextureCoord;","varying float alpha;","uniform sampler2D uSampler;","uniform vec4 color;","uniform bool useTexture;","uniform vec3 uColor;","void main() {","vec4 textureColor = texture2D(uSampler, vTextureCoord);","gl_FragColor = textureColor * vec4(uColor, 1.0);","gl_FragColor.w *= alpha;","}"].join(`
`)}},{key:"initVar",value:function(){this.mstack=new rs,this.umat=Wt.create([2,0,1,0,-2,0,-1,1,1]),this.smat=Wt.create([.01,0,1,0,.01,0,0,0,1]),this.texturebuffers={}}},{key:"blendEquation",value:function(y){this.gl.blendEquation(this.gl[y])}},{key:"blendFunc",value:function(y,T){this.gl.blendFunc(this.gl[y],this.gl[T])}},{key:"getShader",value:function(y,T,I){return I=I?y.createShader(y.FRAGMENT_SHADER):y.createShader(y.VERTEX_SHADER),y.shaderSource(I,T),y.compileShader(I),y.getShaderParameter(I,y.COMPILE_STATUS)?I:(alert(y.getShaderInfoLog(I)),null)}},{key:"initShaders",value:function(){var y=this.getShader(this.gl,this.getFragmentShader(),!0),T=this.getShader(this.gl,this.getVertexShader(),!1);this.sprogram=this.gl.createProgram(),this.gl.attachShader(this.sprogram,T),this.gl.attachShader(this.sprogram,y),this.gl.linkProgram(this.sprogram),this.gl.getProgramParameter(this.sprogram,this.gl.LINK_STATUS)||alert("Could not initialise shaders"),this.gl.useProgram(this.sprogram),this.sprogram.vpa=this.gl.getAttribLocation(this.sprogram,"aVertexPosition"),this.sprogram.tca=this.gl.getAttribLocation(this.sprogram,"aTextureCoord"),this.gl.enableVertexAttribArray(this.sprogram.tca),this.gl.enableVertexAttribArray(this.sprogram.vpa),this.sprogram.tMatUniform=this.gl.getUniformLocation(this.sprogram,"tMat"),this.sprogram.samplerUniform=this.gl.getUniformLocation(this.sprogram,"uSampler"),this.sprogram.useTex=this.gl.getUniformLocation(this.sprogram,"useTexture"),this.sprogram.color=this.gl.getUniformLocation(this.sprogram,"uColor"),this.gl.uniform1i(this.sprogram.useTex,1)}},{key:"initBuffers",value:function(){var y;this.unitIBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.unitIBuffer),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,3,1,0,2,3]),this.gl.STATIC_DRAW);for(var I=void 0,T=[],I=0;I<100;I++)T.push(I);for(y=new Uint16Array(T),this.unitI33=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.unitI33),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,y,this.gl.STATIC_DRAW),T=[],I=0;I<100;I++)T.push(I,I+1,I+2);y=new Uint16Array(T),this.stripBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.stripBuffer),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,y,this.gl.STATIC_DRAW)}},{key:"createCircle",value:function(I){this.circleCanvasRadius=m(O.initValue(I,32));var T=R.createCanvas("circle_canvas",2*this.circleCanvasRadius,2*this.circleCanvasRadius),I=T.getContext("2d");return I.beginPath(),I.arc(this.circleCanvasRadius,this.circleCanvasRadius,this.circleCanvasRadius,0,2*Math.PI,!0),I.closePath(),I.fillStyle="#FFF",I.fill(),T.toDataURL()}},{key:"drawImg2Canvas",value:function(y){var T=y.body.width,I=y.body.height,U=m(y.body.width),J=m(y.body.height),At=y.body.width/U,$e=y.body.height/J;this.texturebuffers[y.data.src]||(this.texturebuffers[y.data.src]=[this.gl.createTexture(),this.gl.createBuffer(),this.gl.createBuffer()]),y.data.texture=this.texturebuffers[y.data.src][0],y.data.vcBuffer=this.texturebuffers[y.data.src][1],y.data.tcBuffer=this.texturebuffers[y.data.src][2],this.gl.bindBuffer(this.gl.ARRAY_BUFFER,y.data.tcBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([0,0,At,0,0,$e,$e,$e]),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,y.data.vcBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([0,0,T,0,0,I,T,I]),this.gl.STATIC_DRAW),J=y.data.canvas.getContext("2d").getImageData(0,0,U,J),this.gl.bindTexture(this.gl.TEXTURE_2D,y.data.texture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,J),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR_MIPMAP_NEAREST),this.gl.generateMipmap(this.gl.TEXTURE_2D),y.data.textureLoaded=!0,y.data.textureWidth=T,y.data.textureHeight=I}},{key:"onProtonUpdate",value:function(){}},{key:"onParticleCreated",value:function(y){y.data.textureLoaded=!1,y.data.tmat=Wt.create(),y.data.tmat[8]=1,y.data.imat=Wt.create(),y.data.imat[8]=1,y.body?P(y.body,this.addImg2Body,y):(P(this.circleCanvasURL,this.addImg2Body,y),y.data.oldScale=y.radius/this.circleCanvasRadius)}},{key:"addImg2Body",value:function(y,T){T.dead||(T.body=y,T.data.src=y.src,T.data.canvas=M(y),T.data.oldScale=1,this.drawImg2Canvas(T))}},{key:"onParticleUpdate",value:function(y){y.data.textureLoaded&&(this.updateMatrix(y),this.gl.uniform3f(this.sprogram.color,y.rgb.r/255,y.rgb.g/255,y.rgb.b/255),this.gl.uniformMatrix3fv(this.sprogram.tMatUniform,!1,this.mstack.top()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,y.data.vcBuffer),this.gl.vertexAttribPointer(this.sprogram.vpa,2,this.gl.FLOAT,!1,0,0),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,y.data.tcBuffer),this.gl.vertexAttribPointer(this.sprogram.tca,2,this.gl.FLOAT,!1,0,0),this.gl.bindTexture(this.gl.TEXTURE_2D,y.data.texture),this.gl.uniform1i(this.sprogram.samplerUniform,0),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.unitIBuffer),this.gl.drawElements(this.gl.TRIANGLES,6,this.gl.UNSIGNED_SHORT,0),this.mstack.pop())}},{key:"onParticleDead",value:function(){}},{key:"updateMatrix",value:function(y){var T=x(-y.data.textureWidth/2,-y.data.textureHeight/2),I=x(y.p.x,y.p.y),J=y.rotation*n.PI_180,U=b(J),J=y.scale*y.data.oldScale,J=E(J,J),J=C(T,J),J=C(J,U);J=C(J,I),Wt.inverse(J,y.data.imat),J[2]=y.alpha,this.mstack.push(J)}}]),V=Or;function Or(y){return i(this,Or),y=f(this,(Or.__proto__||Object.getPrototypeOf(Or)).call(this,y)),y.gl=y.element.getContext("experimental-webgl",{antialias:!0,stencil:!1,depth:!1}),y.gl||alert("Sorry your browser do not suppest WebGL!"),y.initVar(),y.setMaxRadius(),y.initShaders(),y.initBuffers(),y.gl.blendEquation(y.gl.FUNC_ADD),y.gl.blendFunc(y.gl.SRC_ALPHA,y.gl.ONE_MINUS_SRC_ALPHA),y.gl.enable(y.gl.BLEND),y.addImg2Body=y.addImg2Body.bind(y),y.name="WebGLRenderer",y}h(ou,yr),yr=ou;function ou(y){return i(this,ou),y=f(this,(ou.__proto__||Object.getPrototypeOf(ou)).call(this,y)),y.name="CustomRenderer",y}var cr=(h(Qa,ln),o(Qa,[{key:"getPosition",value:function(){return this.random=Math.random(),this.vector.x=this.x1+this.random*this.length*Math.cos(this.gradient),this.vector.y=this.y1+this.random*this.length*Math.sin(this.gradient),this.vector}},{key:"getDirection",value:function(y,T){var I=this.dy,U=-this.dx;return 0<(I*y+U*T+this.dot)*(U==0?1:U)}},{key:"getDistance",value:function(y,T){return(this.dy*y+-this.dx*T+this.dot)/Math.sqrt(this.xxyy)}},{key:"getSymmetric",value:function(y){var U=y.getGradient(),T=2*(this.getGradient()-U),I=y.x,U=y.y;return y.x=I*Math.cos(T)-U*Math.sin(T),y.y=I*Math.sin(T)+U*Math.cos(T),y}},{key:"getGradient",value:function(){return Math.atan2(this.dy,this.dx)}},{key:"rangeOut",value:function(y){if(Math.abs(this.getGradient())<=n.PI/4){if(y.p.x<=this.maxx&&y.p.x>=this.minx)return!0}else if(y.p.y<=this.maxy&&y.p.y>=this.miny)return!0;return!1}},{key:"getLength",value:function(){return Math.sqrt(this.dx*this.dx+this.dy*this.dy)}},{key:"crossing",value:function(y){this.crossType==="dead"?this.direction===">"||this.direction==="R"||this.direction==="right"||this.direction==="down"?this.rangeOut(y)&&this.getDirection(y.p.x,y.p.y)&&(y.dead=!0):this.rangeOut(y)&&(this.getDirection(y.p.x,y.p.y)||(y.dead=!0)):this.crossType==="bound"?this.rangeOut(y)&&this.getDistance(y.p.x,y.p.y)<=y.radius&&(this.dx===0?y.v.x*=-1:this.dy===0?y.v.y*=-1:this.getSymmetric(y.v)):this.crossType==="cross"&&this.alert&&(console.error("Sorry, LineZone does not support cross method!"),this.alert=!1)}}]),Qa);function Qa(y,T,I,U,J){i(this,Qa);var At=f(this,(Qa.__proto__||Object.getPrototypeOf(Qa)).call(this));return 0<=I-y?(At.x1=y,At.y1=T,At.x2=I,At.y2=U):(At.x1=I,At.y1=U,At.x2=y,At.y2=T),At.dx=At.x2-At.x1,At.dy=At.y2-At.y1,At.minx=Math.min(At.x1,At.x2),At.miny=Math.min(At.y1,At.y2),At.maxx=Math.max(At.x1,At.x2),At.maxy=Math.max(At.y1,At.y2),At.dot=At.x2*At.y1-At.x1*At.y2,At.xxyy=At.dx*At.dx+At.dy*At.dy,At.gradient=At.getGradient(),At.length=At.getLength(),At.direction=O.initValue(J,">"),At}var _l=(h(Za,ln),o(Za,[{key:"getPosition",value:function(){return this.angle=n.PIx2*Math.random(),this.randomRadius=Math.random()*this.radius,this.vector.x=this.x+this.randomRadius*Math.cos(this.angle),this.vector.y=this.y+this.randomRadius*Math.sin(this.angle),this.vector}},{key:"setCenter",value:function(y,T){this.center.x=y,this.center.y=T}},{key:"crossing",value:function(y){var T=y.p.distanceTo(this.center);this.crossType==="dead"?T-y.radius>this.radius&&(y.dead=!0):this.crossType==="bound"?T+y.radius>=this.radius&&this.getSymmetric(y):this.crossType==="cross"&&this.alert&&(console.error("Sorry, CircleZone does not support cross method!"),this.alert=!1)}},{key:"getSymmetric",value:function(y){var U=y.v.getGradient(),T=2*(this.getGradient(y)-U),I=y.v.x,U=y.v.y;y.v.x=I*Math.cos(T)-U*Math.sin(T),y.v.y=I*Math.sin(T)+U*Math.cos(T)}},{key:"getGradient",value:function(y){return-n.PI_2+Math.atan2(y.p.y-this.center.y,y.p.x-this.center.x)}}]),Za);function Za(y,T,I){i(this,Za);var U=f(this,(Za.__proto__||Object.getPrototypeOf(Za)).call(this));return U.x=y,U.y=T,U.radius=I,U.angle=0,U.center={x:y,y:T},U}var Ai=(h(Ti,ln),o(Ti,[{key:"getPosition",value:function(){return this.vector.x=this.x+Math.random()*this.width,this.vector.y=this.y+Math.random()*this.height,this.vector}},{key:"crossing",value:function(y){this.crossType==="dead"?((y.p.x+y.radius<this.x||y.p.x-y.radius>this.x+this.width)&&(y.dead=!0),(y.p.y+y.radius<this.y||y.p.y-y.radius>this.y+this.height)&&(y.dead=!0)):this.crossType==="bound"?(y.p.x-y.radius<this.x?(y.p.x=this.x+y.radius,y.v.x*=-1):y.p.x+y.radius>this.x+this.width&&(y.p.x=this.x+this.width-y.radius,y.v.x*=-1),y.p.y-y.radius<this.y?(y.p.y=this.y+y.radius,y.v.y*=-1):y.p.y+y.radius>this.y+this.height&&(y.p.y=this.y+this.height-y.radius,y.v.y*=-1)):this.crossType==="cross"&&(y.p.x+y.radius<this.x&&y.v.x<=0?y.p.x=this.x+this.width+y.radius:y.p.x-y.radius>this.x+this.width&&0<=y.v.x&&(y.p.x=this.x-y.radius),y.p.y+y.radius<this.y&&y.v.y<=0?y.p.y=this.y+this.height+y.radius:y.p.y-y.radius>this.y+this.height&&0<=y.v.y&&(y.p.y=this.y-y.radius))}}]),Ti);function Ti(y,T,I,U){i(this,Ti);var J=f(this,(Ti.__proto__||Object.getPrototypeOf(Ti)).call(this));return J.x=y,J.y=T,J.width=I,J.height=U,J}h(ki,ln),o(ki,[{key:"reset",value:function(y,T,I,U){this.imageData=y,this.x=O.initValue(T,0),this.y=O.initValue(I,0),this.d=O.initValue(U,2),this.vectors=[],this.setVectors()}},{key:"setVectors",value:function(){for(var U=void 0,y=void 0,T=this.imageData.width,I=this.imageData.height,U=0;U<T;U+=this.d)for(y=0;y<I;y+=this.d){var J=4*((y>>0)*T+(U>>0));0<this.imageData.data[3+J]&&this.vectors.push({x:U+this.x,y:y+this.y})}return this.vector}},{key:"getBound",value:function(y,T){return y=4*((T>>0)*this.imageData.width+(y>>0)),0<this.imageData.data[3+y]}},{key:"getPosition",value:function(){var y=O.getRandFromArray(this.vectors);return this.vector.copy(y)}},{key:"getColor",value:function(y,T){return y-=this.x,y=4*(((T-=this.y)>>0)*this.imageData.width+(y>>0)),{r:this.imageData.data[y],g:this.imageData.data[1+y],b:this.imageData.data[2+y],a:this.imageData.data[3+y]}}},{key:"crossing",value:function(y){this.crossType==="dead"?this.getBound(y.p.x-this.x,y.p.y-this.y)?y.dead=!0:y.dead=!1:this.crossType==="bound"&&(this.getBound(y.p.x-this.x,y.p.y-this.y)||y.v.negate())}}]),h=ki;function ki(y,T,I,U){i(this,ki);var J=f(this,(ki.__proto__||Object.getPrototypeOf(ki)).call(this));return J.reset(y,T,I,U),J}return o={addEventListener:function(y,T){y.addEventListener("PROTON_UPDATE_AFTER",function(){return T()})},getStyle:function(y){return y=Pt.hexToRgb(0<arguments.length&&y!==void 0?y:"#ff0000"),"rgba("+y.r+", "+y.g+", "+y.b+", 0.5)"},drawZone:function(y,T,I,U){var J=T.getContext("2d"),At=this.getStyle();this.addEventListener(y,function(){U&&J.clearRect(0,0,T.width,T.height),I instanceof Nn?(J.beginPath(),J.fillStyle=At,J.arc(I.x,I.y,10,0,2*Math.PI,!0),J.fill(),J.closePath()):I instanceof cr?(J.beginPath(),J.strokeStyle=At,J.moveTo(I.x1,I.y1),J.lineTo(I.x2,I.y2),J.stroke(),J.closePath()):I instanceof Ai?(J.beginPath(),J.strokeStyle=At,J.drawRect(I.x,I.y,I.width,I.height),J.stroke(),J.closePath()):I instanceof _l&&(J.beginPath(),J.strokeStyle=At,J.arc(I.x,I.y,I.radius,0,2*Math.PI,!0),J.stroke(),J.closePath())})},drawEmitter:function(y,T,I,U){var J=T.getContext("2d"),At=this.getStyle();this.addEventListener(y,function(){U&&J.clearRect(0,0,T.width,T.height),J.beginPath(),J.fillStyle=At,J.arc(I.p.x,I.p.y,10,0,2*Math.PI,!0),J.fill(),J.closePath()})}},B.Particle=Dt,B.Pool=j,B.Util=O,B.ColorUtil=Pt,B.MathUtil=n,B.Vector2D=B.Vector=wt,B.Polar2D=B.Polar=jt,B.ArraySpan=Gt,B.Rectangle=ue,B.Rate=Te,B.ease=xt,B.Span=p,B.Mat3=Wt,B.getSpan=function(y,T,I){return new p(y,T,I)},B.createArraySpan=Gt.createArraySpan,B.Initialize=B.Init=Se,B.Life=B.L=Xe,B.Position=B.P=Be,B.Velocity=B.V=En,B.Mass=B.M=El,B.Radius=B.R=qa,B.Body=B.B=Dr,B.Behaviour=Cn,B.Force=B.F=Cl,B.Attraction=B.A=ns,B.RandomDrift=B.RD=Qd,B.Gravity=B.G=lh,B.Collision=Sl,B.CrossZone=Zd,B.Alpha=Mn,B.Scale=B.S=ho,B.Rotate=$d,B.Color=ch,B.Repulsion=iu,B.Cyclone=fo,B.GravityWell=mn,B.Emitter=aa,B.BehaviourEmitter=Jd,B.FollowEmitter=fh,B.Zone=ln,B.LineZone=cr,B.CircleZone=_l,B.PointZone=Nn,B.RectZone=Ai,B.ImageZone=h,B.CanvasRenderer=ka,B.DomRenderer=dh,B.EaselRenderer=Rl,B.PixiRenderer=ph,B.PixelRenderer=tp,B.WebGLRenderer=B.WebGlRenderer=V,B.CustomRenderer=yr,B.Debug=o,O.assign(B,xt),B})})(Hf)),Hf.exports}var Yj=Kj();const Z=Rd(Yj);var tA=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},Tr=function(r,t){if(!(r instanceof t))throw new TypeError("Cannot call a class as a function")},kr=(function(){function r(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}})(),ta=function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);r.prototype=Object.create(t&&t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(r,t):r.__proto__=t)},ea=function(r,t){if(!r)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:r},Qj=(function(){function r(){Tr(this,r),this.list=[]}return kr(r,[{key:"set",value:function(e,n){this.list.push({probability:e,target:n,a:0,b:1}),this.calculation()}},{key:"calculation",value:function(){for(var e=0,n=0;n<this.list.length;n++)e+=this.list[n].probability;for(var a=0;a<this.list.length;a++){var i=this.list[a],o=i.probability/e;i.a=a===0?0:this.list[a-1].b,i.b=i.a+o}}},{key:"getResult",value:function(){for(var e=Math.random(),n=0;n<this.list.length;n++){var a=this.list[n];if(e<=a.b&&e>a.a)return a.target}return this.list[0].target}}]),r})(),Va=(function(r){ta(t,r);function t(e){Tr(this,t);var n=ea(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n._iid=0,n._oid=0,n.size={width:0,height:0},n.canvasRef=Kt.createRef(),n}return kr(t,[{key:"componentDidMount",value:function(){var n=this;this._oid=setTimeout(function(){n.initCanvas(),n.resize=n.resize.bind(n),window.addEventListener("resize",n.resize)},100);var a=this.getCanvas();this.props.onCanvasDidMount&&this.props.onCanvasDidMount(a)}},{key:"initCanvas",value:function(){var n=this.getCanvas();if(this.props.globalCompositeOperation){var a=n.getContext("2d");a.globalCompositeOperation=this.props.globalCompositeOperation}var i=this.setCanvasSize(n),o=i.width,u=i.height;this.heartbeatDetectionCanvasSize(n),this.props.onCanvasInited(n,o,u)}},{key:"getCanvas",value:function(){var n=this.canvasRef.current;return n}},{key:"heartbeatDetectionCanvasSize",value:function(n){var a=this;this._iid=setInterval(function(){if(a.canvasRef.current){var i=a.canvasRef.current.clientHeight;if(i!==a.size.height){var o=a.setCanvasSize(n),u=o.width,l=o.height;a.props.onResize&&a.props.onResize(u,l)}}},1e3/10)}},{key:"componentWillUnmount",value:function(){try{window.removeEventListener("resize",this.resize),clearInterval(this._iid),clearTimeout(this._oid)}catch{}}},{key:"resize",value:function(){var n=this.getCanvas(),a=this.setCanvasSize(n),i=a.width,o=a.height;this.props.onResize&&this.props.onResize(i,o)}},{key:"setCanvasSize",value:function(n){var a=this.canvasRef.current.clientWidth,i=this.canvasRef.current.clientHeight;return this.size.width=a,this.size.height=i,n.width=a,n.height=i,{width:a,height:i}}},{key:"handleWaypointEnter",value:function(){Ze.start()}},{key:"handleWaypointLeave",value:function(){Ze.stop()}},{key:"getStyle",value:function(){var n=this.props.bg,a={width:"100%",height:"100%"};return n===!0?a=Object.assign(a,{position:"absolute",zIndex:-1,top:0,left:0}):n&&(typeof n>"u"?"undefined":tA(n))==="object"&&(a=Object.assign(a,n)),a}},{key:"handleMouseDown",value:function(n){this.props.onMouseDown&&this.props.onMouseDown(n)}},{key:"render",value:function(){return Kt.createElement("canvas",{className:"particles-bg-canvas-self",ref:this.canvasRef,onMouseDown:this.handleMouseDown.bind(this),style:this.getStyle()})}}]),t})(Kt.Component);function Zj(r){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(r);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:{}}function Yd(r,t){var e=void 0;return r?(e=Zj(r),"rgba("+e.r+","+e.g+","+e.b+", "+t+")"):null}var SE=(function(r){ta(t,r);function t(e){Tr(this,t);var n=ea(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.renderProton=n.renderProton.bind(n),n}return kr(t,[{key:"onCanvasInited",value:function(n,a,i){this.createProton(n,a,i),this.createMiniEmitter(n),Ze.add(this.renderProton)}},{key:"componentWillUnmount",value:function(){try{Ze.remove(this.renderProton),this.proton.destroy()}catch{}}},{key:"onResize",value:function(){}},{key:"createProton",value:function(n,a,i){var o=this,u=n.getContext("2d");this.proton=new Z;var l=new Z.Emitter;l.rate=new Z.Rate(this.props.num?new Z.Span(this.props.num):new Z.Span(4,9),new Z.Span(.8,1.3)),l.addInitialize(new Z.Mass(1)),l.addInitialize(new Z.Radius(1,50)),l.addInitialize(new Z.Life(5,6)),l.addInitialize(new Z.Velocity(new Z.Span(5,8),new Z.Span(30,70),"polar")),l.addBehaviour(new Z.Alpha(1,0)),l.addBehaviour(new Z.Color(["#36aaf3","#fd769c","#94ff22","#ffa545","#ffffff"])),l.addBehaviour(new Z.Scale(.7,1)),l.addBehaviour(new Z.Gravity(3)),l.addBehaviour(new Z.Collision(l)),l.addBehaviour(this.customDeadBehaviour(n)),l.addBehaviour(new Z.CrossZone(new Z.RectZone(0,0,n.width,n.height),"bound")),l.p.x=Math.min(500,Math.max(n.width/2-400,50)),l.p.y=n.height/2+50,l.emit(),this.proton.addEmitter(l);var h=new Z.CanvasRenderer(n);h.onProtonUpdate=function(){u.fillStyle=Yd(o.props.color,.2)||"rgba(255, 255, 255, 0.2)",u.fillRect(0,0,n.width,n.height)},this.proton.addRenderer(h)}},{key:"customDeadBehaviour",value:function(n){var a=this;return{initialize:function(o){},applyBehaviour:function(o){o.p.y+o.radius>=n.height&&o.radius>9&&(a.miniEmitteing(o),o.dead=!0)}}}},{key:"createMiniEmitter",value:function(n){var a=new Z.Emitter;a.rate=new Z.Rate(new Z.Span(3,6),new Z.Span(1,2)),a.addInitialize(new Z.Mass(1)),a.radiusInitialize=new Z.Radius,a.addInitialize(a.radiusInitialize),a.addInitialize(new Z.Life(.5,1)),a.addInitialize(new Z.V(new Z.Span(1.5,3),new Z.Span(0,70,!0),"polar")),a.colorBehaviour=new Z.Color("#ffffff"),a.addBehaviour(new Z.Alpha(1,0)),a.addBehaviour(a.colorBehaviour),a.addBehaviour(new Z.Gravity(4)),a.addBehaviour(new Z.Collision(a)),a.addBehaviour(new Z.CrossZone(new Z.RectZone(0,0,n.width,n.height),"bound")),this.proton.addEmitter(a),this.miniEmitter=a}},{key:"miniEmitteing",value:function(n){var a=this.miniEmitter;a.radiusInitialize.reset(n.radius*.05,n.radius*.2),a.colorBehaviour.reset(n.color),a.p.x=n.p.x,a.p.y=n.p.y,a.emit("once")}},{key:"renderProton",value:function(){this.proton&&this.proton.update()}},{key:"render",value:function(){return Kt.createElement(Va,{bg:this.props.bg,globalCompositeOperation:"darker",onCanvasInited:this.onCanvasInited.bind(this),onResize:this.onResize.bind(this)})}}]),t})(Kt.Component),jm=(function(r){ta(t,r);function t(e){Tr(this,t);var n=ea(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.colors=["#529B88","#CDD180","#FFFA32","#FB6255","#FB4A53","#FF4E50","#F9D423"],n.renderProton=n.renderProton.bind(n),n}return kr(t,[{key:"componentWillUnmount",value:function(){try{Ze.remove(this.renderProton),this.proton.destroy()}catch{}}},{key:"onCanvasInited",value:function(n,a,i){this.createProton(n,a,i),Ze.add(this.renderProton)}},{key:"onResize",value:function(){}},{key:"createProton",value:function(n,a,i){this.proton=new Z;var o=new Z.Emitter;o.rate=new Z.Rate(this.props.num?new Z.Span(this.props.num):new Z.Span(5,8),new Z.Span(.1,.25)),o.addInitialize(new Z.Mass(1)),o.addInitialize(new Z.Radius(20,200)),o.addInitialize(new Z.Life(2,4)),o.addInitialize(new Z.Position(new Z.RectZone(0,0,a,i))),o.addBehaviour(new Z.Alpha(0,1,1/0,Z.easeOutCubic)),o.addBehaviour(new Z.Scale(1,0,1/0,Z.easeOutCubic)),o.addBehaviour(new Z.Color(this.colors,"random")),o.emit(),this.proton.addEmitter(o);var u=new Z.CanvasRenderer(n);this.proton.addRenderer(u)}},{key:"renderProton",value:function(){this.proton&&this.proton.update()}},{key:"render",value:function(){return Kt.createElement(Va,{bg:this.props.bg,globalCompositeOperation:"darker",onCanvasInited:this.onCanvasInited.bind(this),onResize:this.onResize.bind(this)})}}]),t})(Kt.Component),$j=(function(r){ta(t,r);function t(e){Tr(this,t);var n=ea(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.colors=["#529B88","#CDD180","#FFFA32","#FB6255","#FB4A53","#FF4E50","#F9D423"],n.renderProton=n.renderProton.bind(n),n}return kr(t,[{key:"componentWillUnmount",value:function(){try{Ze.remove(this.renderProton),this.proton.destroy()}catch{}}},{key:"onCanvasInited",value:function(n,a,i){this.createProton(n,a,i),Ze.add(this.renderProton)}},{key:"onResize",value:function(n,a){this.crossZoneBehaviour.zone.width=n,this.crossZoneBehaviour.zone.height=a,this.proton.renderers[0].resize(n,a)}},{key:"getProp",value:function(n,a){var i=this.props.config||{},o=i[n]||a;return Array.isArray(o)?new Z.Span(o[0],o[1]):o}},{key:"getArrProp",value:function(n,a){var i=this.props.config||{},o=i[n]||a;return o?Array.isArray(o)?o:[o,o]:null}},{key:"createProton",value:function(n,a,i){var o=this.getProp("num",[5,8]),u=this.getProp("rps",[.1,.2]),l=this.getProp("mass",1),h=this.getProp("radius",[10,30]),f=this.getProp("life",[2,3]),p=this.getProp("body"),v=this.getProp("position"),m=this.getProp("v",[2,3]),x=this.getProp("tha",[-15,15]),b=this.getArrProp("alpha"),E=this.getArrProp("scale"),C=this.getArrProp("color"),R=this.getProp("cross","dead"),_=this.getProp("random"),A=this.getArrProp("rotate"),k=this.getProp("g"),D=this.getArrProp("f"),P=this.getProp("emitter");this.proton=new Z;var M=void 0;P==="follow"?M=new Z.FollowEmitter:M=new Z.Emitter,M.rate=new Z.Rate(o,u),M.addInitialize(new Z.Mass(l)),M.addInitialize(new Z.Radius(h)),M.addInitialize(new Z.Life(f)),M.addInitialize(new Z.Velocity(m,x,"polar")),p&&M.addInitialize(new Z.Body(p));var O=void 0;v==="all"||v==="screen"?O=new Z.Position(new Z.RectZone(0,0,n.width,n.height)):(typeof v>"u"?"undefined":tA(v))==="object"?O=new Z.Position(new Z.RectZone(v.x,v.y,v.width,v.height)):(M.p.x=n.width/2,M.p.y=n.height/2),M.addInitialize(O);var F=b?new Z.Alpha(b[0],b[1]):new Z.Alpha(0,1),W=E?new Z.Scale(E[0],E[1]):new Z.Scale(1,.2),j=C?new Z.Color(C[0],C[1]):new Z.Color(this.colors);M.addBehaviour(F),M.addBehaviour(W),p||M.addBehaviour(j),A&&(A[0]===!0||A[0]==="rotate"?M.addBehaviour(new Z.Rotate):M.addBehaviour(new Z.Rotate(A[0],A[1])));var ot=new Z.RectZone(0,0,n.width,n.height),nt=new Z.CrossZone(ot,R);M.addBehaviour(nt),_&&M.addBehaviour(new Z.RandomDrift(_,_,.05)),k&&M.addBehaviour(new Z.G(k)),D&&M.addBehaviour(new Z.F(D[0],D[1])),M.emit(),this.proton.addEmitter(M);var at=this.createRenderer(n);this.proton.addRenderer(at),this.emitter=M,this.crossZoneBehaviour=nt}},{key:"createRenderer",value:function(n){var a=n.width,i=n.height,o=n.getContext("2d"),u=new Z.CanvasRenderer(n),l=this.getProp("onUpdate");l&&(u.onProtonUpdate=function(){l(o,a,i)});var h=this.getProp("onParticleCreated");h&&(u.onParticleCreated=function(p){h(o,p)});var f=this.getProp("onParticleUpdate");return f&&(u.onParticleUpdate=function(p){f(o,p)}),u}},{key:"renderProton",value:function(){this.proton&&this.proton.update()}},{key:"handleMouseDown",value:function(n){var a=this.getProp("onMouseDown");a&&a(n)}},{key:"render",value:function(){var n=this.props.globalCompositeOperation||this.props.operation||"source-over";return Kt.createElement(Va,{bg:this.props.bg,onMouseDown:this.handleMouseDown.bind(this),globalCompositeOperation:n,onCanvasInited:this.onCanvasInited.bind(this),onResize:this.onResize.bind(this)})}}]),t})(Kt.Component),RE=(function(r){ta(t,r);function t(e){Tr(this,t);var n=ea(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.renderProton=n.renderProton.bind(n),n}return kr(t,[{key:"onCanvasDidMount",value:function(n){this.props.color&&(n.style.backgroundColor=this.props.color)}},{key:"componentWillUnmount",value:function(){try{Ze.remove(this.renderProton),this.proton.destroy()}catch{}}},{key:"onCanvasInited",value:function(n,a,i){this.createProton(n,a,i),Ze.add(this.renderProton)}},{key:"onResize",value:function(n,a){this.crossZoneBehaviour.zone.width=n,this.crossZoneBehaviour.zone.height=a,this.proton.renderers[0].resize(n,a)}},{key:"createProton",value:function(n,a,i){this.proton=new Z;var o=new Z.Emitter;o.damping=.008,o.rate=new Z.Rate(this.props.num?this.props.num:250),o.addInitialize(new Z.Mass(1)),o.addInitialize(new Z.Radius(4)),o.addInitialize(new Z.Velocity(new Z.Span(1.5),new Z.Span(0,360),"polar"));var u={x:a/2,y:i/2},l=new Z.Attraction(u,0,0),h=new Z.CrossZone(new Z.RectZone(0,0,n.width,n.height),"cross");o.addBehaviour(new Z.Color("random")),o.addBehaviour(l,h),o.addBehaviour(new Z.RandomDrift(10,10,.05)),o.p.x=n.width/2,o.p.y=n.height/2,o.emit("once"),this.proton.addEmitter(o),this.proton.addRenderer(this.createRenderer(n)),this.crossZoneBehaviour=h}},{key:"createRenderer",value:function(n){var a=this,i=n.getContext("2d"),o=new Z.CanvasRenderer(n);return o.onProtonUpdate=function(){i.fillStyle=Yd(a.props.color,.02)||"rgba(0, 0, 0, 0.02)",i.fillRect(0,0,n.width,n.height)},o.onParticleUpdate=function(u){i.beginPath(),i.strokeStyle=u.color,i.lineWidth=1,i.moveTo(u.old.p.x,u.old.p.y),i.lineTo(u.p.x,u.p.y),i.closePath(),i.stroke()},o}},{key:"renderProton",value:function(){this.proton&&this.proton.update()}},{key:"render",value:function(){return Kt.createElement(Va,{bg:this.props.bg,globalCompositeOperation:"darker",onCanvasDidMount:this.onCanvasDidMount.bind(this),onCanvasInited:this.onCanvasInited.bind(this),onResize:this.onResize.bind(this)})}}]),t})(Kt.Component),_E=(function(r){ta(t,r);function t(e){Tr(this,t);var n=ea(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.hue=0,n.index=0,n.colorTemplate="hsla(hue,80%,50%, 0.75)",n.renderProton=n.renderProton.bind(n),n}return kr(t,[{key:"onCanvasDidMount",value:function(n){this.props.color&&(n.style.backgroundColor=this.props.color)}},{key:"onCanvasInited",value:function(n,a,i){this.canvas=n,this.createProton(n,a,i),Ze.add(this.renderProton)}},{key:"onResize",value:function(n,a){this.crossZoneBehaviour.zone.width=n,this.crossZoneBehaviour.zone.height=a,this.proton.renderers[0].resize(n,a)}},{key:"createProton",value:function(n,a,i){this.proton=new Z;var o=new Z.Emitter;o.damping=.008,o.rate=new Z.Rate(this.props.num?this.props.num:150),o.addInitialize(new Z.Mass(1)),o.addInitialize(new Z.Radius(8)),o.addInitialize(new Z.V(new Z.Span(.1,.5),new Z.Span(0,360),"polar")),o.addInitialize(new Z.Position(new Z.CircleZone(n.width/2,n.height/2,100)));var u=new Z.CrossZone(new Z.RectZone(0,0,n.width,n.height),"cross");o.addBehaviour(u),this.repulsion=new Z.Repulsion({x:n.width/2,y:n.height/2-100},3,300),this.attraction=new Z.Attraction({x:n.width/2,y:n.height/2},3,200),o.addBehaviour(this.attraction,this.repulsion),o.addBehaviour(new Z.Color("random")),o.addBehaviour(new Z.RandomDrift(20,15,.15)),o.emit("once"),this.proton.addEmitter(o),this.proton.addRenderer(this.createRenderer(n)),this.crossZoneBehaviour=u}},{key:"createRenderer",value:function(n){var a=this,i=n.getContext("2d"),o=new Z.CanvasRenderer(n);return o.onProtonUpdate=function(){a.hue+=1,i.fillStyle=Yd(a.props.color,.02)||"rgba(0, 0, 0, 0.02)",i.fillRect(0,0,n.width,n.height)},o.onParticleCreated=function(u){u.data.begin=Z.MathUtil.randomAToB(1,120),u.data.tha=Z.MathUtil.randomAToB(0,Math.PI*2)},o.onParticleUpdate=function(u){var l=u.data.begin+a.hue;u.color=a.colorTemplate.replace("hue",l%360);var h=3/4,f=u.radius*(1-h)*Math.cos(u.data.tha+=.01)+u.radius*h;i.beginPath(),i.fillStyle=u.color,i.arc(u.p.x,u.p.y,f,0,Math.PI*2,!0),i.closePath(),i.fill()},o}},{key:"componentWillUnmount",value:function(){try{Ze.remove(this.renderProton),this.proton.destroy()}catch{}}},{key:"renderProton",value:function(){var n=this.canvas;this.proton.update(),this.index%200===0&&(this.attraction.targetPosition.x=Math.random()*n.width,this.attraction.targetPosition.y=Math.random()*n.height,this.repulsion.targetPosition.x=Math.random()*n.width,this.repulsion.targetPosition.y=Math.random()*n.height),this.index++}},{key:"render",value:function(){return Kt.createElement(Va,{bg:this.props.bg,onCanvasDidMount:this.onCanvasDidMount.bind(this),onCanvasInited:this.onCanvasInited.bind(this),onResize:this.onResize.bind(this)})}}]),t})(Kt.Component),AE=(function(r){ta(t,r);function t(e){Tr(this,t);var n=ea(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.colors=["#fad390","#81ecec","#ffffff","#badc58","#f9ca24","#FEA47F"],n.renderProton=n.renderProton.bind(n),n}return kr(t,[{key:"componentWillUnmount",value:function(){try{Ze.remove(this.renderProton),this.proton.destroy()}catch{}}},{key:"onCanvasDidMount",value:function(n){}},{key:"onCanvasInited",value:function(n,a,i){this.createProton(n,a,i),Ze.add(this.renderProton)}},{key:"onResize",value:function(n,a){var i=150;this.crossZoneBehaviour.zone.width=n+2*i,this.crossZoneBehaviour.zone.height=a+2*i,this.proton.renderers[0].resize(n,a)}},{key:"createProton",value:function(n,a,i){this.proton=new Z;var o=new Z.Emitter;o.rate=new Z.Rate(this.props.num?this.props.num:50),o.damping=0,o.addInitialize(new Z.Mass(1)),o.addInitialize(new Z.Radius(4,70)),o.addInitialize(new Z.Velocity(new Z.Span(2,10),new Z.Span(0),"polar")),o.addInitialize(new Z.Position(new Z.LineZone(0,n.height,n.width,n.height)));var u=150,l=new Z.CrossZone(new Z.RectZone(0-u,0-u,n.width+2*u,n.height+2*u),"cross");o.addBehaviour(l),o.addBehaviour(new Z.Alpha(Z.getSpan(.1,.55))),o.addBehaviour(new Z.Color(this.colors)),o.emit("once"),this.proton.addEmitter(o);var h=this.createRenderer(n);this.proton.addRenderer(h),this.crossZoneBehaviour=l,o.preEmit(2)}},{key:"createRenderer",value:function(n){var a=n.getContext("2d"),i=new Z.CustomRenderer;return i.onProtonUpdate=function(){a.clearRect(0,0,n.width,n.height)},i.onParticleCreated=function(o){var u=o.radius||60,l=Z.MathUtil.randomAToB(100,200,"int");o.data.w=u,o.data.h=l},i.onParticleUpdate=function(o){var u=o.data.w,l=o.data.h;a.save(),a.globalAlpha=o.alpha,a.fillStyle=o.color,a.translate(o.p.x,o.p.y),a.rotate(Z.MathUtil.degreeTransform(o.rotation)),a.translate(-o.p.x,-o.p.y),a.beginPath(),a.rect(o.p.x-u/2,o.p.y-l/2,u,l),a.closePath(),a.fill(),a.globalAlpha=1,a.restore()},i}},{key:"renderProton",value:function(){this.proton&&this.proton.update()}},{key:"render",value:function(){return Kt.createElement(Va,{bg:this.props.bg,globalCompositeOperation:"lighter",onCanvasDidMount:this.onCanvasDidMount.bind(this),onCanvasInited:this.onCanvasInited.bind(this),onResize:this.onResize.bind(this)})}}]),t})(Kt.Component),TE=(function(r){ta(t,r);function t(e){Tr(this,t);var n=ea(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.renderProton=n.renderProton.bind(n),n}return kr(t,[{key:"onCanvasInited",value:function(n,a,i){this.createProton(n,a,i),Ze.add(this.renderProton)}},{key:"componentWillUnmount",value:function(){try{Ze.remove(this.renderProton),this.proton.destroy()}catch{}}},{key:"onResize",value:function(n,a){this.crossZoneBehaviour.zone.width=n,this.crossZoneBehaviour.zone.height=a,this.proton.renderers[0].resize(n,a)}},{key:"createProton",value:function(n,a,i){this.proton=new Z;var o=new Z.Emitter;o.rate=new Z.Rate(this.props.num?new Z.Span(this.props.num):new Z.Span(100),new Z.Span(.05,.2)),o.addInitialize(new Z.Mass(1)),o.addInitialize(new Z.Radius(1,4)),o.addInitialize(new Z.Life(1/0));var u=new Z.Position(new Z.RectZone(0,0,a,i));o.addInitialize(u),o.addInitialize(new Z.Velocity(new Z.Span(.3,.6),new Z.Span(0,360),"polar")),o.addBehaviour(new Z.Alpha(Z.getSpan(.2,.9))),o.addBehaviour(new Z.Color(this.props.color||"#333")),this.crossZoneBehaviour=new Z.CrossZone(new Z.RectZone(0,0,a,i),"cross"),o.addBehaviour(this.crossZoneBehaviour),o.emit("once"),o.damping=0,this.proton.addEmitter(o),this.proton.addRenderer(this.createRenderer(n,o))}},{key:"createRenderer",value:function(n,a){var i=this,o=n.getContext("2d"),u=new Z.CanvasRenderer(n),l=140;return u.onProtonUpdateAfter=function(){for(var h=a.particles,f=0;f<h.length;f++)for(var p=f+1;p<h.length;p++){var v=h[f],m=h[p],x=v.p.distanceTo(m.p);if(x<l){var b=(1-x/l)*.5;o.strokeStyle=Yd(i.props.color,b)||"rgba(3, 3, 3, "+b+")",o.beginPath(),o.moveTo(v.p.x,v.p.y),o.lineTo(m.p.x,m.p.y),o.closePath(),o.stroke()}}},u}},{key:"renderProton",value:function(){this.proton&&this.proton.update()}},{key:"render",value:function(){return Kt.createElement(Va,{bg:this.props.bg,globalCompositeOperation:"darker",onCanvasInited:this.onCanvasInited.bind(this),onResize:this.onResize.bind(this)})}}]),t})(Kt.Component),kE=(function(r){ta(t,r);function t(e){Tr(this,t);var n=ea(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.colors=["#74b9ff","#e84393","#6c5ce7","#00b894","#fdcb6e","#006266","#1B1464"],n.renderProton=n.renderProton.bind(n),n}return kr(t,[{key:"componentWillUnmount",value:function(){try{Ze.remove(this.renderProton),this.proton.destroy()}catch{}}},{key:"onCanvasInited",value:function(n,a,i){this.createProton(n,a,i),Ze.add(this.renderProton)}},{key:"onResize",value:function(n,a){this.crossZoneBehaviour.zone.width=n,this.crossZoneBehaviour.zone.height=a,this.proton.renderers[0].resize(n,a)}},{key:"createProton",value:function(n,a,i){this.proton=new Z;var o=new Z.Emitter;o.rate=new Z.Rate(this.props.num||20),o.damping=.008,o.addInitialize(new Z.Mass(1)),o.addInitialize(new Z.Radius(30,600)),o.addInitialize(new Z.Velocity(new Z.Span(.5),new Z.Span(0,360),"polar")),o.addInitialize(new Z.Position(new Z.RectZone(0,0,n.width,n.height)));var u=new Z.CrossZone(new Z.RectZone(0,0,n.width,n.height),"cross");o.addBehaviour(u),o.addBehaviour(new Z.Alpha(Z.getSpan(.35,.55))),o.addBehaviour(new Z.Color(this.getColor())),o.addBehaviour(new Z.RandomDrift(50,50,.5)),o.emit("once"),this.proton.addEmitter(o);var l=new Z.CanvasRenderer(n);this.proton.addRenderer(l),this.crossZoneBehaviour=u}},{key:"getColor",value:function(){var n=this.colors;return this.props.color&&(Array.isArray(this.props.color)?n=this.props.color:n=[this.props.color]),n}},{key:"renderProton",value:function(){this.proton&&this.proton.update()}},{key:"render",value:function(){return Kt.createElement(Va,{bg:this.props.bg,globalCompositeOperation:"darken",onCanvasInited:this.onCanvasInited.bind(this),onResize:this.onResize.bind(this)})}}]),t})(Kt.Component),DE=(function(r){ta(t,r);function t(e){Tr(this,t);var n=ea(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.renderProton=n.renderProton.bind(n),n}return kr(t,[{key:"onCanvasDidMount",value:function(n){}},{key:"onCanvasInited",value:function(n,a,i){this.createProton(n,a,i),this.renderProton()}},{key:"onResize",value:function(n,a){this.crossZoneBehaviour.zone.width=n,this.crossZoneBehaviour.zone.height=a,this.proton.renderers[0].resize(n,a)}},{key:"createProton",value:function(n,a,i){this.proton=new Z;var o=new Z.Emitter;o.damping=.008,o.rate=new Z.Rate(this.props.num?this.props.num:50),o.addInitialize(new Z.Mass(1)),o.addInitialize(new Z.Radius(5,9)),o.addInitialize(new Z.Velocity(new Z.Span(1.5),new Z.Span(0,360),"polar")),o.addInitialize(new Z.Position(new Z.RectZone(0,0,a,i)));var u={x:a/2,y:i/2},l=new Z.Attraction(u,0,0),h=new Z.CrossZone(new Z.RectZone(0,0,n.width,n.height),"bound");o.addBehaviour(new Z.Color(this.props.color||"#bbb")),o.addBehaviour(l,h),o.addBehaviour(new Z.RandomDrift(15,15,.05)),o.emit("once"),this.proton.addEmitter(o),this.proton.addRenderer(this.createRenderer(n)),this.crossZoneBehaviour=h}},{key:"createRenderer",value:function(n){var a=10,i=8,o=n.getContext("2d"),u=new Z.CanvasRenderer(n);u.onProtonUpdate=function(){o.clearRect(0,0,n.width,n.height)},u.onParticleCreated=function(v){v.data.points=[],v.data.index=0},u.onParticleUpdate=function(v){f(v),v.data.index%i===0&&l(v),h(v),v.data.index++};var l=function(m){m.data.points.unshift(m.p.y),m.data.points.unshift(m.p.x),m.data.points.length>a&&(m.data.points.pop(),m.data.points.pop())},h=function(m){o.fillStyle=m.color,o.beginPath(),o.arc(m.p.x,m.p.y,m.radius,0,Math.PI*2,!0),o.closePath(),o.fill()},f=function(m){o.beginPath(),o.strokeStyle=m.color,o.moveTo(m.p.x,m.p.y);for(var x=m.data.points.length,b=0;b<x;b+=2){var E=m.data.points[b],C=m.data.points[b+1];o.lineWidth=p(b,x),o.lineTo(E,C),o.stroke()}},p=function(m,x){if(x<=2)return 1;var b=6,E=(b-1)/(2/x-1),C=1-E,R=(m+2)/x,_=E*R+C;return _=_>>0,_};return u}},{key:"renderProton",value:function(){var n=this;Ze.add(function(){n.proton.update()})}},{key:"render",value:function(){return Kt.createElement(Va,{bg:this.props.bg,globalCompositeOperation:"darker",onCanvasDidMount:this.onCanvasDidMount.bind(this),onCanvasInited:this.onCanvasInited.bind(this),onResize:this.onResize.bind(this)})}}]),t})(Kt.Component),Jj=["#f6b93b","#18dcff","#cd84f1","#ED4C67","#ffffff","#b71540","#32ff7e","#ff3838"],IE=(function(r){ta(t,r);function t(e){Tr(this,t);var n=ea(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.renderProton=n.renderProton.bind(n),n}return kr(t,[{key:"onCanvasInited",value:function(n,a,i){this.createProton(n),this.createEmitter({canvas:n,x:a/2,y:i/2,mainEmitter:!0,zone:"bound"}),Ze.add(this.renderProton)}},{key:"componentWillUnmount",value:function(){try{Ze.remove(this.renderProton),this.proton.destroy()}catch{}}},{key:"onResize",value:function(){}},{key:"createProton",value:function(n){this.proton=new Z;var a=this.createRenderer(n);this.proton.addRenderer(a)}},{key:"createRenderer",value:function(n){var a=n.getContext("2d"),i=new Z.CustomRenderer;i.onProtonUpdate=function(){a.clearRect(0,0,n.width,n.height)},i.onParticleCreated=function(u){u.data.count=Z.MathUtil.randomAToB(3,10,!0)},i.onParticleUpdate=function(u){a.save(),a.globalAlpha=u.alpha,a.fillStyle=u.color,a.translate(u.p.x,u.p.y),a.rotate(Z.MathUtil.degreeTransform(u.rotation)),a.translate(-u.p.x,-u.p.y),a.beginPath(),o(u,u.data.count),a.closePath(),a.fill(),a.globalAlpha=1,a.restore()},i.onParticleDead=function(u){};var o=function(l,h){if(h>=7)a.arc(l.p.x,l.p.y,l.radius,0,Math.PI*2,!0);else for(var f=l.radius,p=0;p<=h;p++){var v=l.p.x+f*Math.cos(Math.PI/180*360/h*p),m=l.p.y+f*Math.sin(Math.PI/180*360/h*p);p===0?a.moveTo(v,m):a.lineTo(v,m)}};return i}},{key:"createEmitter",value:function(n){var a=n.mainEmitter,i=n.canvas,o=n.x,u=n.y,l=n.radius,h=n.color,f=h===void 0?Jj:h,p=n.zone,v=p===void 0?"dead":p,m=n.once,x=m===void 0?"all":m,b=n.alpha,E=b===void 0?.85:b,C=n.gravity,R=C===void 0?3.5:C,_=this.proton.pool.get(Z.Emitter);if(!_.completed){_.rate=new Z.Rate(this.props.num?new Z.Span(this.props.num):new Z.Span(4,9),new Z.Span(1.6,2.2));var A=a?new Z.Radius(10,110):new Z.Radius(3,l);_.addInitialize(new Z.Mass(1)),_.addInitialize(A),_.addInitialize(new Z.Life(3,6)),_.addInitialize(new Z.Velocity(new Z.Span(4,6),new Z.Span(-90,90),"polar")),_.addBehaviour(new Z.Alpha(E,.2)),_.addBehaviour(new Z.Color(f)),_.addBehaviour(new Z.Scale(1,.3)),_.addBehaviour(new Z.Rotate),_.addBehaviour(new Z.Gravity(R)),_.addBehaviour(this.customDeadBehaviour(i)),_.addBehaviour(new Z.CrossZone(new Z.RectZone(0,0,i.width,i.height),v))}_.p.x=o,_.p.y=u,x==="once"?_.emit("once"):_.emit(),this.proton.addEmitter(_)}},{key:"expireEmitter",value:function(n){var a=this;setTimeout(function(){n.completed=!0,a.proton.pool.expire(n),a.proton.removeEmitter(n)},500)}},{key:"customDeadBehaviour",value:function(n){var a=this;return{initialize:function(o){o.data=o.data||{},o.data.oldRadius=o.radius,o.data.emitterCount=0},applyBehaviour:function(o){o.radius<5||o.data.emitterCount>=2||o.radius<=1/3*o.data.oldRadius&&(o.data.emitterCount++,a.createEmitter({canvas:n,x:o.p.x,y:o.p.y,radius:o.radius*(1/2),alpha:.5,gravity:5,color:o.color,once:"once"}))}}}},{key:"renderProton",value:function(){this.proton&&this.proton.update()}},{key:"render",value:function(){return Kt.createElement(Va,{bg:this.props.bg,globalCompositeOperation:"darker",onCanvasInited:this.onCanvasInited.bind(this),onResize:this.onResize.bind(this)})}}]),t})(Kt.Component),NE=(function(r){ta(t,r);function t(e){Tr(this,t);var n=ea(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.colors=["#529B88","#CDD180","#FFFA32","#FB6255","#FB4A53","#FF4E50","#F9D423"],n.renderProton=n.renderProton.bind(n),n}return kr(t,[{key:"componentWillUnmount",value:function(){try{Ze.remove(this.renderProton),this.proton.destroy()}catch{}}},{key:"onCanvasInited",value:function(n,a,i){this.createProton(n,a,i),Ze.add(this.renderProton)}},{key:"onResize",value:function(){}},{key:"createProton",value:function(n,a,i){this.proton=new Z;var o=new Z.Emitter;o.rate=new Z.Rate(this.props.num?new Z.Span(this.props.num):new Z.Span(4,8),new Z.Span(.1,.25)),o.addInitialize(new Z.Mass(1)),o.addInitialize(new Z.Radius(20,200)),o.addInitialize(new Z.Life(2,4)),o.addInitialize(new Z.Velocity(new Z.Span(4,7),new Z.Span(0,360),"polar")),o.addInitialize(new Z.Position(new Z.CircleZone(a/2,i/2,100))),o.addBehaviour(new Z.Alpha(1,0)),o.addBehaviour(new Z.Scale(.2,1)),o.addBehaviour(this.createCustomBehaviour()),o.addBehaviour(new Z.Color(this.colors,"random")),o.emit(),this.proton.addEmitter(o);var u=new Z.CanvasRenderer(n);this.proton.addRenderer(u)}},{key:"createCustomBehaviour",value:function(){var n=1e3;return{initialize:function(i){i.f=new Z.Vector2D(0,0)},applyBehaviour:function(i){var o=i.v.length()/1e3,u=i.v.getGradient();u+=3.14/2,i.f.x=n*o*Math.cos(u),i.f.y=n*o*Math.sin(u),i.a.add(i.f)}}}},{key:"renderProton",value:function(){this.proton&&this.proton.update()}},{key:"render",value:function(){return Kt.createElement(Va,{bg:this.props.bg,globalCompositeOperation:"xor",onCanvasInited:this.onCanvasInited.bind(this),onResize:this.onResize.bind(this)})}}]),t})(Kt.Component),t8=(function(r){ta(t,r);function t(e){return Tr(this,t),ea(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return kr(t,[{key:"getRandom",value:function(){var n=this.props,a=n.num,i=n.bg,o=n.color;return this.random||(this.random=new Qj,this.random.set(.25,Kt.createElement(jm,{num:a,bg:i,color:o})),this.random.set(.2,Kt.createElement(SE,{num:a,bg:i,color:o})),this.random.set(.2,Kt.createElement(RE,{num:a,bg:i,color:o})),this.random.set(.16,Kt.createElement(_E,{num:a,bg:i,color:o})),this.random.set(.18,Kt.createElement(kE,{num:a,bg:i,color:o})),this.random.set(.04,Kt.createElement(TE,{num:a,bg:i,color:o})),this.random.set(.1,Kt.createElement(IE,{num:a,bg:i,color:o})),this.random.set(.08,Kt.createElement(AE,{num:a,bg:i,color:o})),this.random.set(.18,Kt.createElement(DE,{num:a,bg:i,color:o})),this.random.set(.15,Kt.createElement(NE,{num:a,bg:i,color:o}))),this.random.getResult()}},{key:"getBgParticles",value:function(){var n=this.props,a=n.type,i=n.num,o=n.bg,u=n.color,l=n.config,h=void 0;switch(String(a).toLowerCase()){case"color":h=Kt.createElement(jm,{num:i,bg:o,color:u});break;case"ball":h=Kt.createElement(SE,{num:i,bg:o,color:u});break;case"lines":h=Kt.createElement(RE,{num:i,bg:o,color:u});break;case"thick":h=Kt.createElement(_E,{num:i,bg:o,color:u});break;case"circle":h=Kt.createElement(kE,{num:i,bg:o,color:u});break;case"cobweb":h=Kt.createElement(TE,{num:i,bg:o,color:u});break;case"polygon":h=Kt.createElement(IE,{num:i,bg:o,color:u});break;case"square":h=Kt.createElement(AE,{num:i,bg:o,color:u});break;case"tadpole":h=Kt.createElement(DE,{num:i,bg:o,color:u});break;case"fountain":h=Kt.createElement(NE,{num:i,bg:o,color:u});break;case"custom":h=Kt.createElement($j,{bg:o,config:l});break;case"random":h=this.getRandom(i);break;default:h=Kt.createElement(jm,{num:i,bg:o,color:u});break}return h}},{key:"render",value:function(){var n=this.getBgParticles();return Kt.createElement(Kt.Fragment,null,n)}}]),t})(Lc.Component);class e8 extends Kt.Component{constructor(t){super(t),this.state={signInEmail:"",signInPassword:""}}onEmailChange=t=>{this.setState({signInEmail:t.target.value})};onPasswordChange=t=>{this.setState({signInPassword:t.target.value})};onSubmitSignIn=()=>{fetch("https://smart-brain-backend-r92q.onrender.com/signin",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:this.state.signInEmail,password:this.state.signInPassword})}).then(t=>t.json()).then(t=>{t.id&&(this.props.loadUser(t),this.props.onRouteChange("home"))})};render(){const{onRouteChange:t}=this.props;return It.jsx("article",{className:"br3 ba dark-gray b--black-10 mv4 w-100 w-50-m w-25-l mw6 shadow-5 center",children:It.jsx("main",{className:"pa4 black-80",children:It.jsxs("div",{className:"measure",children:[It.jsxs("fieldset",{id:"sign_up",className:"ba b--transparent ph0 mh0",children:[It.jsx("legend",{className:"f1 fw6 ph0 mh0",children:"Sign In"}),It.jsxs("div",{className:"mt3",children:[It.jsx("label",{className:"db fw6 lh-copy f6",htmlFor:"email-address",children:"Email"}),It.jsx("input",{onChange:this.onEmailChange,className:"pa2 input-reset ba bg-transparent hover-bg-black hover-white w-100",type:"email",name:"email-address",id:"email-address"})]}),It.jsxs("div",{className:"mv3",children:[It.jsx("label",{className:"db fw6 lh-copy f6",htmlFor:"password",children:"Password"}),It.jsx("input",{className:"b pa2 input-reset ba bg-transparent hover-bg-black hover-white w-100",type:"password",name:"password",id:"password",onChange:this.onPasswordChange})]})]}),It.jsx("div",{children:It.jsx("input",{onClick:this.onSubmitSignIn,className:"b ph3 pv2 input-reset ba b--black bg-transparent grow pointer f6 dib",type:"submit",value:"Sign in"})}),It.jsx("div",{className:"lh-copy mt3",children:It.jsx("p",{onClick:()=>t("register"),className:"f6 link dim black db pointer",children:"Register"})})]})})})}}class n8 extends Kt.Component{constructor(t){super(t),this.state={email:"",password:"",name:""}}onNameChange=t=>{this.setState({name:t.target.value})};onEmailChange=t=>{this.setState({email:t.target.value})};onPasswordChange=t=>{this.setState({password:t.target.value})};onSubmitSignIn=()=>{fetch("https://smart-brain-backend-r92q.onrender.com/register",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:this.state.email,password:this.state.password,name:this.state.name})}).then(t=>t.json()).then(t=>{t.id&&(this.props.loadUser(t),this.props.onRouteChange("home"))})};render(){return It.jsx("article",{className:"br3 ba dark-gray b--black-10 mv4 w-100 w-50-m w-25-l mw6 shadow-5 center",children:It.jsx("main",{className:"pa4 black-80",children:It.jsxs("div",{className:"measure",children:[It.jsxs("fieldset",{id:"sign_up",className:"ba b--transparent ph0 mh0",children:[It.jsx("legend",{className:"f1 fw6 ph0 mh0",children:"Register"}),It.jsxs("div",{className:"mt3",children:[It.jsx("label",{className:"db fw6 lh-copy f6",htmlFor:"name",children:"Name"}),It.jsx("input",{className:"pa2 input-reset ba bg-transparent hover-bg-black hover-white w-100",type:"text",name:"name",id:"name",onChange:this.onNameChange})]}),It.jsxs("div",{className:"mt3",children:[It.jsx("label",{className:"db fw6 lh-copy f6",htmlFor:"email-address",children:"Email"}),It.jsx("input",{className:"pa2 input-reset ba bg-transparent hover-bg-black hover-white w-100",type:"email",name:"email-address",id:"email-address",onChange:this.onEmailChange})]}),It.jsxs("div",{className:"mv3",children:[It.jsx("label",{className:"db fw6 lh-copy f6",htmlFor:"password",children:"Password"}),It.jsx("input",{className:"b pa2 input-reset ba bg-transparent hover-bg-black hover-white w-100",type:"password",name:"password",id:"password",onChange:this.onPasswordChange})]})]}),It.jsx("div",{children:It.jsx("input",{onClick:this.onSubmitSignIn,className:"b ph3 pv2 input-reset ba b--black bg-transparent grow pointer f6 dib",type:"submit",value:"Register"})})]})})})}}window.process=ME;window.global=window;const OE={input:"",imageUrl:"",boxes:[],route:"signin",isSignedIn:!1,modelsLoaded:!1,user:{id:"",name:"",password:"",email:"",entries:0,joined:""}};class r8 extends Lc.Component{constructor(){super(),this.state=OE}async componentDidMount(){try{await Zr.tinyFaceDetector.loadFromUri("/Smart-Brain-FrontEnd/models"),this.setState({modelsLoaded:!0}),console.log(" Face API models loaded")}catch(t){console.error("Error loading face-api models:",t)}}loadUser=t=>{this.setState({user:{id:t.id,name:t.name,email:t.email,entries:t.entries,joined:t.joined}})};detectFaces=async()=>{const t=document.getElementById("inputimage");if(t)try{const e=await Oj(t,new W_);if(!e.length){this.setState({boxes:[]});return}const n={width:t.width,height:t.height},i=$_(e,n).map(o=>({leftCol:o.box.x,topRow:o.box.y,width:o.box.width,height:o.box.height}));this.displayFaceBox(i)}catch(e){console.error("Face detection error:",e)}};displayFaceBox=t=>{this.setState({boxes:t})};onInputChange=t=>{this.setState({input:t.target.value})};onButtonSubmit=async()=>{if(!this.state.modelsLoaded){alert("Please wait  models are still loading.");return}this.setState({imageUrl:this.state.input},async()=>{if(setTimeout(()=>{this.detectFaces()},500),this.state.user.id)try{const e=await(await fetch("https://smart-brain-backend-r92q.onrender.com/image",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:this.state.user.id})})).json();this.setState(Object.assign(this.state.user,{entries:e}))}catch(t){console.log(t)}})};onRouteChange=t=>{t==="signout"?this.setState({...OE,modelsLoaded:!0}):t==="home"&&this.setState({isSignedIn:!0}),this.setState({route:t})};render(){const{isSignedIn:t,imageUrl:e,route:n,boxes:a,modelsLoaded:i}=this.state;return It.jsxs("div",{className:"App",children:[It.jsx(t8,{type:"cobweb",bg:!0}),It.jsx(Bj,{isSignedIn:t,onRouteChange:this.onRouteChange}),!i&&It.jsx("div",{style:{position:"fixed",inset:0,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"rgba(255,255,255,0.9)",zIndex:9999},children:It.jsx("h2",{children:"Loading face detection model..."})}),n==="home"?It.jsxs("div",{children:[It.jsx(Wj,{}),It.jsx(Gj,{name:this.state.user.name,entries:this.state.user.entries}),It.jsx(Vj,{onInputChange:this.onInputChange,onButtonSubmit:this.onButtonSubmit}),It.jsx(Pj,{boxes:a,imageUrl:e})]}):n==="signin"?It.jsx(e8,{loadUser:this.loadUser,onRouteChange:this.onRouteChange}):It.jsx(n8,{loadUser:this.loadUser,onRouteChange:this.onRouteChange})]})}}window.process=ME;window.global=window;pk.createRoot(document.getElementById("root")).render(It.jsx(Lc.StrictMode,{children:It.jsx(r8,{})}))});export default a8();
